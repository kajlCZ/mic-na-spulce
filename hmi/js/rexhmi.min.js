(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.REX=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){module.exports={name:"REX HMI",version:"2.50.10-12359",created:"2020-07-02 12:38"}},{}],2:[function(require,module,exports){module.exports.Init=require("./src/index.js");module.exports.UTIL=require("./src/utils/utils.js");module.exports.UTIL.Logger=require("./src/utils/Logger.js");module.exports.WS={Group:require("./src/group-management/Group.js"),Item:require("./src/group-management/Item.js"),Trend:require("./src/group-management/Trend.js")};module.exports.WS.Client=require("./src/ws-client/Client.js");module.exports.Watch={};module.exports.Watch.Engine=require("./src/webwatch/Engine.js");module.exports.HMI=require("./src/hmi.js");module.exports.WebBuDi=require("./src/webbudi/WebBuDi.js");module.exports.WebWatch=require("./src/webwatch/Engine.js");module.exports.UI={COLORS:require("./src/utils/Constants.js").COLORS,SVG:{SVGManager:require("./src/ui/svg/SVGManager.js"),Component:require("./src/ui/svg/SVGComponent.js"),HTMLComponent:require("./src/ui/svg/HTMLComponent"),Modules:{HMIConfig:require("./src/ui/svg/HMIConfig.js"),Trend:require("./src/ui/svg/SVGGraph.js"),TRND:require("./src/ui/svg/TRND.js")}}};module.exports.HELPERS=require("./src/utils/utils.js");module.exports.VERSION=require("./build-version.js")},{"./build-version.js":1,"./src/group-management/Group.js":102,"./src/group-management/Item.js":103,"./src/group-management/Trend.js":106,"./src/hmi.js":112,"./src/index.js":113,"./src/ui/svg/HMIConfig.js":121,"./src/ui/svg/HTMLComponent":122,"./src/ui/svg/SVGComponent.js":123,"./src/ui/svg/SVGGraph.js":124,"./src/ui/svg/SVGManager.js":125,"./src/ui/svg/TRND.js":126,"./src/utils/Constants.js":127,"./src/utils/Logger.js":131,"./src/utils/utils.js":134,"./src/webbudi/WebBuDi.js":138,"./src/webwatch/Engine.js":151,"./src/ws-client/Client.js":158}],3:[function(require,module,exports){(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory();else if(typeof define==="function"&&define.amd)define([],factory);else if(typeof exports==="object")exports["Tree"]=factory();else root["Tree"]=factory()})(window,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=0)}([function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=Tree;var _ajax=_interopRequireDefault(__webpack_require__(1));__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function deepClone(obj){return JSON.parse(JSON.stringify(obj))}function uniq(arr){var map={};return arr.reduce(function(acc,item){if(!map[item]){map[item]=true;acc.push(item)}return acc},[])}function empty(ele){while(ele.firstChild){ele.removeChild(ele.firstChild)}}function animation(duration,callback){requestAnimationFrame(function(){callback.enter();requestAnimationFrame(function(){callback.active();setTimeout(function(){callback.leave()},duration)})})}function Tree(container,options){var _this=this;var defaultOptions={selectMode:"checkbox",values:[],disables:[],beforeLoad:null,loaded:null,url:null,method:"GET",closeDepth:null};this.treeNodes=[];this.nodesById={};this.leafNodesById={};this.liElementsById={};this.willUpdateNodesById={};this.container=container;this.options=Object.assign(defaultOptions,options);Object.defineProperties(this,{values:{get:function get(){return this.getValues()},set:function set(values){return this.setValues(uniq(values))}},disables:{get:function get(){return this.getDisables()},set:function set(values){return this.setDisables(uniq(values))}},selectedNodes:{get:function get(){var nodes=[];var nodesById=this.nodesById;for(var id in nodesById){if(nodesById.hasOwnProperty(id)&&(nodesById[id].status===1||nodesById[id].status===2)){var node=Object.assign({},nodesById[id]);delete node.parent;delete node.children;nodes.push(node)}}return nodes}},disabledNodes:{get:function get(){var nodes=[];var nodesById=this.nodesById;for(var id in nodesById){if(nodesById.hasOwnProperty(id)&&nodesById[id].disabled){var node=Object.assign({},nodesById[id]);delete node.parent;nodes.push(node)}}return nodes}}});if(this.options.url){this.load(function(data){_this.init(data)})}else{this.init(this.options.data)}}Tree.prototype.init=function(data){var _Tree$parseTreeData=Tree.parseTreeData(data),treeNodes=_Tree$parseTreeData.treeNodes,nodesById=_Tree$parseTreeData.nodesById,leafNodesById=_Tree$parseTreeData.leafNodesById,defaultValues=_Tree$parseTreeData.defaultValues,defaultDisables=_Tree$parseTreeData.defaultDisables;this.treeNodes=treeNodes;this.nodesById=nodesById;this.leafNodesById=leafNodesById;this.render(this.treeNodes);var _this$options=this.options,values=_this$options.values,disables=_this$options.disables,loaded=_this$options.loaded;if(values&&values.length)defaultValues=values;defaultValues.length&&this.setValues(defaultValues);if(disables&&disables.length)defaultDisables=disables;defaultDisables.length&&this.setDisables(defaultDisables);loaded&&loaded.call(this)};Tree.prototype.load=function(callback){var _this$options2=this.options,url=_this$options2.url,method=_this$options2.method,beforeLoad=_this$options2.beforeLoad;(0,_ajax.default)({url:url,method:method,success:function success(result){var data=result;if(beforeLoad){data=beforeLoad(result)}callback(data)}})};Tree.prototype.render=function(treeNodes){var treeEle=Tree.createRootEle();treeEle.appendChild(this.buildTree(treeNodes,0));this.bindEvent(treeEle);var ele=null;if(this.container instanceof HTMLElement){ele=this.container}else{ele=document.querySelector(this.container)}empty(ele);ele.appendChild(treeEle)};Tree.prototype.buildTree=function(nodes,depth){var _this2=this;var rootUlEle=Tree.createUlEle();if(nodes&&nodes.length){nodes.forEach(function(node){var liEle=Tree.createLiEle(node,depth===_this2.options.closeDepth-1);_this2.liElementsById[node.id]=liEle;var ulEle=null;if(node.children&&node.children.length){ulEle=_this2.buildTree(node.children,depth+1)}ulEle&&liEle.appendChild(ulEle);rootUlEle.appendChild(liEle)})}return rootUlEle};Tree.prototype.bindEvent=function(ele){var _this3=this;ele.addEventListener("click",function(e){var target=e.target;if(target.nodeName==="SPAN"&&(target.classList.contains("treejs-checkbox")||target.classList.contains("treejs-label"))){_this3.onItemClick(target.parentNode.nodeId)}else if(target.nodeName==="LI"&&target.classList.contains("treejs-node")){_this3.onItemClick(target.nodeId)}else if(target.nodeName==="SPAN"&&target.classList.contains("treejs-switcher")){_this3.onSwitcherClick(target)}},false)};Tree.prototype.onItemClick=function(id){var node=this.nodesById[id];var onChange=this.options.onChange;if(!node.disabled){this.setValue(id);this.updateLiElements()}onChange&&onChange.call(this)};Tree.prototype.setValue=function(value){var node=this.nodesById[value];if(!node)return;var prevStatus=node.status;var status=prevStatus===1||prevStatus===2?0:2;node.status=status;this.markWillUpdateNode(node);this.walkUp(node,"status");this.walkDown(node,"status")};Tree.prototype.getValues=function(){var values=[];for(var id in this.leafNodesById){if(this.leafNodesById.hasOwnProperty(id)){if(this.leafNodesById[id].status===1||this.leafNodesById[id].status===2){values.push(id)}}}return values};Tree.prototype.setValues=function(values){var _this4=this;this.emptyNodesCheckStatus();values.forEach(function(value){_this4.setValue(value)});this.updateLiElements();var onChange=this.options.onChange;onChange&&onChange.call(this)};Tree.prototype.setDisable=function(value){var node=this.nodesById[value];if(!node)return;var prevDisabled=node.disabled;if(!prevDisabled){node.disabled=true;this.markWillUpdateNode(node);this.walkUp(node,"disabled");this.walkDown(node,"disabled")}};Tree.prototype.getDisables=function(){var values=[];for(var id in this.leafNodesById){if(this.leafNodesById.hasOwnProperty(id)){if(this.leafNodesById[id].disabled){values.push(id)}}}return values};Tree.prototype.setDisables=function(values){var _this5=this;this.emptyNodesDisable();values.forEach(function(value){_this5.setDisable(value)});this.updateLiElements()};Tree.prototype.emptyNodesCheckStatus=function(){this.willUpdateNodesById=this.getSelectedNodesById();Object.values(this.willUpdateNodesById).forEach(function(node){if(!node.disabled)node.status=0})};Tree.prototype.emptyNodesDisable=function(){this.willUpdateNodesById=this.getDisabledNodesById();Object.values(this.willUpdateNodesById).forEach(function(node){node.disabled=false})};Tree.prototype.getSelectedNodesById=function(){return Object.entries(this.nodesById).reduce(function(acc,_ref){var _ref2=_slicedToArray(_ref,2),id=_ref2[0],node=_ref2[1];if(node.status===1||node.status===2){acc[id]=node}return acc},{})};Tree.prototype.getDisabledNodesById=function(){return Object.entries(this.nodesById).reduce(function(acc,_ref3){var _ref4=_slicedToArray(_ref3,2),id=_ref4[0],node=_ref4[1];if(node.disabled){acc[id]=node}return acc},{})};Tree.prototype.updateLiElements=function(){var _this6=this;Object.values(this.willUpdateNodesById).forEach(function(node){_this6.updateLiElement(node)});this.willUpdateNodesById={}};Tree.prototype.markWillUpdateNode=function(node){this.willUpdateNodesById[node.id]=node};Tree.prototype.onSwitcherClick=function(target){var liEle=target.parentNode;var ele=liEle.lastChild;var height=ele.scrollHeight;if(liEle.classList.contains("treejs-node__close")){animation(150,{enter:function enter(){ele.style.height=0;ele.style.opacity=0},active:function active(){ele.style.height="".concat(height,"px");ele.style.opacity=1},leave:function leave(){ele.style.height="";ele.style.opacity="";liEle.classList.remove("treejs-node__close")}})}else{animation(150,{enter:function enter(){ele.style.height="".concat(height,"px");ele.style.opacity=1},active:function active(){ele.style.height=0;ele.style.opacity=0},leave:function leave(){ele.style.height="";ele.style.opacity="";liEle.classList.add("treejs-node__close")}})}};Tree.prototype.walkUp=function(node,changeState){var parent=node.parent;if(parent){if(changeState==="status"){var pStatus=null;var statusCount=parent.children.reduce(function(acc,child){if(!isNaN(child.status))return acc+child.status;return acc},0);if(statusCount){pStatus=statusCount===parent.children.length*2?2:1}else{pStatus=0}if(parent.status===pStatus)return;parent.status=pStatus}else{var pDisabled=parent.children.reduce(function(acc,child){return acc&&child.disabled},true);if(parent.disabled===pDisabled)return;parent.disabled=pDisabled}this.markWillUpdateNode(parent);this.walkUp(parent,changeState)}};Tree.prototype.walkDown=function(node,changeState){var _this7=this;if(node.children&&node.children.length){node.children.forEach(function(child){if(changeState==="status"&&child.disabled)return;child[changeState]=node[changeState];_this7.markWillUpdateNode(child);_this7.walkDown(child,changeState)})}};Tree.prototype.updateLiElement=function(node){var classList=this.liElementsById[node.id].classList;switch(node.status){case 0:classList.remove("treejs-node__halfchecked","treejs-node__checked");break;case 1:classList.remove("treejs-node__checked");classList.add("treejs-node__halfchecked");break;case 2:classList.remove("treejs-node__halfchecked");classList.add("treejs-node__checked");break}switch(node.disabled){case true:if(!classList.contains("treejs-node__disabled"))classList.add("treejs-node__disabled");break;case false:if(classList.contains("treejs-node__disabled"))classList.remove("treejs-node__disabled");break}};Tree.parseTreeData=function(data){var treeNodes=deepClone(data);var nodesById={};var leafNodesById={};var values=[];var disables=[];var walkTree=function walkTree(nodes,parent){nodes.forEach(function(node){nodesById[node.id]=node;if(node.checked)values.push(node.id);if(node.disabled)disables.push(node.id);if(parent)node.parent=parent;if(node.children&&node.children.length){walkTree(node.children,node)}else{leafNodesById[node.id]=node}})};walkTree(treeNodes);return{treeNodes:treeNodes,nodesById:nodesById,leafNodesById:leafNodesById,defaultValues:values,defaultDisables:disables}};Tree.createRootEle=function(){var div=document.createElement("div");div.classList.add("treejs");return div};Tree.createUlEle=function(){var ul=document.createElement("ul");ul.classList.add("treejs-nodes");return ul};Tree.createLiEle=function(node,closed){var li=document.createElement("li");li.classList.add("treejs-node");if(closed)li.classList.add("treejs-node__close");if(node.children&&node.children.length){var switcher=document.createElement("span");switcher.classList.add("treejs-switcher");li.appendChild(switcher)}else{li.classList.add("treejs-placeholder")}var checkbox=document.createElement("span");checkbox.classList.add("treejs-checkbox");li.appendChild(checkbox);if(node.color){var line=document.createElement("div");line.classList.add("treejs-line");line.style["border-color"]=node.color;li.appendChild(line)}var label=document.createElement("span");label.classList.add("treejs-label");if(node.color){label.style.color=node.color}var text=document.createTextNode(node.text);label.appendChild(text);li.appendChild(label);li.nodeId=node.id;return li}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=_default;function _default(_options){var defaultOptions={method:"GET",url:"",async:true,success:null,failed:null,"Content-Type":"application/json; charset=utf-8"};var options=Object.assign(defaultOptions,_options);var xhq=new XMLHttpRequest;var params=[];for(var key in options.data){if(options.data.hasOwnProperty(key)){params.push(key+"="+options.data[key])}}var postData=params.join("&");if(options.method.toUpperCase()==="POST"){xhq.open(options.method,options.url,options.async);xhq.setRequestHeader("Content-Type",options["Content-Type"]);xhq.send(postData)}else if(options.method.toUpperCase()==="GET"){var url=options.url;if(postData){if(url.indexOf("?")!==-1){url+="&"+postData}else{url+="?"+postData}}xhq.open(options.method,url,options.async);xhq.setRequestHeader("Content-Type",options["Content-Type"]);xhq.send(null)}xhq.onreadystatechange=function(){if(xhq.readyState===4&&xhq.status===200){var res=xhq.responseText;if(options["Content-Type"]===defaultOptions["Content-Type"]){res=JSON.parse(res)}options.success&&options.success(res)}else{options.failed&&options.failed(xhq.status)}}}},function(module,exports,__webpack_require__){var content=__webpack_require__(3);if(typeof content==="string")content=[[module.i,content,""]];var transform;var insertInto;var options={hmr:true};options.transform=transform;options.insertInto=undefined;var update=__webpack_require__(5)(content,options);if(content.locals)module.exports=content.locals;if(false){}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(4)(false);exports.push([module.i,".treejs {\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  font-size: 0.5em;\n}\n.treejs *:after,\n.treejs *:before {\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n.treejs > .treejs-node {\n  padding-left: 0;\n}\n.treejs .treejs-nodes {\n  list-style: none;\n  padding-left: 20px;\n  overflow: hidden;\n  -webkit-transition: height 150ms ease-out, opacity 150ms ease-out;\n  -o-transition: height 150ms ease-out, opacity 150ms ease-out;\n  transition: height 150ms ease-out, opacity 150ms ease-out;\n}\n.treejs > .treejs-nodes {\n  padding-left: 0;\n}\n.treejs .treejs-node {\n  cursor: pointer;\n  overflow: hidden;\n}\n.treejs .treejs-node.treejs-placeholder {\n  padding-left: 5px;\n}\n.treejs .treejs-switcher {\n  display: inline-block;\n  vertical-align: middle;\n  width: 20px;\n  height: 20px;\n  cursor: pointer;\n  position: relative;\n  -webkit-transition: -webkit-transform 150ms ease-out;\n  transition: -webkit-transform 150ms ease-out;\n  -o-transition: transform 150ms ease-out;\n  transition: transform 150ms ease-out;\n  transition: transform 150ms ease-out, -webkit-transform 150ms ease-out;\n}\n.treejs .treejs-switcher:before {\n  position: absolute;\n  top: 8px;\n  left: 6px;\n  display: block;\n  content: ' ';\n  border: 4px solid transparent;\n  border-top: 4px solid rgba(0, 0, 0, 0.4);\n  -webkit-transition: border-color 150ms;\n  -o-transition: border-color 150ms;\n  transition: border-color 150ms;\n}\n.treejs .treejs-switcher:hover:before {\n  border-top: 4px solid rgba(0, 0, 0, 0.65);\n}\n.treejs .treejs-node__close > .treejs-switcher {\n  -webkit-transform: rotate(-90deg);\n      -ms-transform: rotate(-90deg);\n          transform: rotate(-90deg);\n}\n.treejs .treejs-node__close > .treejs-nodes {\n  height: 0;\n}\n.treejs .treejs-line {\n  display: inline-block;\n  position: relative;\n  bottom: 0.5ex;\n  padding-left: 1em;\n  margin-right: 0.25em;\n  height: 1px;\n  border-bottom: 2px solid #000000;\n}\n.treejs .treejs-checkbox {\n  display: inline-block;\n  vertical-align: middle;\n  width: 20px;\n  height: 20px;\n  cursor: pointer;\n  position: relative;\n}\n.treejs .treejs-checkbox:before {\n  -webkit-transition: all 0.3s;\n  -o-transition: all 0.3s;\n  transition: all 0.3s;\n  cursor: pointer;\n  position: absolute;\n  top: 2px;\n  content: ' ';\n  display: block;\n  width: 16px;\n  height: 16px;\n  border: 1px solid var(--rex-color-icon, #b6bab7);\n  border-radius: 2px;\n}\n.treejs .treejs-checkbox:hover:before {\n  -webkit-box-shadow: 0 0 2px 1px var(--rex-input-background-color, #ffffff);\n          box-shadow: 0 0 2px 1px var(--rex-input-background-color, #ffffff);\n}\n.treejs .treejs-node__checked > .treejs-checkbox:before {\n  background-color: var(--rex-input-background-color, #ffffff);\n  border-color: var(--rex-color-icon, #b6bab7);\n}\n.treejs .treejs-node__checked > .treejs-checkbox:after {\n  position: absolute;\n  content: ' ';\n  display: block;\n  top: 4px;\n  left: 5px;\n  width: 5px;\n  height: 9px;\n  border: 2px solid #000000;\n  border-top: none;\n  border-left: none;\n  -webkit-transform: rotate(45deg);\n      -ms-transform: rotate(45deg);\n          transform: rotate(45deg);\n}\n.treejs .treejs-node__halfchecked > .treejs-checkbox:before {\n  background-color: var(--rex-input-background-color, #ffffff);\n  border-color: var(--rex-color-icon, #b6bab7);\n}\n.treejs .treejs-node__halfchecked > .treejs-checkbox:after {\n  position: absolute;\n  content: ' ';\n  display: block;\n  top: 9px;\n  left: 3px;\n  width: 10px;\n  height: 2px;\n  background-color: #000000;\n}\n.treejs .treejs-node__disabled {\n  cursor: not-allowed;\n  color: rgba(0, 0, 0, 0.25);\n}\n.treejs .treejs-node__disabled .treejs-checkbox {\n  cursor: not-allowed;\n}\n.treejs .treejs-node__disabled .treejs-checkbox:before {\n  cursor: not-allowed;\n  border-color: var(--rex-color-icon, #b6bab7) !important;\n  background-color: var(--color-inactive, #f2f4f4) !important;\n}\n.treejs .treejs-node__disabled .treejs-checkbox:hover:before {\n  -webkit-box-shadow: none !important;\n          box-shadow: none !important;\n}\n.treejs .treejs-node__disabled .treejs-node__checked > .treejs-checkbox:after {\n  border-color: var(--rex-color-icon, #b6bab7);\n}\n.treejs .treejs-node__disabled .treejs-node__halfchecked > .treejs-checkbox:after {\n  background-color: var(--rex-color-icon, #b6bab7);\n}\n.treejs .treejs-node__disabled.treejs-node__checked > .treejs-checkbox:after {\n  border-color: var(--rex-color-icon, #b6bab7);\n}\n.treejs .treejs-node__disabled.treejs-node__halfchecked > .treejs-checkbox:after {\n  background-color: var(--rex-color-icon, #b6bab7);\n}\n.treejs .treejs-label {\n  vertical-align: middle;\n}\n",""])},function(module,exports){module.exports=function(useSourceMap){var list=[];list.toString=function toString(){return this.map(function(item){var content=cssWithMappingToString(item,useSourceMap);if(item[2]){return"@media "+item[2]+"{"+content+"}"}else{return content}}).join("")};list.i=function(modules,mediaQuery){if(typeof modules==="string")modules=[[null,modules,""]];var alreadyImportedModules={};for(var i=0;i<this.length;i++){var id=this[i][0];if(typeof id==="number")alreadyImportedModules[id]=true}for(i=0;i<modules.length;i++){var item=modules[i];if(typeof item[0]!=="number"||!alreadyImportedModules[item[0]]){if(mediaQuery&&!item[2]){item[2]=mediaQuery}else if(mediaQuery){item[2]="("+item[2]+") and ("+mediaQuery+")"}list.push(item)}}};return list};function cssWithMappingToString(item,useSourceMap){var content=item[1]||"";var cssMapping=item[3];if(!cssMapping){return content}if(useSourceMap&&typeof btoa==="function"){var sourceMapping=toComment(cssMapping);var sourceURLs=cssMapping.sources.map(function(source){return"/*# sourceURL="+cssMapping.sourceRoot+source+" */"});return[content].concat(sourceURLs).concat([sourceMapping]).join("\n")}return[content].join("\n")}function toComment(sourceMap){var base64=btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));var data="sourceMappingURL=data:application/json;charset=utf-8;base64,"+base64;return"/*# "+data+" */"}},function(module,exports,__webpack_require__){var stylesInDom={};var memoize=function(fn){var memo;return function(){if(typeof memo==="undefined")memo=fn.apply(this,arguments);return memo}};var isOldIE=memoize(function(){return window&&document&&document.all&&!window.atob});var getTarget=function(target){return document.querySelector(target)};var getElement=function(fn){var memo={};return function(target){if(typeof target==="function"){return target()}if(typeof memo[target]==="undefined"){var styleTarget=getTarget.call(this,target);if(window.HTMLIFrameElement&&styleTarget instanceof window.HTMLIFrameElement){try{styleTarget=styleTarget.contentDocument.head}catch(e){styleTarget=null}}memo[target]=styleTarget}return memo[target]}}();var singleton=null;var singletonCounter=0;var stylesInsertedAtTop=[];var fixUrls=__webpack_require__(6);module.exports=function(list,options){if(typeof DEBUG!=="undefined"&&DEBUG){if(typeof document!=="object")throw new Error("The style-loader cannot be used in a non-browser environment")}options=options||{};options.attrs=typeof options.attrs==="object"?options.attrs:{};if(!options.singleton&&typeof options.singleton!=="boolean")options.singleton=isOldIE();if(!options.insertInto)options.insertInto="head";if(!options.insertAt)options.insertAt="bottom";var styles=listToStyles(list,options);addStylesToDom(styles,options);return function update(newList){var mayRemove=[];for(var i=0;i<styles.length;i++){var item=styles[i];var domStyle=stylesInDom[item.id];domStyle.refs--;mayRemove.push(domStyle)}if(newList){var newStyles=listToStyles(newList,options);addStylesToDom(newStyles,options)}for(var i=0;i<mayRemove.length;i++){var domStyle=mayRemove[i];if(domStyle.refs===0){for(var j=0;j<domStyle.parts.length;j++)domStyle.parts[j]();delete stylesInDom[domStyle.id]}}}};function addStylesToDom(styles,options){for(var i=0;i<styles.length;i++){var item=styles[i];var domStyle=stylesInDom[item.id];if(domStyle){domStyle.refs++;for(var j=0;j<domStyle.parts.length;j++){domStyle.parts[j](item.parts[j])}for(;j<item.parts.length;j++){domStyle.parts.push(addStyle(item.parts[j],options))}}else{var parts=[];for(var j=0;j<item.parts.length;j++){parts.push(addStyle(item.parts[j],options))}stylesInDom[item.id]={id:item.id,refs:1,parts:parts}}}}function listToStyles(list,options){var styles=[];var newStyles={};for(var i=0;i<list.length;i++){var item=list[i];var id=options.base?item[0]+options.base:item[0];var css=item[1];var media=item[2];var sourceMap=item[3];var part={css:css,media:media,sourceMap:sourceMap};if(!newStyles[id])styles.push(newStyles[id]={id:id,parts:[part]});else newStyles[id].parts.push(part)}return styles}function insertStyleElement(options,style){var target=getElement(options.insertInto);if(!target){throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.")}var lastStyleElementInsertedAtTop=stylesInsertedAtTop[stylesInsertedAtTop.length-1];if(options.insertAt==="top"){if(!lastStyleElementInsertedAtTop){target.insertBefore(style,target.firstChild)}else if(lastStyleElementInsertedAtTop.nextSibling){target.insertBefore(style,lastStyleElementInsertedAtTop.nextSibling)}else{target.appendChild(style)}stylesInsertedAtTop.push(style)}else if(options.insertAt==="bottom"){target.appendChild(style)}else if(typeof options.insertAt==="object"&&options.insertAt.before){var nextSibling=getElement(options.insertInto+" "+options.insertAt.before);target.insertBefore(style,nextSibling)}else{throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n")}}function removeStyleElement(style){if(style.parentNode===null)return false;style.parentNode.removeChild(style);var idx=stylesInsertedAtTop.indexOf(style);if(idx>=0){stylesInsertedAtTop.splice(idx,1)}}function createStyleElement(options){var style=document.createElement("style");if(options.attrs.type===undefined){options.attrs.type="text/css"}addAttrs(style,options.attrs);insertStyleElement(options,style);return style}function createLinkElement(options){var link=document.createElement("link");if(options.attrs.type===undefined){options.attrs.type="text/css"}options.attrs.rel="stylesheet";addAttrs(link,options.attrs);insertStyleElement(options,link);return link}function addAttrs(el,attrs){Object.keys(attrs).forEach(function(key){el.setAttribute(key,attrs[key])})}function addStyle(obj,options){var style,update,remove,result;if(options.transform&&obj.css){result=options.transform(obj.css);if(result){obj.css=result}else{return function(){}}}if(options.singleton){var styleIndex=singletonCounter++;style=singleton||(singleton=createStyleElement(options));update=applyToSingletonTag.bind(null,style,styleIndex,false);remove=applyToSingletonTag.bind(null,style,styleIndex,true)}else if(obj.sourceMap&&typeof URL==="function"&&typeof URL.createObjectURL==="function"&&typeof URL.revokeObjectURL==="function"&&typeof Blob==="function"&&typeof btoa==="function"){style=createLinkElement(options);update=updateLink.bind(null,style,options);remove=function(){removeStyleElement(style);if(style.href)URL.revokeObjectURL(style.href)}}else{style=createStyleElement(options);update=applyToTag.bind(null,style);remove=function(){removeStyleElement(style)}}update(obj);return function updateStyle(newObj){if(newObj){if(newObj.css===obj.css&&newObj.media===obj.media&&newObj.sourceMap===obj.sourceMap){return}update(obj=newObj)}else{remove()}}}var replaceText=function(){var textStore=[];return function(index,replacement){textStore[index]=replacement;return textStore.filter(Boolean).join("\n")}}();function applyToSingletonTag(style,index,remove,obj){var css=remove?"":obj.css;if(style.styleSheet){style.styleSheet.cssText=replaceText(index,css)}else{var cssNode=document.createTextNode(css);var childNodes=style.childNodes;if(childNodes[index])style.removeChild(childNodes[index]);if(childNodes.length){style.insertBefore(cssNode,childNodes[index])}else{style.appendChild(cssNode)}}}function applyToTag(style,obj){var css=obj.css;var media=obj.media;if(media){style.setAttribute("media",media)}if(style.styleSheet){style.styleSheet.cssText=css}else{while(style.firstChild){style.removeChild(style.firstChild)}style.appendChild(document.createTextNode(css))}}function updateLink(link,options,obj){var css=obj.css;var sourceMap=obj.sourceMap;var autoFixUrls=options.convertToAbsoluteUrls===undefined&&sourceMap;if(options.convertToAbsoluteUrls||autoFixUrls){css=fixUrls(css)}if(sourceMap){css+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))))+" */"}var blob=new Blob([css],{type:"text/css"});var oldSrc=link.href;link.href=URL.createObjectURL(blob);if(oldSrc)URL.revokeObjectURL(oldSrc)}},function(module,exports){module.exports=function(css){var location=typeof window!=="undefined"&&window.location;if(!location){throw new Error("fixUrls requires window.location")}if(!css||typeof css!=="string"){return css}var baseUrl=location.protocol+"//"+location.host;var currentDir=baseUrl+location.pathname.replace(/\/[^\/]*$/,"/");var fixedCss=css.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(fullMatch,origUrl){var unquotedOrigUrl=origUrl.trim().replace(/^"(.*)"$/,function(o,$1){return $1}).replace(/^'(.*)'$/,function(o,$1){return $1});if(/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(unquotedOrigUrl)){return fullMatch}var newUrl;if(unquotedOrigUrl.indexOf("//")===0){newUrl=unquotedOrigUrl}else if(unquotedOrigUrl.indexOf("/")===0){newUrl=baseUrl+unquotedOrigUrl}else{newUrl=currentDir+unquotedOrigUrl.replace(/^\.\//,"")}return"url("+JSON.stringify(newUrl)+")"});return fixedCss}}])["default"]})},{}],4:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):(global=global||self,factory(global.ResizeObserver={}))})(this,function(exports){"use strict";var resizeObservers=[];var hasActiveObservations=function(){return resizeObservers.some(function(ro){return ro.activeTargets.length>0})};var hasSkippedObservations=function(){return resizeObservers.some(function(ro){return ro.skippedTargets.length>0})};var msg="ResizeObserver loop completed with undelivered notifications.";var deliverResizeLoopError=function(){var event;if(typeof ErrorEvent==="function"){event=new ErrorEvent("error",{message:msg})}else{event=document.createEvent("Event");event.initEvent("error",false,false);event.message=msg}window.dispatchEvent(event)};var ResizeObserverBoxOptions;(function(ResizeObserverBoxOptions){ResizeObserverBoxOptions["BORDER_BOX"]="border-box";ResizeObserverBoxOptions["CONTENT_BOX"]="content-box";ResizeObserverBoxOptions["DEVICE_PIXEL_CONTENT_BOX"]="device-pixel-content-box"})(ResizeObserverBoxOptions||(ResizeObserverBoxOptions={}));var DOMRectReadOnly=function(){function DOMRectReadOnly(x,y,width,height){this.x=x;this.y=y;this.width=width;this.height=height;this.top=this.y;this.left=this.x;this.bottom=this.top+this.height;this.right=this.left+this.width;return Object.freeze(this)}DOMRectReadOnly.prototype.toJSON=function(){var _a=this,x=_a.x,y=_a.y,top=_a.top,right=_a.right,bottom=_a.bottom,left=_a.left,width=_a.width,height=_a.height;return{x:x,y:y,top:top,right:right,bottom:bottom,left:left,width:width,height:height}};DOMRectReadOnly.fromRect=function(rectangle){return new DOMRectReadOnly(rectangle.x,rectangle.y,rectangle.width,rectangle.height)};return DOMRectReadOnly}();var isSVG=function(target){return target instanceof SVGElement&&"getBBox"in target};var isHidden=function(target){if(isSVG(target)){var _a=target.getBBox(),width=_a.width,height=_a.height;return!width&&!height}var _b=target,offsetWidth=_b.offsetWidth,offsetHeight=_b.offsetHeight;return!(offsetWidth||offsetHeight||target.getClientRects().length)};var isElement=function(obj){var _a,_b;var scope=(_b=(_a=obj)===null||_a===void 0?void 0:_a.ownerDocument)===null||_b===void 0?void 0:_b.defaultView;return!!(scope&&obj instanceof scope.Element)};var isReplacedElement=function(target){switch(target.tagName){case"INPUT":if(target.type!=="image"){break}case"VIDEO":case"AUDIO":case"EMBED":case"OBJECT":case"CANVAS":case"IFRAME":case"IMG":return true}return false};var global=typeof window!=="undefined"?window:{};var cache=new Map;var scrollRegexp=/auto|scroll/;var verticalRegexp=/^tb|vertical/;var IE=/msie|trident/i.test(global.navigator&&global.navigator.userAgent);var parseDimension=function(pixel){return parseFloat(pixel||"0")};var size=function(inlineSize,blockSize,switchSizes){if(inlineSize===void 0){inlineSize=0}if(blockSize===void 0){blockSize=0}if(switchSizes===void 0){switchSizes=false}return Object.freeze({inlineSize:(switchSizes?blockSize:inlineSize)||0,blockSize:(switchSizes?inlineSize:blockSize)||0})};var zeroBoxes=Object.freeze({devicePixelContentBoxSize:size(),borderBoxSize:size(),contentBoxSize:size(),contentRect:new DOMRectReadOnly(0,0,0,0)});var calculateBoxSizes=function(target){if(cache.has(target)){return cache.get(target)}if(isHidden(target)){cache.set(target,zeroBoxes);return zeroBoxes}var cs=getComputedStyle(target);var svg=isSVG(target)&&target.ownerSVGElement&&target.getBBox();var removePadding=!IE&&cs.boxSizing==="border-box";var switchSizes=verticalRegexp.test(cs.writingMode||"");var canScrollVertically=!svg&&scrollRegexp.test(cs.overflowY||"");var canScrollHorizontally=!svg&&scrollRegexp.test(cs.overflowX||"");var paddingTop=svg?0:parseDimension(cs.paddingTop);var paddingRight=svg?0:parseDimension(cs.paddingRight);var paddingBottom=svg?0:parseDimension(cs.paddingBottom);var paddingLeft=svg?0:parseDimension(cs.paddingLeft);var borderTop=svg?0:parseDimension(cs.borderTopWidth);var borderRight=svg?0:parseDimension(cs.borderRightWidth);var borderBottom=svg?0:parseDimension(cs.borderBottomWidth);var borderLeft=svg?0:parseDimension(cs.borderLeftWidth);var horizontalPadding=paddingLeft+paddingRight;var verticalPadding=paddingTop+paddingBottom;var horizontalBorderArea=borderLeft+borderRight;var verticalBorderArea=borderTop+borderBottom;var horizontalScrollbarThickness=!canScrollHorizontally?0:target.offsetHeight-verticalBorderArea-target.clientHeight;var verticalScrollbarThickness=!canScrollVertically?0:target.offsetWidth-horizontalBorderArea-target.clientWidth;var widthReduction=removePadding?horizontalPadding+horizontalBorderArea:0;var heightReduction=removePadding?verticalPadding+verticalBorderArea:0;var contentWidth=svg?svg.width:parseDimension(cs.width)-widthReduction-verticalScrollbarThickness;var contentHeight=svg?svg.height:parseDimension(cs.height)-heightReduction-horizontalScrollbarThickness;var borderBoxWidth=contentWidth+horizontalPadding+verticalScrollbarThickness+horizontalBorderArea;var borderBoxHeight=contentHeight+verticalPadding+horizontalScrollbarThickness+verticalBorderArea;var boxes=Object.freeze({devicePixelContentBoxSize:size(Math.round(contentWidth*devicePixelRatio),Math.round(contentHeight*devicePixelRatio),switchSizes),borderBoxSize:size(borderBoxWidth,borderBoxHeight,switchSizes),contentBoxSize:size(contentWidth,contentHeight,switchSizes),contentRect:new DOMRectReadOnly(paddingLeft,paddingTop,contentWidth,contentHeight)});cache.set(target,boxes);return boxes};var calculateBoxSize=function(target,observedBox){var _a=calculateBoxSizes(target),borderBoxSize=_a.borderBoxSize,contentBoxSize=_a.contentBoxSize,devicePixelContentBoxSize=_a.devicePixelContentBoxSize;switch(observedBox){case ResizeObserverBoxOptions.DEVICE_PIXEL_CONTENT_BOX:return devicePixelContentBoxSize;case ResizeObserverBoxOptions.BORDER_BOX:return borderBoxSize;default:return contentBoxSize}};var ResizeObserverEntry=function(){function ResizeObserverEntry(target){var boxes=calculateBoxSizes(target);this.target=target;this.contentRect=boxes.contentRect;this.borderBoxSize=[boxes.borderBoxSize];this.contentBoxSize=[boxes.contentBoxSize];this.devicePixelContentBoxSize=[boxes.devicePixelContentBoxSize]}return ResizeObserverEntry}();var calculateDepthForNode=function(node){if(isHidden(node)){return Infinity}var depth=0;var parent=node.parentNode;while(parent){depth+=1;parent=parent.parentNode}return depth};var broadcastActiveObservations=function(){var shallowestDepth=Infinity;var callbacks=[];resizeObservers.forEach(function processObserver(ro){if(ro.activeTargets.length===0){return}var entries=[];ro.activeTargets.forEach(function processTarget(ot){var entry=new ResizeObserverEntry(ot.target);var targetDepth=calculateDepthForNode(ot.target);entries.push(entry);ot.lastReportedSize=calculateBoxSize(ot.target,ot.observedBox);if(targetDepth<shallowestDepth){shallowestDepth=targetDepth}});callbacks.push(function resizeObserverCallback(){ro.callback.call(ro.observer,entries,ro.observer)});ro.activeTargets.splice(0,ro.activeTargets.length)});for(var _i=0,callbacks_1=callbacks;_i<callbacks_1.length;_i++){var callback=callbacks_1[_i];callback()}return shallowestDepth};var gatherActiveObservationsAtDepth=function(depth){cache.clear();resizeObservers.forEach(function processObserver(ro){ro.activeTargets.splice(0,ro.activeTargets.length);ro.skippedTargets.splice(0,ro.skippedTargets.length);ro.observationTargets.forEach(function processTarget(ot){if(ot.isActive()){if(calculateDepthForNode(ot.target)>depth){ro.activeTargets.push(ot)}else{ro.skippedTargets.push(ot)}}})})};var process=function(){var depth=0;gatherActiveObservationsAtDepth(depth);while(hasActiveObservations()){depth=broadcastActiveObservations();gatherActiveObservationsAtDepth(depth)}if(hasSkippedObservations()){deliverResizeLoopError()}return depth>0};var trigger;var callbacks=[];var notify=function(){return callbacks.splice(0).forEach(function(cb){return cb()})};var queueMicroTask=function(callback){if(!trigger){var el_1=document.createTextNode("");var config={characterData:true};new MutationObserver(function(){return notify()}).observe(el_1,config);trigger=function(){el_1.textContent=""}}callbacks.push(callback);trigger()};var queueResizeObserver=function(cb){queueMicroTask(function ResizeObserver(){requestAnimationFrame(cb)})};var watching=0;var isWatching=function(){return!!watching};var CATCH_FRAMES=60/5;var observerConfig={attributes:true,characterData:true,childList:true,subtree:true};var events=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"];var scheduled=false;var Scheduler=function(){function Scheduler(){var _this=this;this.stopped=true;this.listener=function(){return _this.schedule()}}Scheduler.prototype.run=function(frames){var _this=this;if(scheduled){return}scheduled=true;queueResizeObserver(function(){var elementsHaveResized=false;try{elementsHaveResized=process()}finally{scheduled=false;if(!isWatching()){return}if(elementsHaveResized){_this.run(60)}else if(frames){_this.run(frames-1)}else{_this.start()}}})};Scheduler.prototype.schedule=function(){this.stop();this.run(CATCH_FRAMES)};Scheduler.prototype.observe=function(){var _this=this;var cb=function(){return _this.observer&&_this.observer.observe(document.body,observerConfig)};document.body?cb():global.addEventListener("DOMContentLoaded",cb)};Scheduler.prototype.start=function(){var _this=this;if(this.stopped){this.stopped=false;this.observer=new MutationObserver(this.listener);this.observe();events.forEach(function(name){return global.addEventListener(name,_this.listener,true)})}};Scheduler.prototype.stop=function(){var _this=this;if(!this.stopped){this.observer&&this.observer.disconnect();events.forEach(function(name){return global.removeEventListener(name,_this.listener,true)});this.stopped=true}};return Scheduler}();var scheduler=new Scheduler;var updateCount=function(n){!watching&&n>0&&scheduler.start();watching+=n;!watching&&scheduler.stop()};var skipNotifyOnElement=function(target){return!isSVG(target)&&!isReplacedElement(target)&&getComputedStyle(target).display==="inline"};var ResizeObservation=function(){function ResizeObservation(target,observedBox){this.target=target;this.observedBox=observedBox||ResizeObserverBoxOptions.CONTENT_BOX;this.lastReportedSize={inlineSize:0,blockSize:0}}ResizeObservation.prototype.isActive=function(){var size=calculateBoxSize(this.target,this.observedBox);if(skipNotifyOnElement(this.target)){this.lastReportedSize=size}if(this.lastReportedSize.inlineSize!==size.inlineSize||this.lastReportedSize.blockSize!==size.blockSize){return true}return false};return ResizeObservation}();var ResizeObserverDetail=function(){function ResizeObserverDetail(resizeObserver,callback){this.activeTargets=[];this.skippedTargets=[];this.observationTargets=[];this.observer=resizeObserver;this.callback=callback}return ResizeObserverDetail}();var observerMap=new Map;var getObservationIndex=function(observationTargets,target){for(var i=0;i<observationTargets.length;i+=1){if(observationTargets[i].target===target){return i}}return-1};var ResizeObserverController=function(){function ResizeObserverController(){}ResizeObserverController.connect=function(resizeObserver,callback){var detail=new ResizeObserverDetail(resizeObserver,callback);resizeObservers.push(detail);observerMap.set(resizeObserver,detail)};ResizeObserverController.observe=function(resizeObserver,target,options){if(observerMap.has(resizeObserver)){var detail=observerMap.get(resizeObserver);if(getObservationIndex(detail.observationTargets,target)<0){detail.observationTargets.push(new ResizeObservation(target,options&&options.box));updateCount(1);scheduler.schedule()}}};ResizeObserverController.unobserve=function(resizeObserver,target){if(observerMap.has(resizeObserver)){var detail=observerMap.get(resizeObserver);var index=getObservationIndex(detail.observationTargets,target);if(index>=0){detail.observationTargets.splice(index,1);updateCount(-1)}}};ResizeObserverController.disconnect=function(resizeObserver){if(observerMap.has(resizeObserver)){var detail=observerMap.get(resizeObserver);resizeObservers.splice(resizeObservers.indexOf(detail),1);observerMap.delete(resizeObserver);updateCount(-detail.observationTargets.length)}};return ResizeObserverController}();var ResizeObserver=function(){function ResizeObserver(callback){if(arguments.length===0){throw new TypeError("Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.")}if(typeof callback!=="function"){throw new TypeError("Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.")}ResizeObserverController.connect(this,callback)}ResizeObserver.prototype.observe=function(target,options){if(arguments.length===0){throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.")}if(!isElement(target)){throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element")}ResizeObserverController.observe(this,target,options)};ResizeObserver.prototype.unobserve=function(target){if(arguments.length===0){throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.")}if(!isElement(target)){throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element")}ResizeObserverController.unobserve(this,target)};ResizeObserver.prototype.disconnect=function(){ResizeObserverController.disconnect(this)};ResizeObserver.toString=function(){return"function ResizeObserver () { [polyfill code] }"};return ResizeObserver}();exports.ResizeObserver=ResizeObserver;exports.ResizeObserverEntry=ResizeObserverEntry;Object.defineProperty(exports,"__esModule",{value:true})})},{}],5:[function(require,module,exports){(function(global){"use strict";function compare(a,b){if(a===b){return 0}var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y){return-1}if(y<x){return 1}return 0}function isBuffer(b){if(global.Buffer&&typeof global.Buffer.isBuffer==="function"){return global.Buffer.isBuffer(b)}return!!(b!=null&&b._isBuffer)}var util=require("util/");var hasOwn=Object.prototype.hasOwnProperty;var pSlice=Array.prototype.slice;var functionsHaveNames=function(){return function foo(){}.name==="foo"}();function pToString(obj){return Object.prototype.toString.call(obj)}function isView(arrbuf){if(isBuffer(arrbuf)){return false}if(typeof global.ArrayBuffer!=="function"){return false}if(typeof ArrayBuffer.isView==="function"){return ArrayBuffer.isView(arrbuf)}if(!arrbuf){return false}if(arrbuf instanceof DataView){return true}if(arrbuf.buffer&&arrbuf.buffer instanceof ArrayBuffer){return true}return false}var assert=module.exports=ok;var regex=/\s*function\s+([^\(\s]*)\s*/;function getName(func){if(!util.isFunction(func)){return}if(functionsHaveNames){return func.name}var str=func.toString();var match=str.match(regex);return match&&match[1]}assert.AssertionError=function AssertionError(options){this.name="AssertionError";this.actual=options.actual;this.expected=options.expected;this.operator=options.operator;if(options.message){this.message=options.message;this.generatedMessage=false}else{this.message=getMessage(this);this.generatedMessage=true}var stackStartFunction=options.stackStartFunction||fail;if(Error.captureStackTrace){Error.captureStackTrace(this,stackStartFunction)}else{var err=new Error;if(err.stack){var out=err.stack;var fn_name=getName(stackStartFunction);var idx=out.indexOf("\n"+fn_name);if(idx>=0){var next_line=out.indexOf("\n",idx+1);out=out.substring(next_line+1)}this.stack=out}}};util.inherits(assert.AssertionError,Error);function truncate(s,n){if(typeof s==="string"){return s.length<n?s:s.slice(0,n)}else{return s}}function inspect(something){if(functionsHaveNames||!util.isFunction(something)){return util.inspect(something)}var rawname=getName(something);var name=rawname?": "+rawname:"";return"[Function"+name+"]"}function getMessage(self){return truncate(inspect(self.actual),128)+" "+self.operator+" "+truncate(inspect(self.expected),128)}function fail(actual,expected,message,operator,stackStartFunction){throw new assert.AssertionError({message:message,actual:actual,expected:expected,operator:operator,stackStartFunction:stackStartFunction})}assert.fail=fail;function ok(value,message){if(!value)fail(value,true,message,"==",assert.ok)}assert.ok=ok;assert.equal=function equal(actual,expected,message){if(actual!=expected)fail(actual,expected,message,"==",assert.equal)};assert.notEqual=function notEqual(actual,expected,message){if(actual==expected){fail(actual,expected,message,"!=",assert.notEqual)}};assert.deepEqual=function deepEqual(actual,expected,message){if(!_deepEqual(actual,expected,false)){fail(actual,expected,message,"deepEqual",assert.deepEqual)}};assert.deepStrictEqual=function deepStrictEqual(actual,expected,message){if(!_deepEqual(actual,expected,true)){fail(actual,expected,message,"deepStrictEqual",assert.deepStrictEqual)}};function _deepEqual(actual,expected,strict,memos){if(actual===expected){return true}else if(isBuffer(actual)&&isBuffer(expected)){return compare(actual,expected)===0}else if(util.isDate(actual)&&util.isDate(expected)){return actual.getTime()===expected.getTime()}else if(util.isRegExp(actual)&&util.isRegExp(expected)){return actual.source===expected.source&&actual.global===expected.global&&actual.multiline===expected.multiline&&actual.lastIndex===expected.lastIndex&&actual.ignoreCase===expected.ignoreCase}else if((actual===null||typeof actual!=="object")&&(expected===null||typeof expected!=="object")){return strict?actual===expected:actual==expected}else if(isView(actual)&&isView(expected)&&pToString(actual)===pToString(expected)&&!(actual instanceof Float32Array||actual instanceof Float64Array)){return compare(new Uint8Array(actual.buffer),new Uint8Array(expected.buffer))===0}else if(isBuffer(actual)!==isBuffer(expected)){return false}else{memos=memos||{actual:[],expected:[]};var actualIndex=memos.actual.indexOf(actual);if(actualIndex!==-1){if(actualIndex===memos.expected.indexOf(expected)){return true}}memos.actual.push(actual);memos.expected.push(expected);return objEquiv(actual,expected,strict,memos)}}function isArguments(object){return Object.prototype.toString.call(object)=="[object Arguments]"}function objEquiv(a,b,strict,actualVisitedObjects){if(a===null||a===undefined||b===null||b===undefined)return false;if(util.isPrimitive(a)||util.isPrimitive(b))return a===b;if(strict&&Object.getPrototypeOf(a)!==Object.getPrototypeOf(b))return false;var aIsArgs=isArguments(a);var bIsArgs=isArguments(b);if(aIsArgs&&!bIsArgs||!aIsArgs&&bIsArgs)return false;if(aIsArgs){a=pSlice.call(a);b=pSlice.call(b);return _deepEqual(a,b,strict)}var ka=objectKeys(a);var kb=objectKeys(b);var key,i;if(ka.length!==kb.length)return false;ka.sort();kb.sort();for(i=ka.length-1;i>=0;i--){if(ka[i]!==kb[i])return false}for(i=ka.length-1;i>=0;i--){key=ka[i];if(!_deepEqual(a[key],b[key],strict,actualVisitedObjects))return false}return true}assert.notDeepEqual=function notDeepEqual(actual,expected,message){if(_deepEqual(actual,expected,false)){fail(actual,expected,message,"notDeepEqual",assert.notDeepEqual)}};assert.notDeepStrictEqual=notDeepStrictEqual;function notDeepStrictEqual(actual,expected,message){if(_deepEqual(actual,expected,true)){fail(actual,expected,message,"notDeepStrictEqual",notDeepStrictEqual)}}assert.strictEqual=function strictEqual(actual,expected,message){if(actual!==expected){fail(actual,expected,message,"===",assert.strictEqual)}};assert.notStrictEqual=function notStrictEqual(actual,expected,message){if(actual===expected){fail(actual,expected,message,"!==",assert.notStrictEqual)}};function expectedException(actual,expected){if(!actual||!expected){return false}if(Object.prototype.toString.call(expected)=="[object RegExp]"){return expected.test(actual)}try{if(actual instanceof expected){return true}}catch(e){}if(Error.isPrototypeOf(expected)){return false}return expected.call({},actual)===true}function _tryBlock(block){var error;try{block()}catch(e){error=e}return error}function _throws(shouldThrow,block,expected,message){var actual;if(typeof block!=="function"){throw new TypeError('"block" argument must be a function')}if(typeof expected==="string"){message=expected;expected=null}actual=_tryBlock(block);message=(expected&&expected.name?" ("+expected.name+").":".")+(message?" "+message:".");if(shouldThrow&&!actual){fail(actual,expected,"Missing expected exception"+message)}var userProvidedMessage=typeof message==="string";var isUnwantedException=!shouldThrow&&util.isError(actual);var isUnexpectedException=!shouldThrow&&actual&&!expected;if(isUnwantedException&&userProvidedMessage&&expectedException(actual,expected)||isUnexpectedException){fail(actual,expected,"Got unwanted exception"+message)}if(shouldThrow&&actual&&expected&&!expectedException(actual,expected)||!shouldThrow&&actual){throw actual}}assert.throws=function(block,error,message){_throws(true,block,error,message)};assert.doesNotThrow=function(block,error,message){_throws(false,block,error,message)};assert.ifError=function(err){if(err)throw err};var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){if(hasOwn.call(obj,key))keys.push(key)}return keys}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"util/":8}],6:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],7:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],8:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":7,_process:74,inherits:6}],9:[function(require,module,exports){"use strict";exports.byteLength=byteLength;exports.toByteArray=toByteArray;exports.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function getLens(b64){var len=b64.length;if(len%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var validLen=b64.indexOf("=");if(validLen===-1)validLen=len;var placeHoldersLen=validLen===len?0:4-validLen%4;return[validLen,placeHoldersLen]}function byteLength(b64){var lens=getLens(b64);var validLen=lens[0];var placeHoldersLen=lens[1];return(validLen+placeHoldersLen)*3/4-placeHoldersLen}function _byteLength(b64,validLen,placeHoldersLen){return(validLen+placeHoldersLen)*3/4-placeHoldersLen}function toByteArray(b64){var tmp;var lens=getLens(b64);var validLen=lens[0];var placeHoldersLen=lens[1];var arr=new Arr(_byteLength(b64,validLen,placeHoldersLen));var curByte=0;var len=placeHoldersLen>0?validLen-4:validLen;for(var i=0;i<len;i+=4){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[curByte++]=tmp>>16&255;arr[curByte++]=tmp>>8&255;arr[curByte++]=tmp&255}if(placeHoldersLen===2){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[curByte++]=tmp&255}if(placeHoldersLen===1){tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[curByte++]=tmp>>8&255;arr[curByte++]=tmp&255}return arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(uint8[i+2]&255);output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){var tmp;var len=uint8.length;var extraBytes=len%3;var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength))}if(extraBytes===1){tmp=uint8[len-1];parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+uint8[len-1];parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"=")}return parts.join("")}},{}],10:[function(require,module,exports){},{}],11:[function(require,module,exports){arguments[4][10][0].apply(exports,arguments)},{dup:10}],12:[function(require,module,exports){"use strict";var base64=require("base64-js");var ieee754=require("ieee754");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;exports.kMaxLength=K_MAX_LENGTH;Buffer.TYPED_ARRAY_SUPPORT=typedArraySupport();if(!Buffer.TYPED_ARRAY_SUPPORT&&typeof console!=="undefined"&&typeof console.error==="function"){console.error("This browser lacks typed array (Uint8Array) support which is required by "+"`buffer` v5.x. Use `buffer` v4.x if you require old browser support.")}function typedArraySupport(){try{var arr=new Uint8Array(1);arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return arr.foo()===42}catch(e){return false}}Object.defineProperty(Buffer.prototype,"parent",{enumerable:true,get:function(){if(!Buffer.isBuffer(this))return undefined;return this.buffer}});Object.defineProperty(Buffer.prototype,"offset",{enumerable:true,get:function(){if(!Buffer.isBuffer(this))return undefined;return this.byteOffset}});function createBuffer(length){if(length>K_MAX_LENGTH){throw new RangeError('The value "'+length+'" is invalid for option "size"')}var buf=new Uint8Array(length);buf.__proto__=Buffer.prototype;return buf}function Buffer(arg,encodingOrOffset,length){if(typeof arg==="number"){if(typeof encodingOrOffset==="string"){throw new TypeError('The "string" argument must be of type string. Received type number')}return allocUnsafe(arg)}return from(arg,encodingOrOffset,length)}if(typeof Symbol!=="undefined"&&Symbol.species!=null&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:true,enumerable:false,writable:false})}Buffer.poolSize=8192;function from(value,encodingOrOffset,length){if(typeof value==="string"){return fromString(value,encodingOrOffset)}if(ArrayBuffer.isView(value)){return fromArrayLike(value)}if(value==null){throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, "+"or Array-like Object. Received type "+typeof value)}if(isInstance(value,ArrayBuffer)||value&&isInstance(value.buffer,ArrayBuffer)){return fromArrayBuffer(value,encodingOrOffset,length)}if(typeof value==="number"){throw new TypeError('The "value" argument must not be of type number. Received type number')}var valueOf=value.valueOf&&value.valueOf();if(valueOf!=null&&valueOf!==value){return Buffer.from(valueOf,encodingOrOffset,length)}var b=fromObject(value);if(b)return b;if(typeof Symbol!=="undefined"&&Symbol.toPrimitive!=null&&typeof value[Symbol.toPrimitive]==="function"){return Buffer.from(value[Symbol.toPrimitive]("string"),encodingOrOffset,length)}throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, "+"or Array-like Object. Received type "+typeof value)}Buffer.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)};Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array;function assertSize(size){if(typeof size!=="number"){throw new TypeError('"size" argument must be of type number')}else if(size<0){throw new RangeError('The value "'+size+'" is invalid for option "size"')}}function alloc(size,fill,encoding){assertSize(size);if(size<=0){return createBuffer(size)}if(fill!==undefined){return typeof encoding==="string"?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill)}return createBuffer(size)}Buffer.alloc=function(size,fill,encoding){return alloc(size,fill,encoding)};function allocUnsafe(size){assertSize(size);return createBuffer(size<0?0:checked(size)|0)}Buffer.allocUnsafe=function(size){return allocUnsafe(size)};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(size)};function fromString(string,encoding){if(typeof encoding!=="string"||encoding===""){encoding="utf8"}if(!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}var length=byteLength(string,encoding)|0;var buf=createBuffer(length);var actual=buf.write(string,encoding);if(actual!==length){buf=buf.slice(0,actual)}return buf}function fromArrayLike(array){var length=array.length<0?0:checked(array.length)|0;var buf=createBuffer(length);for(var i=0;i<length;i+=1){buf[i]=array[i]&255}return buf}function fromArrayBuffer(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset){throw new RangeError('"offset" is outside of buffer bounds')}if(array.byteLength<byteOffset+(length||0)){throw new RangeError('"length" is outside of buffer bounds')}var buf;if(byteOffset===undefined&&length===undefined){buf=new Uint8Array(array)}else if(length===undefined){buf=new Uint8Array(array,byteOffset)}else{buf=new Uint8Array(array,byteOffset,length)}buf.__proto__=Buffer.prototype;return buf}function fromObject(obj){if(Buffer.isBuffer(obj)){var len=checked(obj.length)|0;var buf=createBuffer(len);if(buf.length===0){return buf}obj.copy(buf,0,0,len);return buf}if(obj.length!==undefined){if(typeof obj.length!=="number"||numberIsNaN(obj.length)){return createBuffer(0)}return fromArrayLike(obj)}if(obj.type==="Buffer"&&Array.isArray(obj.data)){return fromArrayLike(obj.data)}}function checked(length){if(length>=K_MAX_LENGTH){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+K_MAX_LENGTH.toString(16)+" bytes")}return length|0}function SlowBuffer(length){if(+length!=length){length=0}return Buffer.alloc(+length)}Buffer.isBuffer=function isBuffer(b){return b!=null&&b._isBuffer===true&&b!==Buffer.prototype};Buffer.compare=function compare(a,b){if(isInstance(a,Uint8Array))a=Buffer.from(a,a.offset,a.byteLength);if(isInstance(b,Uint8Array))b=Buffer.from(b,b.offset,b.byteLength);if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array')}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!Array.isArray(list)){throw new TypeError('"list" argument must be an Array of Buffers')}if(list.length===0){return Buffer.alloc(0)}var i;if(length===undefined){length=0;for(i=0;i<list.length;++i){length+=list[i].length}}var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(isInstance(buf,Uint8Array)){buf=Buffer.from(buf)}if(!Buffer.isBuffer(buf)){throw new TypeError('"list" argument must be an Array of Buffers')}buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer.isBuffer(string)){return string.length}if(ArrayBuffer.isView(string)||isInstance(string,ArrayBuffer)){return string.byteLength}if(typeof string!=="string"){throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. '+"Received type "+typeof string)}var len=string.length;var mustMatch=arguments.length>2&&arguments[2]===true;if(!mustMatch&&len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase){return mustMatch?-1:utf8ToBytes(string).length}encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===undefined||start<0){start=0}if(start>this.length){return""}if(end===undefined||end>this.length){end=this.length}if(end<=0){return""}end>>>=0;start>>>=0;if(end<=start){return""}if(!encoding)encoding="utf8";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype._isBuffer=true;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i}Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<len;i+=2){swap(this,i,i+1)}return this};Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2)}return this};Buffer.prototype.swap64=function swap64(){var len=this.length;if(len%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<len;i+=8){swap(this,i,i+7);swap(this,i+1,i+6);swap(this,i+2,i+5);swap(this,i+3,i+4)}return this};Buffer.prototype.toString=function toString(){var length=this.length;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.toLocaleString=Buffer.prototype.toString;Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;str=this.toString("hex",0,max).replace(/(.{2})/g,"$1 ").trim();if(this.length>max)str+=" ... ";return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(isInstance(target,Uint8Array)){target=Buffer.from(target,target.offset,target.byteLength)}if(!Buffer.isBuffer(target)){throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. '+"Received type "+typeof target)}if(start===undefined){start=0}if(end===undefined){end=target?target.length:0}if(thisStart===undefined){thisStart=0}if(thisEnd===undefined){thisEnd=this.length}if(start<0||end>target.length||thisStart<0||thisEnd>this.length){throw new RangeError("out of range index")}if(thisStart>=thisEnd&&start>=end){return 0}if(thisStart>=thisEnd){return-1}if(start>=end){return 1}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(buffer.length===0)return-1;if(typeof byteOffset==="string"){encoding=byteOffset;byteOffset=0}else if(byteOffset>2147483647){byteOffset=2147483647}else if(byteOffset<-2147483648){byteOffset=-2147483648}byteOffset=+byteOffset;if(numberIsNaN(byteOffset)){byteOffset=dir?0:buffer.length-1}if(byteOffset<0)byteOffset=buffer.length+byteOffset;if(byteOffset>=buffer.length){if(dir)return-1;else byteOffset=buffer.length-1}else if(byteOffset<0){if(dir)byteOffset=0;else return-1}if(typeof val==="string"){val=Buffer.from(val,encoding)}if(Buffer.isBuffer(val)){if(val.length===0){return-1}return arrayIndexOf(buffer,val,byteOffset,encoding,dir)}else if(typeof val==="number"){val=val&255;if(typeof Uint8Array.prototype.indexOf==="function"){if(dir){return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset)}else{return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset)}}return arrayIndexOf(buffer,[val],byteOffset,encoding,dir)}throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(encoding!==undefined){encoding=String(encoding).toLowerCase();if(encoding==="ucs2"||encoding==="ucs-2"||encoding==="utf16le"||encoding==="utf-16le"){if(arr.length<2||val.length<2){return-1}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i){if(indexSize===1){return buf[i]}else{return buf.readUInt16BE(i*indexSize)}}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++){if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(foundIndex!==-1)i-=i-foundIndex;foundIndex=-1}}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength;for(i=byteOffset;i>=0;i--){var found=true;for(var j=0;j<valLength;j++){if(read(arr,i+j)!==read(val,j)){found=false;break}}if(found)return i}}return-1}Buffer.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1};Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,true)};Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,false)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(length>strLen/2){length=strLen/2}for(var i=0;i<length;++i){var parsed=parseInt(string.substr(i*2,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset>>>0;if(isFinite(length)){length=length>>>0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<128){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112){codePoint=tempCodePoint}}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i]&127)}return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;++i){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype;return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,255,0);this[offset]=value&255;return offset+1};Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255;return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){if(value<0&&sub===0&&this[offset+i-1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){if(value<0&&sub===0&&this[offset+i+1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(value<0)value=255+value+1;this[offset]=value&255;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24;return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!Buffer.isBuffer(target))throw new TypeError("argument should be a Buffer");if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("Index out of range");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;if(this===target&&typeof Uint8Array.prototype.copyWithin==="function"){this.copyWithin(targetStart,start,end)}else if(this===target&&start<targetStart&&targetStart<end){for(var i=len-1;i>=0;--i){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,end),targetStart)}return len};Buffer.prototype.fill=function fill(val,start,end,encoding){if(typeof val==="string"){if(typeof start==="string"){encoding=start;start=0;end=this.length}else if(typeof end==="string"){encoding=end;end=this.length}if(encoding!==undefined&&typeof encoding!=="string"){throw new TypeError("encoding must be a string")}if(typeof encoding==="string"&&!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}if(val.length===1){var code=val.charCodeAt(0);if(encoding==="utf8"&&code<128||encoding==="latin1"){val=code}}}else if(typeof val==="number"){val=val&255}if(start<0||this.length<start||this.length<end){throw new RangeError("Out of range index")}if(end<=start){return this}start=start>>>0;end=end===undefined?this.length:end>>>0;if(!val)val=0;var i;if(typeof val==="number"){for(i=start;i<end;++i){this[i]=val}}else{var bytes=Buffer.isBuffer(val)?val:Buffer.from(val,encoding);var len=bytes.length;if(len===0){throw new TypeError('The value "'+val+'" is invalid for argument "value"')}for(i=0;i<end-start;++i){this[i+start]=bytes[i%len]}}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g;function base64clean(str){str=str.split("=")[0];str=str.trim().replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189)}leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;++i){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function isInstance(obj,type){return obj instanceof type||obj!=null&&obj.constructor!=null&&obj.constructor.name!=null&&obj.constructor.name===type.name}function numberIsNaN(obj){return obj!==obj}},{"base64-js":9,ieee754:17}],13:[function(require,module,exports){(function(Buffer,process){var VERSION="1.8.12";var LOG_VERSION=0;var xxx=function xxx(s){var args=["XX"+"X: "+s].concat(Array.prototype.slice.call(arguments,1));console.error.apply(this,args)};var xxx=function xxx(){};var runtimeEnv;if(typeof process!=="undefined"&&process.versions){if(process.versions.nw){runtimeEnv="nw"}else if(process.versions.node){runtimeEnv="node"}}if(!runtimeEnv&&typeof window!=="undefined"&&window.window===window){runtimeEnv="browser"}if(!runtimeEnv){throw new Error("unknown runtime environment")}var os,fs,dtrace;if(runtimeEnv==="browser"){os={hostname:function(){return window.location.host}};fs={};dtrace=null}else{os=require("os");fs=require("fs");try{dtrace=require("dtrace-provider"+"")}catch(e){dtrace=null}}var util=require("util");var assert=require("assert");var EventEmitter=require("events").EventEmitter;var stream=require("stream");try{var safeJsonStringify=require("safe-json-stringify")}catch(e){safeJsonStringify=null}if(process.env.BUNYAN_TEST_NO_SAFE_JSON_STRINGIFY){safeJsonStringify=null}try{var mv=require("mv"+"")}catch(e){mv=null}try{var sourceMapSupport=require("source-map-support"+"")}catch(_){sourceMapSupport=null}function objCopy(obj){if(obj==null){return obj}else if(Array.isArray(obj)){return obj.slice()}else if(typeof obj==="object"){var copy={};Object.keys(obj).forEach(function(k){copy[k]=obj[k]});return copy}else{return obj}}var format=util.format;if(!format){var inspect=util.inspect;var formatRegExp=/%[sdj%]/g;format=function format(f){if(typeof f!=="string"){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":return fastAndSafeJsonStringify(args[i++]);case"%%":return"%";default:return x}});for(var x=args[i];i<len;x=args[++i]){if(x===null||typeof x!=="object"){str+=" "+x}else{str+=" "+inspect(x)}}return str}}function getCaller3Info(){if(this===undefined){return}var obj={};var saveLimit=Error.stackTraceLimit;var savePrepare=Error.prepareStackTrace;Error.stackTraceLimit=3;Error.prepareStackTrace=function(_,stack){var caller=stack[2];if(sourceMapSupport){caller=sourceMapSupport.wrapCallSite(caller)}obj.file=caller.getFileName();obj.line=caller.getLineNumber();var func=caller.getFunctionName();if(func)obj.func=func};Error.captureStackTrace(this,getCaller3Info);this.stack;Error.stackTraceLimit=saveLimit;Error.prepareStackTrace=savePrepare;return obj}function _indent(s,indent){if(!indent)indent="    ";var lines=s.split(/\r?\n/g);return indent+lines.join("\n"+indent)}function _warn(msg,dedupKey){assert.ok(msg);if(dedupKey){if(_warned[dedupKey]){return}_warned[dedupKey]=true}process.stderr.write(msg+"\n")}function _haveWarned(dedupKey){return _warned[dedupKey]}var _warned={};function ConsoleRawStream(){}ConsoleRawStream.prototype.write=function(rec){if(rec.level<INFO){console.log(rec)}else if(rec.level<WARN){console.info(rec)}else if(rec.level<ERROR){console.warn(rec)}else{console.error(rec)}};var TRACE=10;var DEBUG=20;var INFO=30;var WARN=40;var ERROR=50;var FATAL=60;var levelFromName={trace:TRACE,debug:DEBUG,info:INFO,warn:WARN,error:ERROR,fatal:FATAL};var nameFromLevel={};Object.keys(levelFromName).forEach(function(name){nameFromLevel[levelFromName[name]]=name});var dtp=undefined;var probes=dtrace&&{};function resolveLevel(nameOrNum){var level;var type=typeof nameOrNum;if(type==="string"){level=levelFromName[nameOrNum.toLowerCase()];if(!level){throw new Error(format('unknown level name: "%s"',nameOrNum))}}else if(type!=="number"){throw new TypeError(format("cannot resolve level: invalid arg (%s):",type,nameOrNum))}else if(nameOrNum<0||Math.floor(nameOrNum)!==nameOrNum){throw new TypeError(format("level is not a positive integer: %s",nameOrNum))}else{level=nameOrNum}return level}function isWritable(obj){if(obj instanceof stream.Writable){return true}return typeof obj.write==="function"}function Logger(options,_childOptions,_childSimple){xxx("Logger start:",options);if(!(this instanceof Logger)){return new Logger(options,_childOptions)}var parent;if(_childOptions!==undefined){parent=options;options=_childOptions;if(!(parent instanceof Logger)){throw new TypeError("invalid Logger creation: do not pass a second arg")}}if(!options){throw new TypeError("options (object) is required")}if(!parent){if(!options.name){throw new TypeError("options.name (string) is required")}}else{if(options.name){throw new TypeError("invalid options.name: child cannot set logger name")}}if(options.stream&&options.streams){throw new TypeError('cannot mix "streams" and "stream" options')}if(options.streams&&!Array.isArray(options.streams)){throw new TypeError("invalid options.streams: must be an array")}if(options.serializers&&(typeof options.serializers!=="object"||Array.isArray(options.serializers))){throw new TypeError("invalid options.serializers: must be an object")}EventEmitter.call(this);if(parent&&_childSimple){this._isSimpleChild=true;this._level=parent._level;this.streams=parent.streams;this.serializers=parent.serializers;this.src=parent.src;var fields=this.fields={};var parentFieldNames=Object.keys(parent.fields);for(var i=0;i<parentFieldNames.length;i++){var name=parentFieldNames[i];fields[name]=parent.fields[name]}var names=Object.keys(options);for(var i=0;i<names.length;i++){var name=names[i];fields[name]=options[name]}return}var self=this;if(parent){this._level=parent._level;this.streams=[];for(var i=0;i<parent.streams.length;i++){var s=objCopy(parent.streams[i]);s.closeOnExit=false;this.streams.push(s)}this.serializers=objCopy(parent.serializers);this.src=parent.src;this.fields=objCopy(parent.fields);if(options.level){this.level(options.level)}}else{this._level=Number.POSITIVE_INFINITY;this.streams=[];this.serializers=null;this.src=false;this.fields={}}if(!dtp&&dtrace){dtp=dtrace.createDTraceProvider("bunyan");for(var level in levelFromName){var probe;probes[levelFromName[level]]=probe=dtp.addProbe("log-"+level,"char *");probe.dtp=dtp}dtp.enable()}if(options.stream){self.addStream({type:"stream",stream:options.stream,closeOnExit:false,level:options.level})}else if(options.streams){options.streams.forEach(function(s){self.addStream(s,options.level)})}else if(parent&&options.level){this.level(options.level)}else if(!parent){if(runtimeEnv==="browser"){self.addStream({type:"raw",stream:new ConsoleRawStream,closeOnExit:false,level:options.level})}else{self.addStream({type:"stream",stream:process.stdout,closeOnExit:false,level:options.level})}}if(options.serializers){self.addSerializers(options.serializers)}if(options.src){this.src=true}xxx("Logger: ",self);var fields=objCopy(options);delete fields.stream;delete fields.level;delete fields.streams;delete fields.serializers;delete fields.src;if(this.serializers){this._applySerializers(fields)}if(!fields.hostname&&!self.fields.hostname){fields.hostname=os.hostname()}if(!fields.pid){fields.pid=process.pid}Object.keys(fields).forEach(function(k){self.fields[k]=fields[k]})}util.inherits(Logger,EventEmitter);Logger.prototype.addStream=function addStream(s,defaultLevel){var self=this;if(defaultLevel===null||defaultLevel===undefined){defaultLevel=INFO}s=objCopy(s);if(!s.type){if(s.stream){s.type="stream"}else if(s.path){s.type="file"}}s.raw=s.type==="raw";if(s.level!==undefined){s.level=resolveLevel(s.level)}else{s.level=resolveLevel(defaultLevel)}if(s.level<self._level){self._level=s.level}switch(s.type){case"stream":assert.ok(isWritable(s.stream),'"stream" stream is not writable: '+util.inspect(s.stream));if(!s.closeOnExit){s.closeOnExit=false}break;case"file":if(s.reemitErrorEvents===undefined){s.reemitErrorEvents=true}if(!s.stream){s.stream=fs.createWriteStream(s.path,{flags:"a",encoding:"utf8"});if(!s.closeOnExit){s.closeOnExit=true}}else{if(!s.closeOnExit){s.closeOnExit=false}}break;case"rotating-file":assert.ok(!s.stream,'"rotating-file" stream should not give a "stream"');assert.ok(s.path);assert.ok(mv,'"rotating-file" stream type is not supported: '+'missing "mv" module');s.stream=new RotatingFileStream(s);if(!s.closeOnExit){s.closeOnExit=true}break;case"raw":if(!s.closeOnExit){s.closeOnExit=false}break;default:throw new TypeError('unknown stream type "'+s.type+'"')}if(s.reemitErrorEvents&&typeof s.stream.on==="function"){s.stream.on("error",function onStreamError(err){self.emit("error",err,s)})}self.streams.push(s);delete self.haveNonRawStreams};Logger.prototype.addSerializers=function addSerializers(serializers){var self=this;if(!self.serializers){self.serializers={}}Object.keys(serializers).forEach(function(field){var serializer=serializers[field];if(typeof serializer!=="function"){throw new TypeError(format('invalid serializer for "%s" field: must be a function',field))}else{self.serializers[field]=serializer}})};Logger.prototype.child=function(options,simple){return new this.constructor(this,options||{},simple)};Logger.prototype.reopenFileStreams=function(){var self=this;self.streams.forEach(function(s){if(s.type==="file"){if(s.stream){s.stream.end();s.stream.destroySoon();delete s.stream}s.stream=fs.createWriteStream(s.path,{flags:"a",encoding:"utf8"});s.stream.on("error",function(err){self.emit("error",err,s)})}})};Logger.prototype.level=function level(value){if(value===undefined){return this._level}var newLevel=resolveLevel(value);var len=this.streams.length;for(var i=0;i<len;i++){this.streams[i].level=newLevel}this._level=newLevel};Logger.prototype.levels=function levels(name,value){if(name===undefined){assert.equal(value,undefined);return this.streams.map(function(s){return s.level})}var stream;if(typeof name==="number"){stream=this.streams[name];if(stream===undefined){throw new Error("invalid stream index: "+name)}}else{var len=this.streams.length;for(var i=0;i<len;i++){var s=this.streams[i];if(s.name===name){stream=s;break}}if(!stream){throw new Error(format('no stream with name "%s"',name))}}if(value===undefined){return stream.level}else{var newLevel=resolveLevel(value);stream.level=newLevel;if(newLevel<this._level){this._level=newLevel}}};Logger.prototype._applySerializers=function(fields,excludeFields){var self=this;xxx("_applySerializers: excludeFields",excludeFields);Object.keys(this.serializers).forEach(function(name){if(fields[name]===undefined||excludeFields&&excludeFields[name]){return}xxx('_applySerializers; apply to "%s" key',name);try{fields[name]=self.serializers[name](fields[name])}catch(err){_warn(format('bunyan: ERROR: Exception thrown from the "%s" '+"Bunyan serializer. This should never happen. This is a bug "+"in that serializer function.\n%s",name,err.stack||err));fields[name]=format('(Error in Bunyan log "%s" serializer '+"broke field. See stderr for details.)",name)}})};Logger.prototype._emit=function(rec,noemit){var i;if(this.haveNonRawStreams===undefined){this.haveNonRawStreams=false;for(i=0;i<this.streams.length;i++){if(!this.streams[i].raw){this.haveNonRawStreams=true;break}}}var str;if(noemit||this.haveNonRawStreams){str=fastAndSafeJsonStringify(rec)+"\n"}if(noemit)return str;var level=rec.level;for(i=0;i<this.streams.length;i++){var s=this.streams[i];if(s.level<=level){xxx('writing log rec "%s" to "%s" stream (%d <= %d): %j',rec.msg,s.type,s.level,level,rec);s.stream.write(s.raw?rec:str)}}return str};function mkRecord(log,minLevel,args){var excludeFields,fields,msgArgs;if(args[0]instanceof Error){fields={err:log.serializers&&log.serializers.err?log.serializers.err(args[0]):Logger.stdSerializers.err(args[0])};excludeFields={err:true};if(args.length===1){msgArgs=[fields.err.message]}else{msgArgs=args.slice(1)}}else if(typeof args[0]!=="object"||Array.isArray(args[0])){fields=null;msgArgs=args.slice()}else if(Buffer.isBuffer(args[0])){fields=null;msgArgs=args.slice();msgArgs[0]=util.inspect(msgArgs[0])}else{fields=args[0];if(fields&&args.length===1&&fields.err&&fields.err instanceof Error){msgArgs=[fields.err.message]}else{msgArgs=args.slice(1)}}var rec=objCopy(log.fields);var level=rec.level=minLevel;var recFields=fields?objCopy(fields):null;if(recFields){if(log.serializers){log._applySerializers(recFields,excludeFields)}Object.keys(recFields).forEach(function(k){rec[k]=recFields[k]})}rec.msg=format.apply(log,msgArgs);if(!rec.time){rec.time=new Date}if(log.src&&!rec.src){rec.src=getCaller3Info()}rec.v=LOG_VERSION;return rec}function mkProbeArgs(str,log,minLevel,msgArgs){return[str||log._emit(mkRecord(log,minLevel,msgArgs),true)]}function mkLogEmitter(minLevel){return function(){var log=this;var str=null;var rec=null;if(!this._emit){var dedupKey="unbound";if(!_haveWarned[dedupKey]){var caller=getCaller3Info();_warn(format("bunyan usage error: %s:%s: attempt to log "+"with an unbound log method: `this` is: %s",caller.file,caller.line,util.inspect(this)),dedupKey)}return}else if(arguments.length===0){return this._level<=minLevel}var msgArgs=new Array(arguments.length);for(var i=0;i<msgArgs.length;++i){msgArgs[i]=arguments[i]}if(this._level<=minLevel){rec=mkRecord(log,minLevel,msgArgs);str=this._emit(rec)}if(probes){probes[minLevel].fire(mkProbeArgs,str,log,minLevel,msgArgs)}}}Logger.prototype.trace=mkLogEmitter(TRACE);Logger.prototype.debug=mkLogEmitter(DEBUG);Logger.prototype.info=mkLogEmitter(INFO);Logger.prototype.warn=mkLogEmitter(WARN);Logger.prototype.error=mkLogEmitter(ERROR);Logger.prototype.fatal=mkLogEmitter(FATAL);Logger.stdSerializers={};Logger.stdSerializers.req=function(req){if(!req||!req.connection)return req;return{method:req.method,url:req.url,headers:req.headers,remoteAddress:req.connection.remoteAddress,remotePort:req.connection.remotePort}};Logger.stdSerializers.res=function(res){if(!res||!res.statusCode)return res;return{statusCode:res.statusCode,header:res._header}};function getFullErrorStack(ex){var ret=ex.stack||ex.toString();if(ex.cause&&typeof ex.cause==="function"){var cex=ex.cause();if(cex){ret+="\nCaused by: "+getFullErrorStack(cex)}}return ret}var errSerializer=Logger.stdSerializers.err=function(err){if(!err||!err.stack)return err;var obj={message:err.message,name:err.name,stack:getFullErrorStack(err),code:err.code,signal:err.signal};return obj};function safeCyclesSet(){var seen=new Set;return function(key,val){if(!val||typeof val!=="object"){return val}if(seen.has(val)){return"[Circular]"}seen.add(val);return val}}function safeCyclesArray(){var seen=[];return function(key,val){if(!val||typeof val!=="object"){return val}if(seen.indexOf(val)!==-1){return"[Circular]"}seen.push(val);return val}}var safeCycles=typeof Set!=="undefined"?safeCyclesSet:safeCyclesArray;function fastAndSafeJsonStringify(rec){try{return JSON.stringify(rec)}catch(ex){try{return JSON.stringify(rec,safeCycles())}catch(e){if(safeJsonStringify){return safeJsonStringify(rec)}else{var dedupKey=e.stack.split(/\n/g,3).join("\n");_warn("bunyan: ERROR: Exception in "+"`JSON.stringify(rec)`. You can install the "+'"safe-json-stringify" module to have Bunyan fallback '+"to safer stringification. Record:\n"+_indent(format("%s\n%s",util.inspect(rec),e.stack)),dedupKey);return format("(Exception in JSON.stringify(rec): %j. "+"See stderr for details.)",e.message)}}}}var RotatingFileStream=null;if(mv){RotatingFileStream=function RotatingFileStream(options){this.path=options.path;this.count=options.count==null?10:options.count;assert.equal(typeof this.count,"number",format('rotating-file stream "count" is not a number: %j (%s) in %j',this.count,typeof this.count,this));assert.ok(this.count>=0,format('rotating-file stream "count" is not >= 0: %j in %j',this.count,this));if(options.period){var period={hourly:"1h",daily:"1d",weekly:"1w",monthly:"1m",yearly:"1y"}[options.period]||options.period;var m=/^([1-9][0-9]*)([hdwmy]|ms)$/.exec(period);if(!m){throw new Error(format('invalid period: "%s"',options.period))}this.periodNum=Number(m[1]);this.periodScope=m[2]}else{this.periodNum=1;this.periodScope="d"}var lastModified=null;try{var fileInfo=fs.statSync(this.path);lastModified=fileInfo.mtime.getTime()}catch(err){}var rotateAfterOpen=false;if(lastModified){var lastRotTime=this._calcRotTime(0);if(lastModified<lastRotTime){rotateAfterOpen=true}}this.stream=fs.createWriteStream(this.path,{flags:"a",encoding:"utf8"});this.rotQueue=[];this.rotating=false;if(rotateAfterOpen){this._debug("rotateAfterOpen -> call rotate()");this.rotate()}else{this._setupNextRot()}};util.inherits(RotatingFileStream,EventEmitter);RotatingFileStream.prototype._debug=function(){if(false){if(arguments.length===0){return true}var args=Array.prototype.slice.call(arguments);args[0]="["+(new Date).toISOString()+", "+this.path+"] "+args[0];console.log.apply(this,args)}else{return false}};RotatingFileStream.prototype._setupNextRot=function(){this.rotAt=this._calcRotTime(1);this._setRotationTimer()};RotatingFileStream.prototype._setRotationTimer=function(){var self=this;var delay=this.rotAt-Date.now();var TIMEOUT_MAX=2147483647;if(delay>TIMEOUT_MAX){delay=TIMEOUT_MAX}this.timeout=setTimeout(function(){self._debug("_setRotationTimer timeout -> call rotate()");self.rotate()},delay);if(typeof this.timeout.unref==="function"){this.timeout.unref()}};RotatingFileStream.prototype._calcRotTime=function _calcRotTime(periodOffset){this._debug("_calcRotTime: %s%s",this.periodNum,this.periodScope);var d=new Date;this._debug("  now local: %s",d);this._debug("    now utc: %s",d.toISOString());var rotAt;switch(this.periodScope){case"ms":if(this.rotAt){rotAt=this.rotAt+this.periodNum*periodOffset}else{rotAt=Date.now()+this.periodNum*periodOffset}break;case"h":if(this.rotAt){rotAt=this.rotAt+this.periodNum*60*60*1e3*periodOffset}else{rotAt=Date.UTC(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate(),d.getUTCHours()+periodOffset)}break;case"d":if(this.rotAt){rotAt=this.rotAt+this.periodNum*24*60*60*1e3*periodOffset}else{rotAt=Date.UTC(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()+periodOffset)}break;case"w":if(this.rotAt){rotAt=this.rotAt+this.periodNum*7*24*60*60*1e3*periodOffset}else{var dayOffset=7-d.getUTCDay();if(periodOffset<1){dayOffset=-d.getUTCDay()}if(periodOffset>1||periodOffset<-1){dayOffset+=7*periodOffset}rotAt=Date.UTC(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()+dayOffset)}break;case"m":if(this.rotAt){rotAt=Date.UTC(d.getUTCFullYear(),d.getUTCMonth()+this.periodNum*periodOffset,1)}else{rotAt=Date.UTC(d.getUTCFullYear(),d.getUTCMonth()+periodOffset,1)}break;case"y":if(this.rotAt){rotAt=Date.UTC(d.getUTCFullYear()+this.periodNum*periodOffset,0,1)}else{rotAt=Date.UTC(d.getUTCFullYear()+periodOffset,0,1)}break;default:assert.fail(format('invalid period scope: "%s"',this.periodScope))}if(this._debug()){this._debug("  **rotAt**: %s (utc: %s)",rotAt,new Date(rotAt).toUTCString());var now=Date.now();this._debug("        now: %s (%sms == %smin == %sh to go)",now,rotAt-now,(rotAt-now)/1e3/60,(rotAt-now)/1e3/60/60)}return rotAt};RotatingFileStream.prototype.rotate=function rotate(){var self=this;if(self.rotAt&&self.rotAt>Date.now()){return self._setRotationTimer()}this._debug("rotate");if(self.rotating){throw new TypeError("cannot start a rotation when already rotating")}self.rotating=true;self.stream.end();function del(){var toDel=self.path+"."+String(n-1);if(n===0){toDel=self.path}n-=1;self._debug("  rm %s",toDel);fs.unlink(toDel,function(delErr){moves()})}function moves(){if(self.count===0||n<0){return finish()}var before=self.path;var after=self.path+"."+String(n);if(n>0){before+="."+String(n-1)}n-=1;fs.exists(before,function(exists){if(!exists){moves()}else{self._debug("  mv %s %s",before,after);mv(before,after,function(mvErr){if(mvErr){self.emit("error",mvErr);finish()}else{moves()}})}})}function finish(){self._debug("  open %s",self.path);self.stream=fs.createWriteStream(self.path,{flags:"a",encoding:"utf8"});var q=self.rotQueue,len=q.length;for(var i=0;i<len;i++){self.stream.write(q[i])}self.rotQueue=[];self.rotating=false;self.emit("drain");self._setupNextRot()}var n=this.count;del()};RotatingFileStream.prototype.write=function write(s){if(this.rotating){this.rotQueue.push(s);return false}else{return this.stream.write(s)}};RotatingFileStream.prototype.end=function end(s){this.stream.end()};RotatingFileStream.prototype.destroy=function destroy(s){this.stream.destroy()};RotatingFileStream.prototype.destroySoon=function destroySoon(s){this.stream.destroySoon()}}function RingBuffer(options){this.limit=options&&options.limit?options.limit:100;this.writable=true;this.records=[];EventEmitter.call(this)}util.inherits(RingBuffer,EventEmitter);RingBuffer.prototype.write=function(record){if(!this.writable)throw new Error("RingBuffer has been ended already");this.records.push(record);if(this.records.length>this.limit)this.records.shift();return true};RingBuffer.prototype.end=function(){if(arguments.length>0)this.write.apply(this,Array.prototype.slice.call(arguments));this.writable=false};RingBuffer.prototype.destroy=function(){this.writable=false;this.emit("close")};RingBuffer.prototype.destroySoon=function(){this.destroy()};module.exports=Logger;module.exports.TRACE=TRACE;module.exports.DEBUG=DEBUG;module.exports.INFO=INFO;module.exports.WARN=WARN;module.exports.ERROR=ERROR;module.exports.FATAL=FATAL;module.exports.resolveLevel=resolveLevel;module.exports.levelFromName=levelFromName;module.exports.nameFromLevel=nameFromLevel;module.exports.VERSION=VERSION;module.exports.LOG_VERSION=LOG_VERSION;module.exports.createLogger=function createLogger(options){return new Logger(options)};module.exports.RingBuffer=RingBuffer;module.exports.RotatingFileStream=RotatingFileStream;module.exports.safeCycles=safeCycles}).call(this,{isBuffer:require("../../is-buffer/index.js")},require("_process"))},{"../../is-buffer/index.js":19,_process:74,assert:5,events:16,fs:11,os:72,"safe-json-stringify":89,stream:91,util:98}],14:[function(require,module,exports){(function(Buffer){function isArray(arg){if(Array.isArray){return Array.isArray(arg)}return objectToString(arg)==="[object Array]"}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return objectToString(e)==="[object Error]"||e instanceof Error}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=Buffer.isBuffer;function objectToString(o){return Object.prototype.toString.call(o)}}).call(this,{isBuffer:require("../../is-buffer/index.js")})},{"../../is-buffer/index.js":19}],15:[function(require,module,exports){"use strict";var defaultEscapes={"{":"\\{","}":"\\}","\\":"\\textbackslash{}","#":"\\#",$:"\\$","%":"\\%","&":"\\&","^":"\\textasciicircum{}",_:"\\_","~":"\\textasciitilde{}"};var formatEscapes={"–":"\\--","—":"\\---"," ":"~","\t":"\\qquad{}","\r\n":"\\\\newline{}","\n":"\\\\newline{}"};var defaultEscapeMapFn=function defaultEscapeMapFn(defaultEscapes,formatEscapes){return Object.assign({},defaultEscapes,formatEscapes)};module.exports=function(str){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref$preserveFormatti=_ref.preserveFormatting,preserveFormatting=_ref$preserveFormatti===undefined?false:_ref$preserveFormatti,_ref$escapeMapFn=_ref.escapeMapFn,escapeMapFn=_ref$escapeMapFn===undefined?defaultEscapeMapFn:_ref$escapeMapFn;var runningStr=String(str);var result="";var escapes=escapeMapFn(Object.assign({},defaultEscapes),preserveFormatting?Object.assign({},formatEscapes):{});var escapeKeys=Object.keys(escapes);var _loop=function _loop(){var specialCharFound=false;escapeKeys.forEach(function(key,index){if(specialCharFound){return}if(runningStr.startsWith(key)){result+=escapes[escapeKeys[index]];runningStr=runningStr.slice(key.length,runningStr.length);specialCharFound=true}});if(!specialCharFound){result+=runningStr.slice(0,1);runningStr=runningStr.slice(1,runningStr.length)}};while(runningStr){_loop()}return result}},{}],16:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}else{var err=new Error('Uncaught, unspecified "error" event. ('+er+")");err.context=er;throw err}}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1);handler.apply(this,args)}}else if(isObject(handler)){args=Array.prototype.slice.call(arguments,1);listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-- >0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else if(listeners){while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;else if(evlistener)return evlistener.length}return 0};EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],17:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],18:[function(require,module,exports){arguments[4][6][0].apply(exports,arguments)},{dup:6}],19:[function(require,module,exports){module.exports=function(obj){return obj!=null&&(isBuffer(obj)||isSlowBuffer(obj)||!!obj._isBuffer)};function isBuffer(obj){return!!obj.constructor&&typeof obj.constructor.isBuffer==="function"&&obj.constructor.isBuffer(obj)}function isSlowBuffer(obj){return typeof obj.readFloatLE==="function"&&typeof obj.slice==="function"&&isBuffer(obj.slice(0,0))}},{}],20:[function(require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return toString.call(arr)=="[object Array]"}},{}],21:[function(require,module,exports){module.exports=require("./lib/core/core")},{"./lib/core/core":22}],22:[function(require,module,exports){"use strict";var isFactory=require("./../utils/object").isFactory;var typedFactory=require("./typed");var emitter=require("./../utils/emitter");var importFactory=require("./function/import");var configFactory=require("./function/config");exports.create=function create(options){if(typeof Object.create!=="function"){throw new Error("ES5 not supported by this JavaScript engine. "+"Please load the es5-shim and es5-sham library for compatibility.")}var factories=[];var instances=[];var math=emitter.mixin({});math.type={};math.expression={transform:{},mathWithTransform:{}};math.typed=typedFactory.create(math.type);var _config={epsilon:1e-12,matrix:"Matrix",number:"number",precision:64,predictable:false,randomSeed:null};function load(factory){if(!isFactory(factory)){throw new Error("Factory object with properties `type`, `name`, and `factory` expected")}var index=factories.indexOf(factory);var instance;if(index===-1){if(factory.math===true){instance=factory.factory(math.type,_config,load,math.typed,math)}else{instance=factory.factory(math.type,_config,load,math.typed)}factories.push(factory);instances.push(instance)}else{instance=instances[index]}return instance}math["import"]=load(importFactory);math["config"]=load(configFactory);math.expression.mathWithTransform["config"]=math["config"];if(options){math.config(options)}return math}},{"./../utils/emitter":66,"./../utils/object":69,"./function/config":23,"./function/import":24,"./typed":25}],23:[function(require,module,exports){"use strict";var object=require("../../utils/object");function factory(type,config,load,typed,math){var MATRIX=["Matrix","Array"];var NUMBER=["number","BigNumber","Fraction"];function _config(options){if(options){var prev=object.map(config,object.clone);validateOption(options,"matrix",MATRIX);validateOption(options,"number",NUMBER);object.deepExtend(config,options);var curr=object.map(config,object.clone);var changes=object.map(options,object.clone);math.emit("config",curr,prev,changes);return curr}else{return object.map(config,object.clone)}}_config.MATRIX=MATRIX;_config.NUMBER=NUMBER;return _config}function contains(array,item){return array.indexOf(item)!==-1}function findIndex(array,item){return array.map(function(i){return i.toLowerCase()}).indexOf(item.toLowerCase())}function validateOption(options,name,values){if(options[name]!==undefined&&!contains(values,options[name])){var index=findIndex(values,options[name]);if(index!==-1){console.warn('Warning: Wrong casing for configuration option "'+name+'", should be "'+values[index]+'" instead of "'+options[name]+'".');options[name]=values[index]}else{console.warn('Warning: Unknown value "'+options[name]+'" for configuration option "'+name+'". Available options: '+values.map(JSON.stringify).join(", ")+".")}}}exports.name="config";exports.math=true;exports.factory=factory},{"../../utils/object":69}],24:[function(require,module,exports){"use strict";var lazy=require("../../utils/object").lazy;var isFactory=require("../../utils/object").isFactory;var traverse=require("../../utils/object").traverse;var ArgumentsError=require("../../error/ArgumentsError");function factory(type,config,load,typed,math){function math_import(object,options){var num=arguments.length;if(num!==1&&num!==2){throw new ArgumentsError("import",num,1,2)}if(!options){options={}}if(isFactory(object)){_importFactory(object,options)}else if(Array.isArray(object)){object.forEach(function(entry){math_import(entry,options)})}else if(typeof object==="object"){for(var name in object){if(object.hasOwnProperty(name)){var value=object[name];if(isSupportedType(value)){_import(name,value,options)}else if(isFactory(object)){_importFactory(object,options)}else{math_import(value,options)}}}}else{if(!options.silent){throw new TypeError("Factory, Object, or Array expected")}}}function _import(name,value,options){if(options.wrap&&typeof value==="function"){value=_wrap(value)}if(isTypedFunction(math[name])&&isTypedFunction(value)){if(options.override){value=typed(name,value.signatures)}else{value=typed(math[name],value)}math[name]=value;_importTransform(name,value);math.emit("import",name,function resolver(){return value});return}if(math[name]===undefined||options.override){math[name]=value;_importTransform(name,value);math.emit("import",name,function resolver(){return value});return}if(!options.silent){throw new Error('Cannot import "'+name+'": already exists')}}function _importTransform(name,value){if(value&&typeof value.transform==="function"){math.expression.transform[name]=value.transform;if(allowedInExpressions(name)){math.expression.mathWithTransform[name]=value.transform}}else{delete math.expression.transform[name];if(allowedInExpressions(name)){math.expression.mathWithTransform[name]=value}}}function _wrap(fn){var wrapper=function wrapper(){var args=[];for(var i=0,len=arguments.length;i<len;i++){var arg=arguments[i];args[i]=arg&&arg.valueOf()}return fn.apply(math,args)};if(fn.transform){wrapper.transform=fn.transform}return wrapper}function _importFactory(factory,options){if(typeof factory.name==="string"){var name=factory.name;var existingTransform=name in math.expression.transform;var namespace=factory.path?traverse(math,factory.path):math;var existing=namespace.hasOwnProperty(name)?namespace[name]:undefined;var resolver=function(){var instance=load(factory);if(instance&&typeof instance.transform==="function"){throw new Error("Transforms cannot be attached to factory functions. "+'Please create a separate function for it with exports.path="expression.transform"')}if(isTypedFunction(existing)&&isTypedFunction(instance)){if(options.override){}else{instance=typed(existing,instance)}return instance}if(existing===undefined||options.override){return instance}if(!options.silent){throw new Error('Cannot import "'+name+'": already exists')}};if(factory.lazy!==false){lazy(namespace,name,resolver);if(!existingTransform){if(factory.path==="expression.transform"||factoryAllowedInExpressions(factory)){lazy(math.expression.mathWithTransform,name,resolver)}}}else{namespace[name]=resolver();if(!existingTransform){if(factory.path==="expression.transform"||factoryAllowedInExpressions(factory)){math.expression.mathWithTransform[name]=resolver()}}}math.emit("import",name,resolver,factory.path)}else{load(factory)}}function isSupportedType(object){return typeof object==="function"||typeof object==="number"||typeof object==="string"||typeof object==="boolean"||object===null||object&&type.isUnit(object)||object&&type.isComplex(object)||object&&type.isBigNumber(object)||object&&type.isFraction(object)||object&&type.isMatrix(object)||object&&Array.isArray(object)}function isTypedFunction(fn){return typeof fn==="function"&&typeof fn.signatures==="object"}function allowedInExpressions(name){return!unsafe.hasOwnProperty(name)}function factoryAllowedInExpressions(factory){return factory.path===undefined&&!unsafe.hasOwnProperty(factory.name)}var unsafe={expression:true,type:true,docs:true,error:true,json:true,chain:true};return math_import}exports.math=true;exports.name="import";exports.factory=factory;exports.lazy=true},{"../../error/ArgumentsError":26,"../../utils/object":69}],25:[function(require,module,exports){"use strict";var typedFunction=require("typed-function");var digits=require("./../utils/number").digits;var isBigNumber=require("./../utils/bignumber/isBigNumber");var isMatrix=require("./../utils/collection/isMatrix");var createTyped=function(){createTyped=typedFunction.create;return typedFunction};exports.create=function create(type){type.isNumber=function(x){return typeof x==="number"};type.isComplex=function(x){return type.Complex&&x instanceof type.Complex||false};type.isBigNumber=isBigNumber;type.isFraction=function(x){return type.Fraction&&x instanceof type.Fraction||false};type.isUnit=function(x){return x&&x.constructor.prototype.isUnit||false};type.isString=function(x){return typeof x==="string"};type.isArray=Array.isArray;type.isMatrix=isMatrix;type.isDenseMatrix=function(x){return x&&x.isDenseMatrix&&x.constructor.prototype.isMatrix||false};type.isSparseMatrix=function(x){return x&&x.isSparseMatrix&&x.constructor.prototype.isMatrix||false};type.isRange=function(x){return x&&x.constructor.prototype.isRange||false};type.isIndex=function(x){return x&&x.constructor.prototype.isIndex||false};type.isBoolean=function(x){return typeof x==="boolean"};type.isResultSet=function(x){return x&&x.constructor.prototype.isResultSet||false};type.isHelp=function(x){return x&&x.constructor.prototype.isHelp||false};type.isFunction=function(x){return typeof x==="function"};type.isDate=function(x){return x instanceof Date};type.isRegExp=function(x){return x instanceof RegExp};type.isObject=function(x){return typeof x==="object"&&x.constructor===Object&&!type.isComplex(x)&&!type.isFraction(x)};type.isNull=function(x){return x===null};type.isUndefined=function(x){return x===undefined};type.isAccessorNode=function(x){return x&&x.isAccessorNode&&x.constructor.prototype.isNode||false};type.isArrayNode=function(x){return x&&x.isArrayNode&&x.constructor.prototype.isNode||false};type.isAssignmentNode=function(x){return x&&x.isAssignmentNode&&x.constructor.prototype.isNode||false};type.isBlockNode=function(x){return x&&x.isBlockNode&&x.constructor.prototype.isNode||false};type.isConditionalNode=function(x){return x&&x.isConditionalNode&&x.constructor.prototype.isNode||false};type.isConstantNode=function(x){return x&&x.isConstantNode&&x.constructor.prototype.isNode||false};type.isFunctionAssignmentNode=function(x){return x&&x.isFunctionAssignmentNode&&x.constructor.prototype.isNode||false};type.isFunctionNode=function(x){return x&&x.isFunctionNode&&x.constructor.prototype.isNode||false};type.isIndexNode=function(x){return x&&x.isIndexNode&&x.constructor.prototype.isNode||false};type.isNode=function(x){return x&&x.isNode&&x.constructor.prototype.isNode||false};type.isObjectNode=function(x){return x&&x.isObjectNode&&x.constructor.prototype.isNode||false};type.isOperatorNode=function(x){return x&&x.isOperatorNode&&x.constructor.prototype.isNode||false};type.isParenthesisNode=function(x){return x&&x.isParenthesisNode&&x.constructor.prototype.isNode||false};type.isRangeNode=function(x){return x&&x.isRangeNode&&x.constructor.prototype.isNode||false};type.isSymbolNode=function(x){return x&&x.isSymbolNode&&x.constructor.prototype.isNode||false};type.isChain=function(x){return x&&x.constructor.prototype.isChain||false};var typed=createTyped();typed.types=[{name:"number",test:type.isNumber},{name:"Complex",test:type.isComplex},{name:"BigNumber",test:type.isBigNumber},{name:"Fraction",test:type.isFraction},{name:"Unit",test:type.isUnit},{name:"string",test:type.isString},{name:"Array",test:type.isArray},{name:"Matrix",test:type.isMatrix},{name:"DenseMatrix",test:type.isDenseMatrix},{name:"SparseMatrix",test:type.isSparseMatrix},{name:"Range",test:type.isRange},{name:"Index",test:type.isIndex},{name:"boolean",test:type.isBoolean},{name:"ResultSet",test:type.isResultSet},{name:"Help",test:type.isHelp},{name:"function",test:type.isFunction},{name:"Date",test:type.isDate},{name:"RegExp",test:type.isRegExp},{name:"null",test:type.isNull},{name:"undefined",test:type.isUndefined},{name:"OperatorNode",test:type.isOperatorNode},{name:"ConstantNode",test:type.isConstantNode},{name:"SymbolNode",test:type.isSymbolNode},{name:"ParenthesisNode",test:type.isParenthesisNode},{name:"FunctionNode",test:type.isFunctionNode},{name:"FunctionAssignmentNode",test:type.isFunctionAssignmentNode},{name:"ArrayNode",test:type.isArrayNode},{name:"AssignmentNode",test:type.isAssignmentNode},{name:"BlockNode",test:type.isBlockNode},{name:"ConditionalNode",test:type.isConditionalNode},{name:"IndexNode",test:type.isIndexNode},{name:"RangeNode",test:type.isRangeNode},{name:"Node",test:type.isNode},{name:"Object",test:type.isObject}];typed.conversions=[{from:"number",to:"BigNumber",convert:function(x){if(digits(x)>15){throw new TypeError("Cannot implicitly convert a number with >15 significant digits to BigNumber "+"(value: "+x+"). "+"Use function bignumber(x) to convert to BigNumber.")}return new type.BigNumber(x)}},{from:"number",to:"Complex",convert:function(x){return new type.Complex(x,0)}},{from:"number",to:"string",convert:function(x){return x+""}},{from:"BigNumber",to:"Complex",convert:function(x){return new type.Complex(x.toNumber(),0)}},{from:"Fraction",to:"BigNumber",convert:function(x){throw new TypeError("Cannot implicitly convert a Fraction to BigNumber or vice versa. "+"Use function bignumber(x) to convert to BigNumber or fraction(x) to convert to Fraction.")}},{from:"Fraction",to:"Complex",convert:function(x){return new type.Complex(x.valueOf(),0)}},{from:"number",to:"Fraction",convert:function(x){var f=new type.Fraction(x);if(f.valueOf()!==x){throw new TypeError("Cannot implicitly convert a number to a Fraction when there will be a loss of precision "+"(value: "+x+"). "+"Use function fraction(x) to convert to Fraction.")}return new type.Fraction(x)}},{from:"string",to:"number",convert:function(x){var n=Number(x);if(isNaN(n)){throw new Error('Cannot convert "'+x+'" to a number')}return n}},{from:"string",to:"BigNumber",convert:function(x){try{return new type.BigNumber(x)}catch(err){throw new Error('Cannot convert "'+x+'" to BigNumber')}}},{from:"string",to:"Fraction",convert:function(x){try{return new type.Fraction(x)}catch(err){throw new Error('Cannot convert "'+x+'" to Fraction')}}},{from:"string",to:"Complex",convert:function(x){try{return new type.Complex(x)}catch(err){throw new Error('Cannot convert "'+x+'" to Complex')}}},{from:"boolean",to:"number",convert:function(x){return+x}},{from:"boolean",to:"BigNumber",convert:function(x){return new type.BigNumber(+x)}},{from:"boolean",to:"Fraction",convert:function(x){return new type.Fraction(+x)}},{from:"boolean",to:"string",convert:function(x){return+x}},{from:"Array",to:"Matrix",convert:function(array){return new type.DenseMatrix(array)}},{from:"Matrix",to:"Array",convert:function(matrix){return matrix.valueOf()}}];return typed}},{"./../utils/bignumber/isBigNumber":62,"./../utils/collection/isMatrix":64,"./../utils/number":68,"typed-function":95}],26:[function(require,module,exports){"use strict";function ArgumentsError(fn,count,min,max){if(!(this instanceof ArgumentsError)){throw new SyntaxError("Constructor must be called with the new operator")}this.fn=fn;this.count=count;this.min=min;this.max=max;this.message="Wrong number of arguments in function "+fn+" ("+count+" provided, "+min+(max!=undefined?"-"+max:"")+" expected)";this.stack=(new Error).stack}ArgumentsError.prototype=new Error;ArgumentsError.prototype.constructor=Error;ArgumentsError.prototype.name="ArgumentsError";ArgumentsError.prototype.isArgumentsError=true;module.exports=ArgumentsError},{}],27:[function(require,module,exports){"use strict";function DimensionError(actual,expected,relation){if(!(this instanceof DimensionError)){throw new SyntaxError("Constructor must be called with the new operator")}this.actual=actual;this.expected=expected;this.relation=relation;this.message="Dimension mismatch ("+(Array.isArray(actual)?"["+actual.join(", ")+"]":actual)+" "+(this.relation||"!=")+" "+(Array.isArray(expected)?"["+expected.join(", ")+"]":expected)+")";this.stack=(new Error).stack}DimensionError.prototype=new RangeError;DimensionError.prototype.constructor=RangeError;DimensionError.prototype.name="DimensionError";DimensionError.prototype.isDimensionError=true;module.exports=DimensionError},{}],28:[function(require,module,exports){"use strict";function IndexError(index,min,max){if(!(this instanceof IndexError)){throw new SyntaxError("Constructor must be called with the new operator")}this.index=index;if(arguments.length<3){this.min=0;this.max=min}else{this.min=min;this.max=max}if(this.min!==undefined&&this.index<this.min){this.message="Index out of range ("+this.index+" < "+this.min+")"}else if(this.max!==undefined&&this.index>=this.max){this.message="Index out of range ("+this.index+" > "+(this.max-1)+")"}else{this.message="Index out of range ("+this.index+")"}this.stack=(new Error).stack}IndexError.prototype=new RangeError;IndexError.prototype.constructor=RangeError;IndexError.prototype.name="IndexError";IndexError.prototype.isIndexError=true;module.exports=IndexError},{}],29:[function(require,module,exports){"use strict";var deepMap=require("../../utils/collection/deepMap");function factory(type,config,load,typed){var parse=load(require("../parse"));return typed("compile",{string:function(expr){return parse(expr).compile()},"Array | Matrix":function(expr){return deepMap(expr,function(entry){return parse(entry).compile()})}})}exports.name="compile";exports.factory=factory},{"../../utils/collection/deepMap":63,"../parse":51}],30:[function(require,module,exports){"use strict";var deepMap=require("../../utils/collection/deepMap");function factory(type,config,load,typed){var parse=load(require("../parse"));return typed("compile",{string:function(expr){var scope={};return parse(expr).compile().eval(scope)},"string, Object":function(expr,scope){return parse(expr).compile().eval(scope)},"Array | Matrix":function(expr){var scope={};return deepMap(expr,function(entry){return parse(entry).compile().eval(scope)})},"Array | Matrix, Object":function(expr,scope){return deepMap(expr,function(entry){return parse(entry).compile().eval(scope)})}})}exports.name="eval";exports.factory=factory},{"../../utils/collection/deepMap":63,"../parse":51}],31:[function(require,module,exports){"use strict";function factory(type,config,load,typed){var parse=load(require("../parse"));return typed("parse",{"string | Array | Matrix":parse,"string | Array | Matrix, Object":parse})}exports.name="parse";exports.factory=factory},{"../parse":51}],32:[function(require,module,exports){"use strict";module.exports={end:true}},{}],33:[function(require,module,exports){"use strict";var getSafeProperty=require("../../utils/customs").getSafeProperty;function factory(type,config,load,typed){var Node=load(require("./Node"));var IndexNode=load(require("./IndexNode"));var access=load(require("./utils/access"));function AccessorNode(object,index){if(!(this instanceof AccessorNode)){throw new SyntaxError("Constructor must be called with the new operator")}if(!type.isNode(object)){throw new TypeError('Node expected for parameter "object"')}if(!type.isIndexNode(index)){throw new TypeError('IndexNode expected for parameter "index"')}this.object=object||null;this.index=index;Object.defineProperty(this,"name",{get:function(){if(this.index){return this.index.isObjectProperty()?this.index.getObjectProperty():""}else{return this.object.name||""}}.bind(this),set:function(){throw new Error("Cannot assign a new name, name is read-only")}})}AccessorNode.prototype=new Node;AccessorNode.prototype.type="AccessorNode";AccessorNode.prototype.isAccessorNode=true;AccessorNode.prototype._compile=function(math,argNames){var evalObject=this.object._compile(math,argNames);var evalIndex=this.index._compile(math,argNames);if(this.index.isObjectProperty()){var prop=this.index.getObjectProperty();return function evalAccessorNode(scope,args,context){return getSafeProperty(evalObject(scope,args,context),prop)}}else{return function evalAccessorNode(scope,args,context){var object=evalObject(scope,args,context);var index=evalIndex(scope,args,object);return access(object,index)}}};AccessorNode.prototype.forEach=function(callback){callback(this.object,"object",this);callback(this.index,"index",this)};AccessorNode.prototype.map=function(callback){return new AccessorNode(this._ifNode(callback(this.object,"object",this)),this._ifNode(callback(this.index,"index",this)))};AccessorNode.prototype.clone=function(){return new AccessorNode(this.object,this.index)};AccessorNode.prototype._toString=function(options){var object=this.object.toString(options);if(needParenthesis(this.object)){object="("+object+")"}return object+this.index.toString(options)};AccessorNode.prototype.toHTML=function(options){var object=this.object.toHTML(options);if(needParenthesis(this.object)){object='<span class="math-parenthesis math-round-parenthesis">(</span>'+object+'<span class="math-parenthesis math-round-parenthesis">)</span>'}return object+this.index.toHTML(options)};AccessorNode.prototype._toTex=function(options){var object=this.object.toTex(options);if(needParenthesis(this.object)){object="\\left("+object+"\\right)"}return object+this.index.toTex(options)};AccessorNode.prototype.toJSON=function(){return{mathjs:"AccessorNode",object:this.object,index:this.index}};AccessorNode.fromJSON=function(json){return new AccessorNode(json.object,json.index)};function needParenthesis(node){return!(type.isAccessorNode(node)||type.isArrayNode(node)||type.isConstantNode(node)||type.isFunctionNode(node)||type.isObjectNode(node)||type.isParenthesisNode(node)||type.isSymbolNode(node))}return AccessorNode}exports.name="AccessorNode";exports.path="expression.node";exports.factory=factory},{"../../utils/customs":65,"./IndexNode":41,"./Node":42,"./utils/access":48}],34:[function(require,module,exports){"use strict";var map=require("../../utils/array").map;function factory(type,config,load,typed){var Node=load(require("./Node"));function ArrayNode(items){if(!(this instanceof ArrayNode)){throw new SyntaxError("Constructor must be called with the new operator")}this.items=items||[];if(!Array.isArray(this.items)||!this.items.every(type.isNode)){throw new TypeError("Array containing Nodes expected")}var deprecated=function(){throw new Error("Property `ArrayNode.nodes` is deprecated, use `ArrayNode.items` instead")};Object.defineProperty(this,"nodes",{get:deprecated,set:deprecated})}ArrayNode.prototype=new Node;ArrayNode.prototype.type="ArrayNode";ArrayNode.prototype.isArrayNode=true;ArrayNode.prototype._compile=function(math,argNames){var evalItems=map(this.items,function(item){return item._compile(math,argNames)});var asMatrix=math.config().matrix!=="Array";if(asMatrix){var matrix=math.matrix;return function evalArrayNode(scope,args,context){return matrix(map(evalItems,function(evalItem){return evalItem(scope,args,context)}))}}else{return function evalArrayNode(scope,args,context){return map(evalItems,function(evalItem){return evalItem(scope,args,context)})}}};ArrayNode.prototype.forEach=function(callback){for(var i=0;i<this.items.length;i++){var node=this.items[i];callback(node,"items["+i+"]",this)}};ArrayNode.prototype.map=function(callback){var items=[];for(var i=0;i<this.items.length;i++){items[i]=this._ifNode(callback(this.items[i],"items["+i+"]",this))}return new ArrayNode(items)};ArrayNode.prototype.clone=function(){return new ArrayNode(this.items.slice(0))};ArrayNode.prototype._toString=function(options){var items=this.items.map(function(node){return node.toString(options)});return"["+items.join(", ")+"]"};ArrayNode.prototype.toJSON=function(){return{mathjs:"ArrayNode",items:this.items}};ArrayNode.fromJSON=function(json){return new ArrayNode(json.items)};ArrayNode.prototype.toHTML=function(options){var items=this.items.map(function(node){return node.toHTML(options)});return'<span class="math-parenthesis math-square-parenthesis">[</span>'+items.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-square-parenthesis">]</span>'};ArrayNode.prototype._toTex=function(options){var s="\\begin{bmatrix}";this.items.forEach(function(node){if(node.items){s+=node.items.map(function(childNode){return childNode.toTex(options)}).join("&")}else{s+=node.toTex(options)}s+="\\\\"});s+="\\end{bmatrix}";return s};return ArrayNode}exports.name="ArrayNode";exports.path="expression.node";exports.factory=factory},{"../../utils/array":60,"./Node":42}],35:[function(require,module,exports){"use strict";var getSafeProperty=require("../../utils/customs").getSafeProperty;var setSafeProperty=require("../../utils/customs").setSafeProperty;function factory(type,config,load,typed){var Node=load(require("./Node"));var assign=load(require("./utils/assign"));var access=load(require("./utils/access"));var operators=require("../operators");function AssignmentNode(object,index,value){if(!(this instanceof AssignmentNode)){throw new SyntaxError("Constructor must be called with the new operator")}this.object=object;this.index=value?index:null;this.value=value?value:index;if(!type.isSymbolNode(object)&&!type.isAccessorNode(object)){throw new TypeError('SymbolNode or AccessorNode expected as "object"')}if(type.isSymbolNode(object)&&object.name==="end"){throw new Error('Cannot assign to symbol "end"')}if(this.index&&!type.isIndexNode(this.index)){throw new TypeError('IndexNode expected as "index"')}if(!type.isNode(this.value)){throw new TypeError('Node expected as "value"')}Object.defineProperty(this,"name",{get:function(){if(this.index){return this.index.isObjectProperty()?this.index.getObjectProperty():""}else{return this.object.name||""}}.bind(this),set:function(){throw new Error("Cannot assign a new name, name is read-only")}})}AssignmentNode.prototype=new Node;AssignmentNode.prototype.type="AssignmentNode";AssignmentNode.prototype.isAssignmentNode=true;AssignmentNode.prototype._compile=function(math,argNames){var size;var evalObject=this.object._compile(math,argNames);var evalIndex=this.index?this.index._compile(math,argNames):null;var evalValue=this.value._compile(math,argNames);var name=this.object.name;if(!this.index){if(!type.isSymbolNode(this.object)){throw new TypeError("SymbolNode expected as object")}return function evalAssignmentNode(scope,args,context){return setSafeProperty(scope,name,evalValue(scope,args,context))}}else if(this.index.isObjectProperty()){var prop=this.index.getObjectProperty();return function evalAssignmentNode(scope,args,context){var object=evalObject(scope,args,context);var value=evalValue(scope,args,context);return setSafeProperty(object,prop,value)}}else if(type.isSymbolNode(this.object)){return function evalAssignmentNode(scope,args,context){var childObject=evalObject(scope,args,context);var value=evalValue(scope,args,context);var index=evalIndex(scope,args,childObject);setSafeProperty(scope,name,assign(childObject,index,value));return value}}else{var evalParentObject=this.object.object._compile(math,argNames);if(this.object.index.isObjectProperty()){var parentProp=this.object.index.getObjectProperty();return function evalAssignmentNode(scope,args,context){var parent=evalParentObject(scope,args,context);var childObject=getSafeProperty(parent,parentProp);var index=evalIndex(scope,args,childObject);var value=evalValue(scope,args,context);setSafeProperty(parent,parentProp,assign(childObject,index,value));return value}}else{var evalParentIndex=this.object.index._compile(math,argNames);return function evalAssignmentNode(scope,args,context){var parent=evalParentObject(scope,args,context);var parentIndex=evalParentIndex(scope,args,parent);var childObject=access(parent,parentIndex);var index=evalIndex(scope,args,childObject);var value=evalValue(scope,args,context);assign(parent,parentIndex,assign(childObject,index,value));return value}}}};AssignmentNode.prototype.forEach=function(callback){callback(this.object,"object",this);if(this.index){callback(this.index,"index",this)}callback(this.value,"value",this)};AssignmentNode.prototype.map=function(callback){var object=this._ifNode(callback(this.object,"object",this));var index=this.index?this._ifNode(callback(this.index,"index",this)):null;var value=this._ifNode(callback(this.value,"value",this));return new AssignmentNode(object,index,value)};AssignmentNode.prototype.clone=function(){return new AssignmentNode(this.object,this.index,this.value)};function needParenthesis(node,parenthesis){if(!parenthesis){parenthesis="keep"}var precedence=operators.getPrecedence(node,parenthesis);var exprPrecedence=operators.getPrecedence(node.value,parenthesis);return parenthesis==="all"||exprPrecedence!==null&&exprPrecedence<=precedence}AssignmentNode.prototype._toString=function(options){var object=this.object.toString(options);var index=this.index?this.index.toString(options):"";var value=this.value.toString(options);if(needParenthesis(this,options&&options.parenthesis)){value="("+value+")"}return object+index+" = "+value};AssignmentNode.prototype.toJSON=function(){return{mathjs:"AssignmentNode",object:this.object,index:this.index,value:this.value}};AssignmentNode.fromJSON=function(json){return new AssignmentNode(json.object,json.index,json.value)};AssignmentNode.prototype.toHTML=function(options){var object=this.object.toHTML(options);var index=this.index?this.index.toHTML(options):"";var value=this.value.toHTML(options);if(needParenthesis(this,options&&options.parenthesis)){value='<span class="math-paranthesis math-round-parenthesis">(</span>'+value+'<span class="math-paranthesis math-round-parenthesis">)</span>'}return object+index+'<span class="math-operator math-assignment-operator math-variable-assignment-operator math-binary-operator">=</span>'+value};AssignmentNode.prototype._toTex=function(options){var object=this.object.toTex(options);var index=this.index?this.index.toTex(options):"";var value=this.value.toTex(options);if(needParenthesis(this,options&&options.parenthesis)){value="\\left("+value+"\\right)"}return object+index+":="+value};return AssignmentNode}exports.name="AssignmentNode";exports.path="expression.node";exports.factory=factory},{"../../utils/customs":65,"../operators":50,"./Node":42,"./utils/access":48,"./utils/assign":49}],36:[function(require,module,exports){"use strict";var forEach=require("../../utils/array").forEach;var map=require("../../utils/array").map;function factory(type,config,load,typed){var Node=load(require("./Node"));var ResultSet=load(require("../../type/resultset/ResultSet"));function BlockNode(blocks){if(!(this instanceof BlockNode)){throw new SyntaxError("Constructor must be called with the new operator")}if(!Array.isArray(blocks))throw new Error("Array expected");this.blocks=blocks.map(function(block){var node=block&&block.node;var visible=block&&block.visible!==undefined?block.visible:true;if(!type.isNode(node))throw new TypeError('Property "node" must be a Node');if(typeof visible!=="boolean")throw new TypeError('Property "visible" must be a boolean');return{node:node,visible:visible}})}BlockNode.prototype=new Node;BlockNode.prototype.type="BlockNode";BlockNode.prototype.isBlockNode=true;BlockNode.prototype._compile=function(math,argNames){var evalBlocks=map(this.blocks,function(block){return{eval:block.node._compile(math,argNames),visible:block.visible}});return function evalBlockNodes(scope,args,context){var results=[];forEach(evalBlocks,function evalBlockNode(block){var result=block.eval(scope,args,context);if(block.visible){results.push(result)}});return new ResultSet(results)}};BlockNode.prototype.forEach=function(callback){for(var i=0;i<this.blocks.length;i++){callback(this.blocks[i].node,"blocks["+i+"].node",this)}};BlockNode.prototype.map=function(callback){var blocks=[];for(var i=0;i<this.blocks.length;i++){var block=this.blocks[i];var node=this._ifNode(callback(block.node,"blocks["+i+"].node",this));blocks[i]={node:node,visible:block.visible}}return new BlockNode(blocks)};BlockNode.prototype.clone=function(){var blocks=this.blocks.map(function(block){return{node:block.node,visible:block.visible}});return new BlockNode(blocks)};BlockNode.prototype._toString=function(options){return this.blocks.map(function(param){return param.node.toString(options)+(param.visible?"":";")}).join("\n")};BlockNode.prototype.toJSON=function(){return{mathjs:"BlockNode",blocks:this.blocks}};BlockNode.fromJSON=function(json){return new BlockNode(json.blocks)};BlockNode.prototype.toHTML=function(options){return this.blocks.map(function(param){return param.node.toHTML(options)+(param.visible?"":'<span class="math-separator">;</span>')}).join('<span class="math-separator"><br /></span>')};BlockNode.prototype._toTex=function(options){return this.blocks.map(function(param){return param.node.toTex(options)+(param.visible?"":";")}).join("\\;\\;\n")};return BlockNode}exports.name="BlockNode";exports.path="expression.node";exports.factory=factory},{"../../type/resultset/ResultSet":59,"../../utils/array":60,"./Node":42}],37:[function(require,module,exports){"use strict";var operators=require("../operators");function factory(type,config,load,typed){var Node=load(require("./Node"));var mathTypeOf=load(require("../../function/utils/typeof"));function ConditionalNode(condition,trueExpr,falseExpr){if(!(this instanceof ConditionalNode)){throw new SyntaxError("Constructor must be called with the new operator")}if(!type.isNode(condition))throw new TypeError("Parameter condition must be a Node");if(!type.isNode(trueExpr))throw new TypeError("Parameter trueExpr must be a Node");if(!type.isNode(falseExpr))throw new TypeError("Parameter falseExpr must be a Node");this.condition=condition;this.trueExpr=trueExpr;this.falseExpr=falseExpr}ConditionalNode.prototype=new Node;ConditionalNode.prototype.type="ConditionalNode";ConditionalNode.prototype.isConditionalNode=true;ConditionalNode.prototype._compile=function(math,argNames){var evalCondition=this.condition._compile(math,argNames);var evalTrueExpr=this.trueExpr._compile(math,argNames);var evalFalseExpr=this.falseExpr._compile(math,argNames);return function evalConditionalNode(scope,args,context){return testCondition(evalCondition(scope,args,context))?evalTrueExpr(scope,args,context):evalFalseExpr(scope,args,context)}};ConditionalNode.prototype.forEach=function(callback){callback(this.condition,"condition",this);callback(this.trueExpr,"trueExpr",this);callback(this.falseExpr,"falseExpr",this)};ConditionalNode.prototype.map=function(callback){return new ConditionalNode(this._ifNode(callback(this.condition,"condition",this)),this._ifNode(callback(this.trueExpr,"trueExpr",this)),this._ifNode(callback(this.falseExpr,"falseExpr",this)))};ConditionalNode.prototype.clone=function(){return new ConditionalNode(this.condition,this.trueExpr,this.falseExpr)};ConditionalNode.prototype._toString=function(options){var parenthesis=options&&options.parenthesis?options.parenthesis:"keep";var precedence=operators.getPrecedence(this,parenthesis);var condition=this.condition.toString(options);var conditionPrecedence=operators.getPrecedence(this.condition,parenthesis);if(parenthesis==="all"||this.condition.type==="OperatorNode"||conditionPrecedence!==null&&conditionPrecedence<=precedence){condition="("+condition+")"}var trueExpr=this.trueExpr.toString(options);var truePrecedence=operators.getPrecedence(this.trueExpr,parenthesis);if(parenthesis==="all"||this.trueExpr.type==="OperatorNode"||truePrecedence!==null&&truePrecedence<=precedence){trueExpr="("+trueExpr+")"}var falseExpr=this.falseExpr.toString(options);var falsePrecedence=operators.getPrecedence(this.falseExpr,parenthesis);if(parenthesis==="all"||this.falseExpr.type==="OperatorNode"||falsePrecedence!==null&&falsePrecedence<=precedence){falseExpr="("+falseExpr+")"}return condition+" ? "+trueExpr+" : "+falseExpr};ConditionalNode.prototype.toJSON=function(){return{mathjs:"ConditionalNode",condition:this.condition,trueExpr:this.trueExpr,falseExpr:this.falseExpr}};ConditionalNode.fromJSON=function(json){return new ConditionalNode(json.condition,json.trueExpr,json.falseExpr)};ConditionalNode.prototype.toHTML=function(options){var parenthesis=options&&options.parenthesis?options.parenthesis:"keep";var precedence=operators.getPrecedence(this,parenthesis);var condition=this.condition.toHTML(options);var conditionPrecedence=operators.getPrecedence(this.condition,parenthesis);if(parenthesis==="all"||this.condition.type==="OperatorNode"||conditionPrecedence!==null&&conditionPrecedence<=precedence){condition='<span class="math-parenthesis math-round-parenthesis">(</span>'+condition+'<span class="math-parenthesis math-round-parenthesis">)</span>'}var trueExpr=this.trueExpr.toHTML(options);var truePrecedence=operators.getPrecedence(this.trueExpr,parenthesis);if(parenthesis==="all"||this.trueExpr.type==="OperatorNode"||truePrecedence!==null&&truePrecedence<=precedence){trueExpr='<span class="math-parenthesis math-round-parenthesis">(</span>'+trueExpr+'<span class="math-parenthesis math-round-parenthesis">)</span>'}var falseExpr=this.falseExpr.toHTML(options);var falsePrecedence=operators.getPrecedence(this.falseExpr,parenthesis);if(parenthesis==="all"||this.falseExpr.type==="OperatorNode"||falsePrecedence!==null&&falsePrecedence<=precedence){falseExpr='<span class="math-parenthesis math-round-parenthesis">(</span>'+falseExpr+'<span class="math-parenthesis math-round-parenthesis">)</span>'}return condition+'<span class="math-operator math-conditional-operator">?</span>'+trueExpr+'<span class="math-operator math-conditional-operator">:</span>'+falseExpr};ConditionalNode.prototype._toTex=function(options){return"\\begin{cases} {"+this.trueExpr.toTex(options)+"}, &\\quad{\\text{if }\\;"+this.condition.toTex(options)+"}\\\\{"+this.falseExpr.toTex(options)+"}, &\\quad{\\text{otherwise}}\\end{cases}"};function testCondition(condition){if(typeof condition==="number"||typeof condition==="boolean"||typeof condition==="string"){return condition?true:false}if(condition){if(type.isBigNumber(condition)){return condition.isZero()?false:true}if(type.isComplex(condition)){return condition.re||condition.im?true:false}if(type.isUnit(condition)){return condition.value?true:false}}if(condition===null||condition===undefined){return false}throw new TypeError('Unsupported type of condition "'+mathTypeOf(condition)+'"')}return ConditionalNode}exports.name="ConditionalNode";exports.path="expression.node";exports.factory=factory},{"../../function/utils/typeof":55,"../operators":50,"./Node":42}],38:[function(require,module,exports){"use strict";var format=require("../../utils/string").format;var escapeLatex=require("../../utils/latex").escape;function factory(type,config,load,typed){var Node=load(require("./Node"));var getType=load(require("../../function/utils/typeof"));function ConstantNode(value){if(!(this instanceof ConstantNode)){throw new SyntaxError("Constructor must be called with the new operator")}if(arguments.length===2){throw new SyntaxError("new ConstantNode(valueStr, valueType) is not supported anymore since math v4.0.0. Use new ConstantNode(value) instead, where value is a non-stringified value.")}this.value=value}ConstantNode.prototype=new Node;ConstantNode.prototype.type="ConstantNode";ConstantNode.prototype.isConstantNode=true;ConstantNode.prototype._compile=function(math,argNames){var value=this.value;return function evalConstantNode(){return value}};ConstantNode.prototype.forEach=function(callback){};ConstantNode.prototype.map=function(callback){return this.clone()};ConstantNode.prototype.clone=function(){return new ConstantNode(this.value)};ConstantNode.prototype._toString=function(options){return format(this.value,options)};ConstantNode.prototype.toHTML=function(options){var value=this._toString(options);switch(getType(this.value)){case"number":case"BigNumber":case"Fraction":return'<span class="math-number">'+value+"</span>";case"string":return'<span class="math-string">'+value+"</span>";case"boolean":return'<span class="math-boolean">'+value+"</span>";case"null":return'<span class="math-null-symbol">'+value+"</span>";case"undefined":return'<span class="math-undefined">'+value+"</span>";default:return'<span class="math-symbol">'+value+"</span>"}};ConstantNode.prototype.toJSON=function(){return{mathjs:"ConstantNode",value:this.value}};ConstantNode.fromJSON=function(json){return new ConstantNode(json.value)};ConstantNode.prototype._toTex=function(options){var value=this._toString(options);switch(getType(this.value)){case"string":return"\\mathtt{"+escapeLatex(value)+"}";case"number":case"BigNumber":var index=value.toLowerCase().indexOf("e");if(index!==-1){return value.substring(0,index)+"\\cdot10^{"+value.substring(index+1)+"}"}return value;case"Fraction":return this.value.toLatex();default:return value}};return ConstantNode}exports.name="ConstantNode";exports.path="expression.node";exports.factory=factory},{"../../function/utils/typeof":55,"../../utils/latex":67,"../../utils/string":70,"./Node":42}],39:[function(require,module,exports){"use strict";var keywords=require("../keywords");var escape=require("../../utils/string").escape;var forEach=require("../../utils/array").forEach;var join=require("../../utils/array").join;var latex=require("../../utils/latex");var operators=require("../operators");var setSafeProperty=require("../../utils/customs").setSafeProperty;function factory(type,config,load,typed){var Node=load(require("./Node"));function FunctionAssignmentNode(name,params,expr){if(!(this instanceof FunctionAssignmentNode)){throw new SyntaxError("Constructor must be called with the new operator")}if(typeof name!=="string")throw new TypeError('String expected for parameter "name"');if(!Array.isArray(params))throw new TypeError('Array containing strings or objects expected for parameter "params"');if(!type.isNode(expr))throw new TypeError('Node expected for parameter "expr"');if(name in keywords)throw new Error('Illegal function name, "'+name+'" is a reserved keyword');this.name=name;this.params=params.map(function(param){return param&&param.name||param});this.types=params.map(function(param){return param&&param.type||"any"});this.expr=expr}FunctionAssignmentNode.prototype=new Node;FunctionAssignmentNode.prototype.type="FunctionAssignmentNode";FunctionAssignmentNode.prototype.isFunctionAssignmentNode=true;FunctionAssignmentNode.prototype._compile=function(math,argNames){var childArgNames=Object.create(argNames);forEach(this.params,function(param){childArgNames[param]=true});var evalExpr=this.expr._compile(math,childArgNames);var name=this.name;var params=this.params;var signature=join(this.types,",");var syntax=name+"("+join(this.params,", ")+")";return function evalFunctionAssignmentNode(scope,args,context){var signatures={};signatures[signature]=function(){var childArgs=Object.create(args);for(var i=0;i<params.length;i++){childArgs[params[i]]=arguments[i]}return evalExpr(scope,childArgs,context)};var fn=typed(name,signatures);fn.syntax=syntax;setSafeProperty(scope,name,fn);return fn}};FunctionAssignmentNode.prototype.forEach=function(callback){callback(this.expr,"expr",this)};FunctionAssignmentNode.prototype.map=function(callback){var expr=this._ifNode(callback(this.expr,"expr",this));return new FunctionAssignmentNode(this.name,this.params.slice(0),expr)};FunctionAssignmentNode.prototype.clone=function(){return new FunctionAssignmentNode(this.name,this.params.slice(0),this.expr)};function needParenthesis(node,parenthesis){var precedence=operators.getPrecedence(node,parenthesis);var exprPrecedence=operators.getPrecedence(node.expr,parenthesis);return parenthesis==="all"||exprPrecedence!==null&&exprPrecedence<=precedence}FunctionAssignmentNode.prototype._toString=function(options){var parenthesis=options&&options.parenthesis?options.parenthesis:"keep";var expr=this.expr.toString(options);if(needParenthesis(this,parenthesis)){expr="("+expr+")"}return this.name+"("+this.params.join(", ")+") = "+expr};FunctionAssignmentNode.prototype.toJSON=function(){var types=this.types;return{mathjs:"FunctionAssignmentNode",name:this.name,params:this.params.map(function(param,index){return{name:param,type:types[index]}}),expr:this.expr}};FunctionAssignmentNode.fromJSON=function(json){return new FunctionAssignmentNode(json.name,json.params,json.expr)};FunctionAssignmentNode.prototype.toHTML=function(options){var parenthesis=options&&options.parenthesis?options.parenthesis:"keep";var params=[];for(var i=0;i<this.params.length;i++){params.push('<span class="math-symbol math-parameter">'+escape(this.params[i])+"</span>")}var expr=this.expr.toHTML(options);if(needParenthesis(this,parenthesis)){expr='<span class="math-parenthesis math-round-parenthesis">(</span>'+expr+'<span class="math-parenthesis math-round-parenthesis">)</span>'}return'<span class="math-function">'+escape(this.name)+"</span>"+'<span class="math-parenthesis math-round-parenthesis">(</span>'+params.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-round-parenthesis">)</span><span class="math-operator math-assignment-operator math-variable-assignment-operator math-binary-operator">=</span>'+expr};FunctionAssignmentNode.prototype._toTex=function(options){var parenthesis=options&&options.parenthesis?options.parenthesis:"keep";var expr=this.expr.toTex(options);if(needParenthesis(this,parenthesis)){expr="\\left("+expr+"\\right)"}return"\\mathrm{"+this.name+"}\\left("+this.params.map(latex.toSymbol).join(",")+"\\right):="+expr};return FunctionAssignmentNode}exports.name="FunctionAssignmentNode";exports.path="expression.node";exports.factory=factory},{"../../utils/array":60,"../../utils/customs":65,"../../utils/latex":67,"../../utils/string":70,"../keywords":32,"../operators":50,"./Node":42}],40:[function(require,module,exports){"use strict";var latex=require("../../utils/latex");var escape=require("../../utils/string").escape;var hasOwnProperty=require("../../utils/object").hasOwnProperty;var map=require("../../utils/array").map;var validateSafeMethod=require("../../utils/customs").validateSafeMethod;var getSafeProperty=require("../../utils/customs").getSafeProperty;function factory(type,config,load,typed,math){var Node=load(require("./Node"));var SymbolNode=load(require("./SymbolNode"));function FunctionNode(fn,args){if(!(this instanceof FunctionNode)){throw new SyntaxError("Constructor must be called with the new operator")}if(typeof fn==="string"){fn=new SymbolNode(fn)}if(!type.isNode(fn))throw new TypeError('Node expected as parameter "fn"');if(!Array.isArray(args)||!args.every(type.isNode)){throw new TypeError('Array containing Nodes expected for parameter "args"')}this.fn=fn;this.args=args||[];Object.defineProperty(this,"name",{get:function(){return this.fn.name||""}.bind(this),set:function(){throw new Error("Cannot assign a new name, name is read-only")}});var deprecated=function(){throw new Error("Property `FunctionNode.object` is deprecated, use `FunctionNode.fn` instead")};Object.defineProperty(this,"object",{get:deprecated,set:deprecated})}FunctionNode.prototype=new Node;FunctionNode.prototype.type="FunctionNode";FunctionNode.prototype.isFunctionNode=true;FunctionNode.prototype._compile=function(math,argNames){if(!(this instanceof FunctionNode)){throw new TypeError("No valid FunctionNode")}var evalArgs=map(this.args,function(arg){return arg._compile(math,argNames)});var argsName;if(type.isSymbolNode(this.fn)){var name=this.fn.name;var fn=name in math?getSafeProperty(math,name):undefined;var isRaw=typeof fn==="function"&&fn.rawArgs==true;if(isRaw){var rawArgs=this.args;return function evalFunctionNode(scope,args,context){return(name in scope?getSafeProperty(scope,name):fn)(rawArgs,math,scope)}}else{if(evalArgs.length===1){var evalArg0=evalArgs[0];return function evalFunctionNode(scope,args,context){return(name in scope?getSafeProperty(scope,name):fn)(evalArg0(scope,args,context))}}else if(evalArgs.length===2){var evalArg0=evalArgs[0];var evalArg1=evalArgs[1];return function evalFunctionNode(scope,args,context){return(name in scope?getSafeProperty(scope,name):fn)(evalArg0(scope,args,context),evalArg1(scope,args,context))}}else{return function evalFunctionNode(scope,args,context){return(name in scope?getSafeProperty(scope,name):fn).apply(null,map(evalArgs,function(evalArg){return evalArg(scope,args,context)}))}}}}else if(type.isAccessorNode(this.fn)&&type.isIndexNode(this.fn.index)&&this.fn.index.isObjectProperty()){var evalObject=this.fn.object._compile(math,argNames);var prop=this.fn.index.getObjectProperty();var rawArgs=this.args;return function evalFunctionNode(scope,args,context){var object=evalObject(scope,args,context);validateSafeMethod(object,prop);var isRaw=object[prop]&&object[prop].rawArgs;return isRaw?object[prop](rawArgs,math,scope):object[prop].apply(object,map(evalArgs,function(evalArg){return evalArg(scope,args,context)}))}}else{var evalFn=this.fn._compile(math,argNames);return function evalFunctionNode(scope,args,context){var fn=evalFn(scope,args,context);var isRaw=fn&&fn.rawArgs;return isRaw?fn(rawArgs,math,scope):fn.apply(fn,map(evalArgs,function(evalArg){return evalArg(scope,args,context)}))}}};FunctionNode.prototype.forEach=function(callback){for(var i=0;i<this.args.length;i++){callback(this.args[i],"args["+i+"]",this)}};FunctionNode.prototype.map=function(callback){var fn=this.fn.map(callback);var args=[];for(var i=0;i<this.args.length;i++){args[i]=this._ifNode(callback(this.args[i],"args["+i+"]",this))}return new FunctionNode(fn,args)};FunctionNode.prototype.clone=function(){return new FunctionNode(this.fn,this.args.slice(0))};var nodeToString=FunctionNode.prototype.toString;FunctionNode.prototype.toString=function(options){var customString;var name=this.fn.toString(options);if(options&&typeof options.handler==="object"&&hasOwnProperty(options.handler,name)){customString=options.handler[name](this,options)}if(typeof customString!=="undefined"){return customString}return nodeToString.call(this,options)};FunctionNode.prototype._toString=function(options){var args=this.args.map(function(arg){return arg.toString(options)});var fn=type.isFunctionAssignmentNode(this.fn)?"("+this.fn.toString(options)+")":this.fn.toString(options);return fn+"("+args.join(", ")+")"};FunctionNode.prototype.toJSON=function(){return{mathjs:"FunctionNode",fn:this.fn,args:this.args}};FunctionNode.fromJSON=function(json){return new FunctionNode(json.fn,json.args)};FunctionNode.prototype.toHTML=function(options){var args=this.args.map(function(arg){return arg.toHTML(options)});return'<span class="math-function">'+escape(this.fn)+'</span><span class="math-paranthesis math-round-parenthesis">(</span>'+args.join('<span class="math-separator">,</span>')+'<span class="math-paranthesis math-round-parenthesis">)</span>'};function expandTemplate(template,node,options){var latex="";var regex=new RegExp("\\$(?:\\{([a-z_][a-z_0-9]*)(?:\\[([0-9]+)\\])?\\}|\\$)","ig");var inputPos=0;var match;while((match=regex.exec(template))!==null){latex+=template.substring(inputPos,match.index);inputPos=match.index;if(match[0]==="$$"){latex+="$";inputPos++}else{inputPos+=match[0].length;var property=node[match[1]];if(!property){throw new ReferenceError("Template: Property "+match[1]+" does not exist.")}if(match[2]===undefined){switch(typeof property){case"string":latex+=property;break;case"object":if(type.isNode(property)){latex+=property.toTex(options)}else if(Array.isArray(property)){latex+=property.map(function(arg,index){if(type.isNode(arg)){return arg.toTex(options)}throw new TypeError("Template: "+match[1]+"["+index+"] is not a Node.")}).join(",")}else{throw new TypeError("Template: "+match[1]+" has to be a Node, String or array of Nodes")}break;default:throw new TypeError("Template: "+match[1]+" has to be a Node, String or array of Nodes")}}else{if(type.isNode(property[match[2]]&&property[match[2]])){latex+=property[match[2]].toTex(options)}else{throw new TypeError("Template: "+match[1]+"["+match[2]+"] is not a Node.")}}}}latex+=template.slice(inputPos);return latex}var nodeToTex=FunctionNode.prototype.toTex;FunctionNode.prototype.toTex=function(options){var customTex;if(options&&typeof options.handler==="object"&&hasOwnProperty(options.handler,this.name)){customTex=options.handler[this.name](this,options)}if(typeof customTex!=="undefined"){return customTex}return nodeToTex.call(this,options)};FunctionNode.prototype._toTex=function(options){var args=this.args.map(function(arg){return arg.toTex(options)});var latexConverter;if(math[this.name]&&(typeof math[this.name].toTex==="function"||typeof math[this.name].toTex==="object"||typeof math[this.name].toTex==="string")){latexConverter=math[this.name].toTex}var customToTex;switch(typeof latexConverter){case"function":customToTex=latexConverter(this,options);break;case"string":customToTex=expandTemplate(latexConverter,this,options);break;case"object":switch(typeof latexConverter[args.length]){case"function":customToTex=latexConverter[args.length](this,options);break;case"string":customToTex=expandTemplate(latexConverter[args.length],this,options);break}}if(typeof customToTex!=="undefined"){return customToTex}return expandTemplate(latex.defaultTemplate,this,options)};FunctionNode.prototype.getIdentifier=function(){return this.type+":"+this.name};return FunctionNode}exports.name="FunctionNode";exports.path="expression.node";exports.math=true;exports.factory=factory},{"../../utils/array":60,"../../utils/customs":65,"../../utils/latex":67,"../../utils/object":69,"../../utils/string":70,"./Node":42,"./SymbolNode":47}],41:[function(require,module,exports){"use strict";var map=require("../../utils/array").map;var escape=require("../../utils/string").escape;function factory(type,config,load,typed){var Node=load(require("./Node"));var Range=load(require("../../type/matrix/Range"));var isArray=Array.isArray;function IndexNode(dimensions,dotNotation){if(!(this instanceof IndexNode)){throw new SyntaxError("Constructor must be called with the new operator")}this.dimensions=dimensions;this.dotNotation=dotNotation||false;if(!isArray(dimensions)||!dimensions.every(type.isNode)){throw new TypeError('Array containing Nodes expected for parameter "dimensions"')}if(this.dotNotation&&!this.isObjectProperty()){throw new Error("dotNotation only applicable for object properties")}var deprecated=function(){throw new Error("Property `IndexNode.object` is deprecated, use `IndexNode.fn` instead")};Object.defineProperty(this,"object",{get:deprecated,set:deprecated})}IndexNode.prototype=new Node;IndexNode.prototype.type="IndexNode";IndexNode.prototype.isIndexNode=true;IndexNode.prototype._compile=function(math,argNames){var evalDimensions=map(this.dimensions,function(range,i){if(type.isRangeNode(range)){if(range.needsEnd()){var childArgNames=Object.create(argNames);childArgNames["end"]=true;var evalStart=range.start._compile(math,childArgNames);var evalEnd=range.end._compile(math,childArgNames);var evalStep=range.step?range.step._compile(math,childArgNames):function(){return 1};return function evalDimension(scope,args,context){var size=math.size(context).valueOf();var childArgs=Object.create(args);childArgs["end"]=size[i];return createRange(evalStart(scope,childArgs,context),evalEnd(scope,childArgs,context),evalStep(scope,childArgs,context))}}else{var evalStart=range.start._compile(math,argNames);var evalEnd=range.end._compile(math,argNames);var evalStep=range.step?range.step._compile(math,argNames):function(){return 1};return function evalDimension(scope,args,context){return createRange(evalStart(scope,args,context),evalEnd(scope,args,context),evalStep(scope,args,context))}}}else if(type.isSymbolNode(range)&&range.name==="end"){var childArgNames=Object.create(argNames);childArgNames["end"]=true;var evalRange=range._compile(math,childArgNames);return function evalDimension(scope,args,context){var size=math.size(context).valueOf();var childArgs=Object.create(args);childArgs["end"]=size[i];return evalRange(scope,childArgs,context)}}else{var evalRange=range._compile(math,argNames);return function evalDimension(scope,args,context){return evalRange(scope,args,context)}}});return function evalIndexNode(scope,args,context){var dimensions=map(evalDimensions,function(evalDimension){return evalDimension(scope,args,context)});return math.index.apply(math,dimensions)}};IndexNode.prototype.forEach=function(callback){for(var i=0;i<this.dimensions.length;i++){callback(this.dimensions[i],"dimensions["+i+"]",this)}};IndexNode.prototype.map=function(callback){var dimensions=[];for(var i=0;i<this.dimensions.length;i++){dimensions[i]=this._ifNode(callback(this.dimensions[i],"dimensions["+i+"]",this))}return new IndexNode(dimensions)};IndexNode.prototype.clone=function(){return new IndexNode(this.dimensions.slice(0))};IndexNode.prototype.isObjectProperty=function(){return this.dimensions.length===1&&type.isConstantNode(this.dimensions[0])&&typeof this.dimensions[0].value==="string"};IndexNode.prototype.getObjectProperty=function(){return this.isObjectProperty()?this.dimensions[0].value:null};IndexNode.prototype._toString=function(options){return this.dotNotation?"."+this.getObjectProperty():"["+this.dimensions.join(", ")+"]"};IndexNode.prototype.toJSON=function(){return{mathjs:"IndexNode",dimensions:this.dimensions,dotNotation:this.dotNotation}};IndexNode.fromJSON=function(json){return new IndexNode(json.dimensions,json.dotNotation)};IndexNode.prototype.toHTML=function(options){var dimensions=[];for(var i=0;i<this.dimensions.length;i++){dimensions[i]=this.dimensions[i].toHTML()}if(this.dotNotation){return'<span class="math-operator math-accessor-operator">.</span>'+'<span class="math-symbol math-property">'+escape(this.getObjectProperty())+"</span>"}else{return'<span class="math-parenthesis math-square-parenthesis">[</span>'+dimensions.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-square-parenthesis">]</span>'}};IndexNode.prototype._toTex=function(options){var dimensions=this.dimensions.map(function(range){return range.toTex(options)});return this.dotNotation?"."+this.getObjectProperty()+"":"_{"+dimensions.join(",")+"}"};function createRange(start,end,step){return new Range(type.isBigNumber(start)?start.toNumber():start,type.isBigNumber(end)?end.toNumber():end,type.isBigNumber(step)?step.toNumber():step)}return IndexNode}exports.name="IndexNode";exports.path="expression.node";exports.factory=factory},{"../../type/matrix/Range":56,"../../utils/array":60,"../../utils/string":70,"./Node":42}],42:[function(require,module,exports){"use strict";var keywords=require("../keywords");var deepEqual=require("../../utils/object").deepEqual;var hasOwnProperty=require("../../utils/object").hasOwnProperty;function factory(type,config,load,typed,math){function Node(){if(!(this instanceof Node)){throw new SyntaxError("Constructor must be called with the new operator")}}Node.prototype.eval=function(scope){return this.compile().eval(scope)};Node.prototype.type="Node";Node.prototype.isNode=true;Node.prototype.comment="";Node.prototype.compile=function(){var expr=this._compile(math.expression.mathWithTransform,{});var args={};var context=null;return{eval:function evalNode(scope){var s=scope?scope:{};_validateScope(s);return expr(s,args,context)}}};Node.prototype._compile=function(math,argNames){throw new Error("Method _compile should be implemented by type "+this.type)};Node.prototype.forEach=function(callback){throw new Error("Cannot run forEach on a Node interface")};Node.prototype.map=function(callback){throw new Error("Cannot run map on a Node interface")};Node.prototype._ifNode=function(node){if(!type.isNode(node)){throw new TypeError("Callback function must return a Node")}return node};Node.prototype.traverse=function(callback){callback(this,null,null);function _traverse(node,callback){node.forEach(function(child,path,parent){callback(child,path,parent);_traverse(child,callback)})}_traverse(this,callback)};Node.prototype.transform=function(callback){function _transform(node,callback){return node.map(function(child,path,parent){var replacement=callback(child,path,parent);return _transform(replacement,callback)})}var replacement=callback(this,null,null);return _transform(replacement,callback)};Node.prototype.filter=function(callback){var nodes=[];this.traverse(function(node,path,parent){if(callback(node,path,parent)){nodes.push(node)}});return nodes};Node.prototype.find=function(){throw new Error("Function Node.find is deprecated. Use Node.filter instead.")};Node.prototype.match=function(){throw new Error("Function Node.match is deprecated. See functions Node.filter, Node.transform, Node.traverse.")};Node.prototype.clone=function(){throw new Error("Cannot clone a Node interface")};Node.prototype.cloneDeep=function(){return this.map(function(node){return node.cloneDeep()})};Node.prototype.equals=function(other){return other?deepEqual(this,other):false};Node.prototype.toString=function(options){var customString;if(options&&typeof options==="object"){switch(typeof options.handler){case"object":case"undefined":break;case"function":customString=options.handler(this,options);break;default:throw new TypeError("Object or function expected as callback")}}if(typeof customString!=="undefined"){return customString}return this._toString(options)};Node.prototype.toJSON=function(){throw new Error("Cannot serialize object: toJSON not implemented by "+this.type)};Node.prototype.toHTML=function(options){var customString;if(options&&typeof options==="object"){switch(typeof options.handler){case"object":case"undefined":break;case"function":customString=options.handler(this,options);break;default:throw new TypeError("Object or function expected as callback")}}if(typeof customString!=="undefined"){return customString}return this.toHTML(options)};Node.prototype._toString=function(){throw new Error("_toString not implemented for "+this.type)};Node.prototype.toTex=function(options){var customTex;if(options&&typeof options=="object"){switch(typeof options.handler){case"object":case"undefined":break;case"function":customTex=options.handler(this,options);break;default:throw new TypeError("Object or function expected as callback")}}if(typeof customTex!=="undefined"){return customTex}return this._toTex(options)};Node.prototype._toTex=function(options){throw new Error("_toTex not implemented for "+this.type)};Node.prototype.getIdentifier=function(){return this.type};Node.prototype.getContent=function(){return this};function _validateScope(scope){for(var symbol in scope){if(hasOwnProperty(scope,symbol)){if(symbol in keywords){throw new Error('Scope contains an illegal symbol, "'+symbol+'" is a reserved keyword')}}}}return Node}exports.name="Node";exports.path="expression.node";exports.math=true;exports.factory=factory},{"../../utils/object":69,"../keywords":32}],43:[function(require,module,exports){"use strict";var stringify=require("../../utils/string").stringify;var escape=require("../../utils/string").escape;var isSafeProperty=require("../../utils/customs").isSafeProperty;var hasOwnProperty=require("../../utils/object").hasOwnProperty;function factory(type,config,load,typed){var Node=load(require("./Node"));function ObjectNode(properties){if(!(this instanceof ObjectNode)){throw new SyntaxError("Constructor must be called with the new operator")}this.properties=properties||{};if(properties){if(!(typeof properties==="object")||!Object.keys(properties).every(function(key){return type.isNode(properties[key])})){throw new TypeError("Object containing Nodes expected")}}}ObjectNode.prototype=new Node;ObjectNode.prototype.type="ObjectNode";ObjectNode.prototype.isObjectNode=true;ObjectNode.prototype._compile=function(math,argNames){var evalEntries={};for(var key in this.properties){if(hasOwnProperty(this.properties,key)){var stringifiedKey=stringify(key);var parsedKey=JSON.parse(stringifiedKey);if(!isSafeProperty(this.properties,parsedKey)){throw new Error('No access to property "'+parsedKey+'"')}evalEntries[parsedKey]=this.properties[key]._compile(math,argNames)}}return function evalObjectNode(scope,args,context){var obj={};for(var key in evalEntries){if(hasOwnProperty(evalEntries,key)){obj[key]=evalEntries[key](scope,args,context)}}return obj}};ObjectNode.prototype.forEach=function(callback){for(var key in this.properties){if(this.properties.hasOwnProperty(key)){callback(this.properties[key],"properties["+stringify(key)+"]",this)}}};ObjectNode.prototype.map=function(callback){var properties={};for(var key in this.properties){if(this.properties.hasOwnProperty(key)){properties[key]=this._ifNode(callback(this.properties[key],"properties["+stringify(key)+"]",this))}}return new ObjectNode(properties)};ObjectNode.prototype.clone=function(){var properties={};for(var key in this.properties){if(this.properties.hasOwnProperty(key)){properties[key]=this.properties[key]}}return new ObjectNode(properties)};ObjectNode.prototype._toString=function(options){var entries=[];for(var key in this.properties){if(this.properties.hasOwnProperty(key)){entries.push(stringify(key)+": "+this.properties[key].toString(options))}}return"{"+entries.join(", ")+"}"};ObjectNode.prototype.toJSON=function(){return{mathjs:"ObjectNode",properties:this.properties}};ObjectNode.fromJSON=function(json){return new ObjectNode(json.properties)};ObjectNode.prototype.toHTML=function(options){var entries=[];for(var key in this.properties){if(this.properties.hasOwnProperty(key)){entries.push('<span class="math-symbol math-property">'+escape(key)+"</span>"+'<span class="math-operator math-assignment-operator math-property-assignment-operator math-binary-operator">:</span>'+this.properties[key].toHTML(options))}}return'<span class="math-parenthesis math-curly-parenthesis">{</span>'+entries.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-curly-parenthesis">}</span>'};ObjectNode.prototype._toTex=function(options){var entries=[];for(var key in this.properties){if(this.properties.hasOwnProperty(key)){entries.push("\\mathbf{"+key+":} & "+this.properties[key].toTex(options)+"\\\\")}}return"\\left\\{\\begin{array}{ll}"+entries.join("\n")+"\\end{array}\\right\\}"};return ObjectNode}exports.name="ObjectNode";exports.path="expression.node";exports.factory=factory},{"../../utils/customs":65,"../../utils/object":69,"../../utils/string":70,"./Node":42}],44:[function(require,module,exports){"use strict";var latex=require("../../utils/latex");var map=require("../../utils/array").map;var escape=require("../../utils/string").escape;var isSafeMethod=require("../../utils/customs").isSafeMethod;var getSafeProperty=require("../../utils/customs").getSafeProperty;var operators=require("../operators");function factory(type,config,load,typed){var Node=load(require("./Node"));function OperatorNode(op,fn,args,implicit){if(!(this instanceof OperatorNode)){throw new SyntaxError("Constructor must be called with the new operator")}if(typeof op!=="string"){throw new TypeError('string expected for parameter "op"')}if(typeof fn!=="string"){throw new TypeError('string expected for parameter "fn"')}if(!Array.isArray(args)||!args.every(type.isNode)){throw new TypeError('Array containing Nodes expected for parameter "args"')}this.implicit=implicit===true;this.op=op;this.fn=fn;this.args=args||[]}OperatorNode.prototype=new Node;OperatorNode.prototype.type="OperatorNode";OperatorNode.prototype.isOperatorNode=true;OperatorNode.prototype._compile=function(math,argNames){if(typeof this.fn!=="string"||!isSafeMethod(math,this.fn)){if(!math[this.fn]){throw new Error("Function "+this.fn+' missing in provided namespace "math"')}else{throw new Error('No access to function "'+this.fn+'"')}}var fn=getSafeProperty(math,this.fn);var evalArgs=map(this.args,function(arg){return arg._compile(math,argNames)});if(evalArgs.length===1){var evalArg0=evalArgs[0];return function evalOperatorNode(scope,args,context){return fn(evalArg0(scope,args,context))}}else if(evalArgs.length===2){var evalArg0=evalArgs[0];var evalArg1=evalArgs[1];return function evalOperatorNode(scope,args,context){return fn(evalArg0(scope,args,context),evalArg1(scope,args,context))}}else{return function evalOperatorNode(scope,args,context){return fn.apply(null,map(evalArgs,function(evalArg){return evalArg(scope,args,context)}))}}};OperatorNode.prototype.forEach=function(callback){for(var i=0;i<this.args.length;i++){callback(this.args[i],"args["+i+"]",this)}};OperatorNode.prototype.map=function(callback){var args=[];for(var i=0;i<this.args.length;i++){args[i]=this._ifNode(callback(this.args[i],"args["+i+"]",this))}return new OperatorNode(this.op,this.fn,args,this.implicit)};OperatorNode.prototype.clone=function(){return new OperatorNode(this.op,this.fn,this.args.slice(0),this.implicit)};OperatorNode.prototype.isUnary=function(){return this.args.length===1};OperatorNode.prototype.isBinary=function(){return this.args.length===2};function calculateNecessaryParentheses(root,parenthesis,implicit,args,latex){var precedence=operators.getPrecedence(root,parenthesis);var associativity=operators.getAssociativity(root,parenthesis);if(parenthesis==="all"||args.length>2&&root.getIdentifier()!=="OperatorNode:add"&&root.getIdentifier()!=="OperatorNode:multiply"){var parens=args.map(function(arg){switch(arg.getContent().type){case"ArrayNode":case"ConstantNode":case"SymbolNode":case"ParenthesisNode":return false;break;default:return true}});return parens}var result=undefined;switch(args.length){case 0:result=[];break;case 1:var operandPrecedence=operators.getPrecedence(args[0],parenthesis);if(latex&&operandPrecedence!==null){var operandIdentifier;var rootIdentifier;if(parenthesis==="keep"){operandIdentifier=args[0].getIdentifier();rootIdentifier=root.getIdentifier()}else{operandIdentifier=args[0].getContent().getIdentifier();rootIdentifier=root.getContent().getIdentifier()}if(operators.properties[precedence][rootIdentifier].latexLeftParens===false){result=[false];break}if(operators.properties[operandPrecedence][operandIdentifier].latexParens===false){result=[false];break}}if(operandPrecedence===null){result=[false];break}if(operandPrecedence<=precedence){result=[true];break}result=[false];break;case 2:var lhsParens;var lhsPrecedence=operators.getPrecedence(args[0],parenthesis);var assocWithLhs=operators.isAssociativeWith(root,args[0],parenthesis);if(lhsPrecedence===null){lhsParens=false}else if(lhsPrecedence===precedence&&associativity==="right"&&!assocWithLhs){lhsParens=true}else if(lhsPrecedence<precedence){lhsParens=true}else{lhsParens=false}var rhsParens;var rhsPrecedence=operators.getPrecedence(args[1],parenthesis);var assocWithRhs=operators.isAssociativeWith(root,args[1],parenthesis);if(rhsPrecedence===null){rhsParens=false}else if(rhsPrecedence===precedence&&associativity==="left"&&!assocWithRhs){rhsParens=true}else if(rhsPrecedence<precedence){rhsParens=true}else{rhsParens=false}if(latex){var rootIdentifier;var lhsIdentifier;var rhsIdentifier;if(parenthesis==="keep"){rootIdentifier=root.getIdentifier();lhsIdentifier=root.args[0].getIdentifier();rhsIdentifier=root.args[1].getIdentifier()}else{rootIdentifier=root.getContent().getIdentifier();lhsIdentifier=root.args[0].getContent().getIdentifier();rhsIdentifier=root.args[1].getContent().getIdentifier()}if(lhsPrecedence!==null){if(operators.properties[precedence][rootIdentifier].latexLeftParens===false){lhsParens=false}if(operators.properties[lhsPrecedence][lhsIdentifier].latexParens===false){lhsParens=false}}if(rhsPrecedence!==null){if(operators.properties[precedence][rootIdentifier].latexRightParens===false){rhsParens=false}if(operators.properties[rhsPrecedence][rhsIdentifier].latexParens===false){rhsParens=false}}}result=[lhsParens,rhsParens];break;default:if(root.getIdentifier()==="OperatorNode:add"||root.getIdentifier()==="OperatorNode:multiply"){var result=args.map(function(arg){var argPrecedence=operators.getPrecedence(arg,parenthesis);var assocWithArg=operators.isAssociativeWith(root,arg,parenthesis);var argAssociativity=operators.getAssociativity(arg,parenthesis);if(argPrecedence===null){return false}else if(precedence===argPrecedence&&associativity===argAssociativity&&!assocWithArg){return true}else if(argPrecedence<precedence){return true}return false})}break}if(args.length>=2&&root.getIdentifier()==="OperatorNode:multiply"&&root.implicit&&parenthesis==="auto"&&implicit==="hide"){result=args.map(function(arg,index){var isParenthesisNode=arg.getIdentifier()==="ParenthesisNode";if(result[index]||isParenthesisNode){return true}return false})}return result}OperatorNode.prototype._toString=function(options){var parenthesis=options&&options.parenthesis?options.parenthesis:"keep";var implicit=options&&options.implicit?options.implicit:"hide";var args=this.args;var parens=calculateNecessaryParentheses(this,parenthesis,implicit,args,false);if(args.length===1){var assoc=operators.getAssociativity(this,parenthesis);var operand=args[0].toString(options);if(parens[0]){operand="("+operand+")"}if(assoc==="right"){return this.op+operand}else if(assoc==="left"){return operand+this.op}return operand+this.op}else if(args.length==2){var lhs=args[0].toString(options);var rhs=args[1].toString(options);if(parens[0]){lhs="("+lhs+")"}if(parens[1]){rhs="("+rhs+")"}if(this.implicit&&this.getIdentifier()==="OperatorNode:multiply"&&implicit=="hide"){return lhs+" "+rhs}return lhs+" "+this.op+" "+rhs}else if(args.length>2&&(this.getIdentifier()==="OperatorNode:add"||this.getIdentifier()==="OperatorNode:multiply")){var stringifiedArgs=args.map(function(arg,index){arg=arg.toString(options);if(parens[index]){arg="("+arg+")"}return arg});if(this.implicit&&this.getIdentifier()==="OperatorNode:multiply"&&implicit==="hide"){return stringifiedArgs.join(" ")}return stringifiedArgs.join(" "+this.op+" ")}else{return this.fn+"("+this.args.join(", ")+")"}};OperatorNode.prototype.toJSON=function(){return{mathjs:"OperatorNode",op:this.op,fn:this.fn,args:this.args,implicit:this.implicit}};OperatorNode.fromJSON=function(json){return new OperatorNode(json.op,json.fn,json.args,json.implicit)};OperatorNode.prototype.toHTML=function(options){var parenthesis=options&&options.parenthesis?options.parenthesis:"keep";var implicit=options&&options.implicit?options.implicit:"hide";var args=this.args;var parens=calculateNecessaryParentheses(this,parenthesis,implicit,args,false);if(args.length===1){var assoc=operators.getAssociativity(this,parenthesis);var operand=args[0].toHTML(options);if(parens[0]){operand='<span class="math-parenthesis math-round-parenthesis">(</span>'+operand+'<span class="math-parenthesis math-round-parenthesis">)</span>'}if(assoc==="right"){return'<span class="math-operator math-unary-operator math-lefthand-unary-operator">'+escape(this.op)+"</span>"+operand}else if(assoc==="left"){return'<span class="math-operator math-unary-operator math-righthand-unary-operator">'+escape(this.op)+"</span>"+operand}return'<span class="math-operator math-unary-operator math-righthand-unary-operator">'+escape(this.op)+"</span>"+operand}else if(args.length==2){var lhs=args[0].toHTML(options);var rhs=args[1].toHTML(options);if(parens[0]){lhs='<span class="math-parenthesis math-round-parenthesis">(</span>'+lhs+'<span class="math-parenthesis math-round-parenthesis">)</span>'}if(parens[1]){rhs='<span class="math-parenthesis math-round-parenthesis">(</span>'+rhs+'<span class="math-parenthesis math-round-parenthesis">)</span>'}if(this.implicit&&this.getIdentifier()==="OperatorNode:multiply"&&implicit=="hide"){return lhs+'<span class="math-operator math-binary-operator math-implicit-binary-operator"></span>'+rhs}return lhs+'<span class="math-operator math-binary-operator math-explicit-binary-operator">'+escape(this.op)+"</span>"+rhs}else if(args.length>2&&(this.getIdentifier()==="OperatorNode:add"||this.getIdentifier()==="OperatorNode:multiply")){var stringifiedArgs=args.map(function(arg,index){arg=arg.toHTML(options);if(parens[index]){arg='<span class="math-parenthesis math-round-parenthesis">(</span>'+arg+'<span class="math-parenthesis math-round-parenthesis">)</span>'}return arg});if(this.implicit&&this.getIdentifier()==="OperatorNode:multiply"&&implicit==="hide"){return stringifiedArgs.join('<span class="math-operator math-binary-operator math-implicit-binary-operator"></span>')}return stringifiedArgs.join('<span class="math-operator math-binary-operator math-explicit-binary-operator">'+escape(this.op)+"</span>")}else{return'<span class="math-function">'+escape(this.fn)+'</span><span class="math-paranthesis math-round-parenthesis">(</span>'+stringifiedArgs.join('<span class="math-separator">,</span>')+'<span class="math-paranthesis math-round-parenthesis">)</span>'}};OperatorNode.prototype._toTex=function(options){var parenthesis=options&&options.parenthesis?options.parenthesis:"keep";var implicit=options&&options.implicit?options.implicit:"hide";var args=this.args;var parens=calculateNecessaryParentheses(this,parenthesis,implicit,args,true);var op=latex.operators[this.fn];op=typeof op==="undefined"?this.op:op;if(args.length===1){var assoc=operators.getAssociativity(this,parenthesis);var operand=args[0].toTex(options);if(parens[0]){operand="\\left("+operand+"\\right)"}if(assoc==="right"){return op+operand}else if(assoc==="left"){return operand+op}return operand+op}else if(args.length===2){var lhs=args[0];var lhsTex=lhs.toTex(options);if(parens[0]){lhsTex="\\left("+lhsTex+"\\right)"}var rhs=args[1];var rhsTex=rhs.toTex(options);if(parens[1]){rhsTex="\\left("+rhsTex+"\\right)"}var lhsIdentifier;if(parenthesis==="keep"){lhsIdentifier=lhs.getIdentifier()}else{lhsIdentifier=lhs.getContent().getIdentifier()}switch(this.getIdentifier()){case"OperatorNode:divide":return op+"{"+lhsTex+"}"+"{"+rhsTex+"}";case"OperatorNode:pow":lhsTex="{"+lhsTex+"}";rhsTex="{"+rhsTex+"}";switch(lhsIdentifier){case"ConditionalNode":case"OperatorNode:divide":lhsTex="\\left("+lhsTex+"\\right)"}case"OperatorNode:multiply":if(this.implicit&&implicit==="hide"){return lhsTex+"~"+rhsTex}}return lhsTex+op+rhsTex}else if(args.length>2&&(this.getIdentifier()==="OperatorNode:add"||this.getIdentifier()==="OperatorNode:multiply")){var texifiedArgs=args.map(function(arg,index){arg=arg.toTex(options);if(parens[index]){arg="\\left("+arg+"\\right)"}return arg});if(this.getIdentifier()==="OperatorNode:multiply"&&this.implicit){return texifiedArgs.join("~")}return texifiedArgs.join(op)}else{return"\\mathrm{"+this.fn+"}\\left("+args.map(function(arg){return arg.toTex(options)}).join(",")+"\\right)"}};OperatorNode.prototype.getIdentifier=function(){return this.type+":"+this.fn};return OperatorNode}exports.name="OperatorNode";exports.path="expression.node";exports.factory=factory},{"../../utils/array":60,"../../utils/customs":65,"../../utils/latex":67,"../../utils/string":70,"../operators":50,"./Node":42}],45:[function(require,module,exports){"use strict";function factory(type,config,load,typed){var Node=load(require("./Node"));function ParenthesisNode(content){if(!(this instanceof ParenthesisNode)){throw new SyntaxError("Constructor must be called with the new operator")}if(!type.isNode(content)){throw new TypeError('Node expected for parameter "content"')}this.content=content}ParenthesisNode.prototype=new Node;ParenthesisNode.prototype.type="ParenthesisNode";ParenthesisNode.prototype.isParenthesisNode=true;ParenthesisNode.prototype._compile=function(math,argNames){return this.content._compile(math,argNames)};ParenthesisNode.prototype.getContent=function(){return this.content.getContent()};ParenthesisNode.prototype.forEach=function(callback){callback(this.content,"content",this)};ParenthesisNode.prototype.map=function(callback){var content=callback(this.content,"content",this);return new ParenthesisNode(content)};ParenthesisNode.prototype.clone=function(){return new ParenthesisNode(this.content)};ParenthesisNode.prototype._toString=function(options){if(!options||options&&!options.parenthesis||options&&options.parenthesis==="keep"){return"("+this.content.toString(options)+")"}return this.content.toString(options)};ParenthesisNode.prototype.toJSON=function(){return{mathjs:"ParenthesisNode",content:this.content}};ParenthesisNode.fromJSON=function(json){return new ParenthesisNode(json.content)};ParenthesisNode.prototype.toHTML=function(options){if(!options||options&&!options.parenthesis||options&&options.parenthesis==="keep"){return'<span class="math-parenthesis math-round-parenthesis">(</span>'+this.content.toHTML(options)+'<span class="math-parenthesis math-round-parenthesis">)</span>'}return this.content.toHTML(options)};ParenthesisNode.prototype._toTex=function(options){if(!options||options&&!options.parenthesis||options&&options.parenthesis==="keep"){return"\\left("+this.content.toTex(options)+"\\right)"}return this.content.toTex(options)};return ParenthesisNode}exports.name="ParenthesisNode";exports.path="expression.node";exports.factory=factory},{"./Node":42}],46:[function(require,module,exports){"use strict";var operators=require("../operators");function factory(type,config,load,typed){var Node=load(require("./Node"));function RangeNode(start,end,step){if(!(this instanceof RangeNode)){throw new SyntaxError("Constructor must be called with the new operator")}if(!type.isNode(start))throw new TypeError("Node expected");if(!type.isNode(end))throw new TypeError("Node expected");if(step&&!type.isNode(step))throw new TypeError("Node expected");if(arguments.length>3)throw new Error("Too many arguments");this.start=start;this.end=end;this.step=step||null}RangeNode.prototype=new Node;RangeNode.prototype.type="RangeNode";RangeNode.prototype.isRangeNode=true;RangeNode.prototype.needsEnd=function(){var endSymbols=this.filter(function(node){return type.isSymbolNode(node)&&node.name==="end"});return endSymbols.length>0};RangeNode.prototype._compile=function(math,argNames){var range=math.range;var evalStart=this.start._compile(math,argNames);var evalEnd=this.end._compile(math,argNames);if(this.step){var evalStep=this.step._compile(math,argNames);return function evalRangeNode(scope,args,context){return range(evalStart(scope,args,context),evalEnd(scope,args,context),evalStep(scope,args,context))}}else{return function evalRangeNode(scope,args,context){return range(evalStart(scope,args,context),evalEnd(scope,args,context))}}};RangeNode.prototype.forEach=function(callback){callback(this.start,"start",this);callback(this.end,"end",this);if(this.step){callback(this.step,"step",this)}};RangeNode.prototype.map=function(callback){return new RangeNode(this._ifNode(callback(this.start,"start",this)),this._ifNode(callback(this.end,"end",this)),this.step&&this._ifNode(callback(this.step,"step",this)))};RangeNode.prototype.clone=function(){return new RangeNode(this.start,this.end,this.step&&this.step)};function calculateNecessaryParentheses(node,parenthesis){var precedence=operators.getPrecedence(node,parenthesis);var parens={};var startPrecedence=operators.getPrecedence(node.start,parenthesis);parens.start=startPrecedence!==null&&startPrecedence<=precedence||parenthesis==="all";if(node.step){var stepPrecedence=operators.getPrecedence(node.step,parenthesis);parens.step=stepPrecedence!==null&&stepPrecedence<=precedence||parenthesis==="all"}var endPrecedence=operators.getPrecedence(node.end,parenthesis);parens.end=endPrecedence!==null&&endPrecedence<=precedence||parenthesis==="all";return parens}RangeNode.prototype._toString=function(options){var parenthesis=options&&options.parenthesis?options.parenthesis:"keep";var parens=calculateNecessaryParentheses(this,parenthesis);var str;var start=this.start.toString(options);if(parens.start){start="("+start+")"}str=start;if(this.step){var step=this.step.toString(options);if(parens.step){step="("+step+")"}str+=":"+step}var end=this.end.toString(options);if(parens.end){end="("+end+")"}str+=":"+end;return str};RangeNode.prototype.toJSON=function(){return{mathjs:"RangeNode",start:this.start,end:this.end,step:this.step}};RangeNode.fromJSON=function(json){return new RangeNode(json.start,json.end,json.step)};RangeNode.prototype.toHTML=function(options){var parenthesis=options&&options.parenthesis?options.parenthesis:"keep";var parens=calculateNecessaryParentheses(this,parenthesis);var str;var start=this.start.toHTML(options);if(parens.start){start='<span class="math-parenthesis math-round-parenthesis">(</span>'+start+'<span class="math-parenthesis math-round-parenthesis">)</span>'}str=start;if(this.step){var step=this.step.toHTML(options);if(parens.step){step='<span class="math-parenthesis math-round-parenthesis">(</span>'+step+'<span class="math-parenthesis math-round-parenthesis">)</span>'}str+='<span class="math-operator math-range-operator">:</span>'+step}var end=this.end.toHTML(options);if(parens.end){end='<span class="math-parenthesis math-round-parenthesis">(</span>'+end+'<span class="math-parenthesis math-round-parenthesis">)</span>'}str+='<span class="math-operator math-range-operator">:</span>'+end;return str};RangeNode.prototype._toTex=function(options){var parenthesis=options&&options.parenthesis?options.parenthesis:"keep";var parens=calculateNecessaryParentheses(this,parenthesis);var str=this.start.toTex(options);if(parens.start){str="\\left("+str+"\\right)"}if(this.step){var step=this.step.toTex(options);if(parens.step){step="\\left("+step+"\\right)"}str+=":"+step}var end=this.end.toTex(options);if(parens.end){end="\\left("+end+"\\right)"}str+=":"+end;return str};return RangeNode}exports.name="RangeNode";exports.path="expression.node";exports.factory=factory},{"../operators":50,"./Node":42}],47:[function(require,module,exports){"use strict";var latex=require("../../utils/latex");var escape=require("../../utils/string").escape;var hasOwnProperty=require("../../utils/object").hasOwnProperty;var getSafeProperty=require("../../utils/customs").getSafeProperty;function factory(type,config,load,typed,math){var Node=load(require("./Node"));function isValuelessUnit(name){return type.Unit?type.Unit.isValuelessUnit(name):false}function SymbolNode(name){if(!(this instanceof SymbolNode)){throw new SyntaxError("Constructor must be called with the new operator")}if(typeof name!=="string")throw new TypeError('String expected for parameter "name"');this.name=name}SymbolNode.prototype=new Node;SymbolNode.prototype.type="SymbolNode";SymbolNode.prototype.isSymbolNode=true;SymbolNode.prototype._compile=function(math,argNames){var name=this.name;if(hasOwnProperty(argNames,name)){return function(scope,args,context){return args[name]}}else if(name in math){return function(scope,args,context){return name in scope?getSafeProperty(scope,name):getSafeProperty(math,name)}}else{var isUnit=isValuelessUnit(name);return function(scope,args,context){return name in scope?getSafeProperty(scope,name):isUnit?new type.Unit(null,name):undef(name)}}};SymbolNode.prototype.forEach=function(callback){};SymbolNode.prototype.map=function(callback){return this.clone()};function undef(name){throw new Error("Undefined symbol "+name)}SymbolNode.prototype.clone=function(){return new SymbolNode(this.name)};SymbolNode.prototype._toString=function(options){return this.name};SymbolNode.prototype.toHTML=function(options){var name=escape(this.name);if(name=="true"||name=="false"){return'<span class="math-symbol math-boolean">'+name+"</span>"}else if(name=="i"){return'<span class="math-symbol math-imaginary-symbol">'+name+"</span>"}else if(name=="Infinity"){return'<span class="math-symbol math-infinity-symbol">'+name+"</span>"}else if(name=="NaN"){return'<span class="math-symbol math-nan-symbol">'+name+"</span>"}else if(name=="null"){return'<span class="math-symbol math-null-symbol">'+name+"</span>"}else if(name=="undefined"){return'<span class="math-symbol math-undefined-symbol">'+name+"</span>"}return'<span class="math-symbol">'+name+"</span>"};SymbolNode.prototype.toJSON=function(){return{mathjs:"SymbolNode",name:this.name}};SymbolNode.fromJSON=function(json){return new SymbolNode(json.name)};SymbolNode.prototype._toTex=function(options){var isUnit=false;if(typeof math[this.name]==="undefined"&&isValuelessUnit(this.name)){isUnit=true}var symbol=latex.toSymbol(this.name,isUnit);if(symbol[0]==="\\"){return symbol}return" "+symbol};return SymbolNode}exports.name="SymbolNode";exports.path="expression.node";exports.math=true;exports.factory=factory},{"../../utils/customs":65,"../../utils/latex":67,"../../utils/object":69,"../../utils/string":70,"./Node":42}],48:[function(require,module,exports){"use strict";var errorTransform=require("../../transform/error.transform").transform;var getSafeProperty=require("../../../utils/customs").getSafeProperty;function factory(type,config,load,typed){var subset=load(require("../../../function/matrix/subset"));return function access(object,index){try{if(Array.isArray(object)){return subset(object,index)}else if(object&&typeof object.subset==="function"){return object.subset(index)}else if(typeof object==="string"){return subset(object,index)}else if(typeof object==="object"){if(!index.isObjectProperty()){throw new TypeError("Cannot apply a numeric index as object property")}return getSafeProperty(object,index.getObjectProperty())}else{throw new TypeError("Cannot apply index: unsupported type of object")}}catch(err){throw errorTransform(err)}}}exports.factory=factory},{"../../../function/matrix/subset":53,"../../../utils/customs":65,"../../transform/error.transform":52}],49:[function(require,module,exports){"use strict";var errorTransform=require("../../transform/error.transform").transform;var setSafeProperty=require("../../../utils/customs").setSafeProperty;function factory(type,config,load,typed){var subset=load(require("../../../function/matrix/subset"));var matrix=load(require("../../../type/matrix/function/matrix"));return function assign(object,index,value){try{if(Array.isArray(object)){return matrix(object).subset(index,value).valueOf()}else if(object&&typeof object.subset==="function"){return object.subset(index,value)}else if(typeof object==="string"){return subset(object,index,value)}else if(typeof object==="object"){if(!index.isObjectProperty()){throw TypeError("Cannot apply a numeric index as object property")}setSafeProperty(object,index.getObjectProperty(),value);return object}else{throw new TypeError("Cannot apply index: unsupported type of object")}}catch(err){throw errorTransform(err)}}}exports.factory=factory},{"../../../function/matrix/subset":53,"../../../type/matrix/function/matrix":57,"../../../utils/customs":65,"../../transform/error.transform":52}],50:[function(require,module,exports){"use strict";var properties=[{AssignmentNode:{},FunctionAssignmentNode:{}},{ConditionalNode:{latexLeftParens:false,latexRightParens:false,latexParens:false}},{"OperatorNode:or":{associativity:"left",associativeWith:[]}},{"OperatorNode:xor":{associativity:"left",associativeWith:[]}},{"OperatorNode:and":{associativity:"left",associativeWith:[]}},{"OperatorNode:bitOr":{associativity:"left",associativeWith:[]}},{"OperatorNode:bitXor":{associativity:"left",associativeWith:[]}},{"OperatorNode:bitAnd":{associativity:"left",associativeWith:[]}},{"OperatorNode:equal":{associativity:"left",associativeWith:[]},"OperatorNode:unequal":{associativity:"left",associativeWith:[]},"OperatorNode:smaller":{associativity:"left",associativeWith:[]},"OperatorNode:larger":{associativity:"left",associativeWith:[]},"OperatorNode:smallerEq":{associativity:"left",associativeWith:[]},"OperatorNode:largerEq":{associativity:"left",associativeWith:[]}},{"OperatorNode:leftShift":{associativity:"left",associativeWith:[]},"OperatorNode:rightArithShift":{associativity:"left",associativeWith:[]},"OperatorNode:rightLogShift":{associativity:"left",associativeWith:[]}},{"OperatorNode:to":{associativity:"left",associativeWith:[]}},{RangeNode:{}},{"OperatorNode:add":{associativity:"left",associativeWith:["OperatorNode:add","OperatorNode:subtract"]},"OperatorNode:subtract":{associativity:"left",associativeWith:[]}},{"OperatorNode:multiply":{associativity:"left",associativeWith:["OperatorNode:multiply","OperatorNode:divide","Operator:dotMultiply","Operator:dotDivide"]},"OperatorNode:divide":{associativity:"left",associativeWith:[],latexLeftParens:false,latexRightParens:false,latexParens:false},"OperatorNode:dotMultiply":{associativity:"left",associativeWith:["OperatorNode:multiply","OperatorNode:divide","OperatorNode:dotMultiply","OperatorNode:doDivide"]},"OperatorNode:dotDivide":{associativity:"left",associativeWith:[]},"OperatorNode:mod":{associativity:"left",associativeWith:[]}},{"OperatorNode:unaryPlus":{associativity:"right"},"OperatorNode:unaryMinus":{associativity:"right"},"OperatorNode:bitNot":{associativity:"right"},"OperatorNode:not":{associativity:"right"}},{"OperatorNode:pow":{associativity:"right",associativeWith:[],latexRightParens:false},"OperatorNode:dotPow":{associativity:"right",associativeWith:[]}},{"OperatorNode:factorial":{associativity:"left"}},{"OperatorNode:transpose":{associativity:"left"}}];function getPrecedence(_node,parenthesis){var node=_node;if(parenthesis!=="keep"){node=_node.getContent()}var identifier=node.getIdentifier();for(var i=0;i<properties.length;i++){if(identifier in properties[i]){return i}}return null}function getAssociativity(_node,parenthesis){var node=_node;if(parenthesis!=="keep"){node=_node.getContent()}var identifier=node.getIdentifier();var index=getPrecedence(node,parenthesis);if(index===null){return null}var property=properties[index][identifier];if(property.hasOwnProperty("associativity")){if(property.associativity==="left"){return"left"}if(property.associativity==="right"){return"right"}throw Error("'"+identifier+"' has the invalid associativity '"+property.associativity+"'.")}return null}function isAssociativeWith(nodeA,nodeB,parenthesis){var a=nodeA;var b=nodeB;if(parenthesis!=="keep"){var a=nodeA.getContent();var b=nodeB.getContent()}var identifierA=a.getIdentifier();var identifierB=b.getIdentifier();var index=getPrecedence(a,parenthesis);if(index===null){return null}var property=properties[index][identifierA];if(property.hasOwnProperty("associativeWith")&&property.associativeWith instanceof Array){for(var i=0;i<property.associativeWith.length;i++){if(property.associativeWith[i]===identifierB){return true}}return false}return null}module.exports.properties=properties;module.exports.getPrecedence=getPrecedence;module.exports.getAssociativity=getAssociativity;module.exports.isAssociativeWith=isAssociativeWith},{}],51:[function(require,module,exports){"use strict";var ArgumentsError=require("../error/ArgumentsError");var deepMap=require("../utils/collection/deepMap");function factory(type,config,load,typed){var numeric=load(require("../type/numeric"));var AccessorNode=load(require("./node/AccessorNode"));var ArrayNode=load(require("./node/ArrayNode"));var AssignmentNode=load(require("./node/AssignmentNode"));var BlockNode=load(require("./node/BlockNode"));var ConditionalNode=load(require("./node/ConditionalNode"));var ConstantNode=load(require("./node/ConstantNode"));var FunctionAssignmentNode=load(require("./node/FunctionAssignmentNode"));var IndexNode=load(require("./node/IndexNode"));var ObjectNode=load(require("./node/ObjectNode"));var OperatorNode=load(require("./node/OperatorNode"));var ParenthesisNode=load(require("./node/ParenthesisNode"));var FunctionNode=load(require("./node/FunctionNode"));var RangeNode=load(require("./node/RangeNode"));var SymbolNode=load(require("./node/SymbolNode"));function parse(expr,options){if(arguments.length!==1&&arguments.length!==2){throw new ArgumentsError("parse",arguments.length,1,2)}extra_nodes=options&&options.nodes?options.nodes:{};if(typeof expr==="string"){expression=expr;return parseStart()}else if(Array.isArray(expr)||expr instanceof type.Matrix){return deepMap(expr,function(elem){if(typeof elem!=="string")throw new TypeError("String expected");expression=elem;return parseStart()})}else{throw new TypeError("String or matrix expected")}}var TOKENTYPE={NULL:0,DELIMITER:1,NUMBER:2,SYMBOL:3,UNKNOWN:4};var DELIMITERS={",":true,"(":true,")":true,"[":true,"]":true,"{":true,"}":true,'"':true,";":true,"+":true,"-":true,"*":true,".*":true,"/":true,"./":true,"%":true,"^":true,".^":true,"~":true,"!":true,"&":true,"|":true,"^|":true,"'":true,"=":true,":":true,"?":true,"==":true,"!=":true,"<":true,">":true,"<=":true,">=":true,"<<":true,">>":true,">>>":true};var NAMED_DELIMITERS={mod:true,to:true,in:true,and:true,xor:true,or:true,not:true};var CONSTANTS={true:true,false:false,null:null,undefined:undefined};var NUMERIC_CONSTANTS=["NaN","Infinity"];var extra_nodes={};var expression="";var comment="";var index=0;var c="";var token="";var token_type=TOKENTYPE.NULL;var nesting_level=0;var conditional_level=null;var tokenStates=[];function first(){index=0;c=expression.charAt(0);nesting_level=0;conditional_level=null}function next(){index++;c=expression.charAt(index)}function prevPreview(){return expression.charAt(index-1)}function nextPreview(){return expression.charAt(index+1)}function nextNextPreview(){return expression.charAt(index+2)}function pushTokenState(){tokenStates.push({token_type:token_type,token:token,comment:comment,index:index,c:c})}function popTokenState(){var restoredState=tokenStates.pop();token_type=restoredState.token_type;token=restoredState.token;comment=restoredState.comment;index=restoredState.index;c=restoredState.c}function discardTokenState(){tokenStates.pop()}function getToken(){token_type=TOKENTYPE.NULL;token="";comment="";while(parse.isWhitespace(c,nesting_level)){next()}if(c==="#"){while(c!=="\n"&&c!==""){comment+=c;next()}}if(c===""){token_type=TOKENTYPE.DELIMITER;return}if(c==="\n"&&!nesting_level){token_type=TOKENTYPE.DELIMITER;token=c;next();return}var c2=c+nextPreview();var c3=c2+nextNextPreview();if(c3.length===3&&DELIMITERS[c3]){token_type=TOKENTYPE.DELIMITER;token=c3;next();next();next();return}if(c2.length===2&&DELIMITERS[c2]){token_type=TOKENTYPE.DELIMITER;token=c2;next();next();return}if(DELIMITERS[c]){token_type=TOKENTYPE.DELIMITER;token=c;next();return}if(parse.isDigitDot(c)){token_type=TOKENTYPE.NUMBER;if(c==="."){token+=c;next();if(!parse.isDigit(c)){token_type=TOKENTYPE.DELIMITER}}else{while(parse.isDigit(c)){token+=c;next()}if(parse.isDecimalMark(c,nextPreview())){token+=c;next()}}while(parse.isDigit(c)){token+=c;next()}c2=nextPreview();if(c==="E"||c==="e"){if(parse.isDigit(c2)||c2==="-"||c2==="+"){token+=c;next();if(c==="+"||c==="-"){token+=c;next()}if(!parse.isDigit(c)){throw createSyntaxError('Digit expected, got "'+c+'"')}while(parse.isDigit(c)){token+=c;next()}if(parse.isDecimalMark(c,nextPreview())){throw createSyntaxError('Digit expected, got "'+c+'"')}}else if(c2==="."){next();throw createSyntaxError('Digit expected, got "'+c+'"')}}return}if(parse.isAlpha(c,prevPreview(),nextPreview())){while(parse.isAlpha(c,prevPreview(),nextPreview())||parse.isDigit(c)){token+=c;next()}if(NAMED_DELIMITERS.hasOwnProperty(token)){token_type=TOKENTYPE.DELIMITER}else{token_type=TOKENTYPE.SYMBOL}return}token_type=TOKENTYPE.UNKNOWN;while(c!==""){token+=c;next()}throw createSyntaxError('Syntax error in part "'+token+'"')}function getTokenSkipNewline(){do{getToken()}while(token==="\n")}function openParams(){nesting_level++}function closeParams(){nesting_level--}parse.isAlpha=function isAlpha(c,cPrev,cNext){return parse.isValidLatinOrGreek(c)||parse.isValidMathSymbol(c,cNext)||parse.isValidMathSymbol(cPrev,c)};parse.isValidLatinOrGreek=function isValidLatinOrGreek(c){return/^[a-zA-Z_$\u00C0-\u02AF\u0370-\u03FF\u2100-\u214F]$/.test(c)};parse.isValidMathSymbol=function isValidMathSymbol(high,low){return/^[\uD835]$/.test(high)&&/^[\uDC00-\uDFFF]$/.test(low)&&/^[^\uDC55\uDC9D\uDCA0\uDCA1\uDCA3\uDCA4\uDCA7\uDCA8\uDCAD\uDCBA\uDCBC\uDCC4\uDD06\uDD0B\uDD0C\uDD15\uDD1D\uDD3A\uDD3F\uDD45\uDD47-\uDD49\uDD51\uDEA6\uDEA7\uDFCC\uDFCD]$/.test(low)};parse.isWhitespace=function isWhitespace(c,nestingLevel){return c===" "||c==="\t"||c==="\n"&&nestingLevel>0};parse.isDecimalMark=function isDecimalMark(c,cNext){return c==="."&&cNext!=="/"&&cNext!=="*"&&cNext!=="^"};parse.isDigitDot=function isDigitDot(c){return c>="0"&&c<="9"||c==="."};parse.isDigit=function isDigit(c){return c>="0"&&c<="9"};function parseStart(){first();getToken();var node=parseBlock();if(token!==""){if(token_type===TOKENTYPE.DELIMITER){throw createError("Unexpected operator "+token)}else{throw createSyntaxError('Unexpected part "'+token+'"')}}return node}function parseBlock(){var node;var blocks=[];var visible;if(token!==""&&token!=="\n"&&token!==";"){node=parseAssignment();node.comment=comment}while(token==="\n"||token===";"){if(blocks.length===0&&node){visible=token!==";";blocks.push({node:node,visible:visible})}getToken();if(token!=="\n"&&token!==";"&&token!==""){node=parseAssignment();node.comment=comment;visible=token!==";";blocks.push({node:node,visible:visible})}}if(blocks.length>0){return new BlockNode(blocks)}else{if(!node){node=new ConstantNode(undefined);node.comment=comment}return node}}function parseAssignment(){var name,args,value,valid;var node=parseConditional();if(token==="="){if(type.isSymbolNode(node)){name=node.name;getTokenSkipNewline();value=parseAssignment();return new AssignmentNode(new SymbolNode(name),value)}else if(type.isAccessorNode(node)){getTokenSkipNewline();value=parseAssignment();return new AssignmentNode(node.object,node.index,value)}else if(type.isFunctionNode(node)&&type.isSymbolNode(node.fn)){valid=true;args=[];name=node.name;node.args.forEach(function(arg,index){if(type.isSymbolNode(arg)){args[index]=arg.name}else{valid=false}});if(valid){getTokenSkipNewline();value=parseAssignment();return new FunctionAssignmentNode(name,args,value)}}throw createSyntaxError("Invalid left hand side of assignment operator =")}return node}function parseConditional(){var node=parseLogicalOr();while(token==="?"){var prev=conditional_level;conditional_level=nesting_level;getTokenSkipNewline();var condition=node;var trueExpr=parseAssignment();if(token!==":")throw createSyntaxError("False part of conditional expression expected");conditional_level=null;getTokenSkipNewline();var falseExpr=parseAssignment();node=new ConditionalNode(condition,trueExpr,falseExpr);conditional_level=prev}return node}function parseLogicalOr(){var node=parseLogicalXor();while(token==="or"){getTokenSkipNewline();node=new OperatorNode("or","or",[node,parseLogicalXor()])}return node}function parseLogicalXor(){var node=parseLogicalAnd();while(token==="xor"){getTokenSkipNewline();node=new OperatorNode("xor","xor",[node,parseLogicalAnd()])}return node}function parseLogicalAnd(){var node=parseBitwiseOr();while(token==="and"){getTokenSkipNewline();node=new OperatorNode("and","and",[node,parseBitwiseOr()])}return node}function parseBitwiseOr(){var node=parseBitwiseXor();while(token==="|"){getTokenSkipNewline();node=new OperatorNode("|","bitOr",[node,parseBitwiseXor()])}return node}function parseBitwiseXor(){var node=parseBitwiseAnd();while(token==="^|"){getTokenSkipNewline();node=new OperatorNode("^|","bitXor",[node,parseBitwiseAnd()])}return node}function parseBitwiseAnd(){var node=parseRelational();while(token==="&"){getTokenSkipNewline();node=new OperatorNode("&","bitAnd",[node,parseRelational()])}return node}function parseRelational(){var node,operators,name,fn,params;node=parseShift();operators={"==":"equal","!=":"unequal","<":"smaller",">":"larger","<=":"smallerEq",">=":"largerEq"};while(operators.hasOwnProperty(token)){name=token;fn=operators[name];getTokenSkipNewline();params=[node,parseShift()];node=new OperatorNode(name,fn,params)}return node}function parseShift(){var node,operators,name,fn,params;node=parseConversion();operators={"<<":"leftShift",">>":"rightArithShift",">>>":"rightLogShift"};while(operators.hasOwnProperty(token)){name=token;fn=operators[name];getTokenSkipNewline();params=[node,parseConversion()];node=new OperatorNode(name,fn,params)}return node}function parseConversion(){var node,operators,name,fn,params;node=parseRange();operators={to:"to",in:"to"};while(operators.hasOwnProperty(token)){name=token;fn=operators[name];getTokenSkipNewline();if(name==="in"&&token===""){node=new OperatorNode("*","multiply",[node,new SymbolNode("in")],true)}else{params=[node,parseRange()];node=new OperatorNode(name,fn,params)}}return node}function parseRange(){var node,params=[];if(token===":"){node=new ConstantNode(1)}else{node=parseAddSubtract()}if(token===":"&&conditional_level!==nesting_level){params.push(node);while(token===":"&&params.length<3){getTokenSkipNewline();if(token===")"||token==="]"||token===","||token===""){params.push(new SymbolNode("end"))}else{params.push(parseAddSubtract())}}if(params.length===3){node=new RangeNode(params[0],params[2],params[1])}else{node=new RangeNode(params[0],params[1])}}return node}function parseAddSubtract(){var node,operators,name,fn,params;node=parseMultiplyDivide();operators={"+":"add","-":"subtract"};while(operators.hasOwnProperty(token)){name=token;fn=operators[name];getTokenSkipNewline();params=[node,parseMultiplyDivide()];node=new OperatorNode(name,fn,params)}return node}function parseMultiplyDivide(){var node,last,operators,name,fn;node=parseImplicitMultiplication();last=node;operators={"*":"multiply",".*":"dotMultiply","/":"divide","./":"dotDivide","%":"mod",mod:"mod"};while(true){if(operators.hasOwnProperty(token)){name=token;fn=operators[name];getTokenSkipNewline();last=parseImplicitMultiplication();node=new OperatorNode(name,fn,[node,last])}else{break}}return node}function parseImplicitMultiplication(){var node,last;node=parseRule2();last=node;while(true){if(token_type===TOKENTYPE.SYMBOL||token==="in"&&type.isConstantNode(node)||token_type===TOKENTYPE.NUMBER&&!type.isConstantNode(last)&&(!type.isOperatorNode(last)||last.op==="!")||token==="("){last=parseRule2();node=new OperatorNode("*","multiply",[node,last],true)}else{break}}return node}function parseRule2(){var node,last;node=parseUnary();last=node;while(true){if(token==="/"&&type.isConstantNode(last)){pushTokenState();getTokenSkipNewline();if(token_type===TOKENTYPE.NUMBER){pushTokenState();getTokenSkipNewline();if(token_type===TOKENTYPE.SYMBOL||token==="("){popTokenState();discardTokenState();last=parseUnary();node=new OperatorNode("/","divide",[node,last])}else{popTokenState();popTokenState();break}}else{popTokenState();break}}else{break}}return node}function parseUnary(){var name,params,fn;var operators={"-":"unaryMinus","+":"unaryPlus","~":"bitNot",not:"not"};if(operators.hasOwnProperty(token)){fn=operators[token];name=token;getTokenSkipNewline();params=[parseUnary()];return new OperatorNode(name,fn,params)}return parsePow()}function parsePow(){var node,name,fn,params;node=parseLeftHandOperators();if(token==="^"||token===".^"){name=token;fn=name==="^"?"pow":"dotPow";getTokenSkipNewline();params=[node,parseUnary()];node=new OperatorNode(name,fn,params)}return node}function parseLeftHandOperators(){var node,operators,name,fn,params;node=parseCustomNodes();operators={"!":"factorial","'":"transpose"};while(operators.hasOwnProperty(token)){name=token;fn=operators[name];getToken();params=[node];node=new OperatorNode(name,fn,params);node=parseAccessors(node)}return node}function parseCustomNodes(){var params=[];if(token_type===TOKENTYPE.SYMBOL&&extra_nodes.hasOwnProperty(token)){var CustomNode=extra_nodes[token];getToken();if(token==="("){params=[];openParams();getToken();if(token!==")"){params.push(parseAssignment());while(token===","){getToken();params.push(parseAssignment())}}if(token!==")"){throw createSyntaxError("Parenthesis ) expected")}closeParams();getToken()}return new CustomNode(params)}return parseSymbol()}function parseSymbol(){var node,name;if(token_type===TOKENTYPE.SYMBOL||token_type===TOKENTYPE.DELIMITER&&token in NAMED_DELIMITERS){name=token;getToken();if(CONSTANTS.hasOwnProperty(name)){node=new ConstantNode(CONSTANTS[name])}else if(NUMERIC_CONSTANTS.indexOf(name)!==-1){node=new ConstantNode(numeric(name))}else{node=new SymbolNode(name)}node=parseAccessors(node);return node}return parseString()}function parseAccessors(node,types){var params;while((token==="("||token==="["||token===".")&&(!types||types.indexOf(token)!==-1)){params=[];if(token==="("){if(type.isSymbolNode(node)||type.isAccessorNode(node)){openParams();getToken();if(token!==")"){params.push(parseAssignment());while(token===","){getToken();params.push(parseAssignment())}}if(token!==")"){throw createSyntaxError("Parenthesis ) expected")}closeParams();getToken();node=new FunctionNode(node,params)}else{return node}}else if(token==="["){openParams();getToken();if(token!=="]"){params.push(parseAssignment());while(token===","){getToken();params.push(parseAssignment())}}if(token!=="]"){throw createSyntaxError("Parenthesis ] expected")}closeParams();getToken();node=new AccessorNode(node,new IndexNode(params))}else{getToken();if(token_type!==TOKENTYPE.SYMBOL){throw createSyntaxError("Property name expected after dot")}params.push(new ConstantNode(token));getToken();var dotNotation=true;node=new AccessorNode(node,new IndexNode(params,dotNotation))}}return node}function parseString(){var node,str;if(token==='"'){str=parseStringToken();node=new ConstantNode(str);node=parseAccessors(node);return node}return parseMatrix()}function parseStringToken(){var str="";while(c!==""&&c!=='"'){if(c==="\\"){str+=c;next()}str+=c;next()}getToken();if(token!=='"'){throw createSyntaxError('End of string " expected')}getToken();return JSON.parse('"'+str+'"')}function parseMatrix(){var array,params,rows,cols;if(token==="["){openParams();getToken();if(token!=="]"){var row=parseRow();if(token===";"){rows=1;params=[row];while(token===";"){getToken();params[rows]=parseRow();rows++}if(token!=="]"){throw createSyntaxError("End of matrix ] expected")}closeParams();getToken();cols=params[0].items.length;for(var r=1;r<rows;r++){if(params[r].items.length!==cols){throw createError("Column dimensions mismatch "+"("+params[r].items.length+" !== "+cols+")")}}array=new ArrayNode(params)}else{if(token!=="]"){throw createSyntaxError("End of matrix ] expected")}closeParams();getToken();array=row}}else{closeParams();getToken();array=new ArrayNode([])}return parseAccessors(array)}return parseObject()}function parseRow(){var params=[parseAssignment()];var len=1;while(token===","){getToken();params[len]=parseAssignment();len++}return new ArrayNode(params)}function parseObject(){if(token==="{"){var key;var properties={};do{getToken();if(token!=="}"){if(token==='"'){key=parseStringToken()}else if(token_type===TOKENTYPE.SYMBOL){key=token;getToken()}else{throw createSyntaxError("Symbol or string expected as object key")}if(token!==":"){throw createSyntaxError("Colon : expected after object key")}getToken();properties[key]=parseAssignment()}}while(token===",");if(token!=="}"){throw createSyntaxError("Comma , or bracket } expected after object value")}getToken();var node=new ObjectNode(properties);node=parseAccessors(node);return node}return parseNumber()}function parseNumber(){var numberStr;if(token_type===TOKENTYPE.NUMBER){numberStr=token;getToken();return new ConstantNode(numeric(numberStr,config.number))}return parseParentheses()}function parseParentheses(){var node;if(token==="("){openParams();getToken();node=parseAssignment();if(token!==")"){throw createSyntaxError("Parenthesis ) expected")}closeParams();getToken();node=new ParenthesisNode(node);node=parseAccessors(node);return node}return parseEnd()}function parseEnd(){if(token===""){throw createSyntaxError("Unexpected end of expression")}else if(token==="'"){throw createSyntaxError("Value expected. Note: strings must be enclosed by double quotes")}else{throw createSyntaxError("Value expected")}}function col(){return index-token.length+1}function createSyntaxError(message){var c=col();var error=new SyntaxError(message+" (char "+c+")");error["char"]=c;return error}function createError(message){var c=col();var error=new SyntaxError(message+" (char "+c+")");error["char"]=c;return error}return parse}exports.name="parse";exports.path="expression";exports.factory=factory},{"../error/ArgumentsError":26,"../type/numeric":58,"../utils/collection/deepMap":63,"./node/AccessorNode":33,"./node/ArrayNode":34,"./node/AssignmentNode":35,"./node/BlockNode":36,"./node/ConditionalNode":37,"./node/ConstantNode":38,"./node/FunctionAssignmentNode":39,"./node/FunctionNode":40,"./node/IndexNode":41,"./node/ObjectNode":43,"./node/OperatorNode":44,"./node/ParenthesisNode":45,"./node/RangeNode":46,"./node/SymbolNode":47}],52:[function(require,module,exports){"use strict";var IndexError=require("../../error/IndexError");exports.transform=function(err){if(err&&err.isIndexError){return new IndexError(err.index+1,err.min+1,err.max!==undefined?err.max+1:undefined)}return err}},{"../../error/IndexError":28}],53:[function(require,module,exports){"use strict";var clone=require("../../utils/object").clone;var validateIndex=require("../../utils/array").validateIndex;var getSafeProperty=require("../../utils/customs").getSafeProperty;var setSafeProperty=require("../../utils/customs").setSafeProperty;var DimensionError=require("../../error/DimensionError");function factory(type,config,load,typed){var matrix=load(require("../../type/matrix/function/matrix"));var subset=typed("subset",{"Array, Index":function(value,index){var m=matrix(value);var subset=m.subset(index);return index.isScalar()?subset:subset.valueOf()},"Matrix, Index":function(value,index){return value.subset(index)},"Object, Index":_getObjectProperty,"string, Index":_getSubstring,"Array, Index, any":function(value,index,replacement){return matrix(clone(value)).subset(index,replacement,undefined).valueOf()},"Array, Index, any, any":function(value,index,replacement,defaultValue){return matrix(clone(value)).subset(index,replacement,defaultValue).valueOf()},"Matrix, Index, any":function(value,index,replacement){return value.clone().subset(index,replacement)},"Matrix, Index, any, any":function(value,index,replacement,defaultValue){return value.clone().subset(index,replacement,defaultValue)},"string, Index, string":_setSubstring,"string, Index, string, string":_setSubstring,"Object, Index, any":_setObjectProperty});subset.toTex=undefined;return subset;function _getSubstring(str,index){if(!type.isIndex(index)){throw new TypeError("Index expected")}if(index.size().length!=1){throw new DimensionError(index.size().length,1)}var strLen=str.length;validateIndex(index.min()[0],strLen);validateIndex(index.max()[0],strLen);var range=index.dimension(0);var substr="";range.forEach(function(v){substr+=str.charAt(v)});return substr}function _setSubstring(str,index,replacement,defaultValue){if(!index||index.isIndex!==true){throw new TypeError("Index expected")}if(index.size().length!=1){throw new DimensionError(index.size().length,1)}if(defaultValue!==undefined){if(typeof defaultValue!=="string"||defaultValue.length!==1){throw new TypeError("Single character expected as defaultValue")}}else{defaultValue=" "}var range=index.dimension(0);var len=range.size()[0];if(len!=replacement.length){throw new DimensionError(range.size()[0],replacement.length)}var strLen=str.length;validateIndex(index.min()[0]);validateIndex(index.max()[0]);var chars=[];for(var i=0;i<strLen;i++){chars[i]=str.charAt(i)}range.forEach(function(v,i){chars[v]=replacement.charAt(i[0])});if(chars.length>strLen){for(i=strLen-1,len=chars.length;i<len;i++){if(!chars[i]){chars[i]=defaultValue}}}return chars.join("")}}function _getObjectProperty(object,index){if(index.size().length!==1){throw new DimensionError(index.size(),1)}var key=index.dimension(0);if(typeof key!=="string"){throw new TypeError("String expected as index to retrieve an object property")}return getSafeProperty(object,key)}function _setObjectProperty(object,index,replacement){if(index.size().length!==1){throw new DimensionError(index.size(),1)}var key=index.dimension(0);if(typeof key!=="string"){throw new TypeError("String expected as index to retrieve an object property")}var updated=clone(object);setSafeProperty(updated,key,replacement);return updated}exports.name="subset";exports.factory=factory},{"../../error/DimensionError":27,"../../type/matrix/function/matrix":57,"../../utils/array":60,"../../utils/customs":65,"../../utils/object":69}],54:[function(require,module,exports){"use strict";var string=require("../../utils/string");function factory(type,config,load,typed){var format=typed("format",{any:string.format,"any, Object | function | number":string.format});format.toTex=undefined;return format}exports.name="format";exports.factory=factory},{"../../utils/string":70}],55:[function(require,module,exports){"use strict";function factory(type,config,load,typed){var _typeof=typed("_typeof",{any:function(x){var t=typeof x;if(t==="object"){if(x===null)return"null";if(Array.isArray(x))return"Array";if(x instanceof Date)return"Date";if(x instanceof RegExp)return"RegExp";if(x instanceof Boolean)return"boolean";if(x instanceof Number)return"number";if(x instanceof String)return"string";if(type.isBigNumber(x))return"BigNumber";if(type.isComplex(x))return"Complex";if(type.isFraction(x))return"Fraction";if(type.isMatrix(x))return"Matrix";if(type.isUnit(x))return"Unit";if(type.isIndex(x))return"Index";if(type.isRange(x))return"Range";if(type.isResultSet(x))return"ResultSet";if(type.isNode(x))return x.type;if(type.isChain(x))return"Chain";if(type.isHelp(x))return"Help";return"Object"}if(t==="function")return"Function";return t}});_typeof.toTex=undefined;return _typeof}exports.name="typeof";exports.factory=factory},{}],56:[function(require,module,exports){"use strict";var number=require("../../utils/number");function factory(type,config,load,typed){function Range(start,end,step){if(!(this instanceof Range)){throw new SyntaxError("Constructor must be called with the new operator")}if(start!=null){if(type.isBigNumber(start))start=start.toNumber();else if(typeof start!=="number")throw new TypeError("Parameter start must be a number")}if(end!=null){if(type.isBigNumber(end))end=end.toNumber();else if(typeof end!=="number")throw new TypeError("Parameter end must be a number")}if(step!=null){if(type.isBigNumber(step))step=step.toNumber();else if(typeof step!=="number")throw new TypeError("Parameter step must be a number")}this.start=start!=null?parseFloat(start):0;this.end=end!=null?parseFloat(end):0;this.step=step!=null?parseFloat(step):1}Range.prototype.type="Range";Range.prototype.isRange=true;Range.parse=function(str){if(typeof str!=="string"){return null}var args=str.split(":");var nums=args.map(function(arg){return parseFloat(arg)});var invalid=nums.some(function(num){return isNaN(num)});if(invalid){return null}switch(nums.length){case 2:return new Range(nums[0],nums[1]);case 3:return new Range(nums[0],nums[2],nums[1]);default:return null}};Range.prototype.clone=function(){return new Range(this.start,this.end,this.step)};Range.prototype.size=function(){var len=0,start=this.start,step=this.step,end=this.end,diff=end-start;if(number.sign(step)==number.sign(diff)){len=Math.ceil(diff/step)}else if(diff==0){len=0}if(isNaN(len)){len=0}return[len]};Range.prototype.min=function(){var size=this.size()[0];if(size>0){if(this.step>0){return this.start}else{return this.start+(size-1)*this.step}}else{return undefined}};Range.prototype.max=function(){var size=this.size()[0];if(size>0){if(this.step>0){return this.start+(size-1)*this.step}else{return this.start}}else{return undefined}};Range.prototype.forEach=function(callback){var x=this.start;var step=this.step;var end=this.end;var i=0;if(step>0){while(x<end){callback(x,[i],this);x+=step;i++}}else if(step<0){while(x>end){callback(x,[i],this);x+=step;i++}}};Range.prototype.map=function(callback){var array=[];this.forEach(function(value,index,obj){array[index[0]]=callback(value,index,obj)});return array};Range.prototype.toArray=function(){var array=[];this.forEach(function(value,index){array[index[0]]=value});return array};Range.prototype.valueOf=function(){return this.toArray()};Range.prototype.format=function(options){var str=number.format(this.start,options);if(this.step!=1){str+=":"+number.format(this.step,options)}str+=":"+number.format(this.end,options);return str};Range.prototype.toString=function(){return this.format()};Range.prototype.toJSON=function(){return{mathjs:"Range",start:this.start,end:this.end,step:this.step}};Range.fromJSON=function(json){return new Range(json.start,json.end,json.step)};return Range}exports.name="Range";exports.path="type";exports.factory=factory},{"../../utils/number":68}],57:[function(require,module,exports){"use strict";function factory(type,config,load,typed){var matrix=typed("matrix",{"":function(){return _create([])},string:function(format){return _create([],format)},"string, string":function(format,datatype){return _create([],format,datatype)},Array:function(data){return _create(data)},Matrix:function(data){return _create(data,data.storage())},"Array | Matrix, string":_create,"Array | Matrix, string, string":_create});matrix.toTex={0:"\\begin{bmatrix}\\end{bmatrix}",1:"\\left(${args[0]}\\right)",2:"\\left(${args[0]}\\right)"};return matrix;function _create(data,format,datatype){var M=type.Matrix.storage(format||"default");return new M(data,datatype)}}exports.name="matrix";exports.factory=factory},{}],58:[function(require,module,exports){"use strict";function factory(type,config,load,typed){return function numeric(value,valueType){if(valueType==="BigNumber"){return new type.BigNumber(value)}else if(valueType==="Fraction"){return new type.Fraction(value)}else{if(typeof value==="number"){return value}else{if(value==="Infinity"){return Infinity}if(value==="NaN"){return NaN}if(!/^[\-+]?((\d+\.?\d*)|(\d*\.?\d+))([eE][+\-]?\d+)?$/.test(value)){throw new Error('Invalid numeric value "'+value+'"')}return parseFloat(value.replace(/^(0*)[0-9]/,function(match,zeros){return match.substring(zeros.length)}))}}}}exports.factory=factory},{}],59:[function(require,module,exports){"use strict";function factory(type,config,load,typed){function ResultSet(entries){if(!(this instanceof ResultSet)){throw new SyntaxError("Constructor must be called with the new operator")}this.entries=entries||[]}ResultSet.prototype.type="ResultSet";ResultSet.prototype.isResultSet=true;ResultSet.prototype.valueOf=function(){return this.entries};ResultSet.prototype.toString=function(){return"["+this.entries.join(", ")+"]"};ResultSet.prototype.toJSON=function(){return{mathjs:"ResultSet",entries:this.entries}};ResultSet.fromJSON=function(json){return new ResultSet(json.entries)};return ResultSet}exports.name="ResultSet";exports.path="type";exports.factory=factory},{}],60:[function(require,module,exports){"use strict";var number=require("./number");var string=require("./string");var DimensionError=require("../error/DimensionError");var IndexError=require("../error/IndexError");exports.size=function(x){var s=[];while(Array.isArray(x)){s.push(x.length);x=x[0]}return s};function _validate(array,size,dim){var i;var len=array.length;if(len!=size[dim]){throw new DimensionError(len,size[dim])}if(dim<size.length-1){var dimNext=dim+1;for(i=0;i<len;i++){var child=array[i];if(!Array.isArray(child)){throw new DimensionError(size.length-1,size.length,"<")}_validate(array[i],size,dimNext)}}else{for(i=0;i<len;i++){if(Array.isArray(array[i])){throw new DimensionError(size.length+1,size.length,">")}}}}exports.validate=function(array,size){var isScalar=size.length==0;if(isScalar){if(Array.isArray(array)){throw new DimensionError(array.length,0)}}else{_validate(array,size,0)}};exports.validateIndex=function(index,length){if(!number.isNumber(index)||!number.isInteger(index)){throw new TypeError("Index must be an integer (value: "+index+")")}if(index<0||typeof length==="number"&&index>=length){throw new IndexError(index,length)}};exports.resize=function(array,size,defaultValue){if(!Array.isArray(array)||!Array.isArray(size)){throw new TypeError("Array expected")}if(size.length===0){throw new Error("Resizing to scalar is not supported")}size.forEach(function(value){if(!number.isNumber(value)||!number.isInteger(value)||value<0){throw new TypeError("Invalid size, must contain positive integers "+"(size: "+string.format(size)+")")}});var _defaultValue=defaultValue!==undefined?defaultValue:0;_resize(array,size,0,_defaultValue);return array};function _resize(array,size,dim,defaultValue){var i;var elem;var oldLen=array.length;var newLen=size[dim];var minLen=Math.min(oldLen,newLen);array.length=newLen;if(dim<size.length-1){var dimNext=dim+1;for(i=0;i<minLen;i++){elem=array[i];if(!Array.isArray(elem)){elem=[elem];array[i]=elem}_resize(elem,size,dimNext,defaultValue)}for(i=minLen;i<newLen;i++){elem=[];array[i]=elem;_resize(elem,size,dimNext,defaultValue)}}else{for(i=0;i<minLen;i++){while(Array.isArray(array[i])){array[i]=array[i][0]}}for(i=minLen;i<newLen;i++){array[i]=defaultValue}}}exports.reshape=function(array,sizes){var flatArray=exports.flatten(array);var newArray;var product=function(arr){return arr.reduce(function(prev,curr){return prev*curr})};if(!Array.isArray(array)||!Array.isArray(sizes)){throw new TypeError("Array expected")}if(sizes.length===0){throw new DimensionError(0,product(exports.size(array)),"!=")}try{newArray=_reshape(flatArray,sizes)}catch(e){if(e instanceof DimensionError){throw new DimensionError(product(sizes),product(exports.size(array)),"!=")}throw e}if(flatArray.length>0){throw new DimensionError(product(sizes),product(exports.size(array)),"!=")}return newArray};function _reshape(array,sizes){var accumulator=[];var i;if(sizes.length===0){if(array.length===0){throw new DimensionError(null,null,"!=")}return array.shift()}for(i=0;i<sizes[0];i+=1){accumulator.push(_reshape(array,sizes.slice(1)))}return accumulator}exports.squeeze=function(array,size){var s=size||exports.size(array);while(Array.isArray(array)&&array.length===1){array=array[0];s.shift()}var dims=s.length;while(s[dims-1]===1){dims--}if(dims<s.length){array=_squeeze(array,dims,0);s.length=dims}return array};function _squeeze(array,dims,dim){var i,ii;if(dim<dims){var next=dim+1;for(i=0,ii=array.length;i<ii;i++){array[i]=_squeeze(array[i],dims,next)}}else{while(Array.isArray(array)){array=array[0]}}return array}exports.unsqueeze=function(array,dims,outer,size){var s=size||exports.size(array);if(outer){for(var i=0;i<outer;i++){array=[array];s.unshift(1)}}array=_unsqueeze(array,dims,0);while(s.length<dims){s.push(1)}return array};function _unsqueeze(array,dims,dim){var i,ii;if(Array.isArray(array)){var next=dim+1;for(i=0,ii=array.length;i<ii;i++){array[i]=_unsqueeze(array[i],dims,next)}}else{for(var d=dim;d<dims;d++){array=[array]}}return array}exports.flatten=function(array){if(!Array.isArray(array)){return array}var flat=[];array.forEach(function callback(value){if(Array.isArray(value)){value.forEach(callback)}else{flat.push(value)}});return flat};exports.map=function(array,callback){return Array.prototype.map.call(array,callback)};exports.forEach=function(array,callback){Array.prototype.forEach.call(array,callback)};exports.filter=function(array,callback){if(exports.size(array).length!==1){throw new Error("Only one dimensional matrices supported")}return Array.prototype.filter.call(array,callback)};exports.filterRegExp=function(array,regexp){if(exports.size(array).length!==1){throw new Error("Only one dimensional matrices supported")}return Array.prototype.filter.call(array,function(entry){return regexp.test(entry)})};exports.join=function(array,separator){return Array.prototype.join.call(array,separator)};exports.identify=function(a){if(!Array.isArray(a)){throw new TypeError("Array input expected")}if(a.length===0){return a}var b=[];var count=0;b[0]={value:a[0],identifier:0};for(var i=1;i<a.length;i++){if(a[i]===a[i-1]){count++}else{count=0}b.push({value:a[i],identifier:count})}return b};exports.generalize=function(a){if(!Array.isArray(a)){throw new TypeError("Array input expected")}if(a.length===0){return a}var b=[];for(var i=0;i<a.length;i++){b.push(a[i].value)}return b};exports.isArray=Array.isArray},{"../error/DimensionError":27,"../error/IndexError":28,"./number":68,"./string":70}],61:[function(require,module,exports){"use strict";var objectUtils=require("../object");exports.format=function(value,options){if(typeof options==="function"){return options(value)}if(!value.isFinite()){return value.isNaN()?"NaN":value.gt(0)?"Infinity":"-Infinity"}var notation="auto";var precision=undefined;if(options!==undefined){if(options.notation){notation=options.notation}if(typeof options==="number"){precision=options}else if(options.precision){precision=options.precision}}switch(notation){case"fixed":return exports.toFixed(value,precision);case"exponential":return exports.toExponential(value,precision);case"auto":if(options&&options.exponential&&(options.exponential.lower!==undefined||options.exponential.upper!==undefined)){var fixedOptions=objectUtils.map(options,function(x){return x});fixedOptions.exponential=undefined;if(options.exponential.lower!==undefined){fixedOptions.lowerExp=Math.round(Math.log(options.exponential.lower)/Math.LN10)}if(options.exponential.upper!==undefined){fixedOptions.upperExp=Math.round(Math.log(options.exponential.upper)/Math.LN10)}console.warn("Deprecation warning: Formatting options exponential.lower and exponential.upper "+"(minimum and maximum value) "+"are replaced with exponential.lowerExp and exponential.upperExp "+"(minimum and maximum exponent) since version 4.0.0. "+"Replace "+JSON.stringify(options)+" with "+JSON.stringify(fixedOptions));return exports.format(value,fixedOptions)}var lowerExp=options&&options.lowerExp!==undefined?options.lowerExp:-3;var upperExp=options&&options.upperExp!==undefined?options.upperExp:5;if(value.isZero())return"0";var str;var exp=value.logarithm();if(exp.gte(lowerExp)&&exp.lt(upperExp)){str=value.toSignificantDigits(precision).toFixed()}else{str=exports.toExponential(value,precision)}return str.replace(/((\.\d*?)(0+))($|e)/,function(){var digits=arguments[2];var e=arguments[4];return digits!=="."?digits+e:e});default:throw new Error('Unknown notation "'+notation+'". '+'Choose "auto", "exponential", or "fixed".')}};exports.toExponential=function(value,precision){if(precision!==undefined){return value.toExponential(precision-1)}else{return value.toExponential()}};exports.toFixed=function(value,precision){return value.toFixed(precision)}},{"../object":69}],62:[function(require,module,exports){"use strict";module.exports=function isBigNumber(x){return x&&x.constructor.prototype.isBigNumber||false}},{}],63:[function(require,module,exports){"use strict";module.exports=function deepMap(array,callback,skipZeros){if(array&&typeof array.map==="function"){return array.map(function(x){return deepMap(x,callback,skipZeros)})}else{return callback(array)}}},{}],64:[function(require,module,exports){"use strict";module.exports=function isMatrix(x){return x&&x.constructor.prototype.isMatrix||false}},{}],65:[function(require,module,exports){"use strict";var hasOwnProperty=require("./object").hasOwnProperty;function getSafeProperty(object,prop){if(isPlainObject(object)&&isSafeProperty(object,prop)){return object[prop]}if(typeof object[prop]==="function"&&isSafeMethod(object,prop)){throw new Error('Cannot access method "'+prop+'" as a property')}throw new Error('No access to property "'+prop+'"')}function setSafeProperty(object,prop,value){if(isPlainObject(object)&&isSafeProperty(object,prop)){return object[prop]=value}throw new Error('No access to property "'+prop+'"')}function isSafeProperty(object,prop){if(!object||typeof object!=="object"){return false}if(hasOwnProperty(safeNativeProperties,prop)){return true}if(prop in Object.prototype){return false}if(prop in Function.prototype){return false}return true}function validateSafeMethod(object,method){if(!isSafeMethod(object,method)){throw new Error('No access to method "'+method+'"')}}function isSafeMethod(object,method){if(!object||typeof object[method]!=="function"){return false}if(hasOwnProperty(object,method)&&(object.__proto__&&method in object.__proto__)){return false}if(hasOwnProperty(safeNativeMethods,method)){return true}if(method in Object.prototype){return false}if(method in Function.prototype){return false}return true}function isPlainObject(object){return typeof object==="object"&&object&&object.constructor===Object}var safeNativeProperties={length:true,name:true};var safeNativeMethods={toString:true,valueOf:true,toLocaleString:true};exports.getSafeProperty=getSafeProperty;exports.setSafeProperty=setSafeProperty;exports.isSafeProperty=isSafeProperty;exports.validateSafeMethod=validateSafeMethod;exports.isSafeMethod=isSafeMethod;exports.isPlainObject=isPlainObject},{"./object":69}],66:[function(require,module,exports){"use strict";var Emitter=require("tiny-emitter");exports.mixin=function(obj){var emitter=new Emitter;obj.on=emitter.on.bind(emitter);obj.off=emitter.off.bind(emitter);obj.once=emitter.once.bind(emitter);obj.emit=emitter.emit.bind(emitter);return obj}},{"tiny-emitter":94}],67:[function(require,module,exports){"use strict";var escape_latex=require("escape-latex");exports.symbols={Alpha:"A",alpha:"\\alpha",Beta:"B",beta:"\\beta",Gamma:"\\Gamma",gamma:"\\gamma",Delta:"\\Delta",delta:"\\delta",Epsilon:"E",epsilon:"\\epsilon",varepsilon:"\\varepsilon",Zeta:"Z",zeta:"\\zeta",Eta:"H",eta:"\\eta",Theta:"\\Theta",theta:"\\theta",vartheta:"\\vartheta",Iota:"I",iota:"\\iota",Kappa:"K",kappa:"\\kappa",varkappa:"\\varkappa",Lambda:"\\Lambda",lambda:"\\lambda",Mu:"M",mu:"\\mu",Nu:"N",nu:"\\nu",Xi:"\\Xi",xi:"\\xi",Omicron:"O",omicron:"o",Pi:"\\Pi",pi:"\\pi",varpi:"\\varpi",Rho:"P",rho:"\\rho",varrho:"\\varrho",Sigma:"\\Sigma",sigma:"\\sigma",varsigma:"\\varsigma",Tau:"T",tau:"\\tau",Upsilon:"\\Upsilon",upsilon:"\\upsilon",Phi:"\\Phi",phi:"\\phi",varphi:"\\varphi",Chi:"X",chi:"\\chi",Psi:"\\Psi",psi:"\\psi",Omega:"\\Omega",omega:"\\omega",true:"\\mathrm{True}",false:"\\mathrm{False}",i:"i",inf:"\\infty",Inf:"\\infty",infinity:"\\infty",Infinity:"\\infty",oo:"\\infty",lim:"\\lim",undefined:"\\mathbf{?}"};exports.operators={transpose:"^\\top",factorial:"!",pow:"^",dotPow:".^\\wedge",unaryPlus:"+",unaryMinus:"-",bitNot:"~",not:"\\neg",multiply:"\\cdot",divide:"\\frac",dotMultiply:".\\cdot",dotDivide:".:",mod:"\\mod",add:"+",subtract:"-",to:"\\rightarrow",leftShift:"<<",rightArithShift:">>",rightLogShift:">>>",equal:"=",unequal:"\\neq",smaller:"<",larger:">",smallerEq:"\\leq",largerEq:"\\geq",bitAnd:"\\&",bitXor:"\\underline{|}",bitOr:"|",and:"\\wedge",xor:"\\veebar",or:"\\vee"};exports.defaultTemplate="\\mathrm{${name}}\\left(${args}\\right)";var units={deg:"^\\circ"};exports.escape=function(string){return escape_latex(string,{preserveFormatting:true})};exports.toSymbol=function(name,isUnit){isUnit=typeof isUnit==="undefined"?false:isUnit;if(isUnit){if(units.hasOwnProperty(name)){return units[name]}return"\\mathrm{"+exports.escape(name)+"}"}if(exports.symbols.hasOwnProperty(name)){return exports.symbols[name]}return exports.escape(name)}},{"escape-latex":15}],68:[function(require,module,exports){"use strict";var objectUtils=require("./object");exports.isNumber=function(value){return typeof value==="number"};exports.isInteger=function(value){return isFinite(value)?value==Math.round(value):false};exports.sign=Math.sign||function(x){if(x>0){return 1}else if(x<0){return-1}else{return 0}};exports.format=function(value,options){if(typeof options==="function"){return options(value)}if(value===Infinity){return"Infinity"}else if(value===-Infinity){return"-Infinity"}else if(isNaN(value)){return"NaN"}var notation="auto";var precision=undefined;if(options){if(options.notation){notation=options.notation}if(exports.isNumber(options)){precision=options}else if(options.precision){precision=options.precision}}switch(notation){case"fixed":return exports.toFixed(value,precision);case"exponential":return exports.toExponential(value,precision);case"engineering":return exports.toEngineering(value,precision);case"auto":if(options&&options.exponential&&(options.exponential.lower!==undefined||options.exponential.upper!==undefined)){var fixedOptions=objectUtils.map(options,function(x){return x});fixedOptions.exponential=undefined;if(options.exponential.lower!==undefined){fixedOptions.lowerExp=Math.round(Math.log(options.exponential.lower)/Math.LN10)}if(options.exponential.upper!==undefined){fixedOptions.upperExp=Math.round(Math.log(options.exponential.upper)/Math.LN10)}console.warn("Deprecation warning: Formatting options exponential.lower and exponential.upper "+"(minimum and maximum value) "+"are replaced with exponential.lowerExp and exponential.upperExp "+"(minimum and maximum exponent) since version 4.0.0. "+"Replace "+JSON.stringify(options)+" with "+JSON.stringify(fixedOptions));return exports.toPrecision(value,precision,fixedOptions)}return exports.toPrecision(value,precision,options&&options).replace(/((\.\d*?)(0+))($|e)/,function(){var digits=arguments[2];var e=arguments[4];return digits!=="."?digits+e:e});default:throw new Error('Unknown notation "'+notation+'". '+'Choose "auto", "exponential", or "fixed".')}};exports.splitNumber=function(value){var match=String(value).toLowerCase().match(/^0*?(-?)(\d+\.?\d*)(e([+-]?\d+))?$/);if(!match){throw new SyntaxError("Invalid number "+value)}var sign=match[1];var digits=match[2];var exponent=parseFloat(match[4]||"0");var dot=digits.indexOf(".");exponent+=dot!==-1?dot-1:digits.length-1;var coefficients=digits.replace(".","").replace(/^0*/,function(zeros){exponent-=zeros.length;return""}).replace(/0*$/,"").split("").map(function(d){return parseInt(d)});if(coefficients.length===0){coefficients.push(0);exponent++}return{sign:sign,coefficients:coefficients,exponent:exponent}};exports.toEngineering=function(value,precision){if(isNaN(value)||!isFinite(value)){return String(value)}var rounded=exports.roundDigits(exports.splitNumber(value),precision);var e=rounded.exponent;var c=rounded.coefficients;var newExp=e%3===0?e:e<0?e-3-e%3:e-e%3;var significandsDiff=e>=0?e:Math.abs(newExp);if(c.length-1<significandsDiff)c=c.concat(zeros(significandsDiff-(c.length-1)));var expDiff=Math.abs(e-newExp);var decimalIdx=1;while(--expDiff>=0)decimalIdx++;var decimals=c.slice(decimalIdx).join("");var decimalVal=decimals.match(/[1-9]/)?"."+decimals:"";var str=c.slice(0,decimalIdx).join("")+decimalVal+"e"+(e>=0?"+":"")+newExp.toString();return rounded.sign+str};exports.toFixed=function(value,precision){if(isNaN(value)||!isFinite(value)){return String(value)}var splitValue=exports.splitNumber(value);var rounded=typeof precision==="number"?exports.roundDigits(splitValue,splitValue.exponent+1+precision):splitValue;var c=rounded.coefficients;var p=rounded.exponent+1;var pp=p+(precision||0);if(c.length<pp){c=c.concat(zeros(pp-c.length))}if(p<0){c=zeros(-p+1).concat(c);p=1}if(p<c.length){c.splice(p,0,p===0?"0.":".")}return rounded.sign+c.join("")};exports.toExponential=function(value,precision){if(isNaN(value)||!isFinite(value)){return String(value)}var split=exports.splitNumber(value);var rounded=precision?exports.roundDigits(split,precision):split;var c=rounded.coefficients;var e=rounded.exponent;if(c.length<precision){c=c.concat(zeros(precision-c.length))}var first=c.shift();return rounded.sign+first+(c.length>0?"."+c.join(""):"")+"e"+(e>=0?"+":"")+e};exports.toPrecision=function(value,precision,options){if(isNaN(value)||!isFinite(value)){return String(value)}var lowerExp=options&&options.lowerExp!==undefined?options.lowerExp:-3;var upperExp=options&&options.upperExp!==undefined?options.upperExp:5;var split=exports.splitNumber(value);if(split.exponent<lowerExp||split.exponent>=upperExp){return exports.toExponential(value,precision)}else{var rounded=precision?exports.roundDigits(split,precision):split;var c=rounded.coefficients;var e=rounded.exponent;if(c.length<precision){c=c.concat(zeros(precision-c.length))}c=c.concat(zeros(e-c.length+1+(c.length<precision?precision-c.length:0)));c=zeros(-e).concat(c);var dot=e>0?e:0;if(dot<c.length-1){c.splice(dot+1,0,".")}return rounded.sign+c.join("")}};exports.roundDigits=function(split,precision){var rounded={sign:split.sign,coefficients:split.coefficients,exponent:split.exponent};var c=rounded.coefficients;while(precision<=0){c.unshift(0);rounded.exponent++;precision++}if(c.length>precision){var removed=c.splice(precision,c.length-precision);if(removed[0]>=5){var i=precision-1;c[i]++;while(c[i]===10){c.pop();if(i===0){c.unshift(0);rounded.exponent++;i++}i--;c[i]++}}}return rounded};function zeros(length){var arr=[];for(var i=0;i<length;i++){arr.push(0)}return arr}exports.digits=function(value){return value.toExponential().replace(/e.*$/,"").replace(/^0\.?0*|\./,"").length};exports.DBL_EPSILON=Number.EPSILON||2.220446049250313e-16;exports.nearlyEqual=function(x,y,epsilon){if(epsilon==null){return x==y}if(x==y){return true}if(isNaN(x)||isNaN(y)){return false}if(isFinite(x)&&isFinite(y)){var diff=Math.abs(x-y);if(diff<exports.DBL_EPSILON){return true}else{return diff<=Math.max(Math.abs(x),Math.abs(y))*epsilon}}return false}},{"./object":69}],69:[function(require,module,exports){"use strict";var isBigNumber=require("./bignumber/isBigNumber");exports.clone=function clone(x){var type=typeof x;if(type==="number"||type==="string"||type==="boolean"||x===null||x===undefined){return x}if(typeof x.clone==="function"){return x.clone()}if(Array.isArray(x)){return x.map(function(value){return clone(value)})}if(x instanceof Number)return new Number(x.valueOf());if(x instanceof String)return new String(x.valueOf());if(x instanceof Boolean)return new Boolean(x.valueOf());if(x instanceof Date)return new Date(x.valueOf());if(isBigNumber(x))return x;if(x instanceof RegExp)throw new TypeError("Cannot clone "+x);return exports.map(x,clone)};exports.map=function(object,callback){var clone={};for(var key in object){if(exports.hasOwnProperty(object,key)){clone[key]=callback(object[key])}}return clone};exports.extend=function(a,b){for(var prop in b){if(exports.hasOwnProperty(b,prop)){a[prop]=b[prop]}}return a};exports.deepExtend=function deepExtend(a,b){if(Array.isArray(b)){throw new TypeError("Arrays are not supported by deepExtend")}for(var prop in b){if(exports.hasOwnProperty(b,prop)){if(b[prop]&&b[prop].constructor===Object){if(a[prop]===undefined){a[prop]={}}if(a[prop].constructor===Object){deepExtend(a[prop],b[prop])}else{a[prop]=b[prop]}}else if(Array.isArray(b[prop])){throw new TypeError("Arrays are not supported by deepExtend")}else{a[prop]=b[prop]}}}return a};exports.deepEqual=function deepEqual(a,b){var prop,i,len;if(Array.isArray(a)){if(!Array.isArray(b)){return false}if(a.length!=b.length){return false}for(i=0,len=a.length;i<len;i++){if(!exports.deepEqual(a[i],b[i])){return false}}return true}else if(a instanceof Object){if(Array.isArray(b)||!(b instanceof Object)){return false}for(prop in a){if(!exports.deepEqual(a[prop],b[prop])){return false}}for(prop in b){if(!exports.deepEqual(a[prop],b[prop])){return false}}return true}else{return typeof a===typeof b&&a==b}};exports.canDefineProperty=function(){try{if(Object.defineProperty){Object.defineProperty({},"x",{get:function(){}});return true}}catch(e){}return false};exports.lazy=function(object,prop,fn){if(exports.canDefineProperty()){var _uninitialized=true;var _value;Object.defineProperty(object,prop,{get:function(){if(_uninitialized){_value=fn();_uninitialized=false}return _value},set:function(value){_value=value;_uninitialized=false},configurable:true,enumerable:true})}else{object[prop]=fn()}};exports.traverse=function(object,path){var obj=object;if(path){var names=path.split(".");for(var i=0;i<names.length;i++){var name=names[i];if(!(name in obj)){obj[name]={}}obj=obj[name]}}return obj};exports.hasOwnProperty=function(object,property){return object&&Object.hasOwnProperty.call(object,property)};exports.isFactory=function(object){return object&&typeof object.factory==="function"}},{"./bignumber/isBigNumber":62}],70:[function(require,module,exports){"use strict";var formatNumber=require("./number").format;var formatBigNumber=require("./bignumber/formatter").format;var isBigNumber=require("./bignumber/isBigNumber");exports.isString=function(value){return typeof value==="string"};exports.endsWith=function(text,search){var start=text.length-search.length;var end=text.length;return text.substring(start,end)===search};exports.format=function(value,options){if(typeof value==="number"){return formatNumber(value,options)}if(isBigNumber(value)){return formatBigNumber(value,options)}if(looksLikeFraction(value)){if(!options||options.fraction!=="decimal"){return value.s*value.n+"/"+value.d}else{return value.toString()}}if(Array.isArray(value)){return formatArray(value,options)}if(exports.isString(value)){return'"'+value+'"'}if(typeof value==="function"){return value.syntax?String(value.syntax):"function"}if(value&&typeof value==="object"){if(typeof value.format==="function"){return value.format(options)}else if(value&&value.toString()!=={}.toString()){return value.toString()}else{var entries=[];for(var key in value){if(value.hasOwnProperty(key)){entries.push('"'+key+'": '+exports.format(value[key],options))}}return"{"+entries.join(", ")+"}"}}return String(value)};exports.stringify=function(value){var text=String(value);var escaped="";var i=0;while(i<text.length){var c=text.charAt(i);if(c==="\\"){escaped+=c;i++;c=text.charAt(i);if(c===""||'"\\/bfnrtu'.indexOf(c)===-1){escaped+="\\"}escaped+=c}else if(c==='"'){escaped+='\\"'}else{escaped+=c}i++}return'"'+escaped+'"'};exports.escape=function(value){var text=String(value);text=text.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return text};function formatArray(array,options){if(Array.isArray(array)){var str="[";var len=array.length;for(var i=0;i<len;i++){if(i!=0){str+=", "}str+=formatArray(array[i],options)}str+="]";return str}else{return exports.format(array,options)}}function looksLikeFraction(value){return value&&typeof value==="object"&&typeof value.s==="number"&&typeof value.n==="number"&&typeof value.d==="number"||false}},{"./bignumber/formatter":61,"./bignumber/isBigNumber":62,"./number":68}],71:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory():typeof define==="function"&&define.amd?define(factory):global.moment=factory()})(this,function(){"use strict";var hookCallback;function hooks(){return hookCallback.apply(null,arguments)}function setHookCallback(callback){hookCallback=callback}function isArray(input){return input instanceof Array||Object.prototype.toString.call(input)==="[object Array]"}function isObject(input){return input!=null&&Object.prototype.toString.call(input)==="[object Object]"}function isObjectEmpty(obj){if(Object.getOwnPropertyNames){return Object.getOwnPropertyNames(obj).length===0}else{var k;for(k in obj){if(obj.hasOwnProperty(k)){return false}}return true}}function isUndefined(input){return input===void 0}function isNumber(input){return typeof input==="number"||Object.prototype.toString.call(input)==="[object Number]"}function isDate(input){return input instanceof Date||Object.prototype.toString.call(input)==="[object Date]"}function map(arr,fn){var res=[],i;for(i=0;i<arr.length;++i){res.push(fn(arr[i],i))}return res}function hasOwnProp(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function extend(a,b){for(var i in b){if(hasOwnProp(b,i)){a[i]=b[i]}}if(hasOwnProp(b,"toString")){a.toString=b.toString}if(hasOwnProp(b,"valueOf")){a.valueOf=b.valueOf}return a}function createUTC(input,format,locale,strict){return createLocalOrUTC(input,format,locale,strict,true).utc()}function defaultParsingFlags(){return{empty:false,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:false,invalidMonth:null,invalidFormat:false,userInvalidated:false,iso:false,parsedDateParts:[],meridiem:null,rfc2822:false,weekdayMismatch:false}}function getParsingFlags(m){if(m._pf==null){m._pf=defaultParsingFlags()}return m._pf}var some;if(Array.prototype.some){some=Array.prototype.some}else{some=function(fun){var t=Object(this);var len=t.length>>>0;for(var i=0;i<len;i++){if(i in t&&fun.call(this,t[i],i,t)){return true}}return false}}function isValid(m){if(m._isValid==null){var flags=getParsingFlags(m);var parsedParts=some.call(flags.parsedDateParts,function(i){return i!=null});var isNowValid=!isNaN(m._d.getTime())&&flags.overflow<0&&!flags.empty&&!flags.invalidMonth&&!flags.invalidWeekday&&!flags.weekdayMismatch&&!flags.nullInput&&!flags.invalidFormat&&!flags.userInvalidated&&(!flags.meridiem||flags.meridiem&&parsedParts);if(m._strict){isNowValid=isNowValid&&flags.charsLeftOver===0&&flags.unusedTokens.length===0&&flags.bigHour===undefined}if(Object.isFrozen==null||!Object.isFrozen(m)){m._isValid=isNowValid}else{return isNowValid}}return m._isValid}function createInvalid(flags){var m=createUTC(NaN);if(flags!=null){extend(getParsingFlags(m),flags)}else{getParsingFlags(m).userInvalidated=true}return m}var momentProperties=hooks.momentProperties=[];function copyConfig(to,from){var i,prop,val;if(!isUndefined(from._isAMomentObject)){to._isAMomentObject=from._isAMomentObject}if(!isUndefined(from._i)){to._i=from._i}if(!isUndefined(from._f)){to._f=from._f}if(!isUndefined(from._l)){to._l=from._l}if(!isUndefined(from._strict)){to._strict=from._strict}if(!isUndefined(from._tzm)){to._tzm=from._tzm}if(!isUndefined(from._isUTC)){to._isUTC=from._isUTC}if(!isUndefined(from._offset)){to._offset=from._offset}if(!isUndefined(from._pf)){to._pf=getParsingFlags(from)}if(!isUndefined(from._locale)){to._locale=from._locale}if(momentProperties.length>0){for(i=0;i<momentProperties.length;i++){prop=momentProperties[i];val=from[prop];if(!isUndefined(val)){to[prop]=val}}}return to}var updateInProgress=false;function Moment(config){copyConfig(this,config);this._d=new Date(config._d!=null?config._d.getTime():NaN);if(!this.isValid()){this._d=new Date(NaN)}if(updateInProgress===false){updateInProgress=true;hooks.updateOffset(this);updateInProgress=false}}function isMoment(obj){return obj instanceof Moment||obj!=null&&obj._isAMomentObject!=null}function absFloor(number){if(number<0){return Math.ceil(number)||0}else{return Math.floor(number)}}function toInt(argumentForCoercion){var coercedNumber=+argumentForCoercion,value=0;if(coercedNumber!==0&&isFinite(coercedNumber)){value=absFloor(coercedNumber)}return value}function compareArrays(array1,array2,dontConvert){var len=Math.min(array1.length,array2.length),lengthDiff=Math.abs(array1.length-array2.length),diffs=0,i;for(i=0;i<len;i++){if(dontConvert&&array1[i]!==array2[i]||!dontConvert&&toInt(array1[i])!==toInt(array2[i])){diffs++}}return diffs+lengthDiff}function warn(msg){if(hooks.suppressDeprecationWarnings===false&&typeof console!=="undefined"&&console.warn){console.warn("Deprecation warning: "+msg)}}function deprecate(msg,fn){var firstTime=true;return extend(function(){if(hooks.deprecationHandler!=null){hooks.deprecationHandler(null,msg)}if(firstTime){var args=[];var arg;for(var i=0;i<arguments.length;i++){arg="";if(typeof arguments[i]==="object"){arg+="\n["+i+"] ";for(var key in arguments[0]){arg+=key+": "+arguments[0][key]+", "}arg=arg.slice(0,-2)}else{arg=arguments[i]}args.push(arg)}warn(msg+"\nArguments: "+Array.prototype.slice.call(args).join("")+"\n"+(new Error).stack);firstTime=false}return fn.apply(this,arguments)},fn)}var deprecations={};function deprecateSimple(name,msg){if(hooks.deprecationHandler!=null){hooks.deprecationHandler(name,msg)}if(!deprecations[name]){warn(msg);deprecations[name]=true}}hooks.suppressDeprecationWarnings=false;hooks.deprecationHandler=null;function isFunction(input){return input instanceof Function||Object.prototype.toString.call(input)==="[object Function]"}function set(config){var prop,i;for(i in config){prop=config[i];if(isFunction(prop)){this[i]=prop}else{this["_"+i]=prop}}this._config=config;this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function mergeConfigs(parentConfig,childConfig){var res=extend({},parentConfig),prop;for(prop in childConfig){if(hasOwnProp(childConfig,prop)){if(isObject(parentConfig[prop])&&isObject(childConfig[prop])){res[prop]={};extend(res[prop],parentConfig[prop]);extend(res[prop],childConfig[prop])}else if(childConfig[prop]!=null){res[prop]=childConfig[prop]}else{delete res[prop]}}}for(prop in parentConfig){if(hasOwnProp(parentConfig,prop)&&!hasOwnProp(childConfig,prop)&&isObject(parentConfig[prop])){res[prop]=extend({},res[prop])}}return res}function Locale(config){if(config!=null){this.set(config)}}var keys;if(Object.keys){keys=Object.keys}else{keys=function(obj){var i,res=[];for(i in obj){if(hasOwnProp(obj,i)){res.push(i)}}return res}}var defaultCalendar={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function calendar(key,mom,now){var output=this._calendar[key]||this._calendar["sameElse"];return isFunction(output)?output.call(mom,now):output}var defaultLongDateFormat={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function longDateFormat(key){var format=this._longDateFormat[key],formatUpper=this._longDateFormat[key.toUpperCase()];if(format||!formatUpper){return format}this._longDateFormat[key]=formatUpper.replace(/MMMM|MM|DD|dddd/g,function(val){return val.slice(1)});return this._longDateFormat[key]}var defaultInvalidDate="Invalid date";function invalidDate(){return this._invalidDate}var defaultOrdinal="%d";var defaultDayOfMonthOrdinalParse=/\d{1,2}/;function ordinal(number){return this._ordinal.replace("%d",number)}var defaultRelativeTime={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function relativeTime(number,withoutSuffix,string,isFuture){var output=this._relativeTime[string];return isFunction(output)?output(number,withoutSuffix,string,isFuture):output.replace(/%d/i,number)}function pastFuture(diff,output){var format=this._relativeTime[diff>0?"future":"past"];return isFunction(format)?format(output):format.replace(/%s/i,output)}var aliases={};function addUnitAlias(unit,shorthand){var lowerCase=unit.toLowerCase();aliases[lowerCase]=aliases[lowerCase+"s"]=aliases[shorthand]=unit}function normalizeUnits(units){return typeof units==="string"?aliases[units]||aliases[units.toLowerCase()]:undefined}function normalizeObjectUnits(inputObject){var normalizedInput={},normalizedProp,prop;for(prop in inputObject){if(hasOwnProp(inputObject,prop)){normalizedProp=normalizeUnits(prop);if(normalizedProp){normalizedInput[normalizedProp]=inputObject[prop]}}}return normalizedInput}var priorities={};function addUnitPriority(unit,priority){priorities[unit]=priority}function getPrioritizedUnits(unitsObj){var units=[];for(var u in unitsObj){units.push({unit:u,priority:priorities[u]})}units.sort(function(a,b){return a.priority-b.priority});return units}function zeroFill(number,targetLength,forceSign){var absNumber=""+Math.abs(number),zerosToFill=targetLength-absNumber.length,sign=number>=0;return(sign?forceSign?"+":"":"-")+Math.pow(10,Math.max(0,zerosToFill)).toString().substr(1)+absNumber}var formattingTokens=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;var localFormattingTokens=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g;var formatFunctions={};var formatTokenFunctions={};function addFormatToken(token,padded,ordinal,callback){var func=callback;if(typeof callback==="string"){func=function(){return this[callback]()}}if(token){formatTokenFunctions[token]=func}if(padded){formatTokenFunctions[padded[0]]=function(){return zeroFill(func.apply(this,arguments),padded[1],padded[2])}}if(ordinal){formatTokenFunctions[ordinal]=function(){return this.localeData().ordinal(func.apply(this,arguments),token)}}}function removeFormattingTokens(input){if(input.match(/\[[\s\S]/)){return input.replace(/^\[|\]$/g,"")}return input.replace(/\\/g,"")}function makeFormatFunction(format){var array=format.match(formattingTokens),i,length;for(i=0,length=array.length;i<length;i++){if(formatTokenFunctions[array[i]]){array[i]=formatTokenFunctions[array[i]]}else{array[i]=removeFormattingTokens(array[i])}}return function(mom){var output="",i;for(i=0;i<length;i++){output+=isFunction(array[i])?array[i].call(mom,format):array[i]}return output}}function formatMoment(m,format){if(!m.isValid()){return m.localeData().invalidDate()}format=expandFormat(format,m.localeData());formatFunctions[format]=formatFunctions[format]||makeFormatFunction(format);return formatFunctions[format](m)}function expandFormat(format,locale){var i=5;function replaceLongDateFormatTokens(input){return locale.longDateFormat(input)||input}localFormattingTokens.lastIndex=0;while(i>=0&&localFormattingTokens.test(format)){format=format.replace(localFormattingTokens,replaceLongDateFormatTokens);localFormattingTokens.lastIndex=0;i-=1}return format}var match1=/\d/;var match2=/\d\d/;var match3=/\d{3}/;var match4=/\d{4}/;var match6=/[+-]?\d{6}/;var match1to2=/\d\d?/;var match3to4=/\d\d\d\d?/;var match5to6=/\d\d\d\d\d\d?/;var match1to3=/\d{1,3}/;var match1to4=/\d{1,4}/;var match1to6=/[+-]?\d{1,6}/;var matchUnsigned=/\d+/;var matchSigned=/[+-]?\d+/;var matchOffset=/Z|[+-]\d\d:?\d\d/gi;var matchShortOffset=/Z|[+-]\d\d(?::?\d\d)?/gi;var matchTimestamp=/[+-]?\d+(\.\d{1,3})?/;var matchWord=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i;var regexes={};function addRegexToken(token,regex,strictRegex){regexes[token]=isFunction(regex)?regex:function(isStrict,localeData){return isStrict&&strictRegex?strictRegex:regex}}function getParseRegexForToken(token,config){if(!hasOwnProp(regexes,token)){return new RegExp(unescapeFormat(token))}return regexes[token](config._strict,config._locale)}function unescapeFormat(s){return regexEscape(s.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(matched,p1,p2,p3,p4){return p1||p2||p3||p4}))}function regexEscape(s){return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var tokens={};function addParseToken(token,callback){var i,func=callback;if(typeof token==="string"){token=[token]}if(isNumber(callback)){func=function(input,array){array[callback]=toInt(input)}}for(i=0;i<token.length;i++){tokens[token[i]]=func}}function addWeekParseToken(token,callback){addParseToken(token,function(input,array,config,token){config._w=config._w||{};callback(input,config._w,config,token)})}function addTimeToArrayFromToken(token,input,config){if(input!=null&&hasOwnProp(tokens,token)){tokens[token](input,config._a,config,token)}}var YEAR=0;var MONTH=1;var DATE=2;var HOUR=3;var MINUTE=4;var SECOND=5;var MILLISECOND=6;var WEEK=7;var WEEKDAY=8;addFormatToken("Y",0,0,function(){var y=this.year();return y<=9999?""+y:"+"+y});addFormatToken(0,["YY",2],0,function(){return this.year()%100});addFormatToken(0,["YYYY",4],0,"year");addFormatToken(0,["YYYYY",5],0,"year");addFormatToken(0,["YYYYYY",6,true],0,"year");addUnitAlias("year","y");addUnitPriority("year",1);addRegexToken("Y",matchSigned);addRegexToken("YY",match1to2,match2);addRegexToken("YYYY",match1to4,match4);addRegexToken("YYYYY",match1to6,match6);addRegexToken("YYYYYY",match1to6,match6);addParseToken(["YYYYY","YYYYYY"],YEAR);addParseToken("YYYY",function(input,array){array[YEAR]=input.length===2?hooks.parseTwoDigitYear(input):toInt(input)});addParseToken("YY",function(input,array){array[YEAR]=hooks.parseTwoDigitYear(input)});addParseToken("Y",function(input,array){array[YEAR]=parseInt(input,10)});function daysInYear(year){return isLeapYear(year)?366:365}function isLeapYear(year){return year%4===0&&year%100!==0||year%400===0}hooks.parseTwoDigitYear=function(input){return toInt(input)+(toInt(input)>68?1900:2e3)};var getSetYear=makeGetSet("FullYear",true);function getIsLeapYear(){return isLeapYear(this.year())}function makeGetSet(unit,keepTime){return function(value){if(value!=null){set$1(this,unit,value);hooks.updateOffset(this,keepTime);return this}else{return get(this,unit)}}}function get(mom,unit){return mom.isValid()?mom._d["get"+(mom._isUTC?"UTC":"")+unit]():NaN}function set$1(mom,unit,value){if(mom.isValid()&&!isNaN(value)){if(unit==="FullYear"&&isLeapYear(mom.year())&&mom.month()===1&&mom.date()===29){mom._d["set"+(mom._isUTC?"UTC":"")+unit](value,mom.month(),daysInMonth(value,mom.month()))}else{mom._d["set"+(mom._isUTC?"UTC":"")+unit](value)}}}function stringGet(units){units=normalizeUnits(units);if(isFunction(this[units])){return this[units]()}return this}function stringSet(units,value){if(typeof units==="object"){units=normalizeObjectUnits(units);var prioritized=getPrioritizedUnits(units);for(var i=0;i<prioritized.length;i++){this[prioritized[i].unit](units[prioritized[i].unit])}}else{units=normalizeUnits(units);if(isFunction(this[units])){return this[units](value)}}return this}function mod(n,x){return(n%x+x)%x}var indexOf;if(Array.prototype.indexOf){indexOf=Array.prototype.indexOf}else{indexOf=function(o){var i;for(i=0;i<this.length;++i){if(this[i]===o){return i}}return-1}}function daysInMonth(year,month){if(isNaN(year)||isNaN(month)){return NaN}var modMonth=mod(month,12);year+=(month-modMonth)/12;return modMonth===1?isLeapYear(year)?29:28:31-modMonth%7%2}addFormatToken("M",["MM",2],"Mo",function(){return this.month()+1});addFormatToken("MMM",0,0,function(format){return this.localeData().monthsShort(this,format)});addFormatToken("MMMM",0,0,function(format){return this.localeData().months(this,format)});addUnitAlias("month","M");addUnitPriority("month",8);addRegexToken("M",match1to2);addRegexToken("MM",match1to2,match2);addRegexToken("MMM",function(isStrict,locale){return locale.monthsShortRegex(isStrict)});addRegexToken("MMMM",function(isStrict,locale){return locale.monthsRegex(isStrict)});addParseToken(["M","MM"],function(input,array){array[MONTH]=toInt(input)-1});addParseToken(["MMM","MMMM"],function(input,array,config,token){var month=config._locale.monthsParse(input,token,config._strict);if(month!=null){array[MONTH]=month}else{getParsingFlags(config).invalidMonth=input}});var MONTHS_IN_FORMAT=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/;var defaultLocaleMonths="January_February_March_April_May_June_July_August_September_October_November_December".split("_");function localeMonths(m,format){if(!m){return isArray(this._months)?this._months:this._months["standalone"]}return isArray(this._months)?this._months[m.month()]:this._months[(this._months.isFormat||MONTHS_IN_FORMAT).test(format)?"format":"standalone"][m.month()]}var defaultLocaleMonthsShort="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_");function localeMonthsShort(m,format){if(!m){return isArray(this._monthsShort)?this._monthsShort:this._monthsShort["standalone"]}return isArray(this._monthsShort)?this._monthsShort[m.month()]:this._monthsShort[MONTHS_IN_FORMAT.test(format)?"format":"standalone"][m.month()]}function handleStrictParse(monthName,format,strict){var i,ii,mom,llc=monthName.toLocaleLowerCase();if(!this._monthsParse){this._monthsParse=[];this._longMonthsParse=[];this._shortMonthsParse=[];for(i=0;i<12;++i){mom=createUTC([2e3,i]);this._shortMonthsParse[i]=this.monthsShort(mom,"").toLocaleLowerCase();this._longMonthsParse[i]=this.months(mom,"").toLocaleLowerCase()}}if(strict){if(format==="MMM"){ii=indexOf.call(this._shortMonthsParse,llc);return ii!==-1?ii:null}else{ii=indexOf.call(this._longMonthsParse,llc);return ii!==-1?ii:null}}else{if(format==="MMM"){ii=indexOf.call(this._shortMonthsParse,llc);if(ii!==-1){return ii}ii=indexOf.call(this._longMonthsParse,llc);return ii!==-1?ii:null}else{ii=indexOf.call(this._longMonthsParse,llc);if(ii!==-1){return ii}ii=indexOf.call(this._shortMonthsParse,llc);return ii!==-1?ii:null}}}function localeMonthsParse(monthName,format,strict){var i,mom,regex;if(this._monthsParseExact){return handleStrictParse.call(this,monthName,format,strict)}if(!this._monthsParse){this._monthsParse=[];this._longMonthsParse=[];this._shortMonthsParse=[]}for(i=0;i<12;i++){mom=createUTC([2e3,i]);if(strict&&!this._longMonthsParse[i]){this._longMonthsParse[i]=new RegExp("^"+this.months(mom,"").replace(".","")+"$","i");this._shortMonthsParse[i]=new RegExp("^"+this.monthsShort(mom,"").replace(".","")+"$","i")}if(!strict&&!this._monthsParse[i]){regex="^"+this.months(mom,"")+"|^"+this.monthsShort(mom,"");this._monthsParse[i]=new RegExp(regex.replace(".",""),"i")}if(strict&&format==="MMMM"&&this._longMonthsParse[i].test(monthName)){return i}else if(strict&&format==="MMM"&&this._shortMonthsParse[i].test(monthName)){return i}else if(!strict&&this._monthsParse[i].test(monthName)){return i}}}function setMonth(mom,value){var dayOfMonth;if(!mom.isValid()){return mom}if(typeof value==="string"){if(/^\d+$/.test(value)){value=toInt(value)}else{value=mom.localeData().monthsParse(value);if(!isNumber(value)){return mom}}}dayOfMonth=Math.min(mom.date(),daysInMonth(mom.year(),value));mom._d["set"+(mom._isUTC?"UTC":"")+"Month"](value,dayOfMonth);return mom}function getSetMonth(value){if(value!=null){setMonth(this,value);hooks.updateOffset(this,true);return this}else{return get(this,"Month")}}function getDaysInMonth(){return daysInMonth(this.year(),this.month())}var defaultMonthsShortRegex=matchWord;function monthsShortRegex(isStrict){if(this._monthsParseExact){if(!hasOwnProp(this,"_monthsRegex")){computeMonthsParse.call(this)}if(isStrict){return this._monthsShortStrictRegex}else{return this._monthsShortRegex}}else{if(!hasOwnProp(this,"_monthsShortRegex")){this._monthsShortRegex=defaultMonthsShortRegex}return this._monthsShortStrictRegex&&isStrict?this._monthsShortStrictRegex:this._monthsShortRegex}}var defaultMonthsRegex=matchWord;function monthsRegex(isStrict){if(this._monthsParseExact){if(!hasOwnProp(this,"_monthsRegex")){computeMonthsParse.call(this)}if(isStrict){return this._monthsStrictRegex}else{return this._monthsRegex}}else{if(!hasOwnProp(this,"_monthsRegex")){this._monthsRegex=defaultMonthsRegex}return this._monthsStrictRegex&&isStrict?this._monthsStrictRegex:this._monthsRegex}}function computeMonthsParse(){function cmpLenRev(a,b){return b.length-a.length}var shortPieces=[],longPieces=[],mixedPieces=[],i,mom;for(i=0;i<12;i++){mom=createUTC([2e3,i]);shortPieces.push(this.monthsShort(mom,""));longPieces.push(this.months(mom,""));mixedPieces.push(this.months(mom,""));mixedPieces.push(this.monthsShort(mom,""))}shortPieces.sort(cmpLenRev);longPieces.sort(cmpLenRev);mixedPieces.sort(cmpLenRev);for(i=0;i<12;i++){shortPieces[i]=regexEscape(shortPieces[i]);longPieces[i]=regexEscape(longPieces[i])}for(i=0;i<24;i++){mixedPieces[i]=regexEscape(mixedPieces[i])}this._monthsRegex=new RegExp("^("+mixedPieces.join("|")+")","i");this._monthsShortRegex=this._monthsRegex;this._monthsStrictRegex=new RegExp("^("+longPieces.join("|")+")","i");this._monthsShortStrictRegex=new RegExp("^("+shortPieces.join("|")+")","i")}function createDate(y,m,d,h,M,s,ms){var date=new Date(y,m,d,h,M,s,ms);if(y<100&&y>=0&&isFinite(date.getFullYear())){date.setFullYear(y)}return date}function createUTCDate(y){var date=new Date(Date.UTC.apply(null,arguments));if(y<100&&y>=0&&isFinite(date.getUTCFullYear())){date.setUTCFullYear(y)}return date}function firstWeekOffset(year,dow,doy){var fwd=7+dow-doy,fwdlw=(7+createUTCDate(year,0,fwd).getUTCDay()-dow)%7;return-fwdlw+fwd-1}function dayOfYearFromWeeks(year,week,weekday,dow,doy){var localWeekday=(7+weekday-dow)%7,weekOffset=firstWeekOffset(year,dow,doy),dayOfYear=1+7*(week-1)+localWeekday+weekOffset,resYear,resDayOfYear;if(dayOfYear<=0){resYear=year-1;resDayOfYear=daysInYear(resYear)+dayOfYear}else if(dayOfYear>daysInYear(year)){resYear=year+1;resDayOfYear=dayOfYear-daysInYear(year)}else{resYear=year;resDayOfYear=dayOfYear}return{year:resYear,dayOfYear:resDayOfYear}}function weekOfYear(mom,dow,doy){var weekOffset=firstWeekOffset(mom.year(),dow,doy),week=Math.floor((mom.dayOfYear()-weekOffset-1)/7)+1,resWeek,resYear;if(week<1){resYear=mom.year()-1;resWeek=week+weeksInYear(resYear,dow,doy)}else if(week>weeksInYear(mom.year(),dow,doy)){resWeek=week-weeksInYear(mom.year(),dow,doy);resYear=mom.year()+1}else{resYear=mom.year();resWeek=week}return{week:resWeek,year:resYear}}function weeksInYear(year,dow,doy){var weekOffset=firstWeekOffset(year,dow,doy),weekOffsetNext=firstWeekOffset(year+1,dow,doy);return(daysInYear(year)-weekOffset+weekOffsetNext)/7}addFormatToken("w",["ww",2],"wo","week");addFormatToken("W",["WW",2],"Wo","isoWeek");addUnitAlias("week","w");addUnitAlias("isoWeek","W");addUnitPriority("week",5);addUnitPriority("isoWeek",5);addRegexToken("w",match1to2);addRegexToken("ww",match1to2,match2);addRegexToken("W",match1to2);addRegexToken("WW",match1to2,match2);addWeekParseToken(["w","ww","W","WW"],function(input,week,config,token){week[token.substr(0,1)]=toInt(input)});function localeWeek(mom){return weekOfYear(mom,this._week.dow,this._week.doy).week}var defaultLocaleWeek={dow:0,doy:6};function localeFirstDayOfWeek(){return this._week.dow}function localeFirstDayOfYear(){return this._week.doy}function getSetWeek(input){var week=this.localeData().week(this);return input==null?week:this.add((input-week)*7,"d")}function getSetISOWeek(input){var week=weekOfYear(this,1,4).week;return input==null?week:this.add((input-week)*7,"d")}addFormatToken("d",0,"do","day");addFormatToken("dd",0,0,function(format){return this.localeData().weekdaysMin(this,format)});addFormatToken("ddd",0,0,function(format){return this.localeData().weekdaysShort(this,format)});addFormatToken("dddd",0,0,function(format){return this.localeData().weekdays(this,format)});addFormatToken("e",0,0,"weekday");addFormatToken("E",0,0,"isoWeekday");addUnitAlias("day","d");addUnitAlias("weekday","e");addUnitAlias("isoWeekday","E");addUnitPriority("day",11);addUnitPriority("weekday",11);addUnitPriority("isoWeekday",11);addRegexToken("d",match1to2);addRegexToken("e",match1to2);addRegexToken("E",match1to2);addRegexToken("dd",function(isStrict,locale){return locale.weekdaysMinRegex(isStrict)});addRegexToken("ddd",function(isStrict,locale){return locale.weekdaysShortRegex(isStrict)});addRegexToken("dddd",function(isStrict,locale){return locale.weekdaysRegex(isStrict)});addWeekParseToken(["dd","ddd","dddd"],function(input,week,config,token){var weekday=config._locale.weekdaysParse(input,token,config._strict);if(weekday!=null){week.d=weekday}else{getParsingFlags(config).invalidWeekday=input}});addWeekParseToken(["d","e","E"],function(input,week,config,token){week[token]=toInt(input)});function parseWeekday(input,locale){if(typeof input!=="string"){return input}if(!isNaN(input)){return parseInt(input,10)}input=locale.weekdaysParse(input);if(typeof input==="number"){return input}return null}function parseIsoWeekday(input,locale){if(typeof input==="string"){return locale.weekdaysParse(input)%7||7}return isNaN(input)?null:input}var defaultLocaleWeekdays="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_");function localeWeekdays(m,format){if(!m){return isArray(this._weekdays)?this._weekdays:this._weekdays["standalone"]}return isArray(this._weekdays)?this._weekdays[m.day()]:this._weekdays[this._weekdays.isFormat.test(format)?"format":"standalone"][m.day()]}var defaultLocaleWeekdaysShort="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_");function localeWeekdaysShort(m){return m?this._weekdaysShort[m.day()]:this._weekdaysShort}var defaultLocaleWeekdaysMin="Su_Mo_Tu_We_Th_Fr_Sa".split("_");function localeWeekdaysMin(m){return m?this._weekdaysMin[m.day()]:this._weekdaysMin}function handleStrictParse$1(weekdayName,format,strict){var i,ii,mom,llc=weekdayName.toLocaleLowerCase();if(!this._weekdaysParse){this._weekdaysParse=[];this._shortWeekdaysParse=[];this._minWeekdaysParse=[];for(i=0;i<7;++i){mom=createUTC([2e3,1]).day(i);this._minWeekdaysParse[i]=this.weekdaysMin(mom,"").toLocaleLowerCase();this._shortWeekdaysParse[i]=this.weekdaysShort(mom,"").toLocaleLowerCase();this._weekdaysParse[i]=this.weekdays(mom,"").toLocaleLowerCase()}}if(strict){if(format==="dddd"){ii=indexOf.call(this._weekdaysParse,llc);return ii!==-1?ii:null}else if(format==="ddd"){ii=indexOf.call(this._shortWeekdaysParse,llc);return ii!==-1?ii:null}else{ii=indexOf.call(this._minWeekdaysParse,llc);return ii!==-1?ii:null}}else{if(format==="dddd"){ii=indexOf.call(this._weekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf.call(this._shortWeekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf.call(this._minWeekdaysParse,llc);return ii!==-1?ii:null}else if(format==="ddd"){ii=indexOf.call(this._shortWeekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf.call(this._weekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf.call(this._minWeekdaysParse,llc);return ii!==-1?ii:null}else{ii=indexOf.call(this._minWeekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf.call(this._weekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf.call(this._shortWeekdaysParse,llc);return ii!==-1?ii:null}}}function localeWeekdaysParse(weekdayName,format,strict){var i,mom,regex;if(this._weekdaysParseExact){return handleStrictParse$1.call(this,weekdayName,format,strict)}if(!this._weekdaysParse){this._weekdaysParse=[];this._minWeekdaysParse=[];this._shortWeekdaysParse=[];this._fullWeekdaysParse=[]}for(i=0;i<7;i++){mom=createUTC([2e3,1]).day(i);if(strict&&!this._fullWeekdaysParse[i]){this._fullWeekdaysParse[i]=new RegExp("^"+this.weekdays(mom,"").replace(".","\\.?")+"$","i");this._shortWeekdaysParse[i]=new RegExp("^"+this.weekdaysShort(mom,"").replace(".","\\.?")+"$","i");this._minWeekdaysParse[i]=new RegExp("^"+this.weekdaysMin(mom,"").replace(".","\\.?")+"$","i")}if(!this._weekdaysParse[i]){regex="^"+this.weekdays(mom,"")+"|^"+this.weekdaysShort(mom,"")+"|^"+this.weekdaysMin(mom,"");this._weekdaysParse[i]=new RegExp(regex.replace(".",""),"i")}if(strict&&format==="dddd"&&this._fullWeekdaysParse[i].test(weekdayName)){return i}else if(strict&&format==="ddd"&&this._shortWeekdaysParse[i].test(weekdayName)){return i}else if(strict&&format==="dd"&&this._minWeekdaysParse[i].test(weekdayName)){return i}else if(!strict&&this._weekdaysParse[i].test(weekdayName)){return i}}}function getSetDayOfWeek(input){if(!this.isValid()){return input!=null?this:NaN}var day=this._isUTC?this._d.getUTCDay():this._d.getDay();if(input!=null){input=parseWeekday(input,this.localeData());return this.add(input-day,"d")}else{return day}}function getSetLocaleDayOfWeek(input){if(!this.isValid()){return input!=null?this:NaN}var weekday=(this.day()+7-this.localeData()._week.dow)%7;return input==null?weekday:this.add(input-weekday,"d")}function getSetISODayOfWeek(input){if(!this.isValid()){return input!=null?this:NaN}if(input!=null){var weekday=parseIsoWeekday(input,this.localeData());return this.day(this.day()%7?weekday:weekday-7)}else{return this.day()||7}}var defaultWeekdaysRegex=matchWord;function weekdaysRegex(isStrict){if(this._weekdaysParseExact){if(!hasOwnProp(this,"_weekdaysRegex")){computeWeekdaysParse.call(this)}if(isStrict){return this._weekdaysStrictRegex}else{return this._weekdaysRegex}}else{if(!hasOwnProp(this,"_weekdaysRegex")){this._weekdaysRegex=defaultWeekdaysRegex}return this._weekdaysStrictRegex&&isStrict?this._weekdaysStrictRegex:this._weekdaysRegex}}var defaultWeekdaysShortRegex=matchWord;function weekdaysShortRegex(isStrict){if(this._weekdaysParseExact){if(!hasOwnProp(this,"_weekdaysRegex")){computeWeekdaysParse.call(this)}if(isStrict){return this._weekdaysShortStrictRegex}else{return this._weekdaysShortRegex}}else{if(!hasOwnProp(this,"_weekdaysShortRegex")){this._weekdaysShortRegex=defaultWeekdaysShortRegex}return this._weekdaysShortStrictRegex&&isStrict?this._weekdaysShortStrictRegex:this._weekdaysShortRegex}}var defaultWeekdaysMinRegex=matchWord;function weekdaysMinRegex(isStrict){if(this._weekdaysParseExact){if(!hasOwnProp(this,"_weekdaysRegex")){computeWeekdaysParse.call(this)}if(isStrict){return this._weekdaysMinStrictRegex}else{return this._weekdaysMinRegex}}else{if(!hasOwnProp(this,"_weekdaysMinRegex")){this._weekdaysMinRegex=defaultWeekdaysMinRegex}return this._weekdaysMinStrictRegex&&isStrict?this._weekdaysMinStrictRegex:this._weekdaysMinRegex}}function computeWeekdaysParse(){function cmpLenRev(a,b){return b.length-a.length}var minPieces=[],shortPieces=[],longPieces=[],mixedPieces=[],i,mom,minp,shortp,longp;for(i=0;i<7;i++){mom=createUTC([2e3,1]).day(i);minp=this.weekdaysMin(mom,"");shortp=this.weekdaysShort(mom,"");longp=this.weekdays(mom,"");minPieces.push(minp);shortPieces.push(shortp);longPieces.push(longp);mixedPieces.push(minp);mixedPieces.push(shortp);mixedPieces.push(longp)}minPieces.sort(cmpLenRev);shortPieces.sort(cmpLenRev);longPieces.sort(cmpLenRev);mixedPieces.sort(cmpLenRev);for(i=0;i<7;i++){shortPieces[i]=regexEscape(shortPieces[i]);longPieces[i]=regexEscape(longPieces[i]);mixedPieces[i]=regexEscape(mixedPieces[i])}this._weekdaysRegex=new RegExp("^("+mixedPieces.join("|")+")","i");this._weekdaysShortRegex=this._weekdaysRegex;this._weekdaysMinRegex=this._weekdaysRegex;this._weekdaysStrictRegex=new RegExp("^("+longPieces.join("|")+")","i");this._weekdaysShortStrictRegex=new RegExp("^("+shortPieces.join("|")+")","i");this._weekdaysMinStrictRegex=new RegExp("^("+minPieces.join("|")+")","i")}function hFormat(){return this.hours()%12||12}function kFormat(){return this.hours()||24}addFormatToken("H",["HH",2],0,"hour");addFormatToken("h",["hh",2],0,hFormat);addFormatToken("k",["kk",2],0,kFormat);addFormatToken("hmm",0,0,function(){return""+hFormat.apply(this)+zeroFill(this.minutes(),2)});addFormatToken("hmmss",0,0,function(){return""+hFormat.apply(this)+zeroFill(this.minutes(),2)+zeroFill(this.seconds(),2)});addFormatToken("Hmm",0,0,function(){return""+this.hours()+zeroFill(this.minutes(),2)});addFormatToken("Hmmss",0,0,function(){return""+this.hours()+zeroFill(this.minutes(),2)+zeroFill(this.seconds(),2)});function meridiem(token,lowercase){addFormatToken(token,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),lowercase)})}meridiem("a",true);meridiem("A",false);addUnitAlias("hour","h");addUnitPriority("hour",13);function matchMeridiem(isStrict,locale){return locale._meridiemParse}addRegexToken("a",matchMeridiem);addRegexToken("A",matchMeridiem);addRegexToken("H",match1to2);addRegexToken("h",match1to2);addRegexToken("k",match1to2);addRegexToken("HH",match1to2,match2);addRegexToken("hh",match1to2,match2);addRegexToken("kk",match1to2,match2);addRegexToken("hmm",match3to4);addRegexToken("hmmss",match5to6);addRegexToken("Hmm",match3to4);addRegexToken("Hmmss",match5to6);addParseToken(["H","HH"],HOUR);addParseToken(["k","kk"],function(input,array,config){var kInput=toInt(input);array[HOUR]=kInput===24?0:kInput});addParseToken(["a","A"],function(input,array,config){config._isPm=config._locale.isPM(input);config._meridiem=input});addParseToken(["h","hh"],function(input,array,config){array[HOUR]=toInt(input);getParsingFlags(config).bigHour=true});addParseToken("hmm",function(input,array,config){var pos=input.length-2;array[HOUR]=toInt(input.substr(0,pos));array[MINUTE]=toInt(input.substr(pos));getParsingFlags(config).bigHour=true});addParseToken("hmmss",function(input,array,config){var pos1=input.length-4;var pos2=input.length-2;array[HOUR]=toInt(input.substr(0,pos1));array[MINUTE]=toInt(input.substr(pos1,2));array[SECOND]=toInt(input.substr(pos2));getParsingFlags(config).bigHour=true});addParseToken("Hmm",function(input,array,config){var pos=input.length-2;array[HOUR]=toInt(input.substr(0,pos));array[MINUTE]=toInt(input.substr(pos))});addParseToken("Hmmss",function(input,array,config){var pos1=input.length-4;var pos2=input.length-2;array[HOUR]=toInt(input.substr(0,pos1));array[MINUTE]=toInt(input.substr(pos1,2));array[SECOND]=toInt(input.substr(pos2))});function localeIsPM(input){return(input+"").toLowerCase().charAt(0)==="p"}var defaultLocaleMeridiemParse=/[ap]\.?m?\.?/i;function localeMeridiem(hours,minutes,isLower){if(hours>11){return isLower?"pm":"PM"}else{return isLower?"am":"AM"}}var getSetHour=makeGetSet("Hours",true);var baseConfig={calendar:defaultCalendar,longDateFormat:defaultLongDateFormat,invalidDate:defaultInvalidDate,ordinal:defaultOrdinal,dayOfMonthOrdinalParse:defaultDayOfMonthOrdinalParse,relativeTime:defaultRelativeTime,months:defaultLocaleMonths,monthsShort:defaultLocaleMonthsShort,week:defaultLocaleWeek,weekdays:defaultLocaleWeekdays,weekdaysMin:defaultLocaleWeekdaysMin,weekdaysShort:defaultLocaleWeekdaysShort,meridiemParse:defaultLocaleMeridiemParse};var locales={};var localeFamilies={};var globalLocale;function normalizeLocale(key){return key?key.toLowerCase().replace("_","-"):key}function chooseLocale(names){var i=0,j,next,locale,split;while(i<names.length){split=normalizeLocale(names[i]).split("-");j=split.length;next=normalizeLocale(names[i+1]);next=next?next.split("-"):null;while(j>0){locale=loadLocale(split.slice(0,j).join("-"));if(locale){return locale}if(next&&next.length>=j&&compareArrays(split,next,true)>=j-1){break}j--}i++}return globalLocale}function loadLocale(name){var oldLocale=null;if(!locales[name]&&typeof module!=="undefined"&&module&&module.exports){try{oldLocale=globalLocale._abbr;var aliasedRequire=require;aliasedRequire("./locale/"+name);getSetGlobalLocale(oldLocale)}catch(e){}}return locales[name]}function getSetGlobalLocale(key,values){var data;if(key){if(isUndefined(values)){data=getLocale(key)}else{data=defineLocale(key,values)}if(data){globalLocale=data}else{if(typeof console!=="undefined"&&console.warn){console.warn("Locale "+key+" not found. Did you forget to load it?")}}}return globalLocale._abbr}function defineLocale(name,config){if(config!==null){var locale,parentConfig=baseConfig;config.abbr=name;if(locales[name]!=null){deprecateSimple("defineLocaleOverride","use moment.updateLocale(localeName, config) to change "+"an existing locale. moment.defineLocale(localeName, "+"config) should only be used for creating a new locale "+"See http://momentjs.com/guides/#/warnings/define-locale/ for more info.");parentConfig=locales[name]._config}else if(config.parentLocale!=null){if(locales[config.parentLocale]!=null){parentConfig=locales[config.parentLocale]._config}else{locale=loadLocale(config.parentLocale);if(locale!=null){parentConfig=locale._config}else{if(!localeFamilies[config.parentLocale]){localeFamilies[config.parentLocale]=[]}localeFamilies[config.parentLocale].push({name:name,config:config});return null}}}locales[name]=new Locale(mergeConfigs(parentConfig,config));if(localeFamilies[name]){localeFamilies[name].forEach(function(x){defineLocale(x.name,x.config)})}getSetGlobalLocale(name);return locales[name]}else{delete locales[name];return null}}function updateLocale(name,config){if(config!=null){var locale,tmpLocale,parentConfig=baseConfig;tmpLocale=loadLocale(name);if(tmpLocale!=null){parentConfig=tmpLocale._config}config=mergeConfigs(parentConfig,config);locale=new Locale(config);locale.parentLocale=locales[name];locales[name]=locale;getSetGlobalLocale(name)}else{if(locales[name]!=null){if(locales[name].parentLocale!=null){locales[name]=locales[name].parentLocale}else if(locales[name]!=null){delete locales[name]}}}return locales[name]}function getLocale(key){var locale;if(key&&key._locale&&key._locale._abbr){key=key._locale._abbr}if(!key){return globalLocale}if(!isArray(key)){locale=loadLocale(key);if(locale){return locale}key=[key]}return chooseLocale(key)}function listLocales(){return keys(locales)}function checkOverflow(m){var overflow;var a=m._a;if(a&&getParsingFlags(m).overflow===-2){overflow=a[MONTH]<0||a[MONTH]>11?MONTH:a[DATE]<1||a[DATE]>daysInMonth(a[YEAR],a[MONTH])?DATE:a[HOUR]<0||a[HOUR]>24||a[HOUR]===24&&(a[MINUTE]!==0||a[SECOND]!==0||a[MILLISECOND]!==0)?HOUR:a[MINUTE]<0||a[MINUTE]>59?MINUTE:a[SECOND]<0||a[SECOND]>59?SECOND:a[MILLISECOND]<0||a[MILLISECOND]>999?MILLISECOND:-1;if(getParsingFlags(m)._overflowDayOfYear&&(overflow<YEAR||overflow>DATE)){overflow=DATE}if(getParsingFlags(m)._overflowWeeks&&overflow===-1){overflow=WEEK}if(getParsingFlags(m)._overflowWeekday&&overflow===-1){overflow=WEEKDAY}getParsingFlags(m).overflow=overflow}return m}function defaults(a,b,c){if(a!=null){return a}if(b!=null){return b}return c}function currentDateArray(config){var nowValue=new Date(hooks.now());if(config._useUTC){return[nowValue.getUTCFullYear(),nowValue.getUTCMonth(),nowValue.getUTCDate()]}return[nowValue.getFullYear(),nowValue.getMonth(),nowValue.getDate()]}function configFromArray(config){var i,date,input=[],currentDate,expectedWeekday,yearToUse;if(config._d){return}currentDate=currentDateArray(config);if(config._w&&config._a[DATE]==null&&config._a[MONTH]==null){dayOfYearFromWeekInfo(config)}if(config._dayOfYear!=null){yearToUse=defaults(config._a[YEAR],currentDate[YEAR]);if(config._dayOfYear>daysInYear(yearToUse)||config._dayOfYear===0){getParsingFlags(config)._overflowDayOfYear=true}date=createUTCDate(yearToUse,0,config._dayOfYear);config._a[MONTH]=date.getUTCMonth();config._a[DATE]=date.getUTCDate()}for(i=0;i<3&&config._a[i]==null;++i){config._a[i]=input[i]=currentDate[i]}for(;i<7;i++){config._a[i]=input[i]=config._a[i]==null?i===2?1:0:config._a[i]}if(config._a[HOUR]===24&&config._a[MINUTE]===0&&config._a[SECOND]===0&&config._a[MILLISECOND]===0){config._nextDay=true;config._a[HOUR]=0}config._d=(config._useUTC?createUTCDate:createDate).apply(null,input);expectedWeekday=config._useUTC?config._d.getUTCDay():config._d.getDay();if(config._tzm!=null){config._d.setUTCMinutes(config._d.getUTCMinutes()-config._tzm)}if(config._nextDay){config._a[HOUR]=24}if(config._w&&typeof config._w.d!=="undefined"&&config._w.d!==expectedWeekday){getParsingFlags(config).weekdayMismatch=true}}function dayOfYearFromWeekInfo(config){var w,weekYear,week,weekday,dow,doy,temp,weekdayOverflow;w=config._w;if(w.GG!=null||w.W!=null||w.E!=null){dow=1;doy=4;weekYear=defaults(w.GG,config._a[YEAR],weekOfYear(createLocal(),1,4).year);week=defaults(w.W,1);weekday=defaults(w.E,1);if(weekday<1||weekday>7){weekdayOverflow=true}}else{dow=config._locale._week.dow;doy=config._locale._week.doy;var curWeek=weekOfYear(createLocal(),dow,doy);weekYear=defaults(w.gg,config._a[YEAR],curWeek.year);week=defaults(w.w,curWeek.week);if(w.d!=null){weekday=w.d;if(weekday<0||weekday>6){weekdayOverflow=true}}else if(w.e!=null){weekday=w.e+dow;if(w.e<0||w.e>6){weekdayOverflow=true}}else{weekday=dow}}if(week<1||week>weeksInYear(weekYear,dow,doy)){getParsingFlags(config)._overflowWeeks=true}else if(weekdayOverflow!=null){getParsingFlags(config)._overflowWeekday=true}else{temp=dayOfYearFromWeeks(weekYear,week,weekday,dow,doy);config._a[YEAR]=temp.year;config._dayOfYear=temp.dayOfYear}}var extendedIsoRegex=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/;var basicIsoRegex=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/;var tzRegex=/Z|[+-]\d\d(?::?\d\d)?/;var isoDates=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,false],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,false],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,false],["YYYYDDD",/\d{7}/]];var isoTimes=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]];var aspNetJsonRegex=/^\/?Date\((\-?\d+)/i;function configFromISO(config){var i,l,string=config._i,match=extendedIsoRegex.exec(string)||basicIsoRegex.exec(string),allowTime,dateFormat,timeFormat,tzFormat;if(match){getParsingFlags(config).iso=true;for(i=0,l=isoDates.length;i<l;i++){if(isoDates[i][1].exec(match[1])){dateFormat=isoDates[i][0];allowTime=isoDates[i][2]!==false;break}}if(dateFormat==null){config._isValid=false;return}if(match[3]){for(i=0,l=isoTimes.length;i<l;i++){if(isoTimes[i][1].exec(match[3])){timeFormat=(match[2]||" ")+isoTimes[i][0];break}}if(timeFormat==null){config._isValid=false;return}}if(!allowTime&&timeFormat!=null){config._isValid=false;return}if(match[4]){if(tzRegex.exec(match[4])){tzFormat="Z"}else{config._isValid=false;return}}config._f=dateFormat+(timeFormat||"")+(tzFormat||"");configFromStringAndFormat(config)}else{config._isValid=false}}var rfc2822=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/;function extractFromRFC2822Strings(yearStr,monthStr,dayStr,hourStr,minuteStr,secondStr){var result=[untruncateYear(yearStr),defaultLocaleMonthsShort.indexOf(monthStr),parseInt(dayStr,10),parseInt(hourStr,10),parseInt(minuteStr,10)];if(secondStr){result.push(parseInt(secondStr,10))}return result}function untruncateYear(yearStr){var year=parseInt(yearStr,10);if(year<=49){return 2e3+year}else if(year<=999){return 1900+year}return year}function preprocessRFC2822(s){return s.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function checkWeekday(weekdayStr,parsedInput,config){if(weekdayStr){var weekdayProvided=defaultLocaleWeekdaysShort.indexOf(weekdayStr),weekdayActual=new Date(parsedInput[0],parsedInput[1],parsedInput[2]).getDay();if(weekdayProvided!==weekdayActual){getParsingFlags(config).weekdayMismatch=true;config._isValid=false;return false}}return true}var obsOffsets={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function calculateOffset(obsOffset,militaryOffset,numOffset){if(obsOffset){return obsOffsets[obsOffset]}else if(militaryOffset){return 0}else{var hm=parseInt(numOffset,10);var m=hm%100,h=(hm-m)/100;return h*60+m}}function configFromRFC2822(config){var match=rfc2822.exec(preprocessRFC2822(config._i));if(match){var parsedArray=extractFromRFC2822Strings(match[4],match[3],match[2],match[5],match[6],match[7]);if(!checkWeekday(match[1],parsedArray,config)){return}config._a=parsedArray;config._tzm=calculateOffset(match[8],match[9],match[10]);config._d=createUTCDate.apply(null,config._a);config._d.setUTCMinutes(config._d.getUTCMinutes()-config._tzm);getParsingFlags(config).rfc2822=true}else{config._isValid=false}}function configFromString(config){var matched=aspNetJsonRegex.exec(config._i);if(matched!==null){config._d=new Date(+matched[1]);return}configFromISO(config);if(config._isValid===false){delete config._isValid}else{return}configFromRFC2822(config);if(config._isValid===false){delete config._isValid}else{return}hooks.createFromInputFallback(config)}hooks.createFromInputFallback=deprecate("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), "+"which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are "+"discouraged and will be removed in an upcoming major release. Please refer to "+"http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(config){config._d=new Date(config._i+(config._useUTC?" UTC":""))});hooks.ISO_8601=function(){};hooks.RFC_2822=function(){};function configFromStringAndFormat(config){if(config._f===hooks.ISO_8601){configFromISO(config);return}if(config._f===hooks.RFC_2822){configFromRFC2822(config);return}config._a=[];getParsingFlags(config).empty=true;var string=""+config._i,i,parsedInput,tokens,token,skipped,stringLength=string.length,totalParsedInputLength=0;tokens=expandFormat(config._f,config._locale).match(formattingTokens)||[];for(i=0;i<tokens.length;i++){token=tokens[i];parsedInput=(string.match(getParseRegexForToken(token,config))||[])[0];if(parsedInput){skipped=string.substr(0,string.indexOf(parsedInput));if(skipped.length>0){getParsingFlags(config).unusedInput.push(skipped)}string=string.slice(string.indexOf(parsedInput)+parsedInput.length);totalParsedInputLength+=parsedInput.length}if(formatTokenFunctions[token]){if(parsedInput){getParsingFlags(config).empty=false}else{getParsingFlags(config).unusedTokens.push(token)}addTimeToArrayFromToken(token,parsedInput,config)}else if(config._strict&&!parsedInput){getParsingFlags(config).unusedTokens.push(token)}}getParsingFlags(config).charsLeftOver=stringLength-totalParsedInputLength;if(string.length>0){getParsingFlags(config).unusedInput.push(string)}if(config._a[HOUR]<=12&&getParsingFlags(config).bigHour===true&&config._a[HOUR]>0){getParsingFlags(config).bigHour=undefined}getParsingFlags(config).parsedDateParts=config._a.slice(0);getParsingFlags(config).meridiem=config._meridiem;config._a[HOUR]=meridiemFixWrap(config._locale,config._a[HOUR],config._meridiem);configFromArray(config);checkOverflow(config)}function meridiemFixWrap(locale,hour,meridiem){var isPm;if(meridiem==null){return hour}if(locale.meridiemHour!=null){return locale.meridiemHour(hour,meridiem)}else if(locale.isPM!=null){isPm=locale.isPM(meridiem);if(isPm&&hour<12){hour+=12}if(!isPm&&hour===12){hour=0}return hour}else{return hour}}function configFromStringAndArray(config){var tempConfig,bestMoment,scoreToBeat,i,currentScore;if(config._f.length===0){getParsingFlags(config).invalidFormat=true;config._d=new Date(NaN);return}for(i=0;i<config._f.length;i++){currentScore=0;tempConfig=copyConfig({},config);if(config._useUTC!=null){tempConfig._useUTC=config._useUTC}tempConfig._f=config._f[i];configFromStringAndFormat(tempConfig);if(!isValid(tempConfig)){continue}currentScore+=getParsingFlags(tempConfig).charsLeftOver;currentScore+=getParsingFlags(tempConfig).unusedTokens.length*10;getParsingFlags(tempConfig).score=currentScore;if(scoreToBeat==null||currentScore<scoreToBeat){scoreToBeat=currentScore;bestMoment=tempConfig}}extend(config,bestMoment||tempConfig)}function configFromObject(config){if(config._d){return}var i=normalizeObjectUnits(config._i);config._a=map([i.year,i.month,i.day||i.date,i.hour,i.minute,i.second,i.millisecond],function(obj){return obj&&parseInt(obj,10)});configFromArray(config)}function createFromConfig(config){var res=new Moment(checkOverflow(prepareConfig(config)));if(res._nextDay){res.add(1,"d");res._nextDay=undefined}return res}function prepareConfig(config){var input=config._i,format=config._f;config._locale=config._locale||getLocale(config._l);if(input===null||format===undefined&&input===""){return createInvalid({nullInput:true})}if(typeof input==="string"){config._i=input=config._locale.preparse(input)}if(isMoment(input)){return new Moment(checkOverflow(input))}else if(isDate(input)){config._d=input}else if(isArray(format)){configFromStringAndArray(config)}else if(format){configFromStringAndFormat(config)}else{configFromInput(config)}if(!isValid(config)){config._d=null}return config}function configFromInput(config){var input=config._i;if(isUndefined(input)){config._d=new Date(hooks.now())}else if(isDate(input)){config._d=new Date(input.valueOf())}else if(typeof input==="string"){configFromString(config)}else if(isArray(input)){config._a=map(input.slice(0),function(obj){return parseInt(obj,10)});configFromArray(config)}else if(isObject(input)){configFromObject(config)}else if(isNumber(input)){config._d=new Date(input)}else{hooks.createFromInputFallback(config)}}function createLocalOrUTC(input,format,locale,strict,isUTC){var c={};if(locale===true||locale===false){strict=locale;locale=undefined}if(isObject(input)&&isObjectEmpty(input)||isArray(input)&&input.length===0){input=undefined}c._isAMomentObject=true;c._useUTC=c._isUTC=isUTC;c._l=locale;c._i=input;c._f=format;c._strict=strict;return createFromConfig(c)}function createLocal(input,format,locale,strict){return createLocalOrUTC(input,format,locale,strict,false)}var prototypeMin=deprecate("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var other=createLocal.apply(null,arguments);if(this.isValid()&&other.isValid()){return other<this?this:other}else{return createInvalid()}});var prototypeMax=deprecate("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var other=createLocal.apply(null,arguments);if(this.isValid()&&other.isValid()){return other>this?this:other}else{return createInvalid()}});function pickBy(fn,moments){var res,i;if(moments.length===1&&isArray(moments[0])){moments=moments[0]}if(!moments.length){return createLocal()}res=moments[0];for(i=1;i<moments.length;++i){if(!moments[i].isValid()||moments[i][fn](res)){res=moments[i]}}return res}function min(){var args=[].slice.call(arguments,0);return pickBy("isBefore",args)}function max(){var args=[].slice.call(arguments,0);return pickBy("isAfter",args)}var now=function(){return Date.now?Date.now():+new Date};var ordering=["year","quarter","month","week","day","hour","minute","second","millisecond"];function isDurationValid(m){for(var key in m){if(!(indexOf.call(ordering,key)!==-1&&(m[key]==null||!isNaN(m[key])))){return false}}var unitHasDecimal=false;for(var i=0;i<ordering.length;++i){if(m[ordering[i]]){if(unitHasDecimal){return false}if(parseFloat(m[ordering[i]])!==toInt(m[ordering[i]])){unitHasDecimal=true}}}return true}function isValid$1(){return this._isValid}function createInvalid$1(){return createDuration(NaN)}function Duration(duration){var normalizedInput=normalizeObjectUnits(duration),years=normalizedInput.year||0,quarters=normalizedInput.quarter||0,months=normalizedInput.month||0,weeks=normalizedInput.week||0,days=normalizedInput.day||0,hours=normalizedInput.hour||0,minutes=normalizedInput.minute||0,seconds=normalizedInput.second||0,milliseconds=normalizedInput.millisecond||0;this._isValid=isDurationValid(normalizedInput);this._milliseconds=+milliseconds+seconds*1e3+minutes*6e4+hours*1e3*60*60;this._days=+days+weeks*7;this._months=+months+quarters*3+years*12;this._data={};this._locale=getLocale();this._bubble()}function isDuration(obj){return obj instanceof Duration}function absRound(number){if(number<0){return Math.round(-1*number)*-1}else{return Math.round(number)}}function offset(token,separator){addFormatToken(token,0,0,function(){var offset=this.utcOffset();var sign="+";if(offset<0){offset=-offset;sign="-"}return sign+zeroFill(~~(offset/60),2)+separator+zeroFill(~~offset%60,2)})}offset("Z",":");offset("ZZ","");addRegexToken("Z",matchShortOffset);addRegexToken("ZZ",matchShortOffset);addParseToken(["Z","ZZ"],function(input,array,config){config._useUTC=true;config._tzm=offsetFromString(matchShortOffset,input)});var chunkOffset=/([\+\-]|\d\d)/gi;function offsetFromString(matcher,string){var matches=(string||"").match(matcher);if(matches===null){return null}var chunk=matches[matches.length-1]||[];var parts=(chunk+"").match(chunkOffset)||["-",0,0];var minutes=+(parts[1]*60)+toInt(parts[2]);return minutes===0?0:parts[0]==="+"?minutes:-minutes}function cloneWithOffset(input,model){var res,diff;if(model._isUTC){res=model.clone();diff=(isMoment(input)||isDate(input)?input.valueOf():createLocal(input).valueOf())-res.valueOf();res._d.setTime(res._d.valueOf()+diff);hooks.updateOffset(res,false);return res}else{return createLocal(input).local()}}function getDateOffset(m){return-Math.round(m._d.getTimezoneOffset()/15)*15}hooks.updateOffset=function(){};function getSetOffset(input,keepLocalTime,keepMinutes){var offset=this._offset||0,localAdjust;if(!this.isValid()){return input!=null?this:NaN}if(input!=null){if(typeof input==="string"){input=offsetFromString(matchShortOffset,input);if(input===null){return this}}else if(Math.abs(input)<16&&!keepMinutes){input=input*60}if(!this._isUTC&&keepLocalTime){localAdjust=getDateOffset(this)}this._offset=input;this._isUTC=true;if(localAdjust!=null){this.add(localAdjust,"m")}if(offset!==input){if(!keepLocalTime||this._changeInProgress){addSubtract(this,createDuration(input-offset,"m"),1,false)}else if(!this._changeInProgress){this._changeInProgress=true;hooks.updateOffset(this,true);this._changeInProgress=null}}return this}else{return this._isUTC?offset:getDateOffset(this)}}function getSetZone(input,keepLocalTime){if(input!=null){if(typeof input!=="string"){input=-input}this.utcOffset(input,keepLocalTime);return this}else{return-this.utcOffset()}}function setOffsetToUTC(keepLocalTime){return this.utcOffset(0,keepLocalTime)}function setOffsetToLocal(keepLocalTime){if(this._isUTC){this.utcOffset(0,keepLocalTime);this._isUTC=false;if(keepLocalTime){this.subtract(getDateOffset(this),"m")}}return this}function setOffsetToParsedOffset(){if(this._tzm!=null){this.utcOffset(this._tzm,false,true)}else if(typeof this._i==="string"){var tZone=offsetFromString(matchOffset,this._i);if(tZone!=null){this.utcOffset(tZone)}else{this.utcOffset(0,true)}}return this}function hasAlignedHourOffset(input){if(!this.isValid()){return false}input=input?createLocal(input).utcOffset():0;return(this.utcOffset()-input)%60===0}function isDaylightSavingTime(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function isDaylightSavingTimeShifted(){if(!isUndefined(this._isDSTShifted)){return this._isDSTShifted}var c={};copyConfig(c,this);c=prepareConfig(c);if(c._a){var other=c._isUTC?createUTC(c._a):createLocal(c._a);this._isDSTShifted=this.isValid()&&compareArrays(c._a,other.toArray())>0}else{this._isDSTShifted=false}return this._isDSTShifted}function isLocal(){return this.isValid()?!this._isUTC:false}function isUtcOffset(){return this.isValid()?this._isUTC:false}function isUtc(){return this.isValid()?this._isUTC&&this._offset===0:false}var aspNetRegex=/^(\-|\+)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/;var isoRegex=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function createDuration(input,key){var duration=input,match=null,sign,ret,diffRes;if(isDuration(input)){duration={ms:input._milliseconds,d:input._days,M:input._months}}else if(isNumber(input)){duration={};if(key){duration[key]=input}else{duration.milliseconds=input}}else if(!!(match=aspNetRegex.exec(input))){sign=match[1]==="-"?-1:1;duration={y:0,d:toInt(match[DATE])*sign,h:toInt(match[HOUR])*sign,m:toInt(match[MINUTE])*sign,s:toInt(match[SECOND])*sign,ms:toInt(absRound(match[MILLISECOND]*1e3))*sign}}else if(!!(match=isoRegex.exec(input))){sign=match[1]==="-"?-1:match[1]==="+"?1:1;duration={y:parseIso(match[2],sign),M:parseIso(match[3],sign),w:parseIso(match[4],sign),d:parseIso(match[5],sign),h:parseIso(match[6],sign),m:parseIso(match[7],sign),s:parseIso(match[8],sign)}}else if(duration==null){duration={}}else if(typeof duration==="object"&&("from"in duration||"to"in duration)){diffRes=momentsDifference(createLocal(duration.from),createLocal(duration.to));duration={};duration.ms=diffRes.milliseconds;duration.M=diffRes.months}ret=new Duration(duration);if(isDuration(input)&&hasOwnProp(input,"_locale")){ret._locale=input._locale}return ret}createDuration.fn=Duration.prototype;createDuration.invalid=createInvalid$1;function parseIso(inp,sign){var res=inp&&parseFloat(inp.replace(",","."));return(isNaN(res)?0:res)*sign}function positiveMomentsDifference(base,other){var res={milliseconds:0,months:0};res.months=other.month()-base.month()+(other.year()-base.year())*12;if(base.clone().add(res.months,"M").isAfter(other)){--res.months}res.milliseconds=+other-+base.clone().add(res.months,"M");return res}function momentsDifference(base,other){var res;if(!(base.isValid()&&other.isValid())){return{milliseconds:0,months:0}}other=cloneWithOffset(other,base);if(base.isBefore(other)){res=positiveMomentsDifference(base,other)}else{res=positiveMomentsDifference(other,base);res.milliseconds=-res.milliseconds;res.months=-res.months}return res}function createAdder(direction,name){return function(val,period){var dur,tmp;if(period!==null&&!isNaN(+period)){deprecateSimple(name,"moment()."+name+"(period, number) is deprecated. Please use moment()."+name+"(number, period). "+"See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info.");tmp=val;val=period;period=tmp}val=typeof val==="string"?+val:val;dur=createDuration(val,period);addSubtract(this,dur,direction);return this}}function addSubtract(mom,duration,isAdding,updateOffset){var milliseconds=duration._milliseconds,days=absRound(duration._days),months=absRound(duration._months);if(!mom.isValid()){return}updateOffset=updateOffset==null?true:updateOffset;if(months){setMonth(mom,get(mom,"Month")+months*isAdding)}if(days){set$1(mom,"Date",get(mom,"Date")+days*isAdding)}if(milliseconds){mom._d.setTime(mom._d.valueOf()+milliseconds*isAdding)}if(updateOffset){hooks.updateOffset(mom,days||months)}}var add=createAdder(1,"add");var subtract=createAdder(-1,"subtract");function getCalendarFormat(myMoment,now){var diff=myMoment.diff(now,"days",true);return diff<-6?"sameElse":diff<-1?"lastWeek":diff<0?"lastDay":diff<1?"sameDay":diff<2?"nextDay":diff<7?"nextWeek":"sameElse"}function calendar$1(time,formats){var now=time||createLocal(),sod=cloneWithOffset(now,this).startOf("day"),format=hooks.calendarFormat(this,sod)||"sameElse";var output=formats&&(isFunction(formats[format])?formats[format].call(this,now):formats[format]);return this.format(output||this.localeData().calendar(format,this,createLocal(now)))}function clone(){return new Moment(this)}function isAfter(input,units){var localInput=isMoment(input)?input:createLocal(input);if(!(this.isValid()&&localInput.isValid())){return false}units=normalizeUnits(!isUndefined(units)?units:"millisecond");if(units==="millisecond"){return this.valueOf()>localInput.valueOf()}else{return localInput.valueOf()<this.clone().startOf(units).valueOf()}}function isBefore(input,units){var localInput=isMoment(input)?input:createLocal(input);if(!(this.isValid()&&localInput.isValid())){return false}units=normalizeUnits(!isUndefined(units)?units:"millisecond");if(units==="millisecond"){return this.valueOf()<localInput.valueOf()}else{return this.clone().endOf(units).valueOf()<localInput.valueOf()}}function isBetween(from,to,units,inclusivity){inclusivity=inclusivity||"()";return(inclusivity[0]==="("?this.isAfter(from,units):!this.isBefore(from,units))&&(inclusivity[1]===")"?this.isBefore(to,units):!this.isAfter(to,units))}function isSame(input,units){var localInput=isMoment(input)?input:createLocal(input),inputMs;if(!(this.isValid()&&localInput.isValid())){return false}units=normalizeUnits(units||"millisecond");if(units==="millisecond"){return this.valueOf()===localInput.valueOf()}else{inputMs=localInput.valueOf();return this.clone().startOf(units).valueOf()<=inputMs&&inputMs<=this.clone().endOf(units).valueOf()}}function isSameOrAfter(input,units){return this.isSame(input,units)||this.isAfter(input,units)}function isSameOrBefore(input,units){return this.isSame(input,units)||this.isBefore(input,units)}function diff(input,units,asFloat){var that,zoneDelta,output;if(!this.isValid()){return NaN}that=cloneWithOffset(input,this);if(!that.isValid()){return NaN}zoneDelta=(that.utcOffset()-this.utcOffset())*6e4;units=normalizeUnits(units);switch(units){case"year":output=monthDiff(this,that)/12;break;case"month":output=monthDiff(this,that);break;case"quarter":output=monthDiff(this,that)/3;break;case"second":output=(this-that)/1e3;break;case"minute":output=(this-that)/6e4;break;case"hour":output=(this-that)/36e5;break;case"day":output=(this-that-zoneDelta)/864e5;break;case"week":output=(this-that-zoneDelta)/6048e5;break;default:output=this-that}return asFloat?output:absFloor(output)}function monthDiff(a,b){var wholeMonthDiff=(b.year()-a.year())*12+(b.month()-a.month()),anchor=a.clone().add(wholeMonthDiff,"months"),anchor2,adjust;if(b-anchor<0){anchor2=a.clone().add(wholeMonthDiff-1,"months");adjust=(b-anchor)/(anchor-anchor2)}else{anchor2=a.clone().add(wholeMonthDiff+1,"months");adjust=(b-anchor)/(anchor2-anchor)}return-(wholeMonthDiff+adjust)||0}hooks.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";hooks.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function toString(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function toISOString(keepOffset){if(!this.isValid()){return null}var utc=keepOffset!==true;var m=utc?this.clone().utc():this;if(m.year()<0||m.year()>9999){return formatMoment(m,utc?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ")}if(isFunction(Date.prototype.toISOString)){if(utc){return this.toDate().toISOString()}else{return new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",formatMoment(m,"Z"))}}return formatMoment(m,utc?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function inspect(){if(!this.isValid()){return"moment.invalid(/* "+this._i+" */)"}var func="moment";var zone="";if(!this.isLocal()){func=this.utcOffset()===0?"moment.utc":"moment.parseZone";zone="Z"}var prefix="["+func+'("]';var year=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY";var datetime="-MM-DD[T]HH:mm:ss.SSS";var suffix=zone+'[")]';return this.format(prefix+year+datetime+suffix)}function format(inputString){if(!inputString){inputString=this.isUtc()?hooks.defaultFormatUtc:hooks.defaultFormat}var output=formatMoment(this,inputString);return this.localeData().postformat(output)}function from(time,withoutSuffix){if(this.isValid()&&(isMoment(time)&&time.isValid()||createLocal(time).isValid())){return createDuration({to:this,from:time}).locale(this.locale()).humanize(!withoutSuffix)}else{return this.localeData().invalidDate()}}function fromNow(withoutSuffix){return this.from(createLocal(),withoutSuffix)}function to(time,withoutSuffix){if(this.isValid()&&(isMoment(time)&&time.isValid()||createLocal(time).isValid())){return createDuration({from:this,to:time}).locale(this.locale()).humanize(!withoutSuffix)}else{return this.localeData().invalidDate()}}function toNow(withoutSuffix){return this.to(createLocal(),withoutSuffix)}function locale(key){var newLocaleData;if(key===undefined){return this._locale._abbr}else{newLocaleData=getLocale(key);if(newLocaleData!=null){this._locale=newLocaleData}return this}}var lang=deprecate("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(key){if(key===undefined){return this.localeData()}else{return this.locale(key)}});function localeData(){return this._locale}function startOf(units){units=normalizeUnits(units);switch(units){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":case"date":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}if(units==="week"){this.weekday(0)}if(units==="isoWeek"){this.isoWeekday(1)}if(units==="quarter"){this.month(Math.floor(this.month()/3)*3)}return this}function endOf(units){units=normalizeUnits(units);if(units===undefined||units==="millisecond"){return this}if(units==="date"){units="day"}return this.startOf(units).add(1,units==="isoWeek"?"week":units).subtract(1,"ms")}function valueOf(){return this._d.valueOf()-(this._offset||0)*6e4}function unix(){return Math.floor(this.valueOf()/1e3)}function toDate(){return new Date(this.valueOf())}function toArray(){var m=this;return[m.year(),m.month(),m.date(),m.hour(),m.minute(),m.second(),m.millisecond()]}function toObject(){var m=this;return{years:m.year(),months:m.month(),date:m.date(),hours:m.hours(),minutes:m.minutes(),seconds:m.seconds(),milliseconds:m.milliseconds()}}function toJSON(){return this.isValid()?this.toISOString():null}function isValid$2(){return isValid(this)}function parsingFlags(){return extend({},getParsingFlags(this))}function invalidAt(){return getParsingFlags(this).overflow}function creationData(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}addFormatToken(0,["gg",2],0,function(){return this.weekYear()%100});addFormatToken(0,["GG",2],0,function(){return this.isoWeekYear()%100});function addWeekYearFormatToken(token,getter){addFormatToken(0,[token,token.length],0,getter)}addWeekYearFormatToken("gggg","weekYear");addWeekYearFormatToken("ggggg","weekYear");addWeekYearFormatToken("GGGG","isoWeekYear");addWeekYearFormatToken("GGGGG","isoWeekYear");addUnitAlias("weekYear","gg");addUnitAlias("isoWeekYear","GG");addUnitPriority("weekYear",1);addUnitPriority("isoWeekYear",1);addRegexToken("G",matchSigned);addRegexToken("g",matchSigned);addRegexToken("GG",match1to2,match2);addRegexToken("gg",match1to2,match2);addRegexToken("GGGG",match1to4,match4);addRegexToken("gggg",match1to4,match4);addRegexToken("GGGGG",match1to6,match6);addRegexToken("ggggg",match1to6,match6);addWeekParseToken(["gggg","ggggg","GGGG","GGGGG"],function(input,week,config,token){week[token.substr(0,2)]=toInt(input)});addWeekParseToken(["gg","GG"],function(input,week,config,token){week[token]=hooks.parseTwoDigitYear(input)});function getSetWeekYear(input){return getSetWeekYearHelper.call(this,input,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function getSetISOWeekYear(input){return getSetWeekYearHelper.call(this,input,this.isoWeek(),this.isoWeekday(),1,4)}function getISOWeeksInYear(){return weeksInYear(this.year(),1,4)}function getWeeksInYear(){var weekInfo=this.localeData()._week;return weeksInYear(this.year(),weekInfo.dow,weekInfo.doy)}function getSetWeekYearHelper(input,week,weekday,dow,doy){var weeksTarget;if(input==null){return weekOfYear(this,dow,doy).year}else{weeksTarget=weeksInYear(input,dow,doy);if(week>weeksTarget){week=weeksTarget}return setWeekAll.call(this,input,week,weekday,dow,doy)}}function setWeekAll(weekYear,week,weekday,dow,doy){var dayOfYearData=dayOfYearFromWeeks(weekYear,week,weekday,dow,doy),date=createUTCDate(dayOfYearData.year,0,dayOfYearData.dayOfYear);this.year(date.getUTCFullYear());this.month(date.getUTCMonth());this.date(date.getUTCDate());return this}addFormatToken("Q",0,"Qo","quarter");addUnitAlias("quarter","Q");addUnitPriority("quarter",7);addRegexToken("Q",match1);addParseToken("Q",function(input,array){array[MONTH]=(toInt(input)-1)*3});function getSetQuarter(input){return input==null?Math.ceil((this.month()+1)/3):this.month((input-1)*3+this.month()%3)}addFormatToken("D",["DD",2],"Do","date");addUnitAlias("date","D");addUnitPriority("date",9);addRegexToken("D",match1to2);addRegexToken("DD",match1to2,match2);addRegexToken("Do",function(isStrict,locale){return isStrict?locale._dayOfMonthOrdinalParse||locale._ordinalParse:locale._dayOfMonthOrdinalParseLenient});addParseToken(["D","DD"],DATE);addParseToken("Do",function(input,array){array[DATE]=toInt(input.match(match1to2)[0])});var getSetDayOfMonth=makeGetSet("Date",true);addFormatToken("DDD",["DDDD",3],"DDDo","dayOfYear");addUnitAlias("dayOfYear","DDD");addUnitPriority("dayOfYear",4);addRegexToken("DDD",match1to3);addRegexToken("DDDD",match3);addParseToken(["DDD","DDDD"],function(input,array,config){config._dayOfYear=toInt(input)});function getSetDayOfYear(input){var dayOfYear=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return input==null?dayOfYear:this.add(input-dayOfYear,"d")}addFormatToken("m",["mm",2],0,"minute");addUnitAlias("minute","m");addUnitPriority("minute",14);addRegexToken("m",match1to2);addRegexToken("mm",match1to2,match2);addParseToken(["m","mm"],MINUTE);var getSetMinute=makeGetSet("Minutes",false);addFormatToken("s",["ss",2],0,"second");addUnitAlias("second","s");addUnitPriority("second",15);addRegexToken("s",match1to2);addRegexToken("ss",match1to2,match2);addParseToken(["s","ss"],SECOND);var getSetSecond=makeGetSet("Seconds",false);addFormatToken("S",0,0,function(){return~~(this.millisecond()/100)});addFormatToken(0,["SS",2],0,function(){return~~(this.millisecond()/10)});addFormatToken(0,["SSS",3],0,"millisecond");addFormatToken(0,["SSSS",4],0,function(){return this.millisecond()*10});addFormatToken(0,["SSSSS",5],0,function(){return this.millisecond()*100});addFormatToken(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3});addFormatToken(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4});addFormatToken(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5});addFormatToken(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6});addUnitAlias("millisecond","ms");addUnitPriority("millisecond",16);addRegexToken("S",match1to3,match1);addRegexToken("SS",match1to3,match2);addRegexToken("SSS",match1to3,match3);var token;for(token="SSSS";token.length<=9;token+="S"){addRegexToken(token,matchUnsigned)}function parseMs(input,array){array[MILLISECOND]=toInt(("0."+input)*1e3)}for(token="S";token.length<=9;token+="S"){addParseToken(token,parseMs)}var getSetMillisecond=makeGetSet("Milliseconds",false);addFormatToken("z",0,0,"zoneAbbr");addFormatToken("zz",0,0,"zoneName");function getZoneAbbr(){return this._isUTC?"UTC":""}function getZoneName(){return this._isUTC?"Coordinated Universal Time":""}var proto=Moment.prototype;proto.add=add;proto.calendar=calendar$1;proto.clone=clone;proto.diff=diff;proto.endOf=endOf;proto.format=format;proto.from=from;proto.fromNow=fromNow;proto.to=to;proto.toNow=toNow;proto.get=stringGet;proto.invalidAt=invalidAt;proto.isAfter=isAfter;proto.isBefore=isBefore;proto.isBetween=isBetween;proto.isSame=isSame;proto.isSameOrAfter=isSameOrAfter;proto.isSameOrBefore=isSameOrBefore;proto.isValid=isValid$2;proto.lang=lang;proto.locale=locale;proto.localeData=localeData;proto.max=prototypeMax;proto.min=prototypeMin;proto.parsingFlags=parsingFlags;proto.set=stringSet;proto.startOf=startOf;proto.subtract=subtract;proto.toArray=toArray;proto.toObject=toObject;proto.toDate=toDate;proto.toISOString=toISOString;proto.inspect=inspect;proto.toJSON=toJSON;proto.toString=toString;proto.unix=unix;proto.valueOf=valueOf;proto.creationData=creationData;proto.year=getSetYear;proto.isLeapYear=getIsLeapYear;proto.weekYear=getSetWeekYear;proto.isoWeekYear=getSetISOWeekYear;proto.quarter=proto.quarters=getSetQuarter;proto.month=getSetMonth;proto.daysInMonth=getDaysInMonth;proto.week=proto.weeks=getSetWeek;proto.isoWeek=proto.isoWeeks=getSetISOWeek;proto.weeksInYear=getWeeksInYear;proto.isoWeeksInYear=getISOWeeksInYear;proto.date=getSetDayOfMonth;proto.day=proto.days=getSetDayOfWeek;proto.weekday=getSetLocaleDayOfWeek;proto.isoWeekday=getSetISODayOfWeek;proto.dayOfYear=getSetDayOfYear;proto.hour=proto.hours=getSetHour;proto.minute=proto.minutes=getSetMinute;proto.second=proto.seconds=getSetSecond;proto.millisecond=proto.milliseconds=getSetMillisecond;proto.utcOffset=getSetOffset;proto.utc=setOffsetToUTC;proto.local=setOffsetToLocal;proto.parseZone=setOffsetToParsedOffset;proto.hasAlignedHourOffset=hasAlignedHourOffset;proto.isDST=isDaylightSavingTime;proto.isLocal=isLocal;proto.isUtcOffset=isUtcOffset;proto.isUtc=isUtc;proto.isUTC=isUtc;proto.zoneAbbr=getZoneAbbr;proto.zoneName=getZoneName;proto.dates=deprecate("dates accessor is deprecated. Use date instead.",getSetDayOfMonth);proto.months=deprecate("months accessor is deprecated. Use month instead",getSetMonth);proto.years=deprecate("years accessor is deprecated. Use year instead",getSetYear);proto.zone=deprecate("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",getSetZone);proto.isDSTShifted=deprecate("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",isDaylightSavingTimeShifted);function createUnix(input){return createLocal(input*1e3)}function createInZone(){return createLocal.apply(null,arguments).parseZone()}function preParsePostFormat(string){return string}var proto$1=Locale.prototype;proto$1.calendar=calendar;proto$1.longDateFormat=longDateFormat;proto$1.invalidDate=invalidDate;proto$1.ordinal=ordinal;proto$1.preparse=preParsePostFormat;proto$1.postformat=preParsePostFormat;proto$1.relativeTime=relativeTime;proto$1.pastFuture=pastFuture;proto$1.set=set;proto$1.months=localeMonths;proto$1.monthsShort=localeMonthsShort;proto$1.monthsParse=localeMonthsParse;proto$1.monthsRegex=monthsRegex;proto$1.monthsShortRegex=monthsShortRegex;proto$1.week=localeWeek;proto$1.firstDayOfYear=localeFirstDayOfYear;proto$1.firstDayOfWeek=localeFirstDayOfWeek;proto$1.weekdays=localeWeekdays;proto$1.weekdaysMin=localeWeekdaysMin;proto$1.weekdaysShort=localeWeekdaysShort;proto$1.weekdaysParse=localeWeekdaysParse;proto$1.weekdaysRegex=weekdaysRegex;proto$1.weekdaysShortRegex=weekdaysShortRegex;proto$1.weekdaysMinRegex=weekdaysMinRegex;proto$1.isPM=localeIsPM;proto$1.meridiem=localeMeridiem;function get$1(format,index,field,setter){var locale=getLocale();var utc=createUTC().set(setter,index);return locale[field](utc,format)}function listMonthsImpl(format,index,field){if(isNumber(format)){index=format;format=undefined}format=format||"";if(index!=null){return get$1(format,index,field,"month")}var i;var out=[];for(i=0;i<12;i++){out[i]=get$1(format,i,field,"month")}return out}function listWeekdaysImpl(localeSorted,format,index,field){if(typeof localeSorted==="boolean"){if(isNumber(format)){index=format;format=undefined}format=format||""}else{format=localeSorted;index=format;localeSorted=false;if(isNumber(format)){index=format;format=undefined}format=format||""}var locale=getLocale(),shift=localeSorted?locale._week.dow:0;if(index!=null){return get$1(format,(index+shift)%7,field,"day")}var i;var out=[];for(i=0;i<7;i++){out[i]=get$1(format,(i+shift)%7,field,"day")}return out}function listMonths(format,index){return listMonthsImpl(format,index,"months")}function listMonthsShort(format,index){return listMonthsImpl(format,index,"monthsShort")}function listWeekdays(localeSorted,format,index){return listWeekdaysImpl(localeSorted,format,index,"weekdays")}function listWeekdaysShort(localeSorted,format,index){return listWeekdaysImpl(localeSorted,format,index,"weekdaysShort")}function listWeekdaysMin(localeSorted,format,index){return listWeekdaysImpl(localeSorted,format,index,"weekdaysMin")}getSetGlobalLocale("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(number){var b=number%10,output=toInt(number%100/10)===1?"th":b===1?"st":b===2?"nd":b===3?"rd":"th";return number+output}});hooks.lang=deprecate("moment.lang is deprecated. Use moment.locale instead.",getSetGlobalLocale);hooks.langData=deprecate("moment.langData is deprecated. Use moment.localeData instead.",getLocale);var mathAbs=Math.abs;function abs(){var data=this._data;this._milliseconds=mathAbs(this._milliseconds);this._days=mathAbs(this._days);this._months=mathAbs(this._months);data.milliseconds=mathAbs(data.milliseconds);data.seconds=mathAbs(data.seconds);data.minutes=mathAbs(data.minutes);data.hours=mathAbs(data.hours);data.months=mathAbs(data.months);data.years=mathAbs(data.years);return this}function addSubtract$1(duration,input,value,direction){var other=createDuration(input,value);duration._milliseconds+=direction*other._milliseconds;duration._days+=direction*other._days;duration._months+=direction*other._months;return duration._bubble()}function add$1(input,value){return addSubtract$1(this,input,value,1)}function subtract$1(input,value){return addSubtract$1(this,input,value,-1)}function absCeil(number){if(number<0){return Math.floor(number)}else{return Math.ceil(number)}}function bubble(){var milliseconds=this._milliseconds;var days=this._days;var months=this._months;var data=this._data;var seconds,minutes,hours,years,monthsFromDays;if(!(milliseconds>=0&&days>=0&&months>=0||milliseconds<=0&&days<=0&&months<=0)){milliseconds+=absCeil(monthsToDays(months)+days)*864e5;days=0;months=0}data.milliseconds=milliseconds%1e3;seconds=absFloor(milliseconds/1e3);data.seconds=seconds%60;minutes=absFloor(seconds/60);data.minutes=minutes%60;hours=absFloor(minutes/60);data.hours=hours%24;days+=absFloor(hours/24);monthsFromDays=absFloor(daysToMonths(days));months+=monthsFromDays;days-=absCeil(monthsToDays(monthsFromDays));years=absFloor(months/12);months%=12;data.days=days;data.months=months;data.years=years;return this}function daysToMonths(days){return days*4800/146097}function monthsToDays(months){return months*146097/4800}function as(units){if(!this.isValid()){return NaN}var days;var months;var milliseconds=this._milliseconds;units=normalizeUnits(units);if(units==="month"||units==="year"){days=this._days+milliseconds/864e5;months=this._months+daysToMonths(days);return units==="month"?months:months/12}else{days=this._days+Math.round(monthsToDays(this._months));switch(units){case"week":return days/7+milliseconds/6048e5;case"day":return days+milliseconds/864e5;case"hour":return days*24+milliseconds/36e5;case"minute":return days*1440+milliseconds/6e4;case"second":return days*86400+milliseconds/1e3;case"millisecond":return Math.floor(days*864e5)+milliseconds;default:throw new Error("Unknown unit "+units)}}}function valueOf$1(){if(!this.isValid()){return NaN}return this._milliseconds+this._days*864e5+this._months%12*2592e6+toInt(this._months/12)*31536e6}function makeAs(alias){return function(){return this.as(alias)}}var asMilliseconds=makeAs("ms");var asSeconds=makeAs("s");var asMinutes=makeAs("m");var asHours=makeAs("h");var asDays=makeAs("d");var asWeeks=makeAs("w");var asMonths=makeAs("M");var asYears=makeAs("y");function clone$1(){return createDuration(this)}function get$2(units){units=normalizeUnits(units);return this.isValid()?this[units+"s"]():NaN}function makeGetter(name){return function(){return this.isValid()?this._data[name]:NaN}}var milliseconds=makeGetter("milliseconds");var seconds=makeGetter("seconds");var minutes=makeGetter("minutes");var hours=makeGetter("hours");var days=makeGetter("days");var months=makeGetter("months");var years=makeGetter("years");function weeks(){return absFloor(this.days()/7)}var round=Math.round;var thresholds={ss:44,s:45,m:45,h:22,d:26,M:11};function substituteTimeAgo(string,number,withoutSuffix,isFuture,locale){return locale.relativeTime(number||1,!!withoutSuffix,string,isFuture)}function relativeTime$1(posNegDuration,withoutSuffix,locale){var duration=createDuration(posNegDuration).abs();var seconds=round(duration.as("s"));var minutes=round(duration.as("m"));var hours=round(duration.as("h"));var days=round(duration.as("d"));var months=round(duration.as("M"));var years=round(duration.as("y"));var a=seconds<=thresholds.ss&&["s",seconds]||seconds<thresholds.s&&["ss",seconds]||minutes<=1&&["m"]||minutes<thresholds.m&&["mm",minutes]||hours<=1&&["h"]||hours<thresholds.h&&["hh",hours]||days<=1&&["d"]||days<thresholds.d&&["dd",days]||months<=1&&["M"]||months<thresholds.M&&["MM",months]||years<=1&&["y"]||["yy",years];a[2]=withoutSuffix;a[3]=+posNegDuration>0;a[4]=locale;return substituteTimeAgo.apply(null,a)}function getSetRelativeTimeRounding(roundingFunction){if(roundingFunction===undefined){return round}if(typeof roundingFunction==="function"){round=roundingFunction;return true}return false}function getSetRelativeTimeThreshold(threshold,limit){if(thresholds[threshold]===undefined){return false}if(limit===undefined){return thresholds[threshold]}thresholds[threshold]=limit;if(threshold==="s"){thresholds.ss=limit-1}return true}function humanize(withSuffix){if(!this.isValid()){return this.localeData().invalidDate()}var locale=this.localeData();var output=relativeTime$1(this,!withSuffix,locale);if(withSuffix){output=locale.pastFuture(+this,output)}return locale.postformat(output)}var abs$1=Math.abs;function sign(x){return(x>0)-(x<0)||+x}function toISOString$1(){if(!this.isValid()){return this.localeData().invalidDate()}var seconds=abs$1(this._milliseconds)/1e3;var days=abs$1(this._days);var months=abs$1(this._months);var minutes,hours,years;minutes=absFloor(seconds/60);hours=absFloor(minutes/60);seconds%=60;minutes%=60;years=absFloor(months/12);months%=12;var Y=years;var M=months;var D=days;var h=hours;var m=minutes;var s=seconds?seconds.toFixed(3).replace(/\.?0+$/,""):"";var total=this.asSeconds();if(!total){return"P0D"}var totalSign=total<0?"-":"";var ymSign=sign(this._months)!==sign(total)?"-":"";var daysSign=sign(this._days)!==sign(total)?"-":"";var hmsSign=sign(this._milliseconds)!==sign(total)?"-":"";return totalSign+"P"+(Y?ymSign+Y+"Y":"")+(M?ymSign+M+"M":"")+(D?daysSign+D+"D":"")+(h||m||s?"T":"")+(h?hmsSign+h+"H":"")+(m?hmsSign+m+"M":"")+(s?hmsSign+s+"S":"")}var proto$2=Duration.prototype;proto$2.isValid=isValid$1;proto$2.abs=abs;proto$2.add=add$1;proto$2.subtract=subtract$1;proto$2.as=as;proto$2.asMilliseconds=asMilliseconds;proto$2.asSeconds=asSeconds;proto$2.asMinutes=asMinutes;proto$2.asHours=asHours;proto$2.asDays=asDays;proto$2.asWeeks=asWeeks;proto$2.asMonths=asMonths;proto$2.asYears=asYears;proto$2.valueOf=valueOf$1;proto$2._bubble=bubble;proto$2.clone=clone$1;proto$2.get=get$2;proto$2.milliseconds=milliseconds;proto$2.seconds=seconds;proto$2.minutes=minutes;proto$2.hours=hours;proto$2.days=days;proto$2.weeks=weeks;proto$2.months=months;proto$2.years=years;proto$2.humanize=humanize;proto$2.toISOString=toISOString$1;proto$2.toString=toISOString$1;proto$2.toJSON=toISOString$1;proto$2.locale=locale;proto$2.localeData=localeData;proto$2.toIsoString=deprecate("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",toISOString$1);proto$2.lang=lang;addFormatToken("X",0,0,"unix");addFormatToken("x",0,0,"valueOf");addRegexToken("x",matchSigned);addRegexToken("X",matchTimestamp);addParseToken("X",function(input,array,config){config._d=new Date(parseFloat(input,10)*1e3)});addParseToken("x",function(input,array,config){config._d=new Date(toInt(input))});hooks.version="2.22.2";setHookCallback(createLocal);hooks.fn=proto;hooks.min=min;hooks.max=max;hooks.now=now;hooks.utc=createUTC;hooks.unix=createUnix;hooks.months=listMonths;hooks.isDate=isDate;hooks.locale=getSetGlobalLocale;hooks.invalid=createInvalid;hooks.duration=createDuration;hooks.isMoment=isMoment;hooks.weekdays=listWeekdays;hooks.parseZone=createInZone;hooks.localeData=getLocale;hooks.isDuration=isDuration;hooks.monthsShort=listMonthsShort;hooks.weekdaysMin=listWeekdaysMin;hooks.defineLocale=defineLocale;hooks.updateLocale=updateLocale;hooks.locales=listLocales;hooks.weekdaysShort=listWeekdaysShort;hooks.normalizeUnits=normalizeUnits;hooks.relativeTimeRounding=getSetRelativeTimeRounding;hooks.relativeTimeThreshold=getSetRelativeTimeThreshold;hooks.calendarFormat=getCalendarFormat;hooks.prototype=proto;hooks.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"YYYY-[W]WW",MONTH:"YYYY-MM"};return hooks})},{}],72:[function(require,module,exports){exports.endianness=function(){return"LE"};exports.hostname=function(){if(typeof location!=="undefined"){return location.hostname}else return""};exports.loadavg=function(){return[]};exports.uptime=function(){return 0};exports.freemem=function(){return Number.MAX_VALUE};exports.totalmem=function(){return Number.MAX_VALUE};exports.cpus=function(){return[]};exports.type=function(){return"Browser"};exports.release=function(){if(typeof navigator!=="undefined"){return navigator.appVersion}return""};exports.networkInterfaces=exports.getNetworkInterfaces=function(){return{}};exports.arch=function(){return"javascript"};exports.platform=function(){return"browser"};exports.tmpdir=exports.tmpDir=function(){return"/tmp"};exports.EOL="\n";exports.homedir=function(){return"/"}},{}],73:[function(require,module,exports){(function(process){"use strict";if(!process.version||process.version.indexOf("v0.")===0||process.version.indexOf("v1.")===0&&process.version.indexOf("v1.8.")!==0){module.exports=nextTick}else{module.exports=process.nextTick}function nextTick(fn,arg1,arg2,arg3){if(typeof fn!=="function"){throw new TypeError('"callback" argument must be a function')}var len=arguments.length;var args,i;switch(len){case 0:case 1:return process.nextTick(fn);case 2:return process.nextTick(function afterTickOne(){fn.call(null,arg1)});case 3:return process.nextTick(function afterTickTwo(){fn.call(null,arg1,arg2)});case 4:return process.nextTick(function afterTickThree(){fn.call(null,arg1,arg2,arg3)});default:args=new Array(len-1);i=0;while(i<args.length){args[i++]=arguments[i]}return process.nextTick(function afterTick(){fn.apply(null,args)})}}}).call(this,require("_process"))},{_process:74}],74:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(name){return[]};process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],75:[function(require,module,exports){module.exports=require("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":76}],76:[function(require,module,exports){"use strict";var processNextTick=require("process-nextick-args");var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){keys.push(key)}return keys};module.exports=Duplex;var util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable");var Writable=require("./_stream_writable");util.inherits(Duplex,Readable);var keys=objectKeys(Writable.prototype);for(var v=0;v<keys.length;v++){var method=keys[v];if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method]}function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===false)this.readable=false;if(options&&options.writable===false)this.writable=false;this.allowHalfOpen=true;if(options&&options.allowHalfOpen===false)this.allowHalfOpen=false;this.once("end",onend)}function onend(){if(this.allowHalfOpen||this._writableState.ended)return;processNextTick(onEndNT,this)}function onEndNT(self){self.end()}Object.defineProperty(Duplex.prototype,"destroyed",{get:function(){if(this._readableState===undefined||this._writableState===undefined){return false}return this._readableState.destroyed&&this._writableState.destroyed},set:function(value){if(this._readableState===undefined||this._writableState===undefined){return}this._readableState.destroyed=value;this._writableState.destroyed=value}});Duplex.prototype._destroy=function(err,cb){this.push(null);this.end();processNextTick(cb,err)};function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}},{"./_stream_readable":78,"./_stream_writable":80,"core-util-is":14,inherits:18,"process-nextick-args":73}],77:[function(require,module,exports){"use strict";module.exports=PassThrough;var Transform=require("./_stream_transform");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":79,"core-util-is":14,inherits:18}],78:[function(require,module,exports){(function(process,global){"use strict";var processNextTick=require("process-nextick-args");module.exports=Readable;var isArray=require("isarray");var Duplex;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;var EElistenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream=require("./internal/streams/stream");var Buffer=require("safe-buffer").Buffer;var OurUint8Array=global.Uint8Array||function(){};function _uint8ArrayToBuffer(chunk){return Buffer.from(chunk)}function _isUint8Array(obj){return Buffer.isBuffer(obj)||obj instanceof OurUint8Array}var util=require("core-util-is");util.inherits=require("inherits");var debugUtil=require("util");var debug=void 0;if(debugUtil&&debugUtil.debuglog){debug=debugUtil.debuglog("stream")}else{debug=function(){}}var BufferList=require("./internal/streams/BufferList");var destroyImpl=require("./internal/streams/destroy");var StringDecoder;util.inherits(Readable,Stream);var kProxyEvents=["error","close","destroy","pause","resume"];function prependListener(emitter,event,fn){if(typeof emitter.prependListener==="function"){return emitter.prependListener(event,fn)}else{if(!emitter._events||!emitter._events[event])emitter.on(event,fn);else if(isArray(emitter._events[event]))emitter._events[event].unshift(fn);else emitter._events[event]=[fn,emitter._events[event]]}}function ReadableState(options,stream){Duplex=Duplex||require("./_stream_duplex");options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.readableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=Math.floor(this.highWaterMark);this.buffer=new BufferList;this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.ended=false;this.endEmitted=false;this.reading=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.resumeScheduled=false;this.destroyed=false;this.defaultEncoding=options.defaultEncoding||"utf8";this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}function Readable(options){Duplex=Duplex||require("./_stream_duplex");if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;if(options){if(typeof options.read==="function")this._read=options.read;if(typeof options.destroy==="function")this._destroy=options.destroy}Stream.call(this)}Object.defineProperty(Readable.prototype,"destroyed",{get:function(){if(this._readableState===undefined){return false}return this._readableState.destroyed},set:function(value){if(!this._readableState){return}this._readableState.destroyed=value}});Readable.prototype.destroy=destroyImpl.destroy;Readable.prototype._undestroy=destroyImpl.undestroy;Readable.prototype._destroy=function(err,cb){this.push(null);cb(err)};Readable.prototype.push=function(chunk,encoding){var state=this._readableState;var skipChunkCheck;if(!state.objectMode){if(typeof chunk==="string"){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=Buffer.from(chunk,encoding);encoding=""}skipChunkCheck=true}}else{skipChunkCheck=true}return readableAddChunk(this,chunk,encoding,false,skipChunkCheck)};Readable.prototype.unshift=function(chunk){return readableAddChunk(this,chunk,null,true,false)};function readableAddChunk(stream,chunk,encoding,addToFront,skipChunkCheck){var state=stream._readableState;if(chunk===null){state.reading=false;onEofChunk(stream,state)}else{var er;if(!skipChunkCheck)er=chunkInvalid(state,chunk);if(er){stream.emit("error",er)}else if(state.objectMode||chunk&&chunk.length>0){if(typeof chunk!=="string"&&!state.objectMode&&Object.getPrototypeOf(chunk)!==Buffer.prototype){chunk=_uint8ArrayToBuffer(chunk)}if(addToFront){if(state.endEmitted)stream.emit("error",new Error("stream.unshift() after end event"));else addChunk(stream,state,chunk,true)}else if(state.ended){stream.emit("error",new Error("stream.push() after EOF"))}else{state.reading=false;if(state.decoder&&!encoding){chunk=state.decoder.write(chunk);if(state.objectMode||chunk.length!==0)addChunk(stream,state,chunk,false);else maybeReadMore(stream,state)}else{addChunk(stream,state,chunk,false)}}}else if(!addToFront){state.reading=false}}return needMoreData(state)}function addChunk(stream,state,chunk,addToFront){if(state.flowing&&state.length===0&&!state.sync){stream.emit("data",chunk);stream.read(0)}else{state.length+=state.objectMode?1:chunk.length;if(addToFront)state.buffer.unshift(chunk);else state.buffer.push(chunk);if(state.needReadable)emitReadable(stream)}maybeReadMore(stream,state)}function chunkInvalid(state,chunk){var er;if(!_isUint8Array(chunk)&&typeof chunk!=="string"&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}return er}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}Readable.prototype.isPaused=function(){return this._readableState.flowing===false};Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc;return this};var MAX_HWM=8388608;function computeNewHighWaterMark(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;n|=n>>>1;n|=n>>>2;n|=n>>>4;n|=n>>>8;n|=n>>>16;n++}return n}function howMuchToRead(n,state){if(n<=0||state.length===0&&state.ended)return 0;if(state.objectMode)return 1;if(n!==n){if(state.flowing&&state.length)return state.buffer.head.data.length;else return state.length}if(n>state.highWaterMark)state.highWaterMark=computeNewHighWaterMark(n);if(n<=state.length)return n;if(!state.ended){state.needReadable=true;return 0}return state.length}Readable.prototype.read=function(n){debug("read",n);n=parseInt(n,10);var state=this._readableState;var nOrig=n;if(n!==0)state.emittedReadable=false;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){debug("read: emitReadable",state.length,state.ended);if(state.length===0&&state.ended)endReadable(this);else emitReadable(this);return null}n=howMuchToRead(n,state);if(n===0&&state.ended){if(state.length===0)endReadable(this);return null}var doRead=state.needReadable;debug("need readable",doRead);if(state.length===0||state.length-n<state.highWaterMark){doRead=true;debug("length less than watermark",doRead)}if(state.ended||state.reading){doRead=false;debug("reading or ended",doRead)}else if(doRead){debug("do read");state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false;if(!state.reading)n=howMuchToRead(nOrig,state)}var ret;if(n>0)ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=true;n=0}else{state.length-=n}if(state.length===0){if(!state.ended)state.needReadable=true;if(nOrig!==n&&state.ended)endReadable(this)}if(ret!==null)this.emit("data",ret);return ret};function onEofChunk(stream,state){if(state.ended)return;if(state.decoder){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}state.ended=true;emitReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=false;if(!state.emittedReadable){debug("emitReadable",state.flowing);state.emittedReadable=true;if(state.sync)processNextTick(emitReadable_,stream);else emitReadable_(stream)}}function emitReadable_(stream){debug("emit readable");stream.emit("readable");flow(stream)}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;processNextTick(maybeReadMore_,stream,state)}}function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){debug("maybeReadMore read 0");stream.read(0);if(len===state.length)break;else len=state.length}state.readingMore=false}Readable.prototype._read=function(n){this.emit("error",new Error("_read() is not implemented"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}state.pipesCount+=1;debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:unpipe;if(state.endEmitted)processNextTick(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable,unpipeInfo){debug("onunpipe");if(readable===src){if(unpipeInfo&&unpipeInfo.hasUnpiped===false){unpipeInfo.hasUnpiped=true;cleanup()}}}function onend(){debug("onend");dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);var cleanedUp=false;function cleanup(){debug("cleanup");dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",unpipe);src.removeListener("data",ondata);cleanedUp=true;if(state.awaitDrain&&(!dest._writableState||dest._writableState.needDrain))ondrain()}var increasedAwaitDrain=false;src.on("data",ondata);function ondata(chunk){debug("ondata");increasedAwaitDrain=false;var ret=dest.write(chunk);if(false===ret&&!increasedAwaitDrain){if((state.pipesCount===1&&state.pipes===dest||state.pipesCount>1&&indexOf(state.pipes,dest)!==-1)&&!cleanedUp){debug("false write response, pause",src._readableState.awaitDrain);src._readableState.awaitDrain++;increasedAwaitDrain=true}src.pause()}}function onerror(er){debug("onerror",er);unpipe();dest.removeListener("error",onerror);if(EElistenerCount(dest,"error")===0)dest.emit("error",er)}prependListener(dest,"error",onerror);function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){debug("onfinish");dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){debug("unpipe");src.unpipe(dest)}dest.emit("pipe",src);if(!state.flowing){debug("pipe resume");src.resume()}return dest};function pipeOnDrain(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain);if(state.awaitDrain)state.awaitDrain--;if(state.awaitDrain===0&&EElistenerCount(src,"data")){state.flowing=true;flow(src)}}}Readable.prototype.unpipe=function(dest){var state=this._readableState;var unpipeInfo={hasUnpiped:false};if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;state.flowing=false;if(dest)dest.emit("unpipe",this,unpipeInfo);return this}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;state.flowing=false;for(var i=0;i<len;i++){dests[i].emit("unpipe",this,unpipeInfo)}return this}var index=indexOf(state.pipes,dest);if(index===-1)return this;state.pipes.splice(index,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit("unpipe",this,unpipeInfo);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==="data"){if(this._readableState.flowing!==false)this.resume()}else if(ev==="readable"){var state=this._readableState;if(!state.endEmitted&&!state.readableListening){state.readableListening=state.needReadable=true;state.emittedReadable=false;if(!state.reading){processNextTick(nReadingNextTick,this)}else if(state.length){emitReadable(this)}}}return res};Readable.prototype.addListener=Readable.prototype.on;function nReadingNextTick(self){debug("readable nexttick read 0");self.read(0)}Readable.prototype.resume=function(){var state=this._readableState;if(!state.flowing){debug("resume");state.flowing=true;resume(this,state)}return this};function resume(stream,state){if(!state.resumeScheduled){state.resumeScheduled=true;processNextTick(resume_,stream,state)}}function resume_(stream,state){if(!state.reading){debug("resume read 0");stream.read(0)}state.resumeScheduled=false;state.awaitDrain=0;stream.emit("resume");flow(stream);if(state.flowing&&!state.reading)stream.read(0)}Readable.prototype.pause=function(){debug("call pause flowing=%j",this._readableState.flowing);if(false!==this._readableState.flowing){debug("pause");this._readableState.flowing=false;this.emit("pause")}return this};function flow(stream){var state=stream._readableState;debug("flow",state.flowing);while(state.flowing&&stream.read()!==null){}}Readable.prototype.wrap=function(stream){var state=this._readableState;var paused=false;var self=this;stream.on("end",function(){debug("wrapped end");if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)self.push(chunk)}self.push(null)});stream.on("data",function(chunk){debug("wrapped data");if(state.decoder)chunk=state.decoder.write(chunk);if(state.objectMode&&(chunk===null||chunk===undefined))return;else if(!state.objectMode&&(!chunk||!chunk.length))return;var ret=self.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i in stream){if(this[i]===undefined&&typeof stream[i]==="function"){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}for(var n=0;n<kProxyEvents.length;n++){stream.on(kProxyEvents[n],self.emit.bind(self,kProxyEvents[n]))}self._read=function(n){debug("wrapped _read",n);if(paused){paused=false;stream.resume()}};return self};Readable._fromList=fromList;function fromList(n,state){if(state.length===0)return null;var ret;if(state.objectMode)ret=state.buffer.shift();else if(!n||n>=state.length){if(state.decoder)ret=state.buffer.join("");else if(state.buffer.length===1)ret=state.buffer.head.data;else ret=state.buffer.concat(state.length);state.buffer.clear()}else{ret=fromListPartial(n,state.buffer,state.decoder)}return ret}function fromListPartial(n,list,hasStrings){var ret;if(n<list.head.data.length){ret=list.head.data.slice(0,n);list.head.data=list.head.data.slice(n)}else if(n===list.head.data.length){ret=list.shift()}else{ret=hasStrings?copyFromBufferString(n,list):copyFromBuffer(n,list)}return ret}function copyFromBufferString(n,list){var p=list.head;var c=1;var ret=p.data;n-=ret.length;while(p=p.next){var str=p.data;var nb=n>str.length?str.length:n;if(nb===str.length)ret+=str;else ret+=str.slice(0,n);n-=nb;if(n===0){if(nb===str.length){++c;if(p.next)list.head=p.next;else list.head=list.tail=null}else{list.head=p;p.data=str.slice(nb)}break}++c}list.length-=c;return ret}function copyFromBuffer(n,list){var ret=Buffer.allocUnsafe(n);var p=list.head;var c=1;p.data.copy(ret);n-=p.data.length;while(p=p.next){var buf=p.data;var nb=n>buf.length?buf.length:n;buf.copy(ret,ret.length-n,0,nb);n-=nb;if(n===0){if(nb===buf.length){++c;if(p.next)list.head=p.next;else list.head=list.tail=null}else{list.head=p;p.data=buf.slice(nb)}break}++c}list.length-=c;return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error('"endReadable()" called on non-empty stream');if(!state.endEmitted){state.ended=true;processNextTick(endReadableNT,state,stream)}}function endReadableNT(state,stream){if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit("end")}}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}return-1}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./_stream_duplex":76,"./internal/streams/BufferList":81,"./internal/streams/destroy":82,"./internal/streams/stream":83,_process:74,"core-util-is":14,events:16,inherits:18,isarray:20,"process-nextick-args":73,"safe-buffer":88,"string_decoder/":92,util:10}],79:[function(require,module,exports){"use strict";module.exports=Transform;var Duplex=require("./_stream_duplex");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(Transform,Duplex);function TransformState(stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)};this.needTransform=false;this.transforming=false;this.writecb=null;this.writechunk=null;this.writeencoding=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=false;var cb=ts.writecb;if(!cb){return stream.emit("error",new Error("write callback called multiple times"))}ts.writechunk=null;ts.writecb=null;if(data!==null&&data!==undefined)stream.push(data);cb(er);var rs=stream._readableState;rs.reading=false;if(rs.needReadable||rs.length<rs.highWaterMark){stream._read(rs.highWaterMark)}}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);this._transformState=new TransformState(this);var stream=this;this._readableState.needReadable=true;this._readableState.sync=false;if(options){if(typeof options.transform==="function")this._transform=options.transform;if(typeof options.flush==="function")this._flush=options.flush}this.once("prefinish",function(){if(typeof this._flush==="function")this._flush(function(er,data){done(stream,er,data)});else done(stream)})}Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=false;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("_transform() is not implemented")};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(ts.writechunk!==null&&ts.writecb&&!ts.transforming){ts.transforming=true;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=true}};Transform.prototype._destroy=function(err,cb){var _this=this;Duplex.prototype._destroy.call(this,err,function(err2){cb(err2);_this.emit("close")})};function done(stream,er,data){if(er)return stream.emit("error",er);if(data!==null&&data!==undefined)stream.push(data);var ws=stream._writableState;var ts=stream._transformState;if(ws.length)throw new Error("Calling transform done when ws.length != 0");if(ts.transforming)throw new Error("Calling transform done when still transforming");return stream.push(null)}},{"./_stream_duplex":76,"core-util-is":14,inherits:18}],80:[function(require,module,exports){(function(process,global,setImmediate){"use strict";var processNextTick=require("process-nextick-args");module.exports=Writable;function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb;this.next=null}function CorkedRequest(state){var _this=this;this.next=null;this.entry=null;this.finish=function(){onCorkedFinish(_this,state)}}var asyncWrite=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:processNextTick;var Duplex;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var internalUtil={deprecate:require("util-deprecate")};var Stream=require("./internal/streams/stream");var Buffer=require("safe-buffer").Buffer;var OurUint8Array=global.Uint8Array||function(){};function _uint8ArrayToBuffer(chunk){return Buffer.from(chunk)}function _isUint8Array(obj){return Buffer.isBuffer(obj)||obj instanceof OurUint8Array}var destroyImpl=require("./internal/streams/destroy");util.inherits(Writable,Stream);function nop(){}function WritableState(options,stream){Duplex=Duplex||require("./_stream_duplex");options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.writableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=Math.floor(this.highWaterMark);this.finalCalled=false;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;this.destroyed=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.corked=0;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.bufferedRequest=null;this.lastBufferedRequest=null;this.pendingcb=0;this.prefinished=false;this.errorEmitted=false;this.bufferedRequestCount=0;this.corkedRequestsFree=new CorkedRequest(this)}WritableState.prototype.getBuffer=function getBuffer(){var current=this.bufferedRequest;var out=[];while(current){out.push(current);current=current.next}return out};(function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:internalUtil.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer "+"instead.","DEP0003")})}catch(_){}})();var realHasInstance;if(typeof Symbol==="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]==="function"){realHasInstance=Function.prototype[Symbol.hasInstance];Object.defineProperty(Writable,Symbol.hasInstance,{value:function(object){if(realHasInstance.call(this,object))return true;return object&&object._writableState instanceof WritableState}})}else{realHasInstance=function(object){return object instanceof this}}function Writable(options){Duplex=Duplex||require("./_stream_duplex");if(!realHasInstance.call(Writable,this)&&!(this instanceof Duplex)){return new Writable(options)}this._writableState=new WritableState(options,this);this.writable=true;if(options){if(typeof options.write==="function")this._write=options.write;if(typeof options.writev==="function")this._writev=options.writev;if(typeof options.destroy==="function")this._destroy=options.destroy;if(typeof options.final==="function")this._final=options.final}Stream.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function writeAfterEnd(stream,cb){var er=new Error("write after end");stream.emit("error",er);processNextTick(cb,er)}function validChunk(stream,state,chunk,cb){var valid=true;var er=false;if(chunk===null){er=new TypeError("May not write null values to stream")}else if(typeof chunk!=="string"&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}if(er){stream.emit("error",er);processNextTick(cb,er);valid=false}return valid}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;var isBuf=_isUint8Array(chunk)&&!state.objectMode;if(isBuf&&!Buffer.isBuffer(chunk)){chunk=_uint8ArrayToBuffer(chunk)}if(typeof encoding==="function"){cb=encoding;encoding=null}if(isBuf)encoding="buffer";else if(!encoding)encoding=state.defaultEncoding;if(typeof cb!=="function")cb=nop;if(state.ended)writeAfterEnd(this,cb);else if(isBuf||validChunk(this,state,chunk,cb)){state.pendingcb++;ret=writeOrBuffer(this,state,isBuf,chunk,encoding,cb)}return ret};Writable.prototype.cork=function(){var state=this._writableState;state.corked++};Writable.prototype.uncork=function(){var state=this._writableState;if(state.corked){state.corked--;if(!state.writing&&!state.corked&&!state.finished&&!state.bufferProcessing&&state.bufferedRequest)clearBuffer(this,state)}};Writable.prototype.setDefaultEncoding=function setDefaultEncoding(encoding){if(typeof encoding==="string")encoding=encoding.toLowerCase();if(!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+encoding);this._writableState.defaultEncoding=encoding;return this};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&typeof chunk==="string"){chunk=Buffer.from(chunk,encoding)}return chunk}function writeOrBuffer(stream,state,isBuf,chunk,encoding,cb){if(!isBuf){var newChunk=decodeChunk(state,chunk,encoding);if(chunk!==newChunk){isBuf=true;encoding="buffer";chunk=newChunk}}var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=true;if(state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest={chunk:chunk,encoding:encoding,isBuf:isBuf,callback:cb,next:null};if(last){last.next=state.lastBufferedRequest}else{state.bufferedRequest=state.lastBufferedRequest}state.bufferedRequestCount+=1}else{doWrite(stream,state,false,len,chunk,encoding,cb)}return ret}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;if(writev)stream._writev(chunk,state.onwrite);else stream._write(chunk,encoding,state.onwrite);state.sync=false}function onwriteError(stream,state,sync,er,cb){--state.pendingcb;if(sync){processNextTick(cb,er);processNextTick(finishMaybe,stream,state);stream._writableState.errorEmitted=true;stream.emit("error",er)}else{cb(er);stream._writableState.errorEmitted=true;stream.emit("error",er);finishMaybe(stream,state)}}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(state);if(!finished&&!state.corked&&!state.bufferProcessing&&state.bufferedRequest){clearBuffer(stream,state)}if(sync){asyncWrite(afterWrite,stream,state,finished,cb)}else{afterWrite(stream,state,finished,cb)}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);state.pendingcb--;cb();finishMaybe(stream,state)}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state){state.bufferProcessing=true;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var l=state.bufferedRequestCount;var buffer=new Array(l);var holder=state.corkedRequestsFree;holder.entry=entry;var count=0;var allBuffers=true;while(entry){buffer[count]=entry;if(!entry.isBuf)allBuffers=false;entry=entry.next;count+=1}buffer.allBuffers=allBuffers;doWrite(stream,state,true,state.length,buffer,"",holder.finish);state.pendingcb++;state.lastBufferedRequest=null;if(holder.next){state.corkedRequestsFree=holder.next;holder.next=null}else{state.corkedRequestsFree=new CorkedRequest(state)}}else{while(entry){var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,false,len,chunk,encoding,cb);entry=entry.next;if(state.writing){break}}if(entry===null)state.lastBufferedRequest=null}state.bufferedRequestCount=0;state.bufferedRequest=entry;state.bufferProcessing=false}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("_write() is not implemented"))};Writable.prototype._writev=null;Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==="function"){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==="function"){cb=encoding;encoding=null}if(chunk!==null&&chunk!==undefined)this.write(chunk,encoding);if(state.corked){state.corked=1;this.uncork()}if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(state){return state.ending&&state.length===0&&state.bufferedRequest===null&&!state.finished&&!state.writing}function callFinal(stream,state){stream._final(function(err){state.pendingcb--;if(err){stream.emit("error",err)}state.prefinished=true;stream.emit("prefinish");finishMaybe(stream,state)})}function prefinish(stream,state){if(!state.prefinished&&!state.finalCalled){if(typeof stream._final==="function"){state.pendingcb++;state.finalCalled=true;processNextTick(callFinal,stream,state)}else{state.prefinished=true;stream.emit("prefinish")}}}function finishMaybe(stream,state){var need=needFinish(state);if(need){prefinish(stream,state);if(state.pendingcb===0){state.finished=true;stream.emit("finish")}}return need}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)processNextTick(cb);else stream.once("finish",cb)}state.ended=true;stream.writable=false}function onCorkedFinish(corkReq,state,err){var entry=corkReq.entry;corkReq.entry=null;while(entry){var cb=entry.callback;state.pendingcb--;cb(err);entry=entry.next}if(state.corkedRequestsFree){state.corkedRequestsFree.next=corkReq}else{state.corkedRequestsFree=corkReq}}Object.defineProperty(Writable.prototype,"destroyed",{get:function(){if(this._writableState===undefined){return false}return this._writableState.destroyed},set:function(value){if(!this._writableState){return}this._writableState.destroyed=value}});Writable.prototype.destroy=destroyImpl.destroy;Writable.prototype._undestroy=destroyImpl.undestroy;Writable.prototype._destroy=function(err,cb){this.end();cb(err)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},require("timers").setImmediate)},{"./_stream_duplex":76,"./internal/streams/destroy":82,"./internal/streams/stream":83,_process:74,"core-util-is":14,inherits:18,"process-nextick-args":73,"safe-buffer":88,timers:93,"util-deprecate":96}],81:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Buffer=require("safe-buffer").Buffer;function copyBuffer(src,target,offset){src.copy(target,offset)}module.exports=function(){function BufferList(){_classCallCheck(this,BufferList);this.head=null;this.tail=null;this.length=0}BufferList.prototype.push=function push(v){var entry={data:v,next:null};if(this.length>0)this.tail.next=entry;else this.head=entry;this.tail=entry;++this.length};BufferList.prototype.unshift=function unshift(v){var entry={data:v,next:this.head};if(this.length===0)this.tail=entry;this.head=entry;++this.length};BufferList.prototype.shift=function shift(){if(this.length===0)return;var ret=this.head.data;if(this.length===1)this.head=this.tail=null;else this.head=this.head.next;--this.length;return ret};BufferList.prototype.clear=function clear(){this.head=this.tail=null;this.length=0};BufferList.prototype.join=function join(s){if(this.length===0)return"";var p=this.head;var ret=""+p.data;while(p=p.next){ret+=s+p.data}return ret};BufferList.prototype.concat=function concat(n){if(this.length===0)return Buffer.alloc(0);if(this.length===1)return this.head.data;var ret=Buffer.allocUnsafe(n>>>0);var p=this.head;var i=0;while(p){copyBuffer(p.data,ret,i);i+=p.data.length;p=p.next}return ret};return BufferList}()},{"safe-buffer":88}],82:[function(require,module,exports){"use strict";var processNextTick=require("process-nextick-args");function destroy(err,cb){var _this=this;var readableDestroyed=this._readableState&&this._readableState.destroyed;var writableDestroyed=this._writableState&&this._writableState.destroyed;if(readableDestroyed||writableDestroyed){if(cb){cb(err)}else if(err&&(!this._writableState||!this._writableState.errorEmitted)){processNextTick(emitErrorNT,this,err)}return}if(this._readableState){this._readableState.destroyed=true}if(this._writableState){this._writableState.destroyed=true}this._destroy(err||null,function(err){if(!cb&&err){processNextTick(emitErrorNT,_this,err);if(_this._writableState){_this._writableState.errorEmitted=true}}else if(cb){cb(err)}})}function undestroy(){if(this._readableState){this._readableState.destroyed=false;this._readableState.reading=false;this._readableState.ended=false;this._readableState.endEmitted=false}if(this._writableState){this._writableState.destroyed=false;this._writableState.ended=false;this._writableState.ending=false;this._writableState.finished=false;this._writableState.errorEmitted=false}}function emitErrorNT(self,err){self.emit("error",err)}module.exports={destroy:destroy,undestroy:undestroy}},{"process-nextick-args":73}],83:[function(require,module,exports){module.exports=require("events").EventEmitter},{events:16}],84:[function(require,module,exports){module.exports=require("./readable").PassThrough},{"./readable":85}],85:[function(require,module,exports){exports=module.exports=require("./lib/_stream_readable.js");exports.Stream=exports;exports.Readable=exports;exports.Writable=require("./lib/_stream_writable.js");exports.Duplex=require("./lib/_stream_duplex.js");exports.Transform=require("./lib/_stream_transform.js");exports.PassThrough=require("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":76,"./lib/_stream_passthrough.js":77,"./lib/_stream_readable.js":78,"./lib/_stream_transform.js":79,"./lib/_stream_writable.js":80}],86:[function(require,module,exports){module.exports=require("./readable").Transform},{"./readable":85}],87:[function(require,module,exports){module.exports=require("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":80}],88:[function(require,module,exports){var buffer=require("buffer");var Buffer=buffer.Buffer;function copyProps(src,dst){for(var key in src){dst[key]=src[key]}}if(Buffer.from&&Buffer.alloc&&Buffer.allocUnsafe&&Buffer.allocUnsafeSlow){module.exports=buffer}else{copyProps(buffer,exports);exports.Buffer=SafeBuffer}function SafeBuffer(arg,encodingOrOffset,length){return Buffer(arg,encodingOrOffset,length)}copyProps(Buffer,SafeBuffer);SafeBuffer.from=function(arg,encodingOrOffset,length){if(typeof arg==="number"){throw new TypeError("Argument must not be a number")}return Buffer(arg,encodingOrOffset,length)};SafeBuffer.alloc=function(size,fill,encoding){if(typeof size!=="number"){throw new TypeError("Argument must be a number")}var buf=Buffer(size);if(fill!==undefined){if(typeof encoding==="string"){buf.fill(fill,encoding)}else{buf.fill(fill)}}else{buf.fill(0)}return buf};SafeBuffer.allocUnsafe=function(size){if(typeof size!=="number"){throw new TypeError("Argument must be a number")}return Buffer(size)};SafeBuffer.allocUnsafeSlow=function(size){if(typeof size!=="number"){throw new TypeError("Argument must be a number")}return buffer.SlowBuffer(size)}},{buffer:12}],89:[function(require,module,exports){var hasProp=Object.prototype.hasOwnProperty;function throwsMessage(err){return"[Throws: "+(err?err.message:"?")+"]"}function safeGetValueFromPropertyOnObject(obj,property){if(hasProp.call(obj,property)){try{return obj[property]}catch(err){return throwsMessage(err)}}return obj[property]}function ensureProperties(obj){var seen=[];function visit(obj){if(obj===null||typeof obj!=="object"){return obj}if(seen.indexOf(obj)!==-1){return"[Circular]"}seen.push(obj);if(typeof obj.toJSON==="function"){try{return visit(obj.toJSON())}catch(err){return throwsMessage(err)}}if(Array.isArray(obj)){return obj.map(visit)}return Object.keys(obj).reduce(function(result,prop){result[prop]=visit(safeGetValueFromPropertyOnObject(obj,prop));return result},{})}return visit(obj)}module.exports=function(data){return JSON.stringify(ensureProperties(data))};module.exports.ensureProperties=ensureProperties},{}],90:[function(require,module,exports){!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SlimSelect=t():e.SlimSelect=t()}(window,function(){return(s={},n.m=i=[function(e,t,i){"use strict";function s(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i}var n;t.__esModule=!0,t.hasClassInTree=function(e,t){function s(e,t){return t&&e&&e.classList&&e.classList.contains(t)?e:null}return s(e,t)||function e(t,i){return t&&t!==document?s(t,i)?t:e(t.parentNode,i):null}(e,t)},t.ensureElementInView=function(e,t){var i=e.scrollTop+e.offsetTop,s=i+e.clientHeight,n=t.offsetTop,a=n+t.clientHeight;n<i?e.scrollTop-=i-n:s<a&&(e.scrollTop+=a-s)},t.putContent=function(e,t,i){var s=e.offsetHeight,n=e.getBoundingClientRect(),a=i?n.top:n.top-s,l=i?n.bottom:n.bottom+s;return a<=0?"below":l>=window.innerHeight?"above":i?t:"below"},t.debounce=function(n,a,l){var o;return void 0===a&&(a=100),void 0===l&&(l=!1),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=self,s=l&&!o;clearTimeout(o),o=setTimeout(function(){o=null,l||n.apply(i,e)},a),s&&n.apply(i,e)}},t.isValueInArrayOfObjects=function(e,t,i){if(!Array.isArray(e))return e[t]===i;for(var s=0,n=e;s<n.length;s++){var a=n[s];if(a&&a[t]&&a[t]===i)return!0}return!1},t.highlight=function(e,t,i){var s=e,n=new RegExp("("+t.trim()+")(?![^<]*>[^<>]*</)","i");if(!e.match(n))return e;var a=e.match(n).index,l=a+e.match(n)[0].toString().length,o=e.substring(a,l);return s=s.replace(n,'<mark class="'+i+'">'+o+"</mark>")},"function"!=typeof(n=window).CustomEvent&&(s.prototype=n.Event.prototype,n.CustomEvent=s)},function(e,t,i){"use strict";t.__esModule=!0;var s=(n.prototype.newOption=function(e){return{id:e.id?e.id:String(Math.floor(1e8*Math.random())),value:e.value?e.value:"",text:e.text?e.text:"",innerHTML:e.innerHTML?e.innerHTML:"",selected:!!e.selected&&e.selected,display:void 0===e.display||e.display,disabled:!!e.disabled&&e.disabled,placeholder:!!e.placeholder&&e.placeholder,class:e.class?e.class:void 0,data:e.data?e.data:{}}},n.prototype.add=function(e){this.data.push({id:String(Math.floor(1e8*Math.random())),value:e.value,text:e.text,innerHTML:"",selected:!1,display:!0,disabled:!1,placeholder:!1,class:void 0,data:{}})},n.prototype.parseSelectData=function(){this.data=[];for(var e=0,t=this.main.select.element.childNodes;e<t.length;e++){var i=t[e];if("OPTGROUP"===i.nodeName){for(var s={label:i.label,options:[]},n=0,a=i.childNodes;n<a.length;n++){var l=a[n];if("OPTION"===l.nodeName){var o=this.pullOptionData(l);s.options.push(o),o.placeholder&&""!==o.text.trim()&&(this.main.config.placeholderText=o.text)}}this.data.push(s)}else"OPTION"===i.nodeName&&(o=this.pullOptionData(i),this.data.push(o),o.placeholder&&""!==o.text.trim()&&(this.main.config.placeholderText=o.text))}},n.prototype.pullOptionData=function(e){return{id:!!e.dataset&&e.dataset.id||String(Math.floor(1e8*Math.random())),value:e.value,text:e.text,innerHTML:e.innerHTML,selected:e.selected,disabled:e.disabled,placeholder:"true"===e.dataset.placeholder,class:e.className,style:e.style.cssText,data:e.dataset}},n.prototype.setSelectedFromSelect=function(){if(this.main.config.isMultiple){for(var e=[],t=0,i=this.main.select.element.options;t<i.length;t++){var s=i[t];if(s.selected){var n=this.getObjectFromData(s.value,"value");n&&n.id&&e.push(n.id)}}this.setSelected(e,"id")}else{var a=this.main.select.element;if(-1!==a.selectedIndex){var l=a.options[a.selectedIndex].value;this.setSelected(l,"value")}}},n.prototype.setSelected=function(e,t){void 0===t&&(t="id");for(var i=0,s=this.data;i<s.length;i++){var n=s[i];if(n.hasOwnProperty("label")){if(n.hasOwnProperty("options")){var a=n.options;if(a)for(var l=0,o=a;l<o.length;l++){var r=o[l];r.placeholder||(r.selected=this.shouldBeSelected(r,e,t))}}}else n.selected=this.shouldBeSelected(n,e,t)}},n.prototype.shouldBeSelected=function(e,t,i){if(void 0===i&&(i="id"),Array.isArray(t))for(var s=0,n=t;s<n.length;s++){var a=n[s];if(i in e&&String(e[i])===String(a))return!0}else if(i in e&&String(e[i])===String(t))return!0;return!1},n.prototype.getSelected=function(){for(var e={text:""},t=[],i=0,s=this.data;i<s.length;i++){var n=s[i];if(n.hasOwnProperty("label")){if(n.hasOwnProperty("options")){var a=n.options;if(a)for(var l=0,o=a;l<o.length;l++){var r=o[l];r.selected&&(this.main.config.isMultiple?t.push(r):e=r)}}}else n.selected&&(this.main.config.isMultiple?t.push(n):e=n)}return this.main.config.isMultiple?t:e},n.prototype.addToSelected=function(e,t){if(void 0===t&&(t="id"),this.main.config.isMultiple){var i=[],s=this.getSelected();if(Array.isArray(s))for(var n=0,a=s;n<a.length;n++){var l=a[n];i.push(l[t])}i.push(e),this.setSelected(i,t)}},n.prototype.removeFromSelected=function(e,t){if(void 0===t&&(t="id"),this.main.config.isMultiple){for(var i=[],s=0,n=this.getSelected();s<n.length;s++){var a=n[s];String(a[t])!==String(e)&&i.push(a[t])}this.setSelected(i,t)}},n.prototype.onDataChange=function(){this.main.onChange&&this.isOnChangeEnabled&&this.main.onChange(JSON.parse(JSON.stringify(this.getSelected())))},n.prototype.getObjectFromData=function(e,t){void 0===t&&(t="id");for(var i=0,s=this.data;i<s.length;i++){var n=s[i];if(t in n&&String(n[t])===String(e))return n;if(n.hasOwnProperty("options")){var a=n;if(a.options)for(var l=0,o=a.options;l<o.length;l++){var r=o[l];if(String(r[t])===String(e))return r}}}return null},n.prototype.search=function(n){if(""!==(this.searchValue=n).trim()){var a=this.main.config.searchFilter,e=this.data.slice(0);n=n.trim();var t=e.map(function(e){if(e.hasOwnProperty("options")){var t=e,i=[];if(t.options&&(i=t.options.filter(function(e){return a(e,n)})),0!==i.length){var s=Object.assign({},t);return s.options=i,s}}return e.hasOwnProperty("text")&&a(e,n)?e:null});this.filtered=t.filter(function(e){return e})}else this.filtered=null},n);function n(e){this.contentOpen=!1,this.contentPosition="below",this.isOnChangeEnabled=!0,this.main=e.main,this.searchValue="",this.data=[],this.filtered=null,this.parseSelectData(),this.setSelectedFromSelect()}function r(e){return void 0!==e.text||(console.error("Data object option must have at least have a text value. Check object: "+JSON.stringify(e)),!1)}t.Data=s,t.validateData=function(e){if(!e)return console.error("Data must be an array of objects"),!1;for(var t=0,i=0,s=e;i<s.length;i++){var n=s[i];if(n.hasOwnProperty("label")){if(n.hasOwnProperty("options")){var a=n.options;if(a)for(var l=0,o=a;l<o.length;l++){r(o[l])||t++}}}else r(n)||t++}return 0===t},t.validateOption=r},function(e,t,i){"use strict";t.__esModule=!0;var s=i(3),n=i(4),a=i(5),l=i(1),o=i(0),r=(c.prototype.validate=function(e){var t="string"==typeof e.select?document.querySelector(e.select):e.select;if(!t)throw new Error("Could not find select element");if("SELECT"!==t.tagName)throw new Error("Element isnt of type select");return t},c.prototype.selected=function(){if(this.config.isMultiple){for(var e=[],t=0,i=n=this.data.getSelected();t<i.length;t++){var s=i[t];e.push(s.value)}return e}var n;return(n=this.data.getSelected())?n.value:""},c.prototype.set=function(e,t,i,s){void 0===t&&(t="value"),void 0===i&&(i=!0),void 0===s&&(s=!0),this.config.isMultiple&&!Array.isArray(e)?this.data.addToSelected(e,t):this.data.setSelected(e,t),this.select.setValue(),this.data.onDataChange(),this.render(),i&&this.close()},c.prototype.setSelected=function(e,t,i,s){void 0===t&&(t="value"),void 0===i&&(i=!0),void 0===s&&(s=!0),this.set(e,t,i,s)},c.prototype.setData=function(e){if(l.validateData(e)){var t=JSON.parse(JSON.stringify(e)),i=this.data.getSelected();if(this.config.isAjax&&i)if(this.config.isMultiple)for(var s=0,n=i.reverse();s<n.length;s++){var a=n[s];t.unshift(a)}else t.unshift(this.data.getSelected()),t.unshift({text:"",placeholder:!0});this.select.create(t),this.data.parseSelectData(),this.data.setSelectedFromSelect()}else console.error("Validation problem on: #"+this.select.element.id)},c.prototype.addData=function(e){l.validateData([e])?(this.data.add(this.data.newOption(e)),this.select.create(this.data.data),this.data.parseSelectData(),this.data.setSelectedFromSelect(),this.render()):console.error("Validation problem on: #"+this.select.element.id)},c.prototype.open=function(){var e=this;if(this.config.isEnabled&&!this.data.contentOpen){if(this.beforeOpen&&this.beforeOpen(),this.config.isMultiple&&this.slim.multiSelected?this.slim.multiSelected.plus.classList.add("ss-cross"):this.slim.singleSelected&&(this.slim.singleSelected.arrowIcon.arrow.classList.remove("arrow-down"),this.slim.singleSelected.arrowIcon.arrow.classList.add("arrow-up")),this.slim[this.config.isMultiple?"multiSelected":"singleSelected"].container.classList.add("above"===this.data.contentPosition?this.config.openAbove:this.config.openBelow),this.slim.content.classList.add(this.config.open),"up"===this.config.showContent.toLowerCase()?this.moveContentAbove():"down"===this.config.showContent.toLowerCase()?this.moveContentBelow():"above"===o.putContent(this.slim.content,this.data.contentPosition,this.data.contentOpen)?this.moveContentAbove():this.moveContentBelow(),!this.config.isMultiple){var t=this.data.getSelected();if(t){var i=t.id,s=this.slim.list.querySelector('[data-id="'+i+'"]');s&&o.ensureElementInView(this.slim.list,s)}}setTimeout(function(){e.data.contentOpen=!0,e.config.searchFocus&&e.slim.search.input.focus(),e.afterOpen&&e.afterOpen()},this.config.timeoutDelay)}},c.prototype.close=function(){var e=this;this.data.contentOpen&&(this.beforeClose&&this.beforeClose(),this.config.isMultiple&&this.slim.multiSelected?(this.slim.multiSelected.container.classList.remove(this.config.openAbove),this.slim.multiSelected.container.classList.remove(this.config.openBelow),this.slim.multiSelected.plus.classList.remove("ss-cross")):this.slim.singleSelected&&(this.slim.singleSelected.container.classList.remove(this.config.openAbove),this.slim.singleSelected.container.classList.remove(this.config.openBelow),this.slim.singleSelected.arrowIcon.arrow.classList.add("arrow-down"),this.slim.singleSelected.arrowIcon.arrow.classList.remove("arrow-up")),this.slim.content.classList.remove(this.config.open),this.data.contentOpen=!1,this.search(""),setTimeout(function(){e.slim.content.removeAttribute("style"),e.data.contentPosition="below",e.config.isMultiple&&e.slim.multiSelected?(e.slim.multiSelected.container.classList.remove(e.config.openAbove),e.slim.multiSelected.container.classList.remove(e.config.openBelow)):e.slim.singleSelected&&(e.slim.singleSelected.container.classList.remove(e.config.openAbove),e.slim.singleSelected.container.classList.remove(e.config.openBelow)),e.slim.search.input.blur(),e.afterClose&&e.afterClose()},this.config.timeoutDelay))},c.prototype.moveContentAbove=function(){var e=0;this.config.isMultiple&&this.slim.multiSelected?e=this.slim.multiSelected.container.offsetHeight:this.slim.singleSelected&&(e=this.slim.singleSelected.container.offsetHeight);var t=e+this.slim.content.offsetHeight-1;this.slim.content.style.margin="-"+t+"px 0 0 0",this.slim.content.style.height=t-e+1+"px",this.slim.content.style.transformOrigin="center bottom",this.data.contentPosition="above",this.config.isMultiple&&this.slim.multiSelected?(this.slim.multiSelected.container.classList.remove(this.config.openBelow),this.slim.multiSelected.container.classList.add(this.config.openAbove)):this.slim.singleSelected&&(this.slim.singleSelected.container.classList.remove(this.config.openBelow),this.slim.singleSelected.container.classList.add(this.config.openAbove))},c.prototype.moveContentBelow=function(){this.slim.content.removeAttribute("style"),this.data.contentPosition="below",this.config.isMultiple&&this.slim.multiSelected?(this.slim.multiSelected.container.classList.remove(this.config.openAbove),this.slim.multiSelected.container.classList.add(this.config.openBelow)):this.slim.singleSelected&&(this.slim.singleSelected.container.classList.remove(this.config.openAbove),this.slim.singleSelected.container.classList.add(this.config.openBelow))},c.prototype.enable=function(){this.config.isEnabled=!0,this.config.isMultiple&&this.slim.multiSelected?this.slim.multiSelected.container.classList.remove(this.config.disabled):this.slim.singleSelected&&this.slim.singleSelected.container.classList.remove(this.config.disabled),this.select.triggerMutationObserver=!1,this.select.element.disabled=!1,this.slim.search.input.disabled=!1,this.select.triggerMutationObserver=!0},c.prototype.disable=function(){this.config.isEnabled=!1,this.config.isMultiple&&this.slim.multiSelected?this.slim.multiSelected.container.classList.add(this.config.disabled):this.slim.singleSelected&&this.slim.singleSelected.container.classList.add(this.config.disabled),this.select.triggerMutationObserver=!1,this.select.element.disabled=!0,this.slim.search.input.disabled=!0,this.select.triggerMutationObserver=!0},c.prototype.search=function(t){if(this.data.searchValue!==t)if(this.slim.search.input.value=t,this.config.isAjax){var i=this;this.config.isSearching=!0,this.render(),this.ajax&&this.ajax(t,function(e){i.config.isSearching=!1,Array.isArray(e)?(e.unshift({text:"",placeholder:!0}),i.setData(e),i.data.search(t),i.render()):"string"==typeof e?i.slim.options(e):i.render()})}else this.data.search(t),this.render()},c.prototype.setSearchText=function(e){this.config.searchText=e},c.prototype.render=function(){this.config.isMultiple?this.slim.values():(this.slim.placeholder(),this.slim.deselect()),this.slim.options()},c.prototype.destroy=function(e){void 0===e&&(e=null);var t=e?document.querySelector("."+e):this.slim.container,i=e?document.querySelector("[data-ssid="+e+"]"):this.select.element;t&&i&&(i.style.display=null,delete i.dataset.ssid,i.slim=null,t.parentElement&&t.parentElement.removeChild(t))},c);function c(e){var t=this;this.ajax=null,this.addable=null,this.beforeOnChange=null,this.onChange=null,this.beforeOpen=null,this.afterOpen=null,this.beforeClose=null,this.afterClose=null;var i=this.validate(e);i.dataset.ssid&&this.destroy(i.dataset.ssid),e.ajax&&(this.ajax=e.ajax),e.addable&&(this.addable=e.addable),this.config=new s.Config({select:i,isAjax:!!e.ajax,showSearch:e.showSearch,searchPlaceholder:e.searchPlaceholder,searchText:e.searchText,searchingText:e.searchingText,searchFocus:e.searchFocus,searchHighlight:e.searchHighlight,searchFilter:e.searchFilter,closeOnSelect:e.closeOnSelect,showContent:e.showContent,placeholderText:e.placeholder,allowDeselect:e.allowDeselect,allowDeselectOption:e.allowDeselectOption,hideSelectedOption:e.hideSelectedOption,deselectLabel:e.deselectLabel,isEnabled:e.isEnabled,valuesUseText:e.valuesUseText,showOptionTooltips:e.showOptionTooltips,selectByGroup:e.selectByGroup,limit:e.limit,timeoutDelay:e.timeoutDelay}),this.select=new n.Select({select:i,main:this}),this.data=new l.Data({main:this}),this.slim=new a.Slim({main:this}),this.select.element.parentNode&&this.select.element.parentNode.insertBefore(this.slim.container,this.select.element.nextSibling),e.data?this.setData(e.data):this.render(),document.addEventListener("click",function(e){e.target&&!o.hasClassInTree(e.target,t.config.id)&&t.close()}),window.addEventListener("scroll",o.debounce(function(e){t.data.contentOpen&&"auto"===t.config.showContent&&("above"===o.putContent(t.slim.content,t.data.contentPosition,t.data.contentOpen)?t.moveContentAbove():t.moveContentBelow())}),!1),e.beforeOnChange&&(this.beforeOnChange=e.beforeOnChange),e.onChange&&(this.onChange=e.onChange),e.beforeOpen&&(this.beforeOpen=e.beforeOpen),e.afterOpen&&(this.afterOpen=e.afterOpen),e.beforeClose&&(this.beforeClose=e.beforeClose),e.afterClose&&(this.afterClose=e.afterClose),this.config.isEnabled||this.disable()}t.default=r},function(e,t,i){"use strict";t.__esModule=!0;var s=(n.prototype.searchFilter=function(e,t){return-1!==e.text.toLowerCase().indexOf(t.toLowerCase())},n);function n(e){this.id="",this.isMultiple=!1,this.isAjax=!1,this.isSearching=!1,this.showSearch=!0,this.searchFocus=!0,this.searchHighlight=!1,this.closeOnSelect=!0,this.showContent="auto",this.searchPlaceholder="Search",this.searchText="No Results",this.searchingText="Searching...",this.placeholderText="Select Value",this.allowDeselect=!1,this.allowDeselectOption=!1,this.hideSelectedOption=!1,this.deselectLabel="x",this.isEnabled=!0,this.valuesUseText=!1,this.showOptionTooltips=!1,this.selectByGroup=!1,this.limit=0,this.timeoutDelay=200,this.main="ss-main",this.singleSelected="ss-single-selected",this.arrow="ss-arrow",this.multiSelected="ss-multi-selected",this.add="ss-add",this.plus="ss-plus",this.values="ss-values",this.value="ss-value",this.valueText="ss-value-text",this.valueDelete="ss-value-delete",this.content="ss-content",this.open="ss-open",this.openAbove="ss-open-above",this.openBelow="ss-open-below",this.search="ss-search",this.searchHighlighter="ss-search-highlight",this.addable="ss-addable",this.list="ss-list",this.optgroup="ss-optgroup",this.optgroupLabel="ss-optgroup-label",this.optgroupLabelSelectable="ss-optgroup-label-selectable",this.option="ss-option",this.optionSelected="ss-option-selected",this.highlighted="ss-highlighted",this.disabled="ss-disabled",this.hide="ss-hide",this.id="ss-"+Math.floor(1e5*Math.random()),this.style=e.select.style.cssText,this.class=e.select.className.split(" "),this.isMultiple=e.select.multiple,this.isAjax=e.isAjax,this.showSearch=!1!==e.showSearch,this.searchFocus=!1!==e.searchFocus,this.searchHighlight=!0===e.searchHighlight,this.closeOnSelect=!1!==e.closeOnSelect,e.showContent&&(this.showContent=e.showContent),this.isEnabled=!1!==e.isEnabled,e.searchPlaceholder&&(this.searchPlaceholder=e.searchPlaceholder),e.searchText&&(this.searchText=e.searchText),e.searchingText&&(this.searchingText=e.searchingText),e.placeholderText&&(this.placeholderText=e.placeholderText),this.allowDeselect=!0===e.allowDeselect,this.allowDeselectOption=!0===e.allowDeselectOption,this.hideSelectedOption=!0===e.hideSelectedOption,e.deselectLabel&&(this.deselectLabel=e.deselectLabel),e.valuesUseText&&(this.valuesUseText=e.valuesUseText),e.showOptionTooltips&&(this.showOptionTooltips=e.showOptionTooltips),e.selectByGroup&&(this.selectByGroup=e.selectByGroup),e.limit&&(this.limit=e.limit),e.searchFilter&&(this.searchFilter=e.searchFilter),null!=e.timeoutDelay&&(this.timeoutDelay=e.timeoutDelay)}t.Config=s},function(e,t,i){"use strict";t.__esModule=!0;var s=(n.prototype.setValue=function(){if(this.main.data.getSelected()){if(this.main.config.isMultiple)for(var e=this.main.data.getSelected(),t=0,i=this.element.options;t<i.length;t++){var s=i[t];s.selected=!1;for(var n=0,a=e;n<a.length;n++)a[n].value===s.value&&(s.selected=!0)}else e=this.main.data.getSelected(),this.element.value=e?e.value:"";this.main.data.isOnChangeEnabled=!1,this.element.dispatchEvent(new CustomEvent("change",{bubbles:!0})),this.main.data.isOnChangeEnabled=!0}},n.prototype.addAttributes=function(){this.element.tabIndex=-1,this.element.style.display="none",this.element.dataset.ssid=this.main.config.id},n.prototype.addEventListeners=function(){var t=this;this.element.addEventListener("change",function(e){t.main.data.setSelectedFromSelect(),t.main.render()})},n.prototype.addMutationObserver=function(){var t=this;this.main.config.isAjax||(this.mutationObserver=new MutationObserver(function(e){t.triggerMutationObserver&&(t.main.data.parseSelectData(),t.main.data.setSelectedFromSelect(),t.main.render(),e.forEach(function(e){"class"===e.attributeName&&t.main.slim.updateContainerDivClass(t.main.slim.container)}))}),this.observeMutationObserver())},n.prototype.observeMutationObserver=function(){this.mutationObserver&&this.mutationObserver.observe(this.element,{attributes:!0,childList:!0,characterData:!0})},n.prototype.disconnectMutationObserver=function(){this.mutationObserver&&this.mutationObserver.disconnect()},n.prototype.create=function(e){this.element.innerHTML="";for(var t=0,i=e;t<i.length;t++){var s=i[t];if(s.hasOwnProperty("options")){var n=s,a=document.createElement("optgroup");if(a.label=n.label,n.options)for(var l=0,o=n.options;l<o.length;l++){var r=o[l];a.appendChild(this.createOption(r))}this.element.appendChild(a)}else this.element.appendChild(this.createOption(s))}},n.prototype.createOption=function(t){var i=document.createElement("option");return i.value=t.value||t.text,i.innerHTML=t.innerHTML||t.text,t.selected&&(i.selected=t.selected),t.disabled&&(i.disabled=!0),t.placeholder&&i.setAttribute("data-placeholder","true"),t.class&&t.class.split(" ").forEach(function(e){i.classList.add(e)}),t.data&&"object"==typeof t.data&&Object.keys(t.data).forEach(function(e){i.setAttribute("data-"+e,t.data[e])}),i},n);function n(e){this.triggerMutationObserver=!0,this.element=e.select,this.main=e.main,this.element.disabled&&(this.main.config.isEnabled=!1),this.addAttributes(),this.addEventListeners(),this.mutationObserver=null,this.addMutationObserver(),this.element.slim=e.main}t.Select=s},function(e,t,i){"use strict";t.__esModule=!0;var a=i(0),l=i(1),s=(n.prototype.containerDiv=function(){var e=document.createElement("div");return e.style.cssText=this.main.config.style,this.updateContainerDivClass(e),e},n.prototype.updateContainerDivClass=function(e){this.main.config.class=this.main.select.element.className.split(" "),e.className="",e.classList.add(this.main.config.id),e.classList.add(this.main.config.main);for(var t=0,i=this.main.config.class;t<i.length;t++){var s=i[t];""!==s.trim()&&e.classList.add(s)}},n.prototype.singleSelectedDiv=function(){var t=this,e=document.createElement("div");e.classList.add(this.main.config.singleSelected);var i=document.createElement("span");i.classList.add("placeholder"),e.appendChild(i);var s=document.createElement("span");s.innerHTML=this.main.config.deselectLabel,s.classList.add("ss-deselect"),s.onclick=function(e){e.stopPropagation(),t.main.config.isEnabled&&t.main.set("")},e.appendChild(s);var n=document.createElement("span");n.classList.add(this.main.config.arrow);var a=document.createElement("span");return a.classList.add("arrow-down"),n.appendChild(a),e.appendChild(n),e.onclick=function(){t.main.config.isEnabled&&(t.main.data.contentOpen?t.main.close():t.main.open())},{container:e,placeholder:i,deselect:s,arrowIcon:{container:n,arrow:a}}},n.prototype.placeholder=function(){var e=this.main.data.getSelected();if(null===e||e&&e.placeholder){var t=document.createElement("span");t.classList.add(this.main.config.disabled),t.innerHTML=this.main.config.placeholderText,this.singleSelected&&(this.singleSelected.placeholder.innerHTML=t.outerHTML)}else{var i="";e&&(i=e.innerHTML&&!0!==this.main.config.valuesUseText?e.innerHTML:e.text),this.singleSelected&&(this.singleSelected.placeholder.innerHTML=e?i:"")}},n.prototype.deselect=function(){if(this.singleSelected){if(!this.main.config.allowDeselect)return void this.singleSelected.deselect.classList.add("ss-hide");""===this.main.selected()?this.singleSelected.deselect.classList.add("ss-hide"):this.singleSelected.deselect.classList.remove("ss-hide")}},n.prototype.multiSelectedDiv=function(){var t=this,e=document.createElement("div");e.classList.add(this.main.config.multiSelected);var i=document.createElement("div");i.classList.add(this.main.config.values),e.appendChild(i);var s=document.createElement("div");s.classList.add(this.main.config.add);var n=document.createElement("span");return n.classList.add(this.main.config.plus),n.onclick=function(e){t.main.data.contentOpen&&(t.main.close(),e.stopPropagation())},s.appendChild(n),e.appendChild(s),e.onclick=function(e){t.main.config.isEnabled&&(e.target.classList.contains(t.main.config.valueDelete)||(t.main.data.contentOpen?t.main.close():t.main.open()))},{container:e,values:i,add:s,plus:n}},n.prototype.values=function(){if(this.multiSelected){for(var e,t=this.multiSelected.values.childNodes,i=this.main.data.getSelected(),s=[],n=0,a=t;n<a.length;n++){var l=a[n];e=!0;for(var o=0,r=i;o<r.length;o++){var c=r[o];String(c.id)===String(l.dataset.id)&&(e=!1)}e&&s.push(l)}for(var h=0,d=s;h<d.length;h++){var u=d[h];u.classList.add("ss-out"),this.multiSelected.values.removeChild(u)}for(t=this.multiSelected.values.childNodes,c=0;c<i.length;c++){e=!1;for(var p=0,m=t;p<m.length;p++)l=m[p],String(i[c].id)===String(l.dataset.id)&&(e=!0);e||(0!==t.length&&HTMLElement.prototype.insertAdjacentElement?0===c?this.multiSelected.values.insertBefore(this.valueDiv(i[c]),t[c]):t[c-1].insertAdjacentElement("afterend",this.valueDiv(i[c])):this.multiSelected.values.appendChild(this.valueDiv(i[c])))}if(0===i.length){var f=document.createElement("span");f.classList.add(this.main.config.disabled),f.innerHTML=this.main.config.placeholderText,this.multiSelected.values.innerHTML=f.outerHTML}}},n.prototype.valueDiv=function(a){var l=this,e=document.createElement("div");e.classList.add(this.main.config.value),e.dataset.id=a.id;var t=document.createElement("span");t.classList.add(this.main.config.valueText),t.innerHTML=a.innerHTML&&!0!==this.main.config.valuesUseText?a.innerHTML:a.text,e.appendChild(t);var i=document.createElement("span");return i.classList.add(this.main.config.valueDelete),i.innerHTML=this.main.config.deselectLabel,i.onclick=function(e){e.preventDefault(),e.stopPropagation();var t=!1;if(l.main.config.isEnabled){if(l.main.beforeOnChange||(t=!0),l.main.beforeOnChange){for(var i=l.main.data.getSelected(),s=JSON.parse(JSON.stringify(i)),n=0;n<s.length;n++)s[n].id===a.id&&s.splice(n,1);!1!==l.main.beforeOnChange(s)&&(t=!0)}t&&(l.main.data.removeFromSelected(a.id,"id"),l.main.render(),l.main.select.setValue(),l.main.data.onDataChange())}},e.appendChild(i),e},n.prototype.contentDiv=function(){var e=document.createElement("div");return e.classList.add(this.main.config.content),e},n.prototype.searchDiv=function(){var n=this,e=document.createElement("div"),s=document.createElement("input"),a=document.createElement("div");e.classList.add(this.main.config.search);var t={container:e,input:s};return this.main.config.showSearch||(e.classList.add(this.main.config.hide),s.readOnly=!0),s.type="search",s.placeholder=this.main.config.searchPlaceholder,s.tabIndex=0,s.setAttribute("aria-label",this.main.config.searchPlaceholder),s.onclick=function(e){setTimeout(function(){""===e.target.value&&n.main.search("")},10)},s.onkeydown=function(e){"ArrowUp"===e.key?(n.main.open(),n.highlightUp(),e.preventDefault()):"ArrowDown"===e.key?(n.main.open(),n.highlightDown(),e.preventDefault()):"Tab"===e.key?n.main.data.contentOpen?n.main.close():setTimeout(function(){n.main.close()},n.main.config.timeoutDelay):"Enter"===e.key&&e.preventDefault()},s.onkeyup=function(e){var t=e.target;if("Enter"===e.key){if(n.main.addable&&e.ctrlKey)return a.click(),e.preventDefault(),void e.stopPropagation();var i=n.list.querySelector("."+n.main.config.highlighted);i&&i.click()}else"ArrowUp"===e.key||"ArrowDown"===e.key||("Escape"===e.key?n.main.close():n.main.config.showSearch&&n.main.data.contentOpen?n.main.search(t.value):s.value="");e.preventDefault(),e.stopPropagation()},s.onfocus=function(){n.main.open()},e.appendChild(s),this.main.addable&&(a.classList.add(this.main.config.addable),a.innerHTML="+",a.onclick=function(e){if(n.main.addable){e.preventDefault(),e.stopPropagation();var t=n.search.input.value;if(""===t.trim())return void n.search.input.focus();var i=n.main.addable(t),s="";if(!i)return;"object"==typeof i?l.validateOption(i)&&(n.main.addData(i),s=i.value?i.value:i.text):(n.main.addData(n.main.data.newOption({text:i,value:i})),s=i),n.main.search(""),setTimeout(function(){n.main.set(s,"value",!1,!1)},100),n.main.config.closeOnSelect&&setTimeout(function(){n.main.close()},100)}},e.appendChild(a),t.addable=a),t},n.prototype.highlightUp=function(){var e=this.list.querySelector("."+this.main.config.highlighted),t=null;if(e)for(t=e.previousSibling;null!==t&&t.classList.contains(this.main.config.disabled);)t=t.previousSibling;else{var i=this.list.querySelectorAll("."+this.main.config.option+":not(."+this.main.config.disabled+")");t=i[i.length-1]}if(t&&t.classList.contains(this.main.config.optgroupLabel)&&(t=null),null===t){var s=e.parentNode;if(s.classList.contains(this.main.config.optgroup)&&s.previousSibling){var n=s.previousSibling.querySelectorAll("."+this.main.config.option+":not(."+this.main.config.disabled+")");n.length&&(t=n[n.length-1])}}t&&(e&&e.classList.remove(this.main.config.highlighted),t.classList.add(this.main.config.highlighted),a.ensureElementInView(this.list,t))},n.prototype.highlightDown=function(){var e=this.list.querySelector("."+this.main.config.highlighted),t=null;if(e)for(t=e.nextSibling;null!==t&&t.classList.contains(this.main.config.disabled);)t=t.nextSibling;else t=this.list.querySelector("."+this.main.config.option+":not(."+this.main.config.disabled+")");if(null===t&&null!==e){var i=e.parentNode;i.classList.contains(this.main.config.optgroup)&&i.nextSibling&&(t=i.nextSibling.querySelector("."+this.main.config.option+":not(."+this.main.config.disabled+")"))}t&&(e&&e.classList.remove(this.main.config.highlighted),t.classList.add(this.main.config.highlighted),a.ensureElementInView(this.list,t))},n.prototype.listDiv=function(){var e=document.createElement("div");return e.classList.add(this.main.config.list),e},n.prototype.options=function(e){void 0===e&&(e="");var t,i=this.main.data.filtered||this.main.data.data;if((this.list.innerHTML="")!==e)return(t=document.createElement("div")).classList.add(this.main.config.option),t.classList.add(this.main.config.disabled),t.innerHTML=e,void this.list.appendChild(t);if(this.main.config.isAjax&&this.main.config.isSearching)return(t=document.createElement("div")).classList.add(this.main.config.option),t.classList.add(this.main.config.disabled),t.innerHTML=this.main.config.searchingText,void this.list.appendChild(t);if(0===i.length){var s=document.createElement("div");return s.classList.add(this.main.config.option),s.classList.add(this.main.config.disabled),s.innerHTML=this.main.config.searchText,void this.list.appendChild(s)}for(var n=function(e){if(e.hasOwnProperty("label")){var t=e,n=document.createElement("div");n.classList.add(c.main.config.optgroup);var i=document.createElement("div");i.classList.add(c.main.config.optgroupLabel),c.main.config.selectByGroup&&c.main.config.isMultiple&&i.classList.add(c.main.config.optgroupLabelSelectable),i.innerHTML=t.label,n.appendChild(i);var s=t.options;if(s){for(var a=0,l=s;a<l.length;a++){var o=l[a];n.appendChild(c.option(o))}if(c.main.config.selectByGroup&&c.main.config.isMultiple){var r=c;i.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation();for(var t=0,i=n.children;t<i.length;t++){var s=i[t];-1!==s.className.indexOf(r.main.config.option)&&s.click()}})}}c.list.appendChild(n)}else c.list.appendChild(c.option(e))},c=this,a=0,l=i;a<l.length;a++)n(l[a])},n.prototype.option=function(r){if(r.placeholder){var e=document.createElement("div");return e.classList.add(this.main.config.option),e.classList.add(this.main.config.hide),e}var t=document.createElement("div");t.classList.add(this.main.config.option),r.class&&r.class.split(" ").forEach(function(e){t.classList.add(e)}),r.style&&(t.style.cssText=r.style);var c=this.main.data.getSelected();t.dataset.id=r.id,this.main.config.searchHighlight&&this.main.slim&&r.innerHTML&&""!==this.main.slim.search.input.value.trim()?t.innerHTML=a.highlight(r.innerHTML,this.main.slim.search.input.value,this.main.config.searchHighlighter):r.innerHTML&&(t.innerHTML=r.innerHTML),this.main.config.showOptionTooltips&&t.textContent&&t.setAttribute("title",t.textContent);var h=this;t.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation();var t=this.dataset.id;if(!0===r.selected&&h.main.config.allowDeselectOption){var i=!1;if(h.main.beforeOnChange&&h.main.config.isMultiple||(i=!0),h.main.beforeOnChange&&h.main.config.isMultiple){for(var s=h.main.data.getSelected(),n=JSON.parse(JSON.stringify(s)),a=0;a<n.length;a++)n[a].id===t&&n.splice(a,1);!1!==h.main.beforeOnChange(n)&&(i=!0)}i&&(h.main.config.isMultiple?(h.main.data.removeFromSelected(t,"id"),h.main.render(),h.main.select.setValue(),h.main.data.onDataChange()):h.main.set(""))}else{if(r.disabled||r.selected)return;if(h.main.config.limit&&Array.isArray(c)&&h.main.config.limit<=c.length)return;if(h.main.beforeOnChange){var l=void 0,o=JSON.parse(JSON.stringify(h.main.data.getObjectFromData(t)));o.selected=!0,h.main.config.isMultiple?(l=JSON.parse(JSON.stringify(c))).push(o):l=JSON.parse(JSON.stringify(o)),!1!==h.main.beforeOnChange(l)&&h.main.set(t,"id",h.main.config.closeOnSelect)}else h.main.set(t,"id",h.main.config.closeOnSelect)}});var i=c&&a.isValueInArrayOfObjects(c,"id",r.id);return(r.disabled||i)&&(t.onclick=null,h.main.config.allowDeselectOption||t.classList.add(this.main.config.disabled),h.main.config.hideSelectedOption&&t.classList.add(this.main.config.hide)),i?t.classList.add(this.main.config.optionSelected):t.classList.remove(this.main.config.optionSelected),t},n);function n(e){this.main=e.main,this.container=this.containerDiv(),this.content=this.contentDiv(),this.search=this.searchDiv(),this.list=this.listDiv(),this.options(),this.singleSelected=null,this.multiSelected=null,this.main.config.isMultiple?(this.multiSelected=this.multiSelectedDiv(),this.multiSelected&&this.container.appendChild(this.multiSelected.container)):(this.singleSelected=this.singleSelectedDiv(),this.container.appendChild(this.singleSelected.container)),this.container.appendChild(this.content),this.content.appendChild(this.search.container),this.content.appendChild(this.list)}t.Slim=s}],n.c=s,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)).default;function n(e){if(s[e])return s[e].exports;var t=s[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}var i,s})},{}],91:[function(require,module,exports){module.exports=Stream;var EE=require("events").EventEmitter;var inherits=require("inherits");inherits(Stream,EE);Stream.Readable=require("readable-stream/readable.js");Stream.Writable=require("readable-stream/writable.js");Stream.Duplex=require("readable-stream/duplex.js");Stream.Transform=require("readable-stream/transform.js");Stream.PassThrough=require("readable-stream/passthrough.js");Stream.Stream=Stream;function Stream(){EE.call(this)}Stream.prototype.pipe=function(dest,options){var source=this;function ondata(chunk){if(dest.writable){if(false===dest.write(chunk)&&source.pause){source.pause()}}}source.on("data",ondata);function ondrain(){if(source.readable&&source.resume){source.resume()}}dest.on("drain",ondrain);if(!dest._isStdio&&(!options||options.end!==false)){source.on("end",onend);source.on("close",onclose)}var didOnEnd=false;function onend(){if(didOnEnd)return;didOnEnd=true;dest.end()}function onclose(){if(didOnEnd)return;didOnEnd=true;if(typeof dest.destroy==="function")dest.destroy()}function onerror(er){cleanup();if(EE.listenerCount(this,"error")===0){throw er}}source.on("error",onerror);dest.on("error",onerror);function cleanup(){source.removeListener("data",ondata);dest.removeListener("drain",ondrain);source.removeListener("end",onend);source.removeListener("close",onclose);source.removeListener("error",onerror);dest.removeListener("error",onerror);source.removeListener("end",cleanup);source.removeListener("close",cleanup);dest.removeListener("close",cleanup)}source.on("end",cleanup);source.on("close",cleanup);dest.on("close",cleanup);dest.emit("pipe",source);return dest}},{events:16,inherits:18,"readable-stream/duplex.js":75,"readable-stream/passthrough.js":84,"readable-stream/readable.js":85,"readable-stream/transform.js":86,"readable-stream/writable.js":87}],92:[function(require,module,exports){"use strict";var Buffer=require("safe-buffer").Buffer;var isEncoding=Buffer.isEncoding||function(encoding){encoding=""+encoding;switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return true;default:return false}};function _normalizeEncoding(enc){if(!enc)return"utf8";var retried;while(true){switch(enc){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return enc;default:if(retried)return;enc=(""+enc).toLowerCase();retried=true}}}function normalizeEncoding(enc){var nenc=_normalizeEncoding(enc);if(typeof nenc!=="string"&&(Buffer.isEncoding===isEncoding||!isEncoding(enc)))throw new Error("Unknown encoding: "+enc);return nenc||enc}exports.StringDecoder=StringDecoder;function StringDecoder(encoding){this.encoding=normalizeEncoding(encoding);var nb;switch(this.encoding){case"utf16le":this.text=utf16Text;this.end=utf16End;nb=4;break;case"utf8":this.fillLast=utf8FillLast;nb=4;break;case"base64":this.text=base64Text;this.end=base64End;nb=3;break;default:this.write=simpleWrite;this.end=simpleEnd;return}this.lastNeed=0;this.lastTotal=0;this.lastChar=Buffer.allocUnsafe(nb)}StringDecoder.prototype.write=function(buf){if(buf.length===0)return"";var r;var i;if(this.lastNeed){r=this.fillLast(buf);if(r===undefined)return"";i=this.lastNeed;this.lastNeed=0}else{i=0}if(i<buf.length)return r?r+this.text(buf,i):this.text(buf,i);return r||""};StringDecoder.prototype.end=utf8End;StringDecoder.prototype.text=utf8Text;StringDecoder.prototype.fillLast=function(buf){if(this.lastNeed<=buf.length){buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed);return this.lastChar.toString(this.encoding,0,this.lastTotal)}buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,buf.length);this.lastNeed-=buf.length};function utf8CheckByte(byte){if(byte<=127)return 0;else if(byte>>5===6)return 2;else if(byte>>4===14)return 3;else if(byte>>3===30)return 4;return-1}function utf8CheckIncomplete(self,buf,i){var j=buf.length-1;if(j<i)return 0;var nb=utf8CheckByte(buf[j]);if(nb>=0){if(nb>0)self.lastNeed=nb-1;return nb}if(--j<i)return 0;nb=utf8CheckByte(buf[j]);if(nb>=0){if(nb>0)self.lastNeed=nb-2;return nb}if(--j<i)return 0;nb=utf8CheckByte(buf[j]);if(nb>=0){if(nb>0){if(nb===2)nb=0;else self.lastNeed=nb-3}return nb}return 0}function utf8CheckExtraBytes(self,buf,p){if((buf[0]&192)!==128){self.lastNeed=0;return"�".repeat(p)}if(self.lastNeed>1&&buf.length>1){if((buf[1]&192)!==128){self.lastNeed=1;return"�".repeat(p+1)}if(self.lastNeed>2&&buf.length>2){if((buf[2]&192)!==128){self.lastNeed=2;return"�".repeat(p+2)}}}}function utf8FillLast(buf){var p=this.lastTotal-this.lastNeed;var r=utf8CheckExtraBytes(this,buf,p);if(r!==undefined)return r;if(this.lastNeed<=buf.length){buf.copy(this.lastChar,p,0,this.lastNeed);return this.lastChar.toString(this.encoding,0,this.lastTotal)}buf.copy(this.lastChar,p,0,buf.length);this.lastNeed-=buf.length}function utf8Text(buf,i){var total=utf8CheckIncomplete(this,buf,i);if(!this.lastNeed)return buf.toString("utf8",i);this.lastTotal=total;var end=buf.length-(total-this.lastNeed);buf.copy(this.lastChar,0,end);return buf.toString("utf8",i,end)}function utf8End(buf){var r=buf&&buf.length?this.write(buf):"";if(this.lastNeed)return r+"�".repeat(this.lastTotal-this.lastNeed);return r}function utf16Text(buf,i){if((buf.length-i)%2===0){var r=buf.toString("utf16le",i);if(r){var c=r.charCodeAt(r.length-1);if(c>=55296&&c<=56319){this.lastNeed=2;this.lastTotal=4;this.lastChar[0]=buf[buf.length-2];this.lastChar[1]=buf[buf.length-1];return r.slice(0,-1)}}return r}this.lastNeed=1;this.lastTotal=2;this.lastChar[0]=buf[buf.length-1];return buf.toString("utf16le",i,buf.length-1)}function utf16End(buf){var r=buf&&buf.length?this.write(buf):"";if(this.lastNeed){var end=this.lastTotal-this.lastNeed;return r+this.lastChar.toString("utf16le",0,end)}return r}function base64Text(buf,i){var n=(buf.length-i)%3;if(n===0)return buf.toString("base64",i);this.lastNeed=3-n;this.lastTotal=3;if(n===1){this.lastChar[0]=buf[buf.length-1]}else{this.lastChar[0]=buf[buf.length-2];this.lastChar[1]=buf[buf.length-1]}return buf.toString("base64",i,buf.length-n)}function base64End(buf){var r=buf&&buf.length?this.write(buf):"";if(this.lastNeed)return r+this.lastChar.toString("base64",0,3-this.lastNeed);return r}function simpleWrite(buf){return buf.toString(this.encoding)}function simpleEnd(buf){return buf&&buf.length?this.write(buf):""}},{"safe-buffer":88}],93:[function(require,module,exports){(function(setImmediate,clearImmediate){var nextTick=require("process/browser.js").nextTick;var apply=Function.prototype.apply;var slice=Array.prototype.slice;var immediateIds={};var nextImmediateId=0;exports.setTimeout=function(){return new Timeout(apply.call(setTimeout,window,arguments),clearTimeout)};exports.setInterval=function(){return new Timeout(apply.call(setInterval,window,arguments),clearInterval)};exports.clearTimeout=exports.clearInterval=function(timeout){timeout.close()};function Timeout(id,clearFn){this._id=id;this._clearFn=clearFn}Timeout.prototype.unref=Timeout.prototype.ref=function(){};Timeout.prototype.close=function(){this._clearFn.call(window,this._id)};exports.enroll=function(item,msecs){clearTimeout(item._idleTimeoutId);item._idleTimeout=msecs};exports.unenroll=function(item){clearTimeout(item._idleTimeoutId);item._idleTimeout=-1};exports._unrefActive=exports.active=function(item){clearTimeout(item._idleTimeoutId);var msecs=item._idleTimeout;if(msecs>=0){item._idleTimeoutId=setTimeout(function onTimeout(){if(item._onTimeout)item._onTimeout()},msecs)}};exports.setImmediate=typeof setImmediate==="function"?setImmediate:function(fn){var id=nextImmediateId++;var args=arguments.length<2?false:slice.call(arguments,1);immediateIds[id]=true;nextTick(function onNextTick(){if(immediateIds[id]){if(args){fn.apply(null,args)}else{fn.call(null)}exports.clearImmediate(id)}});return id};exports.clearImmediate=typeof clearImmediate==="function"?clearImmediate:function(id){delete immediateIds[id]}}).call(this,require("timers").setImmediate,require("timers").clearImmediate)},{"process/browser.js":74,timers:93}],94:[function(require,module,exports){function E(){}E.prototype={on:function(name,callback,ctx){var e=this.e||(this.e={});(e[name]||(e[name]=[])).push({fn:callback,ctx:ctx});return this},once:function(name,callback,ctx){var self=this;function listener(){self.off(name,listener);callback.apply(ctx,arguments)}listener._=callback;return this.on(name,listener,ctx)},emit:function(name){var data=[].slice.call(arguments,1);var evtArr=((this.e||(this.e={}))[name]||[]).slice();var i=0;var len=evtArr.length;for(i;i<len;i++){evtArr[i].fn.apply(evtArr[i].ctx,data)}return this},off:function(name,callback){var e=this.e||(this.e={});var evts=e[name];var liveEvents=[];if(evts&&callback){for(var i=0,len=evts.length;i<len;i++){if(evts[i].fn!==callback&&evts[i].fn._!==callback)liveEvents.push(evts[i])}}liveEvents.length?e[name]=liveEvents:delete e[name];return this}};module.exports=E},{}],95:[function(require,module,exports){"use strict";(function(root,factory){if(typeof define==="function"&&define.amd){define([],factory)}else if(typeof exports==="object"){module.exports=factory()}else{root.typed=factory()}})(this,function(){function ok(){return true}function notOk(){return false}function undef(){return undefined}function create(){var _types=[{name:"number",test:function(x){return typeof x==="number"}},{name:"string",test:function(x){return typeof x==="string"}},{name:"boolean",test:function(x){return typeof x==="boolean"}},{name:"Function",test:function(x){return typeof x==="function"}},{name:"Array",test:Array.isArray},{name:"Date",test:function(x){return x instanceof Date}},{name:"RegExp",test:function(x){return x instanceof RegExp}},{name:"Object",test:function(x){return typeof x==="object"&&x.constructor===Object}},{name:"null",test:function(x){return x===null}},{name:"undefined",test:function(x){return x===undefined}}];var anyType={name:"any",test:ok};var _ignore=[];var _conversions=[];var typed={types:_types,conversions:_conversions,ignore:_ignore};function findTypeByName(typeName){var entry=findInArray(typed.types,function(entry){return entry.name===typeName});if(entry){return entry}if(typeName==="any"){return anyType}var hint=findInArray(typed.types,function(entry){return entry.name.toLowerCase()===typeName.toLowerCase()});throw new TypeError('Unknown type "'+typeName+'"'+(hint?'. Did you mean "'+hint.name+'"?':""))}function findTypeIndex(type){if(type===anyType){return 999}return typed.types.indexOf(type)}function findTypeName(value){var entry=findInArray(typed.types,function(entry){return entry.test(value)});if(entry){return entry.name}throw new TypeError("Value has unknown type. Value: "+value)}function find(fn,signature){if(!fn.signatures){throw new TypeError("Function is no typed-function")}var arr;if(typeof signature==="string"){arr=signature.split(",");for(var i=0;i<arr.length;i++){arr[i]=arr[i].trim()}}else if(Array.isArray(signature)){arr=signature}else{throw new TypeError("String array or a comma separated string expected")}var str=arr.join(",");var match=fn.signatures[str];if(match){return match}throw new TypeError("Signature not found (signature: "+(fn.name||"unnamed")+"("+arr.join(", ")+"))")}function convert(value,type){var from=findTypeName(value);if(type===from){return value}for(var i=0;i<typed.conversions.length;i++){var conversion=typed.conversions[i];if(conversion.from===from&&conversion.to===type){return conversion.convert(value)}}throw new Error("Cannot convert from "+from+" to "+type)}function stringifyParams(params){return params.map(function(param){var typeNames=param.types.map(getTypeName);return(param.restParam?"...":"")+typeNames.join("|")}).join(",")}function parseParam(param,conversions){var restParam=param.indexOf("...")===0;var types=!restParam?param:param.length>3?param.slice(3):"any";var typeNames=types.split("|").map(trim).filter(notEmpty).filter(notIgnore);var matchingConversions=filterConversions(conversions,typeNames);var exactTypes=typeNames.map(function(typeName){var type=findTypeByName(typeName);return{name:typeName,typeIndex:findTypeIndex(type),test:type.test,conversion:null,conversionIndex:-1}});var convertibleTypes=matchingConversions.map(function(conversion){var type=findTypeByName(conversion.from);return{name:conversion.from,typeIndex:findTypeIndex(type),test:type.test,conversion:conversion,conversionIndex:conversions.indexOf(conversion)}});return{types:exactTypes.concat(convertibleTypes),restParam:restParam}}function parseSignature(signature,fn,conversions){var params=[];if(signature.trim()!==""){params=signature.split(",").map(trim).map(function(param,index,array){var parsedParam=parseParam(param,conversions);if(parsedParam.restParam&&index!==array.length-1){throw new SyntaxError('Unexpected rest parameter "'+param+'": '+"only allowed for the last parameter")}return parsedParam})}if(params.some(isInvalidParam)){return null}return{params:params,fn:fn}}function hasRestParam(params){var param=last(params);return param?param.restParam:false}function hasConversions(param){return param.types.some(function(type){return type.conversion!=null})}function compileTest(param){if(!param||param.types.length===0){return ok}else if(param.types.length===1){return findTypeByName(param.types[0].name).test}else if(param.types.length===2){var test0=findTypeByName(param.types[0].name).test;var test1=findTypeByName(param.types[1].name).test;return function or(x){return test0(x)||test1(x)}}else{var tests=param.types.map(function(type){return findTypeByName(type.name).test});return function or(x){for(var i=0;i<tests.length;i++){if(tests[i](x)){return true}}return false}}}function compileTests(params){var tests,test0,test1;if(hasRestParam(params)){tests=initial(params).map(compileTest);var varIndex=tests.length;var lastTest=compileTest(last(params));var testRestParam=function(args){for(var i=varIndex;i<args.length;i++){if(!lastTest(args[i])){return false}}return true};return function testArgs(args){for(var i=0;i<tests.length;i++){if(!tests[i](args[i])){return false}}return testRestParam(args)&&args.length>=varIndex+1}}else{if(params.length===0){return function testArgs(args){return args.length===0}}else if(params.length===1){test0=compileTest(params[0]);return function testArgs(args){return test0(args[0])&&args.length===1}}else if(params.length===2){test0=compileTest(params[0]);test1=compileTest(params[1]);return function testArgs(args){return test0(args[0])&&test1(args[1])&&args.length===2}}else{tests=params.map(compileTest);return function testArgs(args){for(var i=0;i<tests.length;i++){if(!tests[i](args[i])){return false}}return args.length===tests.length}}}}function getParamAtIndex(signature,index){return index<signature.params.length?signature.params[index]:hasRestParam(signature.params)?last(signature.params):null}function getExpectedTypeNames(signature,index,excludeConversions){var param=getParamAtIndex(signature,index);var types=param?excludeConversions?param.types.filter(isExactType):param.types:[];return types.map(getTypeName)}function getTypeName(type){return type.name}function isExactType(type){return type.conversion===null||type.conversion===undefined}function mergeExpectedParams(signatures,index){var typeNames=uniq(flatMap(signatures,function(signature){return getExpectedTypeNames(signature,index,false)}));return typeNames.indexOf("any")!==-1?["any"]:typeNames}function createError(name,args,signatures){var err,expected;var _name=name||"unnamed";var matchingSignatures=signatures;var index;for(index=0;index<args.length;index++){var nextMatchingDefs=matchingSignatures.filter(function(signature){var test=compileTest(getParamAtIndex(signature,index));return(index<signature.params.length||hasRestParam(signature.params))&&test(args[index])});if(nextMatchingDefs.length===0){expected=mergeExpectedParams(matchingSignatures,index);if(expected.length>0){var actualType=findTypeName(args[index]);err=new TypeError("Unexpected type of argument in function "+_name+" (expected: "+expected.join(" or ")+", actual: "+actualType+", index: "+index+")");err.data={category:"wrongType",fn:_name,index:index,actual:actualType,expected:expected};return err}}else{matchingSignatures=nextMatchingDefs}}var lengths=matchingSignatures.map(function(signature){return hasRestParam(signature.params)?Infinity:signature.params.length});if(args.length<Math.min.apply(null,lengths)){expected=mergeExpectedParams(matchingSignatures,index);err=new TypeError("Too few arguments in function "+_name+" (expected: "+expected.join(" or ")+", index: "+args.length+")");err.data={category:"tooFewArgs",fn:_name,index:args.length,expected:expected};return err}var maxLength=Math.max.apply(null,lengths);if(args.length>maxLength){err=new TypeError("Too many arguments in function "+_name+" (expected: "+maxLength+", actual: "+args.length+")");err.data={category:"tooManyArgs",fn:_name,index:args.length,expectedLength:maxLength};return err}err=new TypeError('Arguments of type "'+args.join(", ")+'" do not match any of the defined signatures of function '+_name+".");err.data={category:"mismatch",actual:args.map(findTypeName)};return err}function getLowestTypeIndex(param){var min=999;for(var i=0;i<param.types.length;i++){if(isExactType(param.types[i])){min=Math.min(min,param.types[i].typeIndex)}}return min}function getLowestConversionIndex(param){var min=999;for(var i=0;i<param.types.length;i++){if(!isExactType(param.types[i])){min=Math.min(min,param.types[i].conversionIndex)}}return min}function compareParams(param1,param2){var c;c=param1.restParam-param2.restParam;if(c!==0){return c}c=hasConversions(param1)-hasConversions(param2);if(c!==0){return c}c=getLowestTypeIndex(param1)-getLowestTypeIndex(param2);if(c!==0){return c}return getLowestConversionIndex(param1)-getLowestConversionIndex(param2)}function compareSignatures(signature1,signature2){var len=Math.min(signature1.params.length,signature2.params.length);var i;var c;c=signature1.params.some(hasConversions)-signature2.params.some(hasConversions);if(c!==0){return c}for(i=0;i<len;i++){c=hasConversions(signature1.params[i])-hasConversions(signature2.params[i]);if(c!==0){return c}}for(i=0;i<len;i++){c=compareParams(signature1.params[i],signature2.params[i]);if(c!==0){return c}}return signature1.params.length-signature2.params.length}function filterConversions(conversions,typeNames){var matches={};conversions.forEach(function(conversion){if(typeNames.indexOf(conversion.from)===-1&&typeNames.indexOf(conversion.to)!==-1&&!matches[conversion.from]){matches[conversion.from]=conversion}});return Object.keys(matches).map(function(from){return matches[from]})}function compileArgsPreprocessing(params,fn){var fnConvert=fn;if(params.some(hasConversions)){var restParam=hasRestParam(params);var compiledConversions=params.map(compileArgConversion);fnConvert=function convertArgs(){var args=[];var last=restParam?arguments.length-1:arguments.length;for(var i=0;i<last;i++){args[i]=compiledConversions[i](arguments[i])}if(restParam){args[last]=arguments[last].map(compiledConversions[last])}return fn.apply(null,args)}}var fnPreprocess=fnConvert;if(hasRestParam(params)){var offset=params.length-1;fnPreprocess=function preprocessRestParams(){return fnConvert.apply(null,slice(arguments,0,offset).concat([slice(arguments,offset)]))}}return fnPreprocess}function compileArgConversion(param){var test0,test1,conversion0,conversion1;var tests=[];var conversions=[];param.types.forEach(function(type){if(type.conversion){tests.push(findTypeByName(type.conversion.from).test);conversions.push(type.conversion.convert)}});switch(conversions.length){case 0:return function convertArg(arg){return arg};case 1:test0=tests[0];conversion0=conversions[0];return function convertArg(arg){if(test0(arg)){return conversion0(arg)}return arg};case 2:test0=tests[0];test1=tests[1];conversion0=conversions[0];conversion1=conversions[1];return function convertArg(arg){if(test0(arg)){return conversion0(arg)}if(test1(arg)){return conversion1(arg)}return arg};default:return function convertArg(arg){for(var i=0;i<conversions.length;i++){if(tests[i](arg)){return conversions[i](arg)}}return arg}}}function createSignaturesMap(signatures){var signaturesMap={};signatures.forEach(function(signature){if(!signature.params.some(hasConversions)){splitParams(signature.params,true).forEach(function(params){signaturesMap[stringifyParams(params)]=signature.fn})}});return signaturesMap}function splitParams(params,ignoreConversionTypes){function _splitParams(params,index,types){if(index<params.length){var param=params[index];var filteredTypes=ignoreConversionTypes?param.types.filter(isExactType):param.types;var typeGroups;if(param.restParam){var exactTypes=filteredTypes.filter(isExactType);typeGroups=exactTypes.length<filteredTypes.length?[exactTypes,filteredTypes]:[filteredTypes]}else{typeGroups=filteredTypes.map(function(type){return[type]})}return flatMap(typeGroups,function(typeGroup){return _splitParams(params,index+1,types.concat([typeGroup]))})}else{var splittedParams=types.map(function(type,typeIndex){return{types:type,restParam:typeIndex===params.length-1&&hasRestParam(params)}});return[splittedParams]}}return _splitParams(params,0,[])}function hasConflictingParams(signature1,signature2){var ii=Math.max(signature1.params.length,signature2.params.length);for(var i=0;i<ii;i++){var typesNames1=getExpectedTypeNames(signature1,i,true);var typesNames2=getExpectedTypeNames(signature2,i,true);if(!hasOverlap(typesNames1,typesNames2)){return false}}var len1=signature1.params.length;var len2=signature2.params.length;var restParam1=hasRestParam(signature1.params);var restParam2=hasRestParam(signature2.params);return restParam1?restParam2?len1===len2:len2>=len1:restParam2?len1>=len2:len1===len2}function createTypedFunction(name,signaturesMap){if(Object.keys(signaturesMap).length===0){throw new SyntaxError("No signatures provided")}var parsedSignatures=[];Object.keys(signaturesMap).map(function(signature){return parseSignature(signature,signaturesMap[signature],typed.conversions)}).filter(notNull).forEach(function(parsedSignature){var conflictingSignature=findInArray(parsedSignatures,function(s){return hasConflictingParams(s,parsedSignature)});if(conflictingSignature){throw new TypeError('Conflicting signatures "'+stringifyParams(conflictingSignature.params)+'" and "'+stringifyParams(parsedSignature.params)+'".')}parsedSignatures.push(parsedSignature)});var signatures=flatMap(parsedSignatures,function(parsedSignature){var params=parsedSignature?splitParams(parsedSignature.params,false):[];return params.map(function(params){return{params:params,fn:parsedSignature.fn}})}).filter(notNull);signatures.sort(compareSignatures);var ok0=signatures[0]&&signatures[0].params.length<=2&&!hasRestParam(signatures[0].params);var ok1=signatures[1]&&signatures[1].params.length<=2&&!hasRestParam(signatures[1].params);var ok2=signatures[2]&&signatures[2].params.length<=2&&!hasRestParam(signatures[2].params);var ok3=signatures[3]&&signatures[3].params.length<=2&&!hasRestParam(signatures[3].params);var ok4=signatures[4]&&signatures[4].params.length<=2&&!hasRestParam(signatures[4].params);var ok5=signatures[5]&&signatures[5].params.length<=2&&!hasRestParam(signatures[5].params);var allOk=ok0&&ok1&&ok2&&ok3&&ok4&&ok5;var tests=signatures.map(function(signature){return compileTests(signature.params)});var test00=ok0?compileTest(signatures[0].params[0]):notOk;var test10=ok1?compileTest(signatures[1].params[0]):notOk;var test20=ok2?compileTest(signatures[2].params[0]):notOk;var test30=ok3?compileTest(signatures[3].params[0]):notOk;var test40=ok4?compileTest(signatures[4].params[0]):notOk;var test50=ok5?compileTest(signatures[5].params[0]):notOk;var test01=ok0?compileTest(signatures[0].params[1]):notOk;var test11=ok1?compileTest(signatures[1].params[1]):notOk;var test21=ok2?compileTest(signatures[2].params[1]):notOk;var test31=ok3?compileTest(signatures[3].params[1]):notOk;var test41=ok4?compileTest(signatures[4].params[1]):notOk;var test51=ok5?compileTest(signatures[5].params[1]):notOk;var fns=signatures.map(function(signature){return compileArgsPreprocessing(signature.params,signature.fn)});var fn0=ok0?fns[0]:undef;var fn1=ok1?fns[1]:undef;var fn2=ok2?fns[2]:undef;var fn3=ok3?fns[3]:undef;var fn4=ok4?fns[4]:undef;var fn5=ok5?fns[5]:undef;var len0=ok0?signatures[0].params.length:-1;var len1=ok1?signatures[1].params.length:-1;var len2=ok2?signatures[2].params.length:-1;var len3=ok3?signatures[3].params.length:-1;var len4=ok4?signatures[4].params.length:-1;var len5=ok5?signatures[5].params.length:-1;var iStart=allOk?6:0;var iEnd=signatures.length;var generic=function generic(){"use strict";for(var i=iStart;i<iEnd;i++){if(tests[i](arguments)){return fns[i].apply(null,arguments)}}throw createError(name,arguments,signatures)};var fn=function fn(arg0,arg1){"use strict";if(arguments.length===len0&&test00(arg0)&&test01(arg1)){return fn0.apply(null,arguments)}if(arguments.length===len1&&test10(arg0)&&test11(arg1)){return fn1.apply(null,arguments)}if(arguments.length===len2&&test20(arg0)&&test21(arg1)){return fn2.apply(null,arguments)}if(arguments.length===len3&&test30(arg0)&&test31(arg1)){return fn3.apply(null,arguments)}if(arguments.length===len4&&test40(arg0)&&test41(arg1)){return fn4.apply(null,arguments)}if(arguments.length===len5&&test50(arg0)&&test51(arg1)){return fn5.apply(null,arguments)}return generic.apply(null,arguments)};try{Object.defineProperty(fn,"name",{value:name})}catch(err){}fn.signatures=createSignaturesMap(signatures);return fn}function notIgnore(typeName){return typed.ignore.indexOf(typeName)===-1}function trim(str){return str.trim()}function notEmpty(str){return!!str}function notNull(value){return value!==null}function isInvalidParam(param){return param.types.length===0}function initial(arr){return arr.slice(0,arr.length-1)}function last(arr){return arr[arr.length-1]}function slice(arr,start,end){return Array.prototype.slice.call(arr,start,end)}function contains(array,item){return array.indexOf(item)!==-1}function hasOverlap(array1,array2){for(var i=0;i<array1.length;i++){if(contains(array2,array1[i])){return true}}return false}function findInArray(arr,test){for(var i=0;i<arr.length;i++){if(test(arr[i])){return arr[i]}}return undefined}function uniq(arr){var entries={};for(var i=0;i<arr.length;i++){entries[arr[i]]=true}return Object.keys(entries)}function flatMap(arr,callback){return Array.prototype.concat.apply([],arr.map(callback))}function getName(fns){var name="";for(var i=0;i<fns.length;i++){var fn=fns[i];if(fn.signatures&&fn.name!==""){if(name===""){name=fn.name}else if(name!==fn.name){var err=new Error("Function names do not match (expected: "+name+", actual: "+fn.name+")");err.data={actual:fn.name,expected:name};throw err}}}return name}typed=createTypedFunction("typed",{"string, Object":createTypedFunction,Object:function(signaturesMap){var fns=[];for(var signature in signaturesMap){if(signaturesMap.hasOwnProperty(signature)){fns.push(signaturesMap[signature])}}var name=getName(fns);return createTypedFunction(name,signaturesMap)},"...Function":function(fns){var err;var name=getName(fns);var signaturesMap={};for(var i=0;i<fns.length;i++){var fn=fns[i];if(!(typeof fn.signatures==="object")){err=new TypeError("Function is no typed-function (index: "+i+")");err.data={index:i};throw err}for(var signature in fn.signatures){if(fn.signatures.hasOwnProperty(signature)){if(signaturesMap.hasOwnProperty(signature)){if(fn.signatures[signature]!==signaturesMap[signature]){err=new Error('Signature "'+signature+'" is defined twice');err.data={signature:signature};throw err}}else{signaturesMap[signature]=fn.signatures[signature]}}}}return createTypedFunction(name,signaturesMap)}});typed.create=create;typed.types=_types;typed.conversions=_conversions;typed.ignore=_ignore;typed.convert=convert;typed.find=find;typed.addType=function(type){if(!type||typeof type.name!=="string"||typeof type.test!=="function"){throw new TypeError("Object with properties {name: string, test: function} expected")}typed.types.push(type)};typed.addConversion=function(conversion){if(!conversion||typeof conversion.from!=="string"||typeof conversion.to!=="string"||typeof conversion.convert!=="function"){throw new TypeError("Object with properties {from: string, to: string, convert: function} expected")}typed.conversions.push(conversion)};return typed}return create()})},{}],96:[function(require,module,exports){(function(global){module.exports=deprecate;function deprecate(fn,msg){if(config("noDeprecation")){return fn}var warned=false;function deprecated(){if(!warned){if(config("throwDeprecation")){throw new Error(msg)}else if(config("traceDeprecation")){console.trace(msg)}else{console.warn(msg)}warned=true}return fn.apply(this,arguments)}return deprecated}function config(name){try{if(!global.localStorage)return false}catch(_){return false}var val=global.localStorage[name];if(null==val)return false;return String(val).toLowerCase()==="true"}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],97:[function(require,module,exports){arguments[4][7][0].apply(exports,arguments)},{dup:7}],98:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":97,_process:74,inherits:18}],99:[function(require,module,exports){module.exports={}},{}],100:[function(require,module,exports){"use strict";var EventEmitter=require("../utils/EventEmitter.js");var targetManager=require("../target/TargetManager.js");var log=require("../utils/Logger.js").child({component:"ws-base"});var cons=require("../utils/Constants.js");var utils=require("../utils/utils.js");class Base extends EventEmitter{constructor(options){super(options);this.options=options||{};this.id=this.options.id;this.period=this.options.period;this.periodReadEnabled=true;this._timer=null;this._target=null;this._url=this.options.url;this.initCalled=false;this.reinit=false;this.state=cons.State.NONE;this.isDefURL=false;this.isDefPeriod=false;if(!this._url){this.isDefURL=true}if(!this.period){this.isDefPeriod=true}this.log=log}startPeriodicReading(period){this.period=period||this.period;if(this.periodReadEnabled===false){this.periodReadEnabled=true}if(this._timer){clearTimeout(this._timer)}this._readPeriodic()}stopPeriodicReading(){this.periodReadEnabled=false}_changeState(state){if(this.state!==state){var oldState=this.state;this.state=state;switch(state){case cons.State.ONLINE:if(oldState===cons.State.OFFLINE){this._readPeriodic()}this.emit("online",this);break;case cons.State.OFFLINE:if(this._timer){clearTimeout(this._timer)}this.emit("offline",this);break}this.emit("state",this);this.log.debug("State changed to "+utils.getKeyByValue(cons.State,state)||state)}}init(){if(this._timer){clearTimeout(this._timer)}this.initCalled=true;return Promise.resolve()}_getTarget(){if(!this._target){return new Promise((resolve,reject)=>{if(!this._url){this._url=targetManager.getDefaultURL()}targetManager.getTarget(this._url).then(target=>{this._target=target;this._onTargetOnlineHandle=this._onTargetOnline.bind(this);this._onTargetOfflineHandle=this._onTargetOffline.bind(this);this._target.on("online",this._onTargetOnlineHandle);this._target.on("offline",this._onTargetOfflineHandle);resolve(this._target)}).catch(reject)})}else{return Promise.resolve()}}_onTargetOnline(){this.init().then(()=>{this._changeState(cons.State.ONLINE)}).catch(err=>{this._changeState(cons.State.ERROR);if(err instanceof Error){this.emit("error",err)}else{this.emit("error",new Error(err))}})}_onTargetOffline(){if(this._timer){clearTimeout(this._timer)}this._changeState(cons.State.OFFLINE)}read(){return new Promise.resolve}dispose(){if(this._timer){clearTimeout(this._timer)}if(this._target){this.emit("offline");this._target.removeListener("online",this._onTargetOnline);this._target.removeListener("offline",this._onTargetOffline);this._changeState(cons.State.NONE);this.initCalled=false;this._target=null}else if(this._url){return targetManager.disposeTarget(this._url).catch(err=>{this.log.debug(err)})}return Promise.resolve()}changePeriod(period){this.period=period;if(this._timer){clearTimeout(this._timer)}this._readPeriodic()}_readPeriodic(){if(!this._target||!this.periodReadEnabled||!this.period||this.period<=0){if(this._timer){clearTimeout(this._timer)}return}this.read().then(()=>{this.emit("periodic",null,this);if(this.period>0){this._timer=setTimeout(()=>{this._readPeriodic()},this.period)}}).catch(err=>{if(this._timer){clearTimeout(this._timer)}this.log.debug("Periodic reading failed!",err);this.emit("periodic",err,this);if(this.period>0&&(this.state===cons.State.ONLINE||this.state===cons.State.ERROR)){let period=this.period;if(this.state===cons.State.ERROR){period*=2}this._timer=setTimeout(()=>{this._readPeriodic()},period)}})}_setURL(url){this._url=url}}module.exports=Base},{"../target/TargetManager.js":114,"../utils/Constants.js":127,"../utils/EventEmitter.js":129,"../utils/Logger.js":131,"../utils/utils.js":134}],101:[function(require,module,exports){"use strict";var EventEmitter=require("../utils/EventEmitter");var STATE=require("../utils/Constants.js").State;var mathjs=require("../utils/mathjs-expression-parser.js");var EventSync=require("../utils/EventSync.js");var utils=require("../utils/utils.js");class ExpressionItem extends EventEmitter{constructor(options){super(options);options=options||{};this.id=options.id||options.alias;this._srcExpression=options.expression||options.cstring;this.state=STATE.NONE;this.expression=null;this.eventSync=null;this.values={};this.items=[];this.type="string";this.value=null;this.readOnly=true;this.initCalled=false;this.kind={kindName:"special",browse:false,read:true,write:false,view:true};this.setMaxListeners(1e4)}init(){if(!this.eventSync){this.emit("online",this);this.emit("state",this);this.emit("change",this);this.emit("read",this)}this.initCalled=true;return Promise.resolve()}refresh(){if(this.expression){this.setValue(this.expression.eval(this.values))}}parseExpression(hmi){let aliases=this._srcExpression.match(/\{([^}]+)\}/gi);if(!aliases){this.expression=mathjs.compile(this._srcExpression);this.refresh();this._changeState(STATE.ONLINE);return}let tmpSrcExpression=this._srcExpression;this.eventSync=new EventSync(["online"]);this.eventSync.ignoreOfflineItems=false;this.eventSync.on("online",()=>{this.refresh();this._changeState(STATE.ONLINE)});let allOnline=true;for(let i=0;i<aliases.length;i++){let alias=aliases[i].substr(1,aliases[i].length-2);let item=hmi.get(alias);if(!item){throw new ReferenceError("Item with alias "+alias+" not found. All aliases in the expression must be defined earlier!")}let key="var"+i;this.values[key]=null;item.on("change",()=>{this.values[key]=item.getValue();this.refresh()});item.on("offline",()=>{this._changeState(STATE.OFFLINE)});this.eventSync.registerEventEmitter(item);tmpSrcExpression=tmpSrcExpression.replace(aliases[i],key);if(item.state!==STATE.ONLINE){allOnline=false}this.items.push(item)}this.expression=mathjs.compile(tmpSrcExpression);if(allOnline){this.refresh();this._changeState(STATE.ONLINE)}}browse(){return Promise.resolve(this)}read(){this.refresh();return new Promise.resolve(this)}write(value){if(!this.eventSync){this.setValue(value);return Promise.resolve(this)}else{return Promise.reject("Item "+this.id+" is read-only!")}}getValue(){return this.value}setValue(value,promise){if(typeof value==="number"){if(this.value-value>Number.EPSILON){if(this.value>value){this._emit("falling",promise)}else{this._emit("raising",promise)}}}else if(typeof value==="boolean"){if(this.value===true){this._emit("falling",promise)}else{this._emit("raising",promise)}}this.value=value;this._emit("change",promise);this._emit("read",promise)}isOnline(){return this.state===STATE.ONLINE}_changeState(state){if(this.state!==state){this.state=state;switch(state){case STATE.ONLINE:this.emit("online",this);break;case STATE.OFFLINE:this.emit("offline",this);break}this.emit("state",this)}}dispose(){}_emit(ev,promise){if(promise){promise.then(()=>{this.emit(ev,this)})}else{this.emit(ev,this)}}on(){super.on.apply(this,arguments);if(arguments[0]&&arguments[1]&&utils.isFunction(arguments[1])&&(arguments[0]==="online"||arguments[0]==="change")&&this.state===STATE.ONLINE){var args=Array.prototype.slice.call(arguments);args.splice(0,2);args.splice(0,0,this);let fcn=arguments[1];setTimeout(()=>{fcn.apply(this,args)},0)}}}module.exports=ExpressionItem},{"../utils/Constants.js":127,"../utils/EventEmitter":129,"../utils/EventSync.js":130,"../utils/mathjs-expression-parser.js":133,"../utils/utils.js":134}],102:[function(require,module,exports){"use strict";var Base=require("./Base.js");var targetManager=require("../target/TargetManager.js");var Item=require("./Item.js");var log=require("../utils/Logger.js").child({component:"ws-group"});var cons=require("../utils/Constants.js");class Group extends Base{constructor(options){super(options);this.log=log;this.items=[];this.activeItems=[];this.timestamp=null;if(this.options.items){for(let i of this.options.items){this.items.push(this,i,i)}}this.servHandle=null}size(){return this.items.length}_changeState(state){if(this.state!==state){if(this.state===cons.State.ERROR&&state===cons.State.ONLINE){for(let i of this.activeItems){i._changeState(state)}}else if(state!==cons.State.ONLINE){for(let i of this.items){i._changeState(state)}}else{for(let i of this.activeItems){i._changeState(state)}}}super._changeState(state)}addItem(options){if(this.initCalled){return new Promise((resolve,reject)=>{var item=this._getNewItem(options);item.init().then(()=>{return item.browse()}).then(()=>{if(item.kind.kindName==="arr"){throw new TypeError("Array cannot be read using readGroup command. Skiping.")}this.items.push(item);return this.init()}).then(()=>{resolve(item)}).catch(err=>{if(err instanceof TypeError){reject(err);return}item._changeState(cons.State.ERROR);reject(err)})})}else{var item=this._getNewItem(options);this.items.push(item);return Promise.resolve(item)}}removeItem(id){for(let i=0;i<this.items.length;i++){if(this.items[i].id===id){this.items.splice(i,1);if(this.initCalled){return this.init()}else{return Promise.resolve()}}}return Promise.reject("Item: "+id+" not found")}addItems(options){if(this.initCalled){var promises=[];var newItems=[];for(let i of options){var item=this._getNewItem(i);newItems.push(item);var promise=(item=>{return new Promise((resolve,reject)=>{item.init().then(()=>{return item.browse()}).then(resolve).catch(err=>{item._changeState(cons.State.ERROR);reject(err)})})})(item);promises.push(promise)}return new Promise((resolve,reject)=>{Promise.all(promises).then(()=>{for(let i of newItems){this.items.push(i)}this.init().then(resolve).catch(reject)})})}else{for(let i of options){this.addItem(i)}}}removeItems(ids){for(let id of ids){for(let i=0;i<this.items.length;i++){if(this.items[i].id===id){this.items.splice(i,1);break}}}}get(itemId){for(let i of this.items){if(i.id===itemId||i.cstring===itemId){return i}}return null}$i(itemId){return this.get(itemId)}init(){if(!this.items||this.items.length===0){return Promise.reject("Group must have items specified")}return super.init().then(()=>{return new Promise((resolve,reject)=>{this._getTarget().then(()=>{var cstrings=[];this.activeItems=[];for(let i of this.items){i._getTarget();if(i.state!==cons.State.ERROR){cstrings.push(i.cstring);this.activeItems.push(i)}}this._target.addGroup(cstrings).catch(err=>{for(let i of this.items){i.browse();i._changeState(cons.State.ERROR,err)}return Promise.reject()}).then(res=>{return new Promise((resolve,reject)=>{this.servHandle=res.groupid;for(let i=0;i<res.ids.length;i++){var item=this.activeItems[i];if(res.ids[i].errno<0){item._changeState(cons.State.ERROR)}}var initItemsPromises=[];for(let i of this.activeItems){if(i.state!==cons.State.ERROR){initItemsPromises.push((i=>{return i.init().catch(err=>{log.error(err);i._changeState(cons.State.ERROR);return i})})(i))}}Promise.all(initItemsPromises).then(()=>{for(let i of this.activeItems){if(i.state===cons.State.ERROR){reject();break}}resolve()})})}).catch(err=>{return new Promise((resolve,reject)=>{if(this.reinit){this.reinit=false;this._changeState(cons.State.ERROR);log.error("Failed to reinit group.");reject(err);return}if(this.servHandle!==undefined&&this.servHandle!==null){this._target.removeGroup(this.servHandle).then(()=>{this.reinit=true;return this.init()}).then(resolve).catch(reject)}else{var ok=false;for(let i of this.items){if(i.state!==cons.State.ERROR){ok=true;break}}if(ok){this.reinit=true;return this.init().then(resolve).catch(reject)}else{let promises=[];for(let itm of this.activeItems){promises.push(itm.browse())}Promise.all(promises).catch(err=>{var itm;for(itm of this.activeItems){if(itm.kind&&itm.kind.kindName==="arr"){continue}if(itm.state!==cons.State.ERROR){continue}break}reject(new Error(`${this.id} + ': Adding group failed. Connection string '\n                                                    + ${itm.cstring||""} + ' and many more was not found on target!'`))})}}})}).then(()=>{this._changeState(cons.State.ONLINE);return this.read()}).then(()=>{resolve(this.items);this._readPeriodic()}).catch(reject)}).catch(reject)})})}_onTargetOffline(){this.servHandle=null;super._onTargetOffline()}read(){if(this.servHandle!==undefined&&this.servHandle!==null){return new Promise((resolve,reject)=>{var done=null;var promise=new Promise(function(resolve){done=resolve});this._target.readGroup(this.servHandle).then(res=>{this.timestamp=res.t;for(let i=0;i<res.values.length;i++){this.activeItems[i].setValue(res.values[i],promise);this.activeItems[i].timestamp=res.t}this._changeState(cons.State.ONLINE);this.emit("read",this.items);resolve(this.items);done()}).catch(err=>{if(this.state===cons.State.ONLINE){this._changeState(cons.State.ERROR)}reject(err)})})}return Promise.reject("Group is not initialized. Call init() function first!")}dispose(){var oldTarget=this._target;return super.dispose().then(()=>{if(oldTarget){for(let i of this.items){i.dispose()}if(this.servHandle){return oldTarget.removeGroup(this.servHandle).catch(err=>{log.error(err)}).then(()=>{targetManager.disposeTarget(oldTarget).catch(err=>{log.debug(err)})})}}})}_setURL(url){super._setURL(url);for(let i of this.items){i._url=url}}_getNewItem(options){if(options instanceof Item){options._url=this._url;return options}options.url=this._url;return new Item(options)}}module.exports=Group},{"../target/TargetManager.js":114,"../utils/Constants.js":127,"../utils/Logger.js":131,"./Base.js":100,"./Item.js":103}],103:[function(require,module,exports){"use strict";var Base=require("./Base.js");var cons=require("../utils/Constants.js");var utils=require("../utils/utils.js");class Item extends Base{constructor(options){super(options);this.cstring=this.options.cstring;this.id=this.options.id||this.options.alias||this.cstring;this.kind=null;this.type=null;this.value=null;this.timestamp=null;this.maxUpdatePeriod=this.options.maxUpdatePeriod;this.periodReadEnabled=false;this.readOnly=false;this.on("online",this._setMaxPeriodTimer);this.on("offline",this._clearMaxPeriodTimer);this.setMaxListeners(1e4)}on(){super.on.apply(this,arguments);if(arguments[0]&&arguments[1]&&utils.isFunction(arguments[1])&&(arguments[0]==="online"||arguments[0]==="change")&&this.state===cons.State.ONLINE){var args=Array.prototype.slice.call(arguments);args.splice(0,2);args.splice(0,0,this);let fcn=arguments[1];setTimeout(()=>{fcn.apply(this,args)},0)}}init(){if(!this.id||!this.cstring){throw new Error("Item cstring not specified.")}if(this.initCalled){return Promise.resolve(this)}return super.init().then(()=>{this.kind=null;return new Promise((resolve,reject)=>{this._getTarget().then(()=>{return this.browse(true)}).then(()=>{if(this.state!==cons.State.ERROR){this._changeState(cons.State.ONLINE)}resolve(this)}).catch(err=>{this.log.debug(err);this._changeState(cons.State.ERROR);this.initCalled=false;resolve(this)})})})}browse(silent){if(this.kind){return Promise.resolve(this)}else{return new Promise((resolve,reject)=>{var match=this.cstring.split(":");if(match.length<=0&&match.length>2){reject(`Item ${this.id} (${this.cstring}) not valid!`);return}this._target.browseSymbol(match[0]).then(res=>{var symbol=null;for(let s of res.children){if(s.symbol===match[1]){symbol=s;break}}if(!symbol){this.kind=cons.getSymbolKind(15);this._changeState(cons.State.ERROR);if(!silent){reject(`Item ${this.id} (${this.cstring}) not found on target!`);return}else{resolve(this)}}else{this.kind=cons.getSymbolKind(symbol.kind);this.type=cons.getSymbolType(symbol.type);this.readOnly=!this.kind.write;resolve(this);this.emit("browse",this)}}).catch(err=>{this._changeState(cons.State.ERROR);this.log.trace(err);if(silent){resolve(this)}else{reject(`Item ${this.id} (${this.cstring}) not found on target!`)}})})}}_setMaxPeriodTimer(){if(this.maxUpdatePeriod&&this.maxUpdatePeriod>0){if(this._maxPeriodTimer){clearTimeout(this._maxPeriodTimer)}this._maxPeriodTimer=setTimeout(()=>{this.emit("change",this)},this.maxUpdatePeriod)}}_clearMaxPeriodTimer(){if(this._maxPeriodTimer){clearTimeout(this._maxPeriodTimer)}}read(){return new Promise((resolve,reject)=>{this._target.readItems([this.cstring]).then(res=>{if(this.kind&&this.kind.kindName==="arr"){this.setValue(res.values[0].Data)}else{this.setValue(res.values[0])}resolve(this)}).catch(reject)})}write(value){let oldValue=this.value;this.value=value;return new Promise((resolve,reject)=>{if(!this._target){reject("Writing value failed! "+this.id+" is not online!");return}if(!this.kind){this.browse()}else{if(!this.kind.write){reject(`Item ${this.id} is read-only.`);return}}this._target.writeItems([this.cstring],[value]).then(()=>{this.value=oldValue;this.setValue(value);resolve(this)}).catch(err=>{this.setValue(oldValue);if(err&&err.errno===-106){reject(`Writing value failed! Alias ${this.id} does not exist or is not writable.`)}else if(err&&err.errno===-118){reject(`Writing value is not allowed. Permissions are to low.`)}else{reject(err)}})})}getValue(){return this.value}setValue(value,promise){if(this.value!==undefined&&this.value!==null){if(this.type==="array"){value=value.Data}if(this.value!==value){if(typeof value==="number"){if(this.value-value>Number.EPSILON){if(this.value>value){this._emit("falling",promise)}else{this._emit("raising",promise)}}}else if(typeof value==="boolean"){if(this.value===true){this._emit("falling",promise)}else{this._emit("raising",promise)}}this.value=value;this._emit("change",promise)}}else{this.value=value;this._emit("change",promise)}this._setMaxPeriodTimer();this._emit("read",promise)}isOnline(){return this.state===cons.State.ONLINE}_onTargetOnline(){if(this.state!==cons.State.ERROR){super._onTargetOnline()}}_onTargetOffline(){if(this.state!==cons.State.ERROR){super._onTargetOffline()}}dispose(){this._clearMaxPeriodTimer();super.dispose()}_emit(ev,promise){if(promise){promise.then(()=>{this.emit(ev,this)})}else{this.emit(ev,this)}}}module.exports=Item},{"../utils/Constants.js":127,"../utils/utils.js":134,"./Base.js":100}],104:[function(require,module,exports){"use strict";var STATE=require("../utils/Constants.js").State;var EventEmitter=require("../utils/EventEmitter");class LocalItem extends EventEmitter{constructor(options){super(options);options=options||{};this.id=options.id||options.alias;this.state=STATE.ONLINE;this.type=null;this.value=isNaN(Number(options.cstring))?options.cstring:Number(options.cstring);this.readOnly=false;this.initCalled=false;this.kind={kindName:"special",browse:false,read:true,write:true,view:true};this.setMaxListeners(1e4)}init(){this.emit("online",this);this.emit("state",this);this.emit("change",this);this.emit("read",this);this.initCalled=true;return Promise.resolve()}browse(){return Promise.resolve(this)}read(){return Promise.resolve(this)}write(value){this.setValue(value);return Promise.resolve(this)}getValue(){return this.value}setValue(value,promise){if(this.value!==undefined&&this.value!==null){if(this.value!==value){if(typeof value==="number"){if(this.value-value>Number.EPSILON){if(this.value>value){this._emit("falling",promise)}else{this._emit("raising",promise)}}}else if(typeof value==="boolean"){if(this.value===true){this._emit("falling",promise)}else{this._emit("raising",promise)}}this.value=value;this._emit("change",promise)}}else{this.value=value;this._emit("change",promise)}this._emit("read",promise)}isOnline(){return true}_changeState(state){}dispose(){}_emit(ev,promise){if(promise){promise.then(()=>{this.emit(ev,this)})}else{this.emit(ev,this)}}}module.exports=LocalItem},{"../utils/Constants.js":127,"../utils/EventEmitter":129}],105:[function(require,module,exports){"use strict";var Base=require("./Base.js");var Item=require("./Item.js");var log=require("../utils/Logger.js").child({component:"ws-readitemsgroup"});var cons=require("../utils/Constants.js");class ReadItemsGroup extends Base{constructor(options){super(options);this.log=log;this.items=[];this.cstrings=[]}init(){return super.init().then(()=>{return new Promise((resolve,reject)=>{this._getTarget().then(()=>{this._changeState(cons.State.ONLINE);return this.read()}).then(()=>{resolve(this.items);this._readPeriodic()}).catch(reject)})})}size(){return this.items.length}read(){if(this.cstrings.length===0){return Promise.resolve(this.items)}return new Promise((resolve,reject)=>{var done=null;var promise=new Promise(function(resolve){done=resolve});this._target.readItems(this.cstrings).then(res=>{this.timestamp=res.t;for(let i=0;i<res.values.length;i++){if(this.items[i].kind&&this.items[i].kind.kindName==="arr"){this.items[i].setValue(res.values[i].Data,promise)}else{this.items[i].setValue(res.values[i],promise)}this.items[i].timestamp=res.t}this._changeState(cons.State.ONLINE);this.emit("read",this.items);resolve(this.items);done()}).catch(err=>{if(this.state===cons.State.ONLINE){this._changeState(cons.State.ERROR)}reject(err)})})}addItem(item){if(!(item instanceof Item)){return Promise.reject("Object is not an instance of Item class!")}this.items.push(item);this.cstrings.push(item.cstring);return Promise.resolve(item)}removeItem(item){let index=this.items.indexOf(item);if(index>=0){this.items.splice(index,1);this.cstrings=[];for(let itm of this.items){this.cstrings.push(itm.cstring)}return Promise.resolve()}else{return Promise.reject("Item not found",item)}}get(itemId){for(let i of this.items){if(i.id===itemId||i.cstring===itemId){return i}}return null}}module.exports=ReadItemsGroup},{"../utils/Constants.js":127,"../utils/Logger.js":131,"./Base.js":100,"./Item.js":103}],106:[function(require,module,exports){"use strict";var Base=require("./Base.js");var cons=require("../utils/Constants.js");var log=require("../utils/Logger.js").child({component:"ws-trend"});var utils=require("../utils/utils.js");class Trend extends Base{constructor(options){super(options);this.log=log;this.trndCfg=null;if(!this.options.cstring){throw new Error(this.id+" trend connection string (cstring) is not defined!")}this.cstring=this.options.cstring;this.id=utils.check(this.id,this.cstring);this.readWholeBuffer=utils.check(this.options.readWholeBuffer,true);this.MAX_UPDATE_PERIOD=5}init(){return super.init().then(()=>{return new Promise((resolve,reject)=>{this._getTarget().then(()=>{this._target.getTrendConfig(this.cstring).catch(err=>{this.log.debug("Adding trend failed! Connection string "+this.cstring+" is not pointing to the TRND block!");return Promise.reject(err)}).then(cfg=>{this.trndCfg=cfg;this.emit("init")}).then(()=>{this._changeState(cons.State.ONLINE);return this.read()}).then(()=>{resolve(this.items);this._readPeriodic()}).catch(()=>{this.initCalled=false;this._changeState(cons.State.ERROR);resolve(this.items)})}).catch(reject)})})}_onTargetOffline(){this.trndCfg=null;this.readWholeBuffer=utils.check(this.options.readWholeBuffer,true);super._onTargetOffline()}read(){if(this.trndCfg!==undefined&&this.trndCfg!==null){return new Promise((resolve,reject)=>{this._target.readTrend(this.trndCfg.trendid).then(res=>{this.emit("read",res);resolve(res)}).catch(reject)})}return Promise.reject("Trend is not initialized. Call init() function first!")}_readPeriodic(){if(!this._target||!this.periodReadEnabled||!this.period||this.period<=0){if(this._timer){clearTimeout(this._timer)}return}this.read().then(res=>{this.emit("periodic",null,this);if(this.readWholeBuffer&&!res.underflow&&res.unread>0){this._timer=setTimeout(()=>{this._readPeriodic()},this.MAX_UPDATE_PERIOD)}else if(this.period>0){this._timer=setTimeout(()=>{this._readPeriodic()},this.period)}if(this.readWholeBuffer&&!res.underflow&&res.unread===0){this.emit("read-all",this)}}).catch(err=>{if(this._timer){clearTimeout(this._timer)}this.emit("periodic",err,this);if(this.period>0&&this.state===cons.State.ONLINE){this._timer=setTimeout(()=>{this._readPeriodic()},this.period)}})}dispose(){this.trndCfg=null;this.readWholeBuffer=utils.check(this.options.readWholeBuffer,true);return super.dispose()}}module.exports=Trend},{"../utils/Constants.js":127,"../utils/Logger.js":131,"../utils/utils.js":134,"./Base.js":100}],107:[function(require,module,exports){"use strict";var Group=require("./Group.js");var Item=require("./Item.js");class WGroup extends Group{constructor(options){super(options)}write(values){return new Promise((resolve,reject)=>{if(this.servHandle!==undefined&&this.servHandle!==null){if(!values){values=[];for(let item of this.activeItems){values.push(item.value)}}else{for(let i=0;i<values.length;i++){this.activeItems[i].value=values[i]}}this._target.writeGroup(this.servHandle,values).then(()=>{resolve(this.items)}).catch(reject)}else{reject(new Error("Group not initialized"))}})}_getNewItem(options){return new Item(options)}}module.exports=WGroup},{"./Group.js":102,"./Item.js":103}],108:[function(require,module,exports){"use strict";var Item=require("../Item.js");class SystemItem extends Item{constructor(options){super(options);this.cstring="special";this.readOnly=false;this.kind={kindName:"special",browse:false,read:true,write:false,view:true};this.type="string"}init(){return super.init()}browse(){return Promise.resolve(this)}read(){return Promise.resolve(this)}}module.exports=SystemItem},{"../Item.js":103}],109:[function(require,module,exports){"use strict";var SystemItem=require("./SystemItem.js");var utils=require("../../utils/utils.js");class TimeItem extends SystemItem{constructor(options){options=options||{};options.id=options.id||"$time";super(options);this.format=options.format||"time"}_setValueFromDateObject(date){switch(this.format){case"datetime":this.setValue(utils.getREXSecondsFromDate(date));break;default:let copyDate=new Date(date.getTime());copyDate.setUTCHours(0,0,0,0);this.setValue((date.getTime()-copyDate.getTime())/1e3);break}}init(){return super.init().then(()=>{if(this._target.time){this._setValueFromDateObject(this._target.time)}this._target.on("time",date=>{this._setValueFromDateObject(date)})})}read(){return new Promise((resolve,reject)=>{this.getTime().then(time=>{this._setValueFromDateObject(utils.getDateFromREXSeconds(time.utc/1e9));resolve(this)}).catch(reject)})}}module.exports=TimeItem},{"../../utils/utils.js":134,"./SystemItem.js":108}],110:[function(require,module,exports){"use strict";var SystemItem=require("./SystemItem.js");class VersionItem extends SystemItem{constructor(options){options=options||{};options.id=options.id||"$version";super(options)}init(){return super.init().then(()=>{if(this._target.version){this.setValue(this._target.version)}})}read(){return new Promise((resolve,reject)=>{this._target.getVersion().then(version=>{this.setValue(version);resolve(this)}).catch(reject)})}}module.exports=VersionItem},{"./SystemItem.js":108}],111:[function(require,module,exports){"use strict";var SystemItem=require("./SystemItem.js");class WhoamiItem extends SystemItem{constructor(options){options=options||{};options.id=options.id||"$whoami";super(options);this.whoamiProperty=options.property}_setWhoami(whoami){if(this.whoamiProperty){this.setValue(whoami[this.whoamiProperty])}else{this.setValue(whoami)}}init(){return super.init().then(()=>{if(this._target.whoami){this._setWhoami(this._target.whoami)}this._target.on("whoami",whoami=>{this._setWhoami(whoami)})})}read(){return new Promise((resolve,reject)=>{this._target.getWhoami().then(whoami=>{this._setWhoami(whoami);resolve(this)}).catch(reject)})}}module.exports=WhoamiItem},{"./SystemItem.js":108}],112:[function(require,module,exports){"use strict";var targetManager=require("./target/TargetManager.js");var log=require("./utils/Logger.js").child({component:"hmi"});var EventEmitter=require("./utils/EventEmitter.js");var Base=require("./group-management/Base.js");var Group=require("./group-management/Group.js");var ReadItemsGroup=require("./group-management/ReadItemsGroup.js");var Item=require("./group-management/Item.js");var LocalItem=require("./group-management/LocalItem.js");var ExpressionItem=require("./group-management/ExpressionItem.js");var HMIGraph=require("./ui/HMIGraph.js");var EventSync=require("./utils/EventSync");var utils=require("./utils/utils.js");var cons=require("./utils/Constants.js");var WhoamiItem=require("./group-management/system-items/WhoamiItem.js");var VersionItem=require("./group-management/system-items/VersionItem.js");var TimeItem=require("./group-management/system-items/TimeItem.js");class HMI extends EventEmitter{constructor(){super();this.GROUP_MAX_SIZE=100;this.DEFAULT_REFRESH_RATE=500;this.baseObjects=[];this.groups=[];this.userGroup=[];this.errorItems=[];this._defaultRefreshRate=this.DEFAULT_REFRESH_RATE;this.initialized=false;this.defTarget=null;this._onTargetTimeHandle=this._onTargetTime.bind(this);this._onTargetHeartbeatHandle=this._onTargetHeartbeat.bind(this);this._onTargetOnlineHandle=this._onTargetOnline.bind(this);this._onTargetOfflineHandle=this._onTargetOffline.bind(this);this._showHeartBeatClock=false;this._useClientTime=false;this.Graph=HMIGraph;this.log=log;this.headerTitleElement=null;this._ownTarget=false;this.standalone=true;this.kioskMode=null;this.headerMode=function(){};this.disableAutoReload=false;this.on("init",()=>{this.defTarget.on("headerFlags",flags=>{if(!this.disableAutoReload){if(flags&cons.WSF_HMI_CHANGED||flags&cons.WSF_CONFIG_CHANGED){window.location.reload(true)}}});if(this.standalone){this.commit().then(()=>{if(this.errorItems.length>10){this.log.error(`Item ${this.errorItems[0].id} (${this.errorItems[0].cstring}) and ${this.errorItems.length-1} more was not found on the target. Does your HMI match target configuration?`)}else{for(let itm of this.errorItems){this.log.error(`Item ${itm.id} not found!`)}}})}});this.userGroup.push(new WhoamiItem({id:"$whoami"}));this.userGroup.push(new WhoamiItem({id:"$login",property:"login"}));this.userGroup.push(new WhoamiItem({id:"$group",property:"group"}));this.userGroup.push(new VersionItem({id:"$version"}));this.userGroup.push(new TimeItem({id:"$time",format:"time"}));this.userGroup.push(new TimeItem({id:"$datetime",format:"datetime"}))}init(){}connect(){if(this.init.length===1){return new Promise((resolve,reject)=>{this.init(err=>{if(err){reject(err)}else{resolve()}})}).then(()=>{return targetManager.getTarget().then(target=>{this._setDefaultTarget(target);this._ownTarget=true;this.initialized=true;this.emit("init")})})}else{this.init();return targetManager.getTarget().then(target=>{this._setDefaultTarget(target);this._ownTarget=true;this.initialized=true;this.emit("init")})}}_initBaseObjects(){var promises=[];for(let obj of this.baseObjects){if(!obj.initCalled){promises.push(obj.init())}}for(let itm of this.userGroup){promises.push(itm.init())}return Promise.all(promises)}_reorganizeBaseObjects(){let group=null;let rigroup=null;for(let g of this.groups){if(g.isDefPeriod&&g.isDefURL&&g.size()<this.GROUP_MAX_SIZE){if(!this.standalone&&g.initCalled){continue}if(g instanceof Group){group=g}else{rigroup=g}}}let getGroup=()=>{if(group&&group.size()-2<this.GROUP_MAX_SIZE&&!(!this.standalone&&group.initCalled)){return group}else{let g=new Group({id:"HMIGroup-"+this.groups.length,period:this._defaultRefreshRate});this.groups.push(g);this.baseObjects.push(g);group=g;return g}};let getRIGroup=()=>{if(rigroup&&rigroup.size()-2<this.GROUP_MAX_SIZE){return rigroup}else{let rig=new ReadItemsGroup({id:"HMIRIGroup-"+this.groups.length,period:this._defaultRefreshRate});this.groups.push(rig);this.baseObjects.push(rig);rigroup=rig;return rig}};let itemsIndexes=[];let len=this.baseObjects.length;for(let i=0;i<len;i++){let item=this.baseObjects[i];if(item instanceof Item&&item.isDefURL&&item.isDefPeriod){itemsIndexes.push(i);if(item.kind&&item.kind.kindName==="arr"){getRIGroup().addItem(item)}else if(item.state!==cons.State.ERROR){getGroup().addItem(item).catch(()=>{this.log.debug("Adding %s failed! CString %s not found",item.alias,item.cstring)})}else{this.errorItems.push(item)}}}while(itemsIndexes.length){this.baseObjects.splice(itemsIndexes.pop(),1)}return Promise.resolve()}disconnect(){for(let obj of this.baseObjects){obj.stopPeriodicReading();obj.dispose()}}getTarget(url){if(url){for(let obj of this.baseObjects){if(obj._target.url===url){return obj._target}}}else{if(this.defTarget){return this.defTarget}else{for(let obj of this.baseObjects){if(obj.isDefURL){return obj._target}}return null}}}setTargetUrl(url,force){if(!force){if(location&&location.hostname){url=""}}if(url&&!new RegExp("^(?:ws|wss|http|https):\\/\\/").test(url)){url="ws://"+url}if(targetManager.getDefaultURL()===url){return Promise.resolve()}this._disposeTarget();targetManager.setDefaultURL(url);var baseObjects=[];for(let obj of this.baseObjects){if(obj.isDefURL){baseObjects.push(obj)}}var promises=[];if(this.initialized){if(baseObjects.length===0){this._ownTarget=true;return targetManager.getTarget().then(target=>{this._setDefaultTarget(target)})}for(let obj of baseObjects){obj.dispose();obj._setURL(url);promises.push(obj.init())}return Promise.all(promises).then(()=>{this._setDefaultTarget();log.info("Target URL changed");return this.defTarget}).catch(err=>{log.error(err);return Promise.reject(err)})}else{for(let g of baseObjects){g._setURL(url)}return Promise.resolve()}}setRefreshRate(period){if(!utils.isNumber(period)){throw new Error("Refresh rate must be number!")}this._defaultRefreshRate=period;for(let obj of this.baseObjects){if(obj.isDefPeriod){obj.changePeriod(this._defaultRefreshRate)}}this.emit("refreshRate");log.info("Refresh rate changed.")}addItem(opt){if(opt.type&&opt.type==="L"){let item=new LocalItem(opt);this.userGroup.push(item);return item}else if(opt.type&&opt.type==="X"){let item=new ExpressionItem(opt);try{item.parseExpression(this);this.userGroup.push(item)}catch(err){this.log.warn(`${item.id}: Parsing expression item failed. See debug log for more details.`);this.log.debug(err)}return item}else{var item=new Item(opt);this.baseObjects.push(item);return item}}addItems(items){var res=[];for(var i=0;i<items.length;i++){res.push(this.addItem(items[i]))}return res}commit(){if(!this.defTarget){return new Promise((resolve,reject)=>{this.once("online",()=>{this.commit().then(resolve).catch(reject)})})}return this._initBaseObjects().then(this._reorganizeBaseObjects.bind(this)).then(this._initBaseObjects.bind(this))}removeItem(alias){for(let obj of this.baseObjects){if(obj instanceof Group){let item=obj.get(alias);if(item){if(obj.items.length===1){this._removeBaseObject(obj)}let disposeObject=()=>{if(obj.items.length===0){return obj.dispose()}};return obj.removeItem(alias).then(disposeObject).catch(disposeObject)}}else{if(obj.id===alias){return obj.dispose()}}}return Promise.reject(alias+" not found")}get(alias){for(let obj of this.baseObjects){if(obj instanceof Group||obj instanceof ReadItemsGroup){let item=obj.get(alias);if(item){return item}}else{if(obj.id&&obj.id===alias){return obj}}}for(let itm of this.userGroup){if(itm.id===alias){return itm}}return null}$i(alias){return this.get(alias)}_addBaseObject(obj){if(obj instanceof Base){this.baseObjects.push(obj)}else{throw new Error("Object is not instance of Base class. Cannot add!")}}_removeBaseObject(obj){var index=-1;if(obj instanceof Group){index=this.groups.indexOf(obj);if(index>-1){this.groups.splice(index,1)}}index=this.baseObjects.indexOf(obj);if(index>-1){return this.baseObjects.splice(index,1)}}addGroup(g){this._addBaseObject(g)}removeGroup(g){this._removeBaseObject(g)}addTrend(t){this._addBaseObject(t)}removeTrend(t){this._removeBaseObject(t)}writeValues(aliases,values){if(aliases.length!==values.length){log.error(new Error("Length of aliases and length of values must be the same."));return}var items=[];for(let alias of aliases){var itm=this.get(alias);if(itm){if(itm.kind.write){items.push(itm)}else{log.error(new Error("Alias '"+alias+"' not writable."));return}}else{log.error(new Error("Alias '"+alias+"' not found."));return}}var tasks=[];for(let i=0;i<items.length;i++){var found=false;for(let j=0;j<tasks.length;j++){if(tasks[j].target===items[i]._target){tasks[j].items.push(items[i]);tasks[j].values.push(values[i]);found=true;break}}if(!found){tasks.push({target:items[i]._target,items:[items[i]],values:[values[i]]})}}var promises=[];for(let task of tasks){var names=[];for(let itm of task.items){names.push(itm.cstring)}var promise=task.target.writeItems(names,task.values);promises.push(promise)}return Promise.all(promises)}setTitle(title){if(document&&document.title){document.title=title}this.setHeaderTitle(title)}setHeaderTitle(title){if(this.headerTitleElement){this.headerTitleElement.text(title)}}showHeartBeatClock(show){this._showHeartBeatClock=show!==undefined?show:true}useClientTime(use){this._useClientTime=use!==undefined?use:true}getItemsEventSynchonizer(aliases,events){if(typeof aliases==="string"){aliases=[aliases]}if(typeof events==="string"){events=[events]}var itemsSync=new EventSync(events);for(let alias of aliases){var item=this.get(alias);if(!item){throw new Error("Alias "+alias+" is not defined. Add item first!")}else{itemsSync.registerEventEmitter(item)}}return itemsSync}_setDefaultTarget(target){if(this.defTarget){this.emit("offline");this._disposeTarget()}if(target){this.defTarget=target}else{this.defTarget=this.getTarget()}this.emit("online");this.defTarget.on("time",this._onTargetTimeHandle);this.defTarget.on("heartbeat",this._onTargetHeartbeatHandle);this.defTarget.on("online",this._onTargetOnlineHandle);this.defTarget.on("offline",this._onTargetOfflineHandle)}_disposeTarget(){if(this._ownTarget){if(this.defTarget){this.defTarget.removeListener("time",this._onTargetTimeHandle);this.defTarget.removeListener("heartbeat",this._onTargetHeartbeatHandle);this.defTarget.removeListener("online",this._onTargetOnlineHandle);this.defTarget.removeListener("offline",this._onTargetOfflineHandle);targetManager.disposeTarget(this.defTarget)}else{targetManager.disposeTarget(targetManager.getDefaultURL())}this._ownTarget=false}this.defTarget=null}_onTargetTime(time){if(this.showClientTime){time=new Date}this.emit("time",time)}_onTargetOnline(){this.emit("online")}_onTargetOffline(){this.emit("offline")}_onTargetHeartbeat(){this.emit("heartbeat")}}module.exports=new HMI},{"./group-management/Base.js":100,"./group-management/ExpressionItem.js":101,"./group-management/Group.js":102,"./group-management/Item.js":103,"./group-management/LocalItem.js":104,"./group-management/ReadItemsGroup.js":105,"./group-management/system-items/TimeItem.js":109,"./group-management/system-items/VersionItem.js":110,"./group-management/system-items/WhoamiItem.js":111,"./target/TargetManager.js":114,"./ui/HMIGraph.js":117,"./utils/Constants.js":127,"./utils/EventEmitter.js":129,"./utils/EventSync":130,"./utils/Logger.js":131,"./utils/utils.js":134}],113:[function(require,module,exports){"use strict";var utils=require("./utils/utils.js");var DivLoggerStream=require("./utils/DivLoggerStream.js");var HMI=require("./hmi.js");var Logger=require("./utils/Logger.js");var SVGManager=require("./ui/svg/SVGManager.js");var WebWatchEngine=require("./webwatch/Engine.js");var moment=require("moment");class HMILoader{constructor(){this.WebWatchEngineInitialized=false;this._hbTimer=null;this._hbElement=null}_startHB(){if(!this._hbElement){return}this._hbElement.addClass("heart-beat-on");if(this._hbTimer){clearTimeout(this._hbTimer)}this._hbTimer=setTimeout(()=>{this._hbElement.removeClass("heart-beat-on")},2e3)}refreshControls(){var target=HMI.getTarget();$("#info .info-version").text(target.version);$("#target-url").val(target.url);$("#target-refresh-rate").val(HMI._defaultRefreshRate);if(target.whoami){$("#info .whoami").text(target.whoami.login)}else{target.on("whoami",whoami=>{$("#info .whoami").text(whoami.login)})}$("#content").removeClass("error");this._startHB()}refreshSVGComponents(){var target=HMI.getTarget();if(target){if(target.whoami){let components=SVGManager.components;for(let c of components){if(c.setPermissions){c.setPermissions(target.whoami)}}}else{target.on("whoami",this.refreshSVGComponents)}}}initializeBrowser(){function hideInfo(){$("#info").removeClass("open");$("#content").unbind("click",hideInfo)}$("#info-btn").click(function(){$("#info").toggleClass("open");if($("#info").is(":visible")){$("#log-error-counter").removeClass();$("#content").bind("click",hideInfo)}});this._hbElement=$("#header #heart-beat");if($(".current-time").length>0){var time_elem=$(".current-time");var hbClock=$("#heart-beat-clock");var hbClockVisible=false;var hbElement=this._hbElement;HMI.on("heartbeat",()=>{if(!hbClockVisible){this._startHB()}});HMI.on("time",date=>{if(HMI._useClientTime){time_elem.text(moment().format("HH:mm:ss"))}else{time_elem.text(moment(date).format("HH:mm:ss"))}if(HMI._showHeartBeatClock&&$(window).width()>800){if(!hbClock.is(":visible")){$("#header-title").removeClass("header-title-with-info-and-hearth-beat");$("#header-title").addClass("header-title-with-info-and-hearth-beat-clock");hbClock.show();hbElement.hide();hbClockVisible=true}}else{if(hbClock.is(":visible")){$("#header-title").addClass("header-title-with-info-and-hearth-beat");$("#header-title").removeClass("header-title-with-info-and-hearth-beat-clock");hbClock.hide();hbElement.show();hbClockVisible=false}}})}$("#content").prop("tab-index","-1");$("#target-refresh-rate").keyup(function(evt){var keyCode=evt.keyCode||evt.which;var elem=$(this);var textField=elem.parent()[0].MDCTextField;if(keyCode===27){textField.valid=true;elem.blur();elem.val(HMI._defaultRefreshRate)}if(keyCode===13){textField.valid=true;if(utils.isUint(elem.val())){HMI.setRefreshRate(parseInt(elem.val()));elem.blur()}else{textField.valid=false}}});$("#target-url").keyup(function(evt){var keyCode=evt.keyCode||evt.which;var elem=$(this);var textField=elem.parent()[0].MDCTextField;if(keyCode===27){textField.valid=true;elem.blur();var target=HMI.getTarget();elem.val(target.url)}if(keyCode===13){textField.valid=true;HMI.setTargetUrl(elem.val(),true);elem.blur()}});let urlParams=utils.getJsonFromUrl();if(urlParams.virtualkeyboard||urlParams.virtualKeyboard){window.localStorage.setItem("virtualKeyboard",urlParams.virtualKeyboard.toLowerCase()==="true")}if(window.localStorage.getItem("virtualKeyboard")==="true"){$("#virtual-keyboard").prop("checked",true)}else{$("#virtual-keyboard").prop("checked",false)}$("#virtual-keyboard").change(function(){window.localStorage.setItem("virtualKeyboard",this.checked);setTimeout(()=>{if(confirm("Reload is needed! Reload now?")){location.reload()}},200)});if(urlParams.nologout||urlParams.noLogout){$("#info-logout").remove()}HMI.headerTitleElement=$("#header-title");if($("#log").length>0){var divLoggerStream=new DivLoggerStream($("#log table"),$("#log-error-counter"));Logger.addStream({name:"DivLogger",stream:divLoggerStream,level:"info",type:"raw"})}HMI.kioskMode=function(){$("#header a").removeAttr("href");$("#controls input").prop("disabled",true)};HMI.headerMode=function(mode){if(!mode){mode=""}if(typeof mode==="string"){$("#logo").off().attr("href","/");$("#header").removeClass();switch(mode.toLowerCase()){case"thin":$("#header").addClass("header--"+mode.toLowerCase());break;case"pack-top-left":case"pack-top-right":case"pack-bottom-left":case"pack-bottom-right":$("#header").addClass("header--packed");$("#header").addClass("header--"+mode.toLowerCase());$("#logo").removeAttr("href");$("#logo").click(()=>{$("#header").toggleClass("header--packed")});break;default:break}}else{HMI.log.warn("[HMI Config] Header mode "+mode+" is not string!")}}}initializeInkscapeHMI(rootNode){var $rootNode=$(rootNode);var svgs=$rootNode.children('svg[rexsvg\\:module="REXSVG"]');if(svgs.length>0){for(var i=0;i<svgs.length;i++){SVGManager.init(svgs[i])}HMI.log.debug("SVG modules initialized.")}}initializeWebWatch(rootNode){var $rootNode=$(rootNode);var svgs=$rootNode.children("svg");if(svgs.length>0){WebWatchEngine.processSvg($(svgs[0]));HMI.log.debug("WebWatch initialized.");this.WebWatchEngineInitialized=true}}getRootURL(){var wsURL=HMI.getTarget().url||"";var rootURL=wsURL?"http"+wsURL.substr(2):"http://127.0.0.1:8008";var lastIndexOfRex=rootURL.lastIndexOf("/rex");if(lastIndexOfRex>=0){rootURL=rootURL.substr(0,lastIndexOfRex+1)}return rootURL}refreshBlockInfo(){if(this.WebWatchEngineInitialized&&WebWatchEngine&&WebWatchEngine._blocks.length>0&&Object.keys(WebWatchEngine._blockInfo).length===0){$.ajax({url:this.getRootURL()+"resources/block-info.json",success:data=>{WebWatchEngine.setBlockInfo(JSON.parse(data));HMI.log.debug("BlockInfo loaded")},dataType:"text"}).fail(()=>{HMI.log.warn("WebWatch block information resources loading failed!")})}}loadDone(){this.refreshSVGComponents();$(".rex__loading-screen").remove()}}let HMILoaderInstance=new HMILoader;module.exports=HMILoaderInstance;$(document).ready(function(){if(!REX.HMI.standalone){return}HMILoaderInstance.initializeBrowser();HMILoaderInstance.initializeWebWatch($("#rex-dialog-container")[0]);HMILoaderInstance.initializeInkscapeHMI($("#content")[0]);HMILoaderInstance.loadDone();HMI.connect().then(target=>{}).catch(err=>{$("#content").addClass("error");if(err){HMI.log.error(err)}else{HMI.log.debug("HMI connect failed! Err is not defined!")}});HMI.on("online",function(){HMILoaderInstance.refreshControls();HMILoaderInstance.refreshBlockInfo();HMILoaderInstance.refreshSVGComponents()});HMI.on("offline",function(){$("#content").addClass("error")});$(window).on("beforeunload",function(){HMI.disconnect()})})},{"./hmi.js":112,"./ui/svg/SVGManager.js":125,"./utils/DivLoggerStream.js":128,"./utils/Logger.js":131,"./utils/utils.js":134,"./webwatch/Engine.js":151,moment:71}],114:[function(require,module,exports){(function(process){"use strict";var WSTarget=require("../target/WSTarget.js");var DEFAULT_TARGET_URL="ws://127.0.0.1:8008/rex";class TargetManager{constructor(){this._wsTargets=[];this._connecting=[];this._defaultUrl=""}setDefaultURL(url){this._defaultUrl=url}getDefaultURL(){if(!this._defaultUrl){if(process.browser&&location.host!=="localhost:3000"&&location.host!=="127.0.0.1:3000"&&(location.protocol==="https:"||location.protocol==="http:")){var url=location.host+"/rex";if(url.indexOf("s://")===-1){if(location.protocol==="https:"){url="wss://"+url}else{url="ws://"+url}}this._defaultUrl=url}else{this._defaultUrl=DEFAULT_TARGET_URL}}return this._defaultUrl}getTarget(url){if(!url){url=this.getDefaultURL()}if(new RegExp("^(?:ws|wss):\\/\\/").test(url)){for(let target of this._wsTargets){if(target.url===url){target.ref++;return Promise.resolve(target.target)}}for(let target of this._connecting){if(target.url===url){target.ref++;return target.promise}}var target=new WSTarget(url);var p=new Promise((resolve,reject)=>{target.init().then(()=>{var i;for(i=0;i<this._connecting.length;i++){if(this._connecting[i].url===url){var trgt=this._connecting.splice(i,1);this._wsTargets.push({target:target,url:url,ref:trgt[0].ref});break}}resolve(target)}).catch(target=>{reject(target)})});this._connecting.push({url:url,target:target,promise:p,ref:1});return p}else{return Promise.reject("REST not supported yet. Use WebSocket instead!")}}disposeTarget(target){var targets;if(typeof target==="string"){targets=this._connecting}else{targets=this._wsTargets}for(let i=0;i<targets.length;i++){if(typeof target==="string"){if(targets[i].url!==target){continue}}else if(targets[i].target!==target){continue}targets[i].ref--;if(targets[i].ref===0){return targets.splice(i,1)[0].target.dispose()}return Promise.resolve("Target is still referenced by some components.")}return Promise.resolve("Target already disposed or not found!")}}module.exports=new TargetManager}).call(this,require("_process"))},{"../target/WSTarget.js":115,_process:74}],115:[function(require,module,exports){"use strict";var WsClient=require("../ws-client/Client.js");var log=require("../utils/Logger.js").child({component:"ws-target"});var utils=require("../utils/utils.js");var cons=require("../utils/Constants.js");class WSTarget extends WsClient{constructor(url){super();this.url=url;this._timeout=null;this._reconnectTimer=null;this.disposed=false;this._keepAliveTimer=null;this._keepAliveInterval=2e3;this.keepAlive=true;this.cmdTimeout=1e4;this._timeoutedRequests=0;this._maxTimeoutedRequests=5;this.reconnecting=false;this.version=null;this.whoami=null;this.time=null;this.browsedSymbols={};this._syncTimeTimer=null;this._syncTimePeriod=3e5;this._calcTimeTimer=null;this._calcTimeTimerLastTime=null;this.syncTime=true;this._onInitResolve=null;this.on("online",()=>{this.browsedSymbols={};this._clearTimers();this._resetKeepAlive();this._resetTimeSync();this._timeoutedRequests=0;this._calcTimeTimer=setInterval(()=>{let now=new Date;if(!this._calcTimeTimerLastTime){this._calcTimeTimerLastTime=now}let elapsed=now-this._calcTimeTimerLastTime;if(this.time){this.time.setTime(this.time.getTime()+elapsed);this.emit("time",this.time)}this._calcTimeTimerLastTime=now},1e3)});this.on("offline",()=>{this._clearTimers();this.commands.clear()});this.on("closed",this._onSockClose);this.on("headerFlags",flags=>{if(flags&cons.WSF_CONFIG_CHANGED){log.info("REX configuration has been changed!");this.disconnect().then(this._reconnect.bind(this))}})}init(){return new Promise((resolve,reject)=>{this._onInitResolve=resolve;this.connect(this.url).then(()=>{this._init()}).catch(err=>{this._reconnect()})})}_init(){this.emit("online");var versionProm=this.getVersion();var timeProm=this.getTime();Promise.all([versionProm,timeProm]).then(ret=>{this.version=ret[0];this.time=utils.getDateFromREXSeconds(ret[1].utc/1e9);let resolve=whoami=>{if(whoami&&whoami.login){this.whoami=whoami;this.emit("whoami",whoami)}if(this._onInitResolve){this._onInitResolve(this);this._onInitResolve=null}};this.getWhoami().then(resolve).catch(resolve)}).catch(err=>{log.error(err)})}browseSymbol(symbol){if(this.browsedSymbols[symbol]){if(this.browsedSymbols[symbol]instanceof Promise){return this.browsedSymbols[symbol]}return Promise.resolve(this.browsedSymbols[symbol])}else{let promise=super.browseSymbol(symbol);this.browsedSymbols[symbol]=promise;promise.then(response=>{this.browsedSymbols[symbol]=response});return promise}}_makeAPICall(code,data){this._resetKeepAlive();var cmd=super._makeAPICall(code,data);cmd.promise.then(()=>{clearTimeout(cmd.cmdTimer)}).catch(()=>{clearTimeout(cmd.cmdTimer)});cmd.cmdTimer=setTimeout(()=>{cmd.reject("Request "+cmd.header.id+" timed out");this.commands.removeCmd(cmd.id);if(!this.reconnecting){this._timeoutedRequests++;log.debug("Remaining commands: "+this.commands.length+" message length: "+this.commands.getMsgLength());if(this._timeoutedRequests>=this._maxTimeoutedRequests){if(this._timeoutedRequests===this._maxTimeoutedRequests){this.commands.clear();this._clearTimers();this.idle().then(()=>{log.debug("Idle cmd after timeout successful");this._sock.close()}).catch(()=>{log.debug("Idle cmd after timeout failed");this._sock.close()})}else{}}}},this.cmdTimeout);return cmd.promise}_resetKeepAlive(){if(this._keepAliveTimer){clearTimeout(this._keepAliveTimer)}if(this.keepAlive){if(typeof this._onKeepAlive==="function"){this._keepAliveTimer=setTimeout(()=>{this._onKeepAlive()},this._keepAliveInterval)}}}_onKeepAlive(){this.idle().catch(err=>{if(this._keepAliveTimer){clearTimeout(this._keepAliveTimer)}log.debug("Keep alive (IDLE) request failed",err)})}_resetTimeSync(){if(this._syncTimeTimer){clearTimeout(this._syncTimeTimer)}if(this.syncTime){this._syncTimeTimer=setTimeout(()=>{this.getTime().then(time=>{this.time=utils.getDateFromREXSeconds(time.utc/1e9);this._calcTimeTimerLastTime=null;this._resetTimeSync()}).catch(err=>{if(this._syncTimeTimer){clearTimeout(this._syncTimeTimer)}log.debug(err)})},this._syncTimePeriod)}}_onSockClose(){this.emit("offline");this._reconnect()}_clearTimers(){if(this._keepAliveTimer){clearTimeout(this._keepAliveTimer);this._keepAliveTimer=null}if(this._syncTimeTimer){clearTimeout(this._syncTimeTimer);this._syncTimeTimer=null}if(this._calcTimeTimer){clearInterval(this._calcTimeTimer);this._calcTimeTimerLastTime=null}}dispose(){this.removeListener("closed",this._onSockClose);this.emit("offline");this._clearTimers();if(this._reconnectTimer){clearTimeout(this._reconnectTimer);this._reconnectTimer=null;this.reconnecting=false}this.disposed=true;log.debug("Target "+this.url+" is being disposed.");return this.disconnect()}disconnect(){this.emit("offline");this._clearTimers();return super.disconnect()}_reconnect(){if(!this.disposed&&!this.reconnecting){this._timeout=_getTimeoutGenerator();this._reconnectLoop();this.reconnecting=true}}_reconnectLoop(){var timeout=this._timeout.next().value;log.debug('Reconnecting to target "'+this.url+'" in '+timeout+" ms.");this._reconnectTimer=setTimeout(()=>{this.reconnect().then(()=>{if(this._reconnectTimer){clearTimeout(this._reconnectTimer)}this.reconnecting=false;this._init()}).catch(()=>{this._reconnectLoop()})},timeout)}}function*_getTimeoutGenerator(){yield 500;yield 1e3;yield 2e3;yield 5e3;yield 1e4;while(true){yield 6e4}}module.exports=WSTarget},{"../utils/Constants.js":127,"../utils/Logger.js":131,"../utils/utils.js":134,"../ws-client/Client.js":158}],116:[function(require,module,exports){"use strict";var EventEmitter=require("../utils/EventEmitter.js");var utils=require("../utils/utils.js");var STATE=require("../utils/Constants.js").State;var COLORS=require("../utils/Constants.js").COLORS;var log=require("../utils/Logger.js").child({component:"UI"});class Component extends EventEmitter{constructor(options){super();this.options=options=options||{};this.id=options.id||(options.element?options.element.id:"");this.element=options.element;this.version=options.version;this.items={};this.COLORS=COLORS;this.readOnly=false;this.initDone=false;this._state=STATE.NONE;this._isDisabled=false;this._isVisible=true;this.log=log;this.writePerm=utils.check(options.writePerm,[]);if(this.constructor.name){this.log=require("../utils/Logger.js").child({component:`UI-${this.constructor.name}`,id:this.id})}}init(){this.initDone=true}addWriteInterface(){if(!this.items.value){this.log.warn("Adding write interface failed. Item `value` is note defined");return}this.items.refresh_from=this.items.refresh_from||this.items.value;this.disableRefresh=false;this.refresh=function(){};this.items.value.once("online",itm=>{if(itm.kind&&itm.kind.write){return}else{this.log.warn("Item `value` is not writable. ReadOnly mode enabled!");this.setReadOnly()}});this.items.refresh_from.on("change",itm=>{if(!this.disableRefresh){this.refresh()}});this.writeFailed=(err=>{if(err.msg&&err.msg.header.errno==-1){this.log.error(this.id+": Write failed! Unexpected value type.")}else{this.log.error(this.id+": Write failed!",err.msg||err)}});this.write=(value=>{this.items.value.write(value).catch(this.writeFailed);if(this.items.refresh_from!==this.items.refresh_from.value){this.items.refresh_from.setValue(this.items.value.getValue())}})}_disable(){this._isDisabled=true;this.emit("disable",true);return true}_enable(){this._isDisabled=false;this.emit("disable",false);return true}_show(){this._isVisible=true;this.emit("visible",true);return true}_hide(){this._isVisible=false;this.emit("visible",false);return true}disable(){return this._disable()}enable(){return this._enable()}show(){return this._show()}hide(){return this._hide()}isDisabled(){return this._isDisabled}isVisible(){return this._isVisible}state(newState){if(newState){let found=false;for(var prop in STATE){if(STATE.hasOwnProperty(prop)){if(STATE[prop]===newState){this._state=STATE[prop];found=true;this.emit("state",this)}}}if(!found){throw Error("State "+newState+" is not defined!")}}return this._state}setPermissions(whoami){let login=whoami.login;if(this.writePerm&&this.writePerm.length>0){for(let p of this.writePerm){if(p.login.toLowerCase()===login.toLowerCase().trim()){return}}this.log.debug("Login "+login+" not found in write permission list.");this.setReadOnly()}}setReadOnly(){this.readOnly=true}}module.exports=Component},{"../utils/Constants.js":127,"../utils/EventEmitter.js":129,"../utils/Logger.js":131,"../utils/utils.js":134}],117:[function(require,module,exports){"use strict";var Graph=require("./graph/Graph.js");var utils=require("../utils/utils.js");var EventSync=require("../utils/EventSync.js");var Trend=require("../group-management/Trend.js");var Item=require("../group-management/Item.js");class HMIGraph extends Graph{constructor(){super({id:"rexhmi-graph",element:$('<div id="rexhmi-graph" class="mdc-card"></div>')[0]});this.trendSize=.39;this.initialized=false;this.eventSync=new EventSync(["read"]);this.eventSync.on("read",()=>{this.refresh()});this.eventSync.ignoreOfflineItems=true;$(window).resize(()=>{if(this._isVisible){this._resize()}});this.rootDiv=null}_resize(){var $content=$("#content");if(this._isVisible){var graph=$(this.element);var content_top=$content[0].getBoundingClientRect().y;var chart_bottom=parseInt(graph.css("bottom"),10);var height=$(window).height()-content_top-chart_bottom;if(graph.is(":visible")){$content.css("max-height",((1-this.trendSize)*height).toFixed(3)+"px");let bcr=$content[0].getBoundingClientRect();graph.css("top",(bcr.y+bcr.height).toFixed(3)+"px")}else{$content.css("max-height","none")}}else{$content.css("max-height","none")}}resume(){super.resume()}pause(){super.pause()}show(){super.show();this._resize()}hide(){super.hide();this._resize()}addSignal(opt){var HMI=require("../hmi.js");if(!this.initialized){if(this.rootDiv){this.rootDiv=$(this.rootDiv)[0]}else{this.rootDiv=$("#main-block")[0]}$("#content").css("overflow-y","auto");this.rootDiv.after(this.element);this.show();this.initialized=true}if(opt.alias||opt.desc){opt.alias=opt.alias||utils.createID(opt.desc);opt.label=opt.desc||opt.alias;if(opt.alias.indexOf(" ")!==-1){this.log.error(opt.label+": Alias "+opt.alias+" in trend signal must not contain spaces!");return}var item=HMI.get(opt.alias);if(item&&opt.cstring&&item.cstring!==opt.cstring){this.log.error(opt.label+": Alias "+opt.alias+" already defined! Must be unique!");return}if(!item&&!opt.cstring){if(!opt.cstring){this.log.error(opt.label+": Cannot create an item. There is no connection string for alias "+opt.alias);return}}if(!item){item=HMI.addItem({alias:opt.alias,cstring:opt.cstring})}var serieID=this.addSignal(opt);item.on("read",itm=>{this.data.addPoint(serieID,itm.timestamp,itm.value)});this.eventSync.registerEventEmitter(item);this.refresh()}else{if(!opt.cstring){this.log.error("addTrendSignal: Alias or ConnectionString is not define. Cannot add!");return}if(opt.cstring.indexOf(":")!==-1){opt.cstring=opt.cstring.substr(0,opt.cstring.indexOf(":"))}var isDefPeriod=false;var period=opt.period;if(!opt.period){isDefPeriod=true;period=HMI._defaultRefreshRate}var trend=new Trend(opt);trend.period=period;var trndID=null;trend.on("read",data=>{if(trndID===null){var cfg=trend.trndCfg;cfg.labels=opt.labels;trndID=this.addTrendConfig(cfg);let vcItem=new Item({alias:"ViewConfig-"+trndID,cstring:trend.cstring+":ViewConfig"});vcItem.init().then(()=>vcItem.read());vcItem.on("read",itm=>{let value=itm.getValue();if(value){try{this.applyViewConfig(trndID,JSON.parse(value))}catch(err){this.log.debug("ViewConfig not found or invalid")}}});this.viewConfigItems.push(vcItem)}this.data.addTrend(trndID,data);if(!this._timer){this.refresh()}});HMI.addTrend(trend)}}addTrend(opt){if(!opt.cstring){this.log.error("addTrendSignal: ConnectionString is not define. Cannot add!");return}if(opt.alias){this.log.error("addTrendSignal: ALIAS is not allowed here! Only cstring should be specified.");return}this.addSignal(opt)}setSize(size){if(size<0||size>1){this.log.error("Trend size must be <0;1>");return}this.trendSize=size;$(window).trigger("resize")}setRefreshRate(period){if(utils.isNumber(period)){this.eventSync.removeAllListeners("read")}super.setRefreshRate(period)}hideLegend(){super.hideLegend()}}module.exports=new HMIGraph},{"../group-management/Item.js":103,"../group-management/Trend.js":106,"../hmi.js":112,"../utils/EventSync.js":130,"../utils/utils.js":134,"./graph/Graph.js":118}],118:[function(require,module,exports){"use strict";var Component=require("../Component.js");var GraphData=require("../graph/GraphData.js");var utils=require("../../utils/utils.js");var Timer=require("../../utils/Timer.js");var Treejs=require("../../../lib/Require/daweilv_treejs/dist/tree.js");class Graph extends Component{constructor(options){super(options);this.$element=$(this.element);this.graph=null;this.dygraphOptions=null;this._timer=null;this._pause=false;this._autoZoom=false;this._autoZoomRange=-1;this._autoZoomChanged=false;this._selected=null;this.data=new GraphData;this.viewConfigItems=[];this._injectTemplates();this._graphDiv=this.$element.find(".graph-graph");this._controlsDiv=this.$element.find(".graph-controls");this._labelsDiv=this.$element.find(".graph-labels");this._legendDiv=this.$element.find(".graph-legend");this._legendTree=null;this._initControls();this.$element.css("overflow","hidden");$(window).resize(()=>{this.resize()})}_initControls(){var self=this;var settingsBtn=this.$element.find(".graph-settings");settingsBtn.button({text:false,icons:{primary:"ui-icon-rex-cog"},label:"Show settings"}).css("z-index",11).click(function(){self._controlsDiv.toggle("slide",{direction:"down"})});this._controlsDiv.append($(`<button id="graphdiv-${this.id}-pause-btn"></button>`).button({text:false,icons:{primary:"ui-icon-rex-pause"},label:"Lock time axis"}).click(function(){var options;if(self._pause){self.resume();options={icons:{primary:"ui-icon-rex-pause"},label:"Lock time axis"}}else{self.pause();options={icons:{primary:"ui-icon-rex-play"},label:"Unlock time axis"}}$(this).button("option",options)}));this._controlsDiv.append($(`<button id="graphdiv-${this.id}-points-btn"></button>`).button({text:false,icons:{primary:"ui-icon-rex-chart-line"},label:"Show points markers"}).click(function(){self.graph.updateOptions({drawPoints:!self.graph.getOption("drawPoints")})}));this._controlsDiv.append($(`<button id="graphdiv-${this.id}-legend-btn"></button>`).button({text:false,icons:{primary:"ui-icon-rex-text-list-bullets"},label:"Show signal details"}).click(function(){self._labelsDiv.toggle();self._graphDiv.toggleClass("full-width");self.resize()}));this._controlsDiv.append($(`<button id="graphdiv-${this.id}-range-btn"></button>`).button({text:false,icons:{primary:"ui-icon-circle-arrow-s"},label:"Hide range selector"}).click(function(){var options;if(self.graph.getOption("showRangeSelector")){options={icons:{primary:"ui-icon-circle-arrow-n"},label:"Show range selector"}}else{options={icons:{primary:"ui-icon-circle-arrow-s"},label:"Hide range selector"}}delete self.graph.rangeSelector_;self.graph.updateOptions({showRangeSelector:!self.graph.getOption("showRangeSelector")});self.graph.resize(10,10);self._graphDiv.css("width","").css("height","");self.resize();$(this).button("option",options)}));this._controlsDiv.append($(`<button id="graphdiv-${this.id}-refresh-vc"></button>`).button({text:false,icons:{primary:"ui-icon-refresh"},label:"Refresh graph view configuration from target."}).click(function(){for(let vci of self.viewConfigItems){vci.read()}}))}_initGraph(){var self=this;var firstData=[];for(let i=0;i<this.data.labels.length;i++){firstData.push(0)}if(this.data.pointBuffer.length!==0){firstData=this.data.pointBuffer[0]}this.graph=new Dygraph(this._graphDiv[0],[firstData],{colors:utils.CONSTANTS.TRND_COLORS,legend:"always",labelsSeparateLines:false,labelsDiv:this._legendDiv[0],labelsShowZeroValues:true,drawPoints:false,showRoller:false,showRangeSelector:!self.isDisabled(),connectSeparatedPoints:true,labels:this.data.labels,axisLabelFontSize:12,rightGap:30,interactionModel:self.isDisabled()?Dygraph.nonInteractiveModel:Dygraph.defaultInteractionModel,title:this.options.title,highlightCallback:(event,x,points,row,seriesName)=>{this._selected={x:x,points:points,row:row,seriesName:seriesName};this._legendDiv.css("text-align","left")},unhighlightCallback:()=>{this._selected=null;this._legendDiv.css("text-align","center")},axes:{x:{valueFormatter:function(val){var date=new Date(val);var mills=date.getMilliseconds().toString();switch(mills.length){case 1:mills="00"+mills;break;case 2:mills="0"+mills;break}return`<b>${Globalize.format(date,"HH:mm:ss")}.${mills}&nbsp;</b>`}}},zoomCallback:(minDate,maxDate,yRange)=>{this._autoZoomRange=maxDate-minDate;if(this.dygraphOptions&&this.dygraphOptions.valueRange){if(this.graph.isZoomed()){this.graph.updateOptions({valueRange:yRange[0]},true)}else{this.graph.updateOptions({valueRange:this.dygraphOptions.valueRange},true)}}}});if(this.dygraphOptions){if(typeof this.dygraphOptions==="object"){try{this.graph.updateOptions(this.dygraphOptions)}catch(e){this.log.warn("Setting dygraph options failed! "+e)}}else{this.log.debug("Dygraph options are not an object.")}}this.resize()}pause(){this._pause=true;if(this._timer){this._timer.stop()}}resume(){this._pause=false;this.refresh();if(this._timer){this._timer.start()}}show(){super.show();if(this._timer){this._timer.start()}}hide(){super.hide();if(this._timer){this._timer.stop()}}disable(){if(this.graph&&!this._isDisabled){this._isDisabled=true;this.graph.destroy();this._initGraph();this.refresh()}this._controlsDiv.hide();this.$element.find(".graph-settings").hide();return super.disable()}enable(){if(this.graph&&this._isDisabled){this._isDisabled=false;this.graph.destroy();this._initGraph();this.refresh()}this.$element.find(".graph-settings").show();return super.enable()}refresh(){if(!this._pause){if(!this.graph){this._initGraph()}if(this.data.pointBuffer.length>0){if(this.graph.isZoomed("x")){var range=this.graph.xAxisRange();var extremes=this.graph.xAxisExtremes();if(range[0]<=extremes[0]){if(this._autoZoomRange!==-1){this.graph.updateOptions({dateWindow:[extremes[0],extremes[0]+this._autoZoomRange]},true)}}else if(range[1]===extremes[1]){var end=this.data.pointBuffer[this.data.pointBuffer.length-1][0].getTime();var start=end-this._autoZoomRange;this.graph.updateOptions({dateWindow:[start,end]},true)}else if(range[1]<this.data.pointBuffer[0][0].getTime()){this.graph.updateOptions({dateWindow:null,valueRange:null},true)}}if(this.data.needsUpdate){let series={};let visibility=[];for(let cfg of this.data.series){series[cfg.id]=cfg.toDygraphSeriesObject();visibility.push(cfg.visible)}let options={labels:this.data.labels,file:this.data.pointBuffer,visibility:visibility,series:series};if(visibility.length===0){delete options.visibility}if(utils.isEmptyObject(series)){delete options.series}if(options.file&&options.file[0]&&options.file[0].length&&options.labels){if(options.file[0].length!==options.labels.length){this.log.warn(`Number of labels does not match number os signals. ViewConfig is invalid!`)}}this.graph.updateOptions(options)}else{this.graph.updateOptions({file:this.data.pointBuffer});if(this._selected){this.graph.setSelection(this._selected.row)}}}if(this.data.needsUpdate){this.data.needsUpdate=false;var labels=this.data.labels;var self=this;this._labelsDiv.empty();let treeJsData=[];let signalGroup=0;for(let i=1;i<labels.length;i++){let cfg=this.data.series[i-1]||{visible:true};let color=cfg.color||utils.CONSTANTS.TRND_COLORS[i-1]||this.graph.colors_[i-1];let node={id:i-1,text:labels[i],color:color,checked:cfg.visible};if(labels.length>9){if(!treeJsData[signalGroup]){treeJsData[signalGroup]={id:"s-"+signalGroup,text:`Signals ${signalGroup*8+1} - ${signalGroup*8+8}`,children:[]}}treeJsData[signalGroup].children.push(node);if(i%8===0){signalGroup++}}else{treeJsData.push(node)}}this._legendTree=new Treejs(this._labelsDiv.get(0),{data:treeJsData,closeDepth:0,onChange:function(){let visibility=[];for(let i=0;i<self.data.labels.length-1;i++){visibility.push(false);for(let val of this.values){if(i==val){visibility[i]=true;break}}}self.graph.setVisibility(visibility)}})}this.emit("refresh",this)}}resize(){if(this.graph){this._graphDiv.css("width","").css("height","");this.graph.resize();if(this.graph.getOption("legend")==="always"){let area=this.graph.getArea();let legend=this._legendDiv;legend[0].style.left=`${area.x+2}px`;legend[0].style.top=`${area.y+2}px`;legend[0].style.width=`${area.w-2}px`;if(area.h<300){legend[0].style.fontSize="9px"}else{legend[0].style.fontSize=""}}}}addSignal(options){return this.data.addSignal(options)}addPoint(id,tstamp,y){this.data.addPoint(id,tstamp,y)}addTrendConfig(trndCfg){return this.data.addTrendConfig(trndCfg)}addTrend(ind,data){return this.data.addTrend(ind,data)}setMaxBufferSize(maxBuffSize){this.data.maxBuffSize=maxBuffSize}setTitle(title){this.graph.updateOptions({title:title})}showLegend(){this._labelsDiv.show();this._graphDiv.removeClass("full-width");this.resize()}hideLegend(){this._labelsDiv.hide();this._graphDiv.addClass("full-width");this.resize()}hideRangeSelector(hide){if(this.this.graph){delete this.graph.rangeSelector_;this.graph.updateOptions({showRangeSelector:typeof hide==="undefined"?false:!hide})}}setRefreshRate(period){if(utils.isNumber(period)){if(!this._timer){this._timer=new Timer(()=>{this.refresh()});this._timer.start(period)}else{this._timer.stop();this._timer.start(period)}}}_injectTemplates(){if(this.$element.find(".graph-graph").length===0){var graph=`\x3c!-- Dygraph placeholder template --\x3e`;graph+=`<div id="graphdiv-${this.id}-graph" class="graph-graph"></div>`;graph+=`<div id="graphdiv-${this.id}-labels" class="graph-labels"></div>`;graph+=`<div id="graphdiv-${this.id}-legend" class="dygraph-legend graph-legend"></div>`;graph+=`<div id="graphdiv-${this.id}-controls" class="graph-controls"></div>`;graph+=`<button id="graphdiv-${this.id}-settings" class="graph-settings"></button>`;this.$element.append($(graph))}}applyViewConfig(trndID,vc){if(!(vc&&vc.View&&vc.View.PropertiesModel)){this.log.warn("ViewConfig object is not valid! Application is not possible!");return}if(trndID===null){this.log.warn("There is no trend for ViewConfig to be applied to.");return}this.data.applyViewConfig(trndID,vc);this.data.needsUpdate=true;this.refresh()}showSignals(signals){if(!Array.isArray(signals)){signals=[signals]}for(let i=0;i<this.data.series.length;i++){this.data.series[i].visible=false;for(let signalIndex of signals){if(i===signalIndex-1){this.data.series[i].visible=true}}}this.data.needsUpdate=true;this.refresh()}}module.exports=Graph},{"../../../lib/Require/daweilv_treejs/dist/tree.js":3,"../../utils/Timer.js":132,"../../utils/utils.js":134,"../Component.js":116,"../graph/GraphData.js":119}],119:[function(require,module,exports){"use strict";var GraphSeries=require("./GraphSeries.js");var utils=require("../../utils/utils.js");class GraphData{constructor(){this.maxBuffSize=5e3;this.pointBuffer=[];this.signals=[];this.trends=[];this.labels=[];this.series=[];this.timeAxisLabel="Time";this.needsUpdate=false}addSignal(options){options=options||{};options.id=options.id||"s"+this.signals.length;options.index=this.signals.length;this.signals.push(new GraphSeries(options));this._update(options.index);this.needsUpdate=true;return this.signals.length-1}addTrendConfig(trndCfg){trndCfg=trndCfg||{};trndCfg.index=this.trends.length;if(trndCfg.user){try{trndCfg.viewConfig=JSON.parse(trndCfg.user)}catch(err){this.log.trace("Parsing ViewConfig failed. Invalid JSON",err)}}this.trends.push(trndCfg);this._update();this.needsUpdate=true;return this.trends.length-1}applyViewConfig(trndID,vc){if(!(vc&&vc.View&&vc.View.PropertiesModel)){this.log.warn("ViewConfig object is not valid! Application is not possible!");return}if(trndID===null){this.log.warn("There is not trend for ViewConfig to be applied to.");return}this.trends[trndID].viewConfig=vc;this._update()}addPoint(id,tstamp,y){if(!this.signals[id]){throw new Error(id+": series does not exist!")}var row=this.pointBuffer[this.pointBuffer.length-1];if(!(tstamp instanceof Date)){tstamp=utils.getDateFromREXNanoseconds(tstamp)}if(row&&tstamp.getTime()===row[0].getTime()){row[this.signals[id].index+1]=y}else{row=Array(this.labels.length).fill(null);row[0]=tstamp;row[this.signals[id].index+1]=y;this.pointBuffer.push(row)}if(this.pointBuffer.length>=this.maxBuffSize){this.pointBuffer.shift()}}_insertData(arr,startIndex,dataIndex,data){for(let i=0;i<data.length;i++){arr[startIndex+i]=data[i][dataIndex]}return arr}addTrend(ind,data){var cfg=this.trends[ind];var append=false;if(!cfg){throw new Error("Adding trend data failed. Trend configuration on index "+ind+" is not defined!")}if(!data.signals||cfg.signalcount!==data.signals.length){throw new Error("Trend data do not fit to trend configuration! Number of signals do not match")}var startIndex=this.signals.length+1;for(let i=0;i<ind;i++){startIndex+=this.trends[i].signalcount}if(this.pointBuffer.length===0){append=true}else{if(this.pointBuffer[this.pointBuffer.length-1][0]<utils.getDateFromREXNanoseconds(data.times[0])){append=true}else{for(let i=0;i<data.times.length;i++){var t=utils.getDateFromREXNanoseconds(data.times[i]);var buffInd=this.pointBuffer.length-1;while(this.pointBuffer[buffInd][0]>t&&buffInd>0){buffInd--}if(this.pointBuffer[buffInd][0].getTime()===t.getTime()){this._insertData(this.pointBuffer[buffInd],startIndex,i,data.signals)}else{var tmp=Array(this.labels.length).fill(null);tmp[0]=t;this._insertData(tmp,startIndex,i,data.signals);this.pointBuffer.splice(buffInd+1,0,tmp)}}}}if(append){for(let i=0;i<data.times.length;i++){var tmp=Array(this.labels.length).fill(null);tmp[0]=utils.getDateFromREXNanoseconds(data.times[i]);this._insertData(tmp,startIndex,i,data.signals);this.pointBuffer.push(tmp)}}while(this.pointBuffer.length>=this.maxBuffSize){this.pointBuffer.shift()}}_update(newSerieIndex){this.labels.length=0;this.series.length=0;this.labels.push(this.timeAxisLabel);for(let s of this.signals){this.labels.push(s.label);this.series.push(s)}for(let cfg of this.trends){if(cfg.viewConfig){let vc=cfg.viewConfig;for(let model of vc.View.PropertiesModel){var items=model.Items.sort((i1,i2)=>i1<i2);for(let i=0;i<items.length;i++){let item=items[i];let label=item.Name;if(!label){label=this.trends.length>1?"t-"+this.trends.indexOf(cfg):"";label+="u"+(item.Id+1)}this.series.push(new GraphSeries({id:label,label:label,visible:item.IsActive,color:item.Color,strokeWidth:items.LineWidth}));this.labels.push(label)}}}else{for(let i=0;i<cfg.signalcount;i++){var label="";if(cfg.labels){label=cfg.labels[i]}else{if(this.trends.length>1){label+="t"+(this.trends.indexOf(cfg)+1)+"-"}label+="u"+(i+1)}this.labels.push(label);let signal={};try{signal=cfg.signals[i];if(!signal){signal={visible:true}}}catch(error){signal={visible:true}}this.series.push(new GraphSeries({id:label,label:label,visible:signal.visible===""?true:utils.parseBoolean(signal.visible),color:utils.check(signal.color,null)}))}}}for(let point of this.pointBuffer){if(newSerieIndex!==undefined){point.splice(newSerieIndex+1,0,null)}while(point.length<this.labels.length){point.push(null)}}}reset(){this.pointBuffer.length=0}}module.exports=GraphData},{"../../utils/utils.js":134,"./GraphSeries.js":120}],120:[function(require,module,exports){var utils=require("../../utils/utils.js");class GraphSeries{constructor(options){var opt=options||{};this.id=opt.id;this.index=utils.checkNumber(opt.index,-1);this.label=opt.label||opt.name||opt.id;this.color=opt.color;this.strokeWidth=utils.checkNumber(opt.strokeWidth,1);this.visible=utils.check(opt.visible,true)}toDygraphSeriesObject(){return{color:this.color,strokeWidth:this.strokeWidth}}}module.exports=GraphSeries},{"../../utils/utils.js":134}],121:[function(require,module,exports){"use strict";var SVGComponent=require("./SVGComponent.js");var HMI=require("../../hmi.js");var utils=require("../../utils/utils.js");var Logger=require("../../utils/Logger.js");class HMIConfig extends SVGComponent{constructor(svgElem,options){super(svgElem,options);options=options||{};for(let o in options){if(options.hasOwnProperty(o)){if(options[o]){switch(o.toLowerCase()){case"target_url":HMI.setTargetUrl(options[o]);break;case"refresh_rate":if(utils.isNumber(options[o])){HMI.setRefreshRate(Number(options[o]))}else{this.log.warn("HMIConfig: Refresh rate is not number, default value is used")}break;case"log_level":Logger.level(options[o]);break;case"use_client_time":if(utils.parseBoolean(options[o])){HMI.useClientTime()}break;case"show_clock":if(utils.parseBoolean(options[o])){HMI.showHeartBeatClock()}break;case"kiosk_mode":if(utils.parseBoolean(options[o])&&HMI.kioskMode&&$.isFunction(HMI.kioskMode)){HMI.kioskMode()}break;case"header_mode":if(options[o]){HMI.headerMode(options[o])}break;case"debug":if(utils.parseBoolean(options[o])){Logger.level("debug")}break;case"ws_ip":this.log.warn("HMIConfig: Parameter WS IP is obsolete use target_url instead!");HMI.setTargetUrl(options[o]);break;default:}}}}this.element.setAttribute("visibility","hidden")}}module.exports=HMIConfig},{"../../hmi.js":112,"../../utils/Logger.js":131,"../../utils/utils.js":134,"./SVGComponent.js":123}],122:[function(require,module,exports){"use strict";var SVGComponent=require("./SVGComponent.js");var EventEmitter=require("../../utils/EventEmitter.js");var ResizeObserverPolyfill=require("@juggle/resize-observer").ResizeObserver;var ResizeObserver=window.ResizeObserver||ResizeObserverPolyfill;class HTMLComponent extends SVGComponent{constructor(svgElem,options){super(svgElem,options);this.div=document.createElement("div");this.svg.parentNode.append(this.div);var $div=$(this.div);if(!this.svg.resizeEmitter){this.svg.resizeEmitter=new EventEmitter;this.svg.resizeEmitter.setMaxListeners(1e4);this.svg.resizeObserver=new ResizeObserver(()=>{this.svg.resizeEmitter.emit("resize")});this.svg.resizeObserver.observe(this.svg);this.svg.resizeObserver.observe(document.querySelector("#content"))}this.svg.resizeEmitter.on("resize",()=>{this.updatePosition();delayedResize()});if($(this.element).parent().attr("rexsvg:module")==="GeneralComponent"){let parGroup=this.element.parentElement;this.opacityChangeObserver=new MutationObserver(mutation=>{if(mutation[0].attributeName==="style"){this.div.style.opacity=parGroup.style.opacity;this.div.style.pointerEvents=parGroup.style.pointerEvents}else if(mutation[0].attributeName==="opacity"){this.div.style.opacity=parGroup.getAttribute("opacity");this.div.style.pointerEvents=parGroup.style.pointerEvents}});this.opacityChangeObserver.observe(this.element.parentNode,{attributes:true})}$div.css("position","absolute").addClass("ui-svg-div").attr("id",this.element.getAttributeNS(null,"id")+"-div");this.element.setAttributeNS(null,"visibility","hidden");$(this.element).children().css("visibility","hidden");let updPosTout=null;let resizeCalled=false;let delayedResize=()=>{if(!resizeCalled){this.updatePosition();if(updPosTout){clearTimeout(updPosTout)}updPosTout=setTimeout(()=>{this.updatePosition();resizeCalled=false},50);resizeCalled=true}};window.addEventListener("orientationchange",()=>{if(!resizeCalled){this.updatePosition()}});$div.parent().scroll(()=>{this.updatePosition()});let updPosInterval=null;let updPosCounter=0;let updPosMaxCount=100;let observer=new MutationObserver(mutationsList=>{for(var mutation of mutationsList){if(mutation.attributeName==="class"){clearInterval(updPosInterval);updPosCounter=0;updPosInterval=setInterval(()=>{if(updPosCounter<updPosMaxCount){this.updatePosition();updPosCounter++}else{updPosCounter=0;clearInterval(updPosInterval)}},20);break}}});let nodes=[$div.parent()[0],$("#content")[0],$("#menu")[0],$("#header")[0]];for(let node of nodes){if(node){observer.observe(node,{attributes:true})}}this.updatePosition()}getAbsPosition(elem){let rect=elem.getBoundingClientRect();let win=elem.ownerDocument.defaultView;return{top:rect.top+win.pageYOffset,left:rect.left+win.pageXOffset,width:rect.width,height:rect.height}}updatePosition(){let posRect=this.getAbsPosition(this.element);let posRectDiv=this.getAbsPosition(this.div.parentNode);let scrollLeft=this.div.parentNode.scrollLeft;let scrollTop=this.div.parentNode.scrollTop;let style=window.getComputedStyle(this.div.parentNode);let borderTop=parseInt(style["border-top"]||style["border-top-width"]);let top=posRect.top-posRectDiv.top+scrollTop-borderTop;let left=posRect.left-posRectDiv.left+scrollLeft;this.div.style.top=top+"px";this.div.style.left=left+"px";this.div.style.width=posRect.width+"px";this.div.style.height=posRect.height+"px";if(posRect.width===0||posRect.height===0){this.div.style.display="none"}else{if(this._isVisible){this.div.style.display=""}}this.emit("updatePosition",{left:left,top:top,width:posRect.width,height:posRect.height})}disable(autoEnableAllowed){if(super.disable(autoEnableAllowed)){$(this.div).attr("disabled",true);return true}}enable(){if(super.enable()){$(this.div).removeAttr("disabled");return true}}hide(){if(super.hide()){$(this.div).hide();return true}}show(){if(super.show()){$(this.div).show();return true}}}module.exports=HTMLComponent},{"../../utils/EventEmitter.js":129,"./SVGComponent.js":123,"@juggle/resize-observer":4}],123:[function(require,module,exports){"use strict";var Component=require("./../Component.js");var utils=require("../../utils/utils.js");var STATE=require("../../utils/Constants.js").State;var HMI=require("../../hmi.js");var EventSync=require("../../utils/EventSync");var Item=require("../../group-management/Item.js");var DISABLE_OPACITY=.5;class SVGComponent extends Component{constructor(svgElem,options){options=options||{};options.element=options.element||svgElem;super(options);Object.assign(this,utils);this.element=svgElem;this.svg=this.options.svg;this.defs=this.options.defs;this.module=this.type=this.options.module||"SVGComponent";this.utils=utils;this.bbox=null;if(this.constructor.name){this.log=require("../../utils/Logger.js").child({component:this.module||this.constructor.name,id:this.id})}this._autoEnableAllowed=true;this._onlineEventSync=new EventSync(["online"]);this._onlineEventSync.ignoreOfflineItems=false;var title_elem=$(this.element).children("title")[0];this.title=title_elem?title_elem.childNodes[0].nodeValue:null;var desc=$(this.element).children("desc")[0];if(desc){var desc_json;try{desc_json=JSON.parse(desc.childNodes[0].nodeValue)}catch(err){this.log.warn("Failed to parse options from DESC tag in "+this.element.id)}if(desc_json){this.$c=this.items=this._initConnections(desc_json["connections"]);this.options=Object.assign(this.options,desc_json.options);this.writePerm=utils.check(this.options.writePerm,[])}}else{this.log.warn("Element "+this.element.id+" has no description tag")}if(!this.title){this.title=this.options.$T}if(this.items.disable_by){this.items.disable_by.on("change",itm=>{if(itm.getValue()){this.disable()}else{this.enable()}})}if(this.items.hide_by){this.items.hide_by.on("change",itm=>{if(itm.getValue()){this.hide()}else{this.show()}})}if(this.items.readonly_by){this.items.readonly_by.on("change",itm=>{if(itm.getValue()){this.setReadOnly()}})}}init(){if(this.initDone){return}super.init();let alreadyOnline=true;let itemInErrorState=false;let onState=itm=>{switch(itm.state){case STATE.NONE:case STATE.OFFLINE:this.disable(true);this.state(STATE.OFFLINE);break;case STATE.ERROR:this.state(STATE.ERROR);this.disable(true);break}};let onAllOnline=()=>{this.state(STATE.ONLINE);if(this._autoEnableAllowed){this.enable()}};this._onlineEventSync.on("online",onAllOnline);for(var key in this.items){if(this.items.hasOwnProperty(key)){let item=this.items[key];if(item.state!==STATE.ONLINE){alreadyOnline=false}if(item.state===STATE.ERROR){itemInErrorState=true}item.on("state",onState);this._onlineEventSync.registerEventEmitter(item)}}if(itemInErrorState){this.state(STATE.ERROR);this.disable(true)}else if(alreadyOnline){onAllOnline()}else{this.disable(true)}}testBBox(){try{if(!this.bbox||this.bbox.width===0&&this.bbox.height===0){this.bbox=this.element.getBBox();if(this.bbox.width===0&&this.bbox.height===0){this.bbox=null;return false}}}catch(error){return false}return true}hide(){this.element.setAttributeNS(null,"visibility","hidden");this.element.style["pointer-events"]="none";return super.hide()}show(){this.element.setAttributeNS(null,"visibility","visible");if(!this.isDisabled()&&!this.readOnly){this.element.style["pointer-events"]="auto"}this.init();return super.show()}enable(){if(!this.isDisabled()){this.emit("disable",false);return true}if(this.state()!==STATE.ONLINE){return false}if(super.enable()){this.element.setAttributeNS(null,"opacity",this.element.oldOpacity||"");this.element.oldOpacity=null;if(this.isVisible()&&!this.readOnly){this.element.style["pointer-events"]="auto"}return true}}disable(autoEnableAllowed){this._autoEnableAllowed=autoEnableAllowed;if(this.isDisabled()){this.emit("disable",true);return true}if(super.disable()){this.element.oldOpacity=this.element.getAttributeNS(null,"opacity");this.element.setAttributeNS(null,"opacity",""+DISABLE_OPACITY);this.element.style["pointer-events"]="none";return true}}_replaceString(str){return this.title?str.replace("$T",this.title):str}_getChildOfElementByTag(element,childModule){var childNodes=Array.prototype.slice.call(element.childNodes);for(var i=0;i<childNodes.length;i++){var item=childNodes[i];var tag=null;if(item.getAttribute){tag=item.getAttribute("rexsvg:tag")||""}if(tag===childModule){return item}childNodes=childNodes.concat(Array.prototype.slice.call(item.childNodes))}}getChildByTag(tag){return this._getChildOfElementByTag(this.element,tag)}_initConnections(conn){if(!conn){return{}}var $c={};if(conn instanceof Array){for(var i=0;i<conn.length;i++){if(conn[i].type==="L"){if(!conn[i].alias){this.log.error("Alias for user item is not defined!")}else{let itmCfg={alias:conn[i].alias,type:conn[i].type,cstring:conn[i].cstring};HMI.addItem(itmCfg)}}else if(conn[i].alias&&this._replaceString(conn[i].cstring)&&conn[i].type){let itmCfg={alias:conn[i].alias,type:conn[i].type,cstring:this._replaceString(conn[i].cstring)};HMI.addItem(itmCfg)}else{this.log.error("alias: "+conn[i].alias+" cstring: "+this._replaceString(conn[i].cstring)+" or type:"+conn[i].type+" is not defined")}}return $c}else{for(var prop in conn){if(conn.hasOwnProperty(prop)){if(conn[prop]instanceof Object){if(conn[prop].cstring){HMI.addItem({alias:conn[prop].alias,cstring:this._replaceString(conn[prop].cstring)})}else{$c[prop]=HMI.$i(conn[prop].alias);if(!$c[prop]){this.log.error(this.element.id+": Alias "+conn[prop].alias+" is not found");$c[prop]=new Item}}}else{var itemStr=this._replaceString(conn[prop]);var item=HMI.$i(itemStr);if(item){$c[prop]=item}else{this.log.error(this.element.id+": Alias "+itemStr+" is not found");$c[prop]=new Item}}}}}return $c}}module.exports=SVGComponent},{"../../group-management/Item.js":103,"../../hmi.js":112,"../../utils/Constants.js":127,"../../utils/EventSync":130,"../../utils/Logger.js":131,"../../utils/utils.js":134,"./../Component.js":116}],124:[function(require,module,exports){"use strict";var Graph=require("../graph/Graph.js");var HTMLComponent=require("./HTMLComponent.js");var utils=require("../../utils/utils.js");var EventSync=require("../../utils/EventSync.js");class SVGGraph extends HTMLComponent{constructor(svgElem,options){super(svgElem,options);var $div=$(this.div);if(this.options.chart.backgroundColor){$div.css("background-color",this.options.chart.backgroundColor)}if(utils.isNumber(this.options.chart.backgroundOpacity)){$div.css("background-color",this.options.chart.backgroundColor)}this._eventSync=new EventSync(["read"]);this._eventSync.on("read",()=>{this.graph.refresh()});this.graph=new Graph({id:this.id,element:this.div});this.graph.setMaxBufferSize(utils.checkNumber(options.chart.bufferSize,this.graph.data.maxBuffSize));if(options.chart.refreshRate){this.graph.setRefreshRate(utils.checkNumber(options.chart.refreshRate,500))}for(let i=1;i<=parseInt(options.chart.numberOfSignals);i++){if(options.chart.type.toLowerCase()!=="time"){this.log.warn("XY graph is not currently supported!")}else{var signal="signal"+i;var signalInd=this.graph.addSerie({id:signal,label:options.signals[i].name||signal,color:options.signals[i].color});if(options.signals[i].bufferCapacity>this.graph.data.maxBuffSize){this.graph.setMaxBufferSize(options.signals[i].bufferCapacity)}if(!this.items||!this.items[signal]){this.log.warn("Signal "+signal+" not found in connection strings!");continue}this.items[signal].on("read",()=>{this.graph.data.addPoint(signalInd,utils.getDateFromREXNanoseconds(this.items[signal].timestamp),this.items[signal].getValue())});this._eventSync.registerEventEmitter(this.items[signal])}}}}module.exports=SVGGraph},{"../../utils/EventSync.js":130,"../../utils/utils.js":134,"../graph/Graph.js":118,"./HTMLComponent.js":122}],125:[function(require,module,exports){"use strict";var utils=require("../../utils/utils.js");var HMIConfig=require("./HMIConfig.js");var log=require("../../utils/Logger.js").child({component:"SVGManager"});class SVGManager{constructor(){this.components=[];this.suffixes=[];this.log=log}registerComponent(svgComponent){this.components.push(svgComponent)}unregisterComponent(svgComponent){this.components.splice(this.components.indexOf(svgComponent),1)}getComponentById(id){for(let component of this.components){if(component.id===id){return component}for(let suffix of this.suffixes){if(component.id===id+suffix){return component}}}}getComponentByTitle(title){for(let component of this.components){if(component.title===title){return component}}}init(svg){var self=this;if(!svg){throw"SVG initialization failed. No SVG element found"}var defs=null;var defs_elems=svg.getElementsByTagNameNS(utils.ns_svg,"defs");if(defs_elems.length>0){defs=defs_elems[0]}else{defs=document.createElementNS(utils.ns_svg,"defs");svg.appendChild(defs)}var $svg=$(svg);$svg.find('[rexsvg\\:module="HMIConfig"]').each(function(index,element){var module=this.getAttribute("rexsvg:module")||"";var component=new HMIConfig(element,{type:module,svg:svg,defs:defs});if(component.init){component.init()}let i=component.id.indexOf("-");if(i>=0){self.suffixes.push(component.id.substring(i))}self.registerComponent(component)});$svg.find("[rexsvg\\:module]").not('[rexsvg\\:module="HMIConfig"]').each(function(index,element){var module=this.getAttribute("rexsvg:module")||"";var version=this.getAttribute("rexsvg:version")||"";if(version.indexOf("${version}")>=0){version=""}REX.UI.SVG.Modules[module]=REX.UI.SVG.Modules[module]?REX.UI.SVG.Modules[module]:REX.UI.SVG[module];if(REX.UI.SVG.Modules[module]){try{var component=new REX.UI.SVG.Modules[module](element,{module:module,type:module,svg:svg,defs:defs,version:version});if(component.init){component.init()}self.registerComponent(component)}catch(error){self.log.error({err:error},"Failed to create and initialize module %s!",module)}}else if(module==="Wrapper"){}else{self.log.warn("Module %s not found! Do you have all necessary libraries included?",module)}})}}module.exports=new SVGManager},{"../../utils/Logger.js":131,"../../utils/utils.js":134,"./HMIConfig.js":121}],126:[function(require,module,exports){"use strict";var Graph=require("../graph/Graph.js");var Trend=require("../../group-management/Trend.js");var Item=require("../../group-management/Item.js");var HTMLComponent=require("./HTMLComponent.js");var utils=require("../../utils/utils.js");var HMI=require("../../hmi.js");class TRND extends HTMLComponent{constructor(svgElem,options){super(svgElem,options);this.trndID=null;this.viewConfig=null;this.graph=new Graph({id:this.id,element:this.div,title:this.options.title});let bufferSize=utils.checkNumber(this.options.bufferSize,-1);if(bufferSize>0){this.graph.setMaxBufferSize(this.options.bufferSize)}var refreshRate=utils.checkNumber(this.options.refreshRate,-1);if(utils.parseBoolean(this.options.hideLegend)){this.graph.hideLegend()}var cstring=this.$c.TRND.cstring;if(!cstring){this.log.warn(this.id+": Connection string is used twice or not at all. Pick exactly one alias for each TRND.");return}if(options.dygraphOptions){if(typeof options.dygraphOptions==="object"){this.graph.dygraphOptions=options.dygraphOptions}else{this.log.error(this.id+"dygraphOptions property is not an object. Write it as a value pair JSON object!")}}if(options.yAxis){let yAxis=options.yAxis[0]||{};if(yAxis.type&&yAxis.type==="logarithmic"){this.graph.dygraphOptions.logscale=true}this.graph.dygraphOptions.valueRange=[yAxis.min,yAxis.max]}if(utils.parseBoolean(this.options.hideRangeSelector)){this.graph.dygraphOptions.showRangeSelector=false}if(this.$c.reset_by){this.$c.reset_by.on("change",itm=>{if(itm.getValue()){this.graph.data.reset()}})}cstring=cstring.substr(0,cstring.indexOf(":"));var trend=HMI.get(cstring);if(!trend){trend=new Trend({id:cstring,cstring:cstring,period:HMI._defaultRefreshRate})}trend.on("read",data=>{if(this.trndID===null){var cfg=trend.trndCfg;if(cfg.samplecount&&bufferSize===-1){this.graph.setMaxBufferSize(cfg.samplecount)}if(this.options.signals){var optSignals=this.options.signals;var labels=[];if(optSignals.length>0&&cfg.signalcount!==optSignals.length){this.log.warn(this.id+": Length of signals array is not matching number of signals!")}for(let i=0;i<cfg.signalcount;i++){if(optSignals[i]){labels.push(optSignals[i].label)}else{labels.push("u"+(i+1))}}for(let s of optSignals){s.visible=utils.check(s.visible,true);s.visible=s.visible===""?true:utils.parseBoolean(s.visible)}cfg.labels=labels;cfg.signals=optSignals}this.trndID=this.graph.data.addTrendConfig(cfg);if(refreshRate>=0){this.graph.setRefreshRate(refreshRate)}if(this.viewConfig){this.graph.applyViewConfig(this.trndID,this.viewConfig)}this.state(utils.CONSTANTS.State.ONLINE);this.enable()}this.graph.data.addTrend(this.trndID,data);if(!this.graph._timer){this.graph.refresh()}else{trend.once("read-all",()=>{this.graph.refresh()})}});HMI.addTrend(trend);var viewConfigItemRemoved=false;if(!this.$c.ViewConfig){viewConfigItemRemoved=true;this.$c.ViewConfig=new Item({alias:this.id+"-vc",cstring:cstring+":ViewConfig"});trend.once("online",()=>{this.$c.ViewConfig.init()});this.graph.viewConfigItems.push(this.$c.ViewConfig)}this.$c.ViewConfig.on("read",itm=>{if(!viewConfigItemRemoved){this.graph.viewConfigItems.push(this.$c.ViewConfig);if(this.$c.ViewConfig instanceof Item){HMI.removeItem(this.$c.ViewConfig.id)}viewConfigItemRemoved=true}if(itm.getValue()){let vc=null;try{vc=JSON.parse(itm.getValue());if(this.trndID!==null){this.graph.applyViewConfig(this.trndID,vc)}this.viewConfig=vc}catch(err){this.log.warn(`${this.id}: ViewConfig is not valid JSON string or valid ViewConfig.`)}}})}enable(){if(this.items.disable_by&&this.graph){this.graph.enable()}return super.enable()}disable(){if(this.items.disable_by&&this.graph){this.graph.disable()}return super.disable()}updatePosition(){super.updatePosition();if(this.graph){this.graph.resize()}}}module.exports=TRND},{"../../group-management/Item.js":103,"../../group-management/Trend.js":106,"../../hmi.js":112,"../../utils/utils.js":134,"../graph/Graph.js":118,"./HTMLComponent.js":122}],127:[function(require,module,exports){"use strict";var exports=module.exports;var cmdNames={};function define(name,value){Object.defineProperty(exports,name,{value:value,enumerable:true});if(name.toUpperCase().indexOf("CMD")>=0){cmdNames[value]=name}}define("CMD_INIT",1);define("CMD_EXIT",2);define("CMD_IDLE",3);define("CMD_VERSION",17);define("CMD_READ_GROUP",49);define("CMD_WRITE_GROUP",50);define("CMD_ADD_GROUP",51);define("CMD_REMOVE_GROUP",52);define("CMD_NAMES_TO_IDS",19);define("CMD_BROWSE_SYMBOL",21);define("CMD_WHO_AMI",514);define("CMD_READ_ITEMS",4097);define("CMD_WRITE_ITEMS",4098);define("CMD_SET_CRYPT_KEY",7);define("CMD_LOGIN",8);define("CMD_GET_TRND_CFG",85);define("CMD_TRND_READ",86);define("CMD_GET_TIME",258);define("CMD_SET_TIME",259);define("CMD_GET_ARC_CFG",81);define("CMD_GET_ARC_DGN",82);define("CMD_ARC_OPEN",92);define("CMD_ARC_CLOSE",93);define("CMD_ARC_READ",84);define("CMD_ARC_WRITE_STRING",87);define("CMD_ARC_WRITE_ACKN",90);define("CMD_ARC_STR_UPLOAD",91);define("WSF_CONFIG_CHANGED",1);define("WSF_HMI_CHANGED",2);define("WSF_SHUTDOWN",4);define("WSF_CONFIG_CHANGING",8);define("WSF_HMI_CHANGING",16);exports.getCmdName=function(cmd){if(cmdNames[cmd]){return cmdNames[cmd]}else{return"UNKNOWN"}};exports.KINDS={0:{kindName:"exec",browse:true,read:false,write:false,view:true},1:{kindName:"module",browse:false,read:false,write:false,view:false},2:{kindName:"iodrv",browse:true,read:false,write:false,view:true},3:{kindName:"archive",browse:true,read:false,write:false,view:true},4:{kindName:"level",browse:false,read:false,write:false,view:false},5:{kindName:"task",browse:true,read:false,write:false,view:true},6:{kindName:"qtask",browse:true,read:false,write:false,view:true},7:{kindName:"seq",browse:true,read:false,write:false,view:true},8:{kindName:"block",browse:true,read:false,write:false,view:true},9:{kindName:"in",browse:false,read:true,write:true,view:true,mode:"RW",type:"string"},10:{kindName:"out",browse:false,read:true,write:false,view:true,mode:"R",type:"string"},11:{kindName:"stat",browse:false,read:false,write:false,view:false},12:{kindName:"arr",browse:false,read:true,write:false,view:true},13:{kindName:"special",browse:false,read:false,write:false,view:false},15:{kindName:"type_unknown",browse:false,read:false,write:false,view:false},256:{kindName:"name",browse:true,read:false,write:false,view:false},257:{kindName:"device",browse:true,read:false,write:false,view:false}};exports.getSymbolKind=function(kind){return exports.KINDS[kind]};exports.TYPES={1:"boolean",2:"number",3:"number",4:"number",5:"number",6:"number",7:"float",8:"float",9:"number",10:"number",11:"number",12:"string"};exports.getSymbolType=function(kind){return exports.TYPES[kind]||""};exports.State={NONE:"",ONLINE:"online",OFFLINE:"offline",ERROR:"error",DISABLED:"disabled"};exports.COLORS={primary:"#00C8B4",complementary:"#0074C5",secondary:"#545e61",warning:"#f6a312",error:"#df2626",inactive:"#f2f4f4",background:"#eef1f0",icon:"#b6bab7",false:"#B8BDC5",textOnPrimary:"#ffffff",textOnInactive:"#000000"};exports.TRND_COLORS=["#000099","#669900","#ff0000","#9966cc","#339999","#996600","#ff6666","#006600","#990066","#cc9900","#330066","#ff6600","#cc6699","#6666cc","#990000","#00cc00","#333333","#ffcc00","#000099","#669900","#ff0000","#9966cc","#339999","#996600","#ff6666","#006600","#990066","#cc9900","#330066","#ff6600","#cc6699","#6666cc","#990000","#00cc00","#333333","#ffcc00","#000099","#669900","#ff0000","#9966cc","#339999","#996600","#ff6666","#006600","#990066","#cc9900","#330066","#ff6600","#cc6699","#6666cc","#990000","#00cc00","#333333","#ffcc00","#000099","#669900","#ff0000","#9966cc","#339999","#996600","#ff6666","#006600","#990066","#cc9900"];exports.REX_SVG_NS="http://www.rexcontrols.com/rexsvg/"},{}],128:[function(require,module,exports){"use strict";var bunyan=require("bunyan");var utils=require("./utils.js");var MAX_LOG_SIZE=100;class DivLoggerStream{constructor(jQelement,jQerrNum){this.element=jQelement;this.maxLogSize=MAX_LOG_SIZE;this._errNum=jQerrNum}write(rec){var level=bunyan.nameFromLevel[rec.level];var row=$("<tr></tr>");switch(level.toLowerCase()){case"error":row.addClass("error");row.append($("<td>cancel</td>"));if(this._errNum&&this._errNum.length>0){this._errNum.text(this.element.find(".error").length+1);this._errNum.addClass("error")}break;case"warn":row.addClass("warning");row.append($("<td>error</td>"));if(this._errNum&&this._errNum.length>0){this._errNum.text(this.element.find(".warning").length+1);this._errNum.addClass("warning")}break;default:row.append($("<td></td>"));break}row.append($("<td>"+rec.time.toLocaleTimeString()+"</td>"));row.append($("<td>"+(rec.id?`[${rec.id}] `:"")+rec.msg+"</td>"));this.element.append(row);if(this.element.children().length>this.maxLogSize){this.element.children().first().remove()}this.element.parent().scrollTop(this.element.parent()[0].scrollHeight)}}module.exports=DivLoggerStream},{"./utils.js":134,bunyan:13}],129:[function(require,module,exports){"use strict";var events=require("events");class EventEmitter extends events.EventEmitter{constructor(options){options=options||{};super(options);this.setMaxListeners(100)}once(event,cb){var self=this;let handler=function onceHandler(){cb.apply(self,arguments);self.off(event,handler)};this.on(event,handler)}off(){this.removeListener.apply(this,arguments)}}module.exports=EventEmitter},{events:16}],130:[function(require,module,exports){"use strict";var EventEmitter=require("./EventEmitter.js");var State=require("./Constants.js").State;var events=require("events");class EventSync extends EventEmitter{constructor(monitoredEvents){super();this.eventEmitterList=[];this._eventList={};this._eventNames=monitoredEvents||["read"];this._eventNames.forEach(evtName=>{this._eventList[evtName]=true});this.ignoreOfflineItems=true}registerEventEmitter(item){var self=this;if(!(item instanceof events.EventEmitter)){throw new Error("Cannot register item which is not instance of EventEmitter class")}var element={item:item};for(let evtName of this._eventNames){item.on(evtName,()=>{self._handleEvent(element,evtName)});element[evtName]=false}this.eventEmitterList.push(element)}_handleEvent(element,eventName){element[eventName]=true;this._refresh()}_refresh(){for(let evtName of this._eventNames){this._eventList[evtName]=true;for(let elem of this.eventEmitterList){if(this.ignoreOfflineItems&&elem.item.state!==State.ONLINE){continue}if(!elem[evtName]){this._eventList[evtName]=false;break}}if(this._eventList[evtName]){for(let elem of this.eventEmitterList){elem[evtName]=false}this.emit(evtName)}}}}module.exports=EventSync},{"./Constants.js":127,"./EventEmitter.js":129,events:16}],131:[function(require,module,exports){(function(process){"use strict";var bunyan=require("bunyan");var logger={};var childLoggers=[];if(process.browser){var MyRawStream=function(){};MyRawStream.prototype.write=function(rec){var level=bunyan.nameFromLevel[rec.level];let logFcn=console.log;switch(level.toLowerCase()){case"error":logFcn=console.error;break;case"warn":logFcn=console.warn;break;default:logFcn=console.log;break}if(rec.level<=20){logFcn=console.groupCollapsed}if(rec.err){logFcn("[%s][%s]%s%s: %s\t at %s",rec.time.toLocaleTimeString(),bunyan.nameFromLevel[rec.level].toUpperCase(),rec.component?`[${rec.component}]`:"",rec.id?`[${rec.id}]`:"",rec.msg,rec.err.stack)}else{logFcn("[%s][%s]%s%s: %s",rec.time.toLocaleTimeString(),bunyan.nameFromLevel[rec.level].toUpperCase(),rec.component?`[${rec.component}]`:"",rec.id?`[${rec.id}]`:"",rec.msg)}if(rec.level<=20){console.trace();console.groupEnd()}};logger=bunyan.createLogger({name:"RexHMI",streams:[{level:"info",stream:new MyRawStream,type:"raw"}]})}else{logger=bunyan.createLogger({name:"RexHMI",level:"debug"})}var old_child=logger.child;logger.child=function(){if(typeof arguments[0]==="object"&&arguments[0].component){let component=arguments[0].component;for(let child of childLoggers){if(child.component===component){return child}}}var childLogger=old_child.apply(logger,arguments);childLoggers.push(childLogger);return childLogger};var old_level=logger.level;logger.level=function(){for(let child of childLoggers){child.level.apply(child,arguments)}return old_level.apply(logger,arguments)};var old_addStream=logger.addStream;logger.addStream=function(){for(let child of childLoggers){child.addStream.apply(child,arguments)}return old_addStream.apply(logger,arguments)};logger.childLoggers=childLoggers;module.exports=logger}).call(this,require("_process"))},{_process:74,bunyan:13}],132:[function(require,module,exports){"use strict";class Timer{constructor(fcn){this.Initial=true;this._fcn=fcn;this._run=false;this._interval=null;this._tHandle=null;this._initialized=false}_loop(){if(!this._run){return}if(this.Initial||this._initialized){this._fcn()}this._initialized=true;this._tHandle=setTimeout(()=>{this._loop()},this._interval)}start(interval){if(!this._run){this._interval=interval;this._run=true;this._loop()}}stop(){this._initialized=false;this._run=false;clearTimeout(this._tHandle)}}module.exports=Timer},{}],133:[function(require,module,exports){var core=require("mathjs/core");var math=core.create();math.import(require("mathjs/lib/expression/function/parse"));math.import(require("mathjs/lib/expression/function/compile"));math.import(require("mathjs/lib/expression/function/eval"));math.import(require("mathjs/lib/function/string/format"));math.import({add:function(a,b){return a+b},subtract:function(a,b){return a-b},multiply:function(a,b){return a*b},divide:function(a,b){return a/b},mod:function(a,b){return a%b},unaryPlus:function(a){return a},unaryMinus:function(a){return-a},bitOr:function(a,b){return a|b},bitXor:function(a,b){return a^b},bitAnd:function(a,b){return a&b},bitNot:function(a){return~a},leftShift:function(a,b){return a<<b},rightArithShift:function(a,b){return a>>b},rightLogShift:function(a,b){return a>>>b},or:function(a,b){return!!(a||b)},xor:function(a,b){return!!a!==!!b},and:function(a,b){return!!(a&&b)},not:function(a){return!a},equal:function(a,b){return a==b},unequal:function(a,b){return a!=b},smaller:function(a,b){return a<b},larger:function(a,b){return a>b},smallerEq:function(a,b){return a<=b},largerEq:function(a,b){return a>=b},matrix:function(){throw new Error("Matrices not supported")},index:function(){throw new Error("Matrix indexes not supported")},pi:Math.PI,e:Math.E,true:true,false:false,null:null});var allFromMath={};Object.getOwnPropertyNames(Math).forEach(function(name){if(name!=="toSource"){allFromMath[name]=Math[name]}});math.import(allFromMath);module.exports=math},{"mathjs/core":21,"mathjs/lib/expression/function/compile":29,"mathjs/lib/expression/function/eval":30,"mathjs/lib/expression/function/parse":31,"mathjs/lib/function/string/format":54}],134:[function(require,module,exports){"use strict";var log=require("../utils/Logger.js").child({component:"utils"});var utils=window.REXUTIL||{};var EPOCH_START=new Date(2e3,0,1).getTime()-new Date(2e3,0,1).getTimezoneOffset()*60*1e3;utils.CONSTANTS=require("./Constants.js");window.$.extend(true,utils.CONSTANTS,require("../../rex-graphics/dist/js/Constants.js"));utils.ns_svg="http://www.w3.org/2000/svg";utils.ns_xlink="http://www.w3.org/1999/xlink";utils.round=function(number,decimals){if(decimals===undefined){decimals=6}let precision=Math.pow(10,decimals);return Math.round(number*precision)/precision};utils.isFunction=function(functionToCheck){return functionToCheck&&{}.toString.call(functionToCheck)==="[object Function]"};utils.isEmptyObject=function(obj){return Object.keys(obj).length===0&&obj.constructor===Object};utils.round_prec=function(number,precision){return Math.round(number*precision)/precision};utils.isUint=function(number){return/^(\d+)$/.test(number)};utils.isInt=function(number,low,high){var result=/^(-?\d+)$/.test(number);if(result===true&&(low!==undefined||high!==undefined)){result=utils.inRange(parseInt(number),low,high)}return result};utils.inRange=function(number,low,high){var result=true;if(low!==undefined&&number<low){result=false}if(high!==undefined&&number>high){result=false}return result};utils.isReal=function(number,low,high){var result=/^((-?\d+|\d+)(.\d+)?\d*((\+|-)(E|e)\d+)?)$/.test(number);if(result===true&&(low!==undefined||high!==undefined)){result=utils.inRange(parseFloat(number),low,high)}return result};utils.isNumber=function(number){return number-parseFloat(number)>=0};utils.appendClass=function(element,className){var classes=element.getAttribute("class")?element.getAttribute("class").split(" "):[];for(var i=0;i<classes.length;i++){if(classes[i]===className){return}}element.setAttribute("class",classes.join(" ")+" "+className)};utils.removeClass=function(element,className){var classes=[];classes=element.getAttribute("class").split(" ");for(var i=0;i<classes.length;i++){if(classes[i]===className){classes.splice(i,1);element.setAttribute("class",classes.join(" "));return}}};utils.getDateFromREXSeconds=function(rexSeconds){var date=new Date(rexSeconds*1e3+EPOCH_START);return date};utils.getREXSecondsFromDate=function(date){return(date.getTime()-EPOCH_START)/1e3};utils.getREXNanosecondsFromDate=function(date){return(date.getTime()-EPOCH_START)*1e6};utils.getDateFromREXNanoseconds=function(ns){return new Date(ns/1e6+EPOCH_START)};utils.str2time=function(str){if(str.indexOf(":")===-1){return Number.NaN}var timearr=str.split(":");if(timearr.length===2){return Number(timearr[0])*3600+Number(timearr[1])*60}if(timearr.length===3){return Number(timearr[0])*3600+Number(timearr[1])*60+Number(timearr[2])}else{return Number.NaN}};utils.time2str=function(totSec,format){if(totSec<0){totSec=3600*24+totSec}var hours=parseInt(totSec/3600)%24;var minutes=parseInt(totSec/60)%60;var seconds=totSec%60;seconds=utils.round(seconds,4);var result=(hours<10?"0"+hours:hours)+":"+(minutes<10?"0"+minutes:minutes);if(format&&format.toLowerCase()==="hh:mm:ss"){result+=":"+(seconds<10?"0"+seconds:seconds)}return result};utils.date2str=function(date){var curr_date=date.getDate();var curr_month=date.getMonth()+1;var curr_year=date.getFullYear();return curr_year+"-"+(curr_month<10?"0"+curr_month:curr_month)+"-"+(curr_date<10?"0"+curr_date:curr_date)};utils.parseBoolean=function(string){if(!string){return false}if(typeof string==="boolean"){return string}if(typeof string==="string"){switch(string.toLowerCase()){case"false":case"no":case"0":case"":return false;default:return true}}return false};utils.check=function(value,defaultVal){return typeof value==="undefined"?defaultVal:value};utils.checkNumber=function(value,defaultVal){if(typeof value==="undefined"){return defaultVal}if(utils.isNumber(value)){return parseFloat(value)}let value2=parseFloat((""+value).replace(",","."));if(utils.isNumber(value2)){return value2}else{log.debug("Parameter "+value+" is not number, using defaultValue");return defaultVal}};utils.createID=function(name){var sdiak="áäčďéěíĺľňóôőöŕšťúůűüýřžÁÄČĎÉĚÍĹĽŇÓÔŐÖŔŠŤÚŮŰÜÝŘŽ ()[]{}";var bdiak="aacdeeillnoooorstuuuuyrzAACDEEILLNOOOORSTUUUUYRZ-------";var id="";for(var i=0;i<name.length;i++){var ind=sdiak.indexOf(name.charAt(i));if(ind!==-1){id+=bdiak.charAt(ind)}else{id+=name.charAt(i)}}return id};utils.color2RGBA=function(color){try{var div=document.createElement("div");div.style.color=color;var colors=window.getComputedStyle(document.body.appendChild(div)).color.match(/\d+/g).map(function(a){return parseInt(a,10)});document.body.removeChild(div);return{r:colors[0],g:colors[1],b:colors[2],a:colors[3]||1}}catch(e){return{r:0,g:0,b:0,a:1}}};utils.hexToRgb=function(hex){var bigint=parseInt(hex,16);var r=bigint>>16&255;var g=bigint>>8&255;var b=bigint&255;return{r:r,g:g,b:b}};utils.isBright=function(color){if(typeof color==="string"){color=utils.color2RGBA(color)}let a=1;if(typeof color==="object"){a=1-(.299*color.r+.587*color.g+.114*color.b)/255}return a<.5};utils.crlf2br=function(str){return str.replace(/(?:\r\n|\r|\n|\\n)/g,"<br />")};utils.getJsonFromUrl=function(hashBased){var query;if(hashBased){var pos=location.href.indexOf("?");if(pos==-1){return[]}query=location.href.substr(pos+1)}else{query=location.search.substr(1)}var result={};query.split("&").forEach(function(part){if(!part){return}part=part.split("+").join(" ");var eq=part.indexOf("=");var key=eq>-1?part.substr(0,eq):part;var val=eq>-1?decodeURIComponent(part.substr(eq+1)):"";var from=key.indexOf("[");if(from==-1){result[decodeURIComponent(key)]=val}else{var to=key.indexOf("]",from);var index=decodeURIComponent(key.substring(from+1,to));key=decodeURIComponent(key.substring(0,from));if(!result[key]){result[key]=[]}if(!index){result[key].push(val)}else{result[key][index]=val}}});return result};utils.getColor=function(colorName){if(this.CONSTANTS.COLORS[colorName]){return this.CONSTANTS.COLORS[colorName]}else if(colorName==="text-on-primary"){return this.CONSTANTS.COLORS.textOnPrimary}else if(colorName==="text-on-inactive"){return this.CONSTANTS.COLORS.textOnInactive}else{return colorName}};utils.getKeyByValue=function(object,value){return Object.keys(object).find(key=>object[key]===value)};utils.isBrowserOnRPi=function(){return navigator.userAgent.indexOf("Raspbian Chromium")>=0};module.exports=utils},{"../../rex-graphics/dist/js/Constants.js":99,"../utils/Logger.js":131,"./Constants.js":127}],135:[function(require,module,exports){"use strict";$.widget("wbd.column",$.wbd.component,{options:{},_create:function(){this._super();this.element.addClass("wbd-column")},_setOption:function(key,value){if(key==="title"||key==="desc"||key==="name"||key==="label"){var name=this.element.find(".wbd-column-title");if(name.length===0){this.element.prepend(['<div class="wbd-column-title"><h2>',value,"</h2></div>"].join(""))}else{name.find("h2").text(value)}}this._super(key,value)},addSection:function(section){section.addClass("wbd-section_"+(this.element.find(":wbd-section").length%4+1));this.element.append(section)}});$.widget("wbd.section",$.wbd.component,{options:{},_create:function(){this._super();this.element.addClass("wbd-section");this.element.attr("id",this.element.attr("id")||"wbd-c-"+this.options.column+"-s-"+$(":wbd-section").length);var row_data=this.options.rows;this.options.rows=[];for(var i=0;i<row_data.length;i++){this.addRow(row_data[i])}},_setOption:function(key,value){if(key==="title"||key==="desc"||key==="name"||key==="label"){var name=this.element.find(".wbd-section-title");if(name.length===0){this.element.prepend(['<div class="wbd-section-title"><h2>',value,"</h2></div>"].join(""))}else{name.find("h2").text(value)}}if(key==="background_color"){this.element.css("background-color",value)}if(key==="text_color"){this.element.find(".wbd-section-title").css("color",value)}this._super(key,value)},addRow:function(row_data){var row=$("<div></div>").row(row_data);row.attr("id",row.attr("id")||this.element.attr("id")+"-r-"+this.element.find(":wbd-row").length);this.element.append(row);this.options.rows.push(row);return row}})},{}],136:[function(require,module,exports){"use strict";var log=require("../utils/Logger.js").child({component:"webbudi"});var HMI=require("../hmi.js");$.widget("wbd.component",{options:{},_create:function(){this.element.addClass("wbd-component");var that=this;$.each(this.options,function(key,value){that._setOption(key,value)})},_setOption:function(key,value){var that=this;if(key==="hide_by"||key==="visibility"){this._super(key,this._bindItem(value,function(){that.element.hide()},function(){that.element.show()}))}if(key==="disable_by"||key==="state"){this._super(key,this._bindItem(value,function(){that.disable()},function(){that.enable()}))}this._super(key,value)},_bindItem:function(data,trueFcn,falseFcn){var item;if(typeof data==="string"){item=HMI.$i(data)}else{item=data.cstring?HMI.addItem(data.alias,data.cstring):HMI.$i(data.alias)}if(!item){log.error(this.options.desc+": Alias "+data+" not found!")}else{item.on("change",function(i){if(data.reverse_meaning){if(i.getValue()===0){trueFcn()}else{falseFcn()}}else{if(i.getValue()===0){falseFcn()}else{trueFcn()}}})}return item},disable:function(){this.element.disabler();this.element.disabler("disable");this.element.find(":wbd-row").row("disable");this.options.isDisabled=true},enable:function(){this.element.disabler();this.element.disabler("enable");this.element.find(":wbd-row").row("enable");this.options.isDisabled=false},isDisabled:function(){return this.options.isDisabled}})},{"../hmi.js":112,"../utils/Logger.js":131}],137:[function(require,module,exports){"use strict";var itemIdIndex=0;var utils=require("../utils/utils.js");var log=require("../utils/Logger.js").child({component:"webbudi"});var State=require("../utils/Constants.js").State;var HMI=require("../hmi.js");var AnalogLookupTable=require("./widget/AnalogLookupTable.js");var AnalogReadRow=require("./widget/AnalogReadRow.js");var AnalogWriteRow=require("./widget/AnalogWriteRow.js");var DigitalReadRow=require("./widget/DigitalReadRow.js");var DigitalWriteRow=require("./widget/DigitalWriteRow.js");var LinkButton=require("./widget/LinkButton.js");var ManualPulseRow=require("./widget/ManualPulseRow.js");var PushButton=require("./widget/PushButton.js");var EmptySpace=require("./widget/EmptySpace.js");$.widget("wbd.row",$.wbd.component,{options:{},_create:function(){if(this.options.options){$.extend(this.options,this.options.options);delete this.options.options}this._super();this.element.addClass("wbd-row");if(!this.options.type){log.debug("Row type is not defined, assume as empty space.")}if(this.options.name){this._setOption("desc",this.options.name);delete this.options.name}if(this.options.type&&this.options.type.toUpperCase()!=="ES"&&this.options.type.toUpperCase()!=="LINK"){if(!this.options.alias){if(!this.options.desc){log.error("Neither alias nor description is defined! Cannot create row");this.element.addClass("ui-state-error");return this}this._setOption("alias",utils.createID(this.options.desc))}if(!this.options.desc){this._setOption("desc",this.options.alias)}}this._createRow();if(this.options.item&&this.options.item.state!==State.ONLINE){this.disable()}else{if(this.options.refresh_from&&this.options.item.refresh_from!==State.ONLINE){this.disable()}}},_setOption:function(key,value){if(key==="desc"){this.element.find(".wbd-row-label").text(value)}this._super(key,value)},_initItem:function(type){if(this.options.alias.indexOf(" ")!==-1){log.error(this.options.desc+": Alias "+this.options.alias+" must not contain spaces!");return}this.options.item=HMI.$i(this.options.alias);if(this.options.item&&this.options.cstring&&this.options.item.cstring!==this.options.cstring){log.error(this.options.desc+": Alias "+this.options.alias+" already defined! Must be unique!");this.options.item=null;return}if(this.options.item&&type==="W"&&!this.options.item.write){log.error(this.options.desc+": Alias "+this.options.alias+" item is not writable!");this.options.item=null;return}this.options.id=this.options.item?this.options.alias+"-"+itemIdIndex++:this.options.alias;if(!this.options.item&&!this.options.cstring){if(!this.options.cstring){log.error(this.options.desc+": Cannot create an item. There is no connection string for alias "+this.options.alias);return}}if(!this.options.item){this.options.item=HMI.addItem({alias:this.options.alias,cstring:this.options.cstring})}if(type==="W"){this._initRefreshItem()}this.options.item.on("state",itm=>{if(itm.state===State.ONLINE){this.enable()}else{this.disable()}})},_initRefreshItem:function(){if(this.options.no_refresh){this.options.refresh_from=null;return}if(!this.options.refresh_from){if(!this.options.item){log.error(this.options.desc+": Cannot create an update item because either alias nor refresh_from is not defined.");return}this.options.refresh_from=this.options.item}else{var refItm=this.options.refresh_from;if(typeof refItm==="string"){this.options.refresh_from=HMI.$i(refItm);if(!this.options.refresh_from){log.error(this.options.desc+": Refresh item alias "+refItm+" is not defined!");return}}else{if(!refItm.alias){log.error(this.options.desc+": Refresh item alias is not defined");return}if(refItm.alias&&refItm.alias.indexOf(" ")!==-1){log.error(this.options.desc+": Refresh item alias "+refItm.alias+" must not contain spaces!");return}this.options.refresh_from=HMI.$i(refItm.alias);if(this.options.refresh_from&&refItm.cstring&&this.options.refresh_from.cstring!==refItm.cstring){log.error(this.options.desc+": Refresh item alias "+refItm.alias+" already defined! Must be unique!");return}if(!this.options.refresh_from&&!refItm.cstring){log.error(this.options.desc+": Cannot create an update item. There is no connection string for alias "+this.options.refresh_from.alias);return}if(!this.options.refresh_from){this.options.refresh_from=HMI.addItem({alias:refItm.alias,cstring:refItm.cstring})}}}this.options.refresh_from.on("state",itm=>{if(itm.state===State.ONLINE){this.enable()}else{this.disable()}})},_createRow:function(){this.element.append($('<div class="wbd-row-desc">'+this.options.desc+"</div>"));switch(this.options.type){case"AR":this._initItem("R");if(!this.options.item){this.element.addClass("ui-state-error");return}AnalogReadRow(this);break;case"DR":this._initItem("R");if(!this.options.item){this.element.addClass("ui-state-error");return}DigitalReadRow(this);break;case"AW":this._initItem("W");if(!this.options.item){this.element.addClass("ui-state-error");return}AnalogWriteRow(this);break;case"ALT":this._initItem("W");if(!this.options.item){this.element.addClass("ui-state-error");return}AnalogLookupTable(this);break;case"DW":this._initItem("W");if(!this.options.item){this.element.addClass("ui-state-error");return}DigitalWriteRow(this);break;case"MPRpt":case"MP":this.options.no_refresh=true;this._initItem("W");if(!this.options.item){this.element.addClass("ui-state-error");return}ManualPulseRow(this);break;case"PB":this.options.no_refresh=true;this._initItem("W");if(!this.options.item){this.element.addClass("ui-state-error");return}PushButton(this);break;case"ES":EmptySpace(this);break;case"LINK":LinkButton(this);break;default:this.element.empty();break}}})},{"../hmi.js":112,"../utils/Constants.js":127,"../utils/Logger.js":131,"../utils/utils.js":134,"./widget/AnalogLookupTable.js":139,"./widget/AnalogReadRow.js":140,"./widget/AnalogWriteRow.js":141,"./widget/DigitalReadRow.js":142,"./widget/DigitalWriteRow.js":143,"./widget/EmptySpace.js":144,"./widget/LinkButton.js":145,"./widget/ManualPulseRow.js":146,"./widget/PushButton.js":147}],138:[function(require,module,exports){"use strict";require("./Component.js");require("./Column.js");require("./Row.js");var HMI=require("../hmi.js");var log=require("../utils/Logger.js").child({component:"webbudi"});class WebBuDi{constructor(){this.ROUND_CONSTANT=1e4;this.DEFAULT_DECIMALS=4;this.customDivID="";this.rootDiv=null}addSection(data){if(arguments.length>1){throw new Error("Only 1 parameter with object is expected")}data.column=data.column||1;if(this.rootDiv){this.rootDiv=$(this.rootDiv)}else{if(this.customDivID){this.rootDiv=$("#"+this.customDivID)}else{this.rootDiv=$("<div></div>");this.rootDiv.addClass("wbd-main");this.rootDiv.appendTo($("#content"))}}var column_div_id=this.customDivID?"wbd-column-"+this.customDivID+"-"+data.column:"wbd-column-"+data.column;var column_div=this.rootDiv.children("#"+column_div_id);if(column_div.length<=0){column_div=$("<div></div>").attr("id",column_div_id);column_div.addClass("wbd-column_"+(this.rootDiv.find(":wbd-column").length%3+1));column_div.appendTo(this.rootDiv).column()}var section=$("<div></div>").section(data);column_div.column("addSection",section);section.data("wbd-section").disable();return this}add(data){return this.addSection(data)}addItems(items){return HMI.addItems(items)}defineAliases(items){log.warn("REX.WebBuDi.defineAliases is deprecated. Use REX.WebBuDi.addItems instead!");return HMI.addItems(items)}setTitle(title){log.warn("REX.WebBuDi.setTitle is deprecated. Use REX.HMI.setTitle instead!");return HMI.setTitle(title)}setWsIP(url){log.warn("REX.WebBuDi.setWsIP is deprecated. Use REX.HMI.setTargetUrl instead!");return HMI.setTargetUrl(url)}setRefreshRate(period){log.warn("REX.WebBuDi.setRefreshRate is deprecated. Use REX.HMI instead!");return HMI.setRefreshRate(period)}connect(){log.warn("REX.WebBuDi.connect is deprecated. REX.HMI autoconnects to the target.")}addTrendSignal(opt){log.warn("REX.WebBuDi.addTrendSignal is deprecated. Use REX.HMI.Graph.addSignal instead!");return HMI.Graph.addSignal(opt)}setTrendSize(size){log.warn("REX.WebBuDi.setTrendSize is deprecated. Use REX.HMI.Graph.setSize instead!");return HMI.Graph.setSize(size)}}module.exports=new WebBuDi},{"../hmi.js":112,"../utils/Logger.js":131,"./Column.js":135,"./Component.js":136,"./Row.js":137}],139:[function(require,module,exports){"use strict";var utils=require("../../utils/utils.js");var log=require("../../utils/Logger.js").child({component:"webbudi"});var SlimSelect=require("slim-select");function AnalogLookupTable(row){var slimSelect=null;$(row.element).addClass("wbd-alt");let select=$(document.createElement("select"));select.addClass("wbd-input rex__input rex__select");select.attr("id","ALT-"+row.options.id);let $el=$(row.element);$el.append(select);if(utils.isBrowserOnRPi()){select.addClass("wbd-input-slimselect");select.removeClass("rex__input");slimSelect=new SlimSelect({select:select.get(0),showSearch:false})}let showKey=utils.check(row.options.show_key,false);let refresh_from=row.options.refresh_from||row.options.item;refresh_from.on("change",refresh);for(var key in row.options.values){if(row.options.values.hasOwnProperty(key)){var option=$("<option></option>").attr("value",Number(key)).appendTo(select);if(showKey){option.html(key+": "+row.options.values[key])}else{option.html(row.options.values[key])}}}select.change(function(){log.debug(row.options.id+": "+select.find("option:selected").text());row.options.item.write(Number(select.val())).catch(err=>{log.error(new Error(row.options.id+" writing failed! Probably R/O item!"));log.debug(err.err||err)})});function refresh(){let key=refresh_from.getValue();if(select.find('option[value="'+key+'"]').length>0){if(slimSelect){slimSelect.set(key)}else{select.val(key)}}else{var option=$("<option></option>").attr("value",key).appendTo(select);if(showKey&&row.options.values[key]){option.html(key+": "+row.options.values[key])}else{if(row.options.values[key]){option.html(row.options.values[key])}else{option.html(key)}}if(slimSelect){slimSelect.destroy();slimSelect=new SlimSelect({select:select.get(0),showSearch:false});slimSelect.set(key)}else{select.val(key)}}}}module.exports=AnalogLookupTable},{"../../utils/Logger.js":131,"../../utils/utils.js":134,"slim-select":90}],140:[function(require,module,exports){"use strict";var utils=require("../../utils/utils.js");function AnalogReadRow(row){var DEFAULT_DECIMALS=4;var format=row.options.format||"";var scale=utils.checkNumber(row.options.scale,1);var offset=utils.checkNumber(row.options.offset,0);var decimals=utils.checkNumber(row.options.decimals,DEFAULT_DECIMALS);var convert=row.options.convert||null;$(row.element).addClass("wbd-ar");let arDiv=$(document.createElement("div"));arDiv.addClass("wbd-ar-div wbd-input rex__input rex__input--read-only");arDiv.attr("id","AR-"+row.options.id);$(row.element).append(arDiv);let timeFormat=null;row.options.item.on("change",function(itm){switch(format.toLowerCase()){case"date":arDiv.text(utils.date2str(utils.getDateFromREXSeconds(itm.value)));break;case"time":let totSeconds=itm.getValue()*scale+offset;totSeconds=utils.round(totSeconds,decimals);if(!timeFormat&&totSeconds%60!==0){timeFormat="hh:mm:ss"}arDiv.text(utils.time2str(totSeconds,timeFormat));break;case"datetime":let date=utils.getDateFromREXSeconds(itm.getValue());var secs=date.getSeconds()+60*(date.getMinutes()+60*date.getHours());arDiv.text(utils.date2str(date)+" "+utils.time2str(secs));break;case"text":let value=itm.getValue();if(value instanceof Object){value=JSON.stringify(value)}arDiv.text(value);break;default:if(convert&&$.isFunction(convert)){arDiv.text(""+convert(itm.getValue()))}else{let resultValue=itm.value*scale+offset;resultValue=utils.round(resultValue,decimals);arDiv.text(""+resultValue)}break}})}module.exports=AnalogReadRow},{"../../utils/utils.js":134}],141:[function(require,module,exports){"use strict";var utils=require("../../utils/utils.js");var log=require("../../utils/Logger.js").child({component:"webbudi"});function AnalogWriteRow(row){var DEFAULT_DECIMALS=4;var format=(row.options.format||"").toLowerCase();var min=utils.checkNumber(row.options.min,-Number.MAX_VALUE);var max=utils.checkNumber(row.options.max,Number.MAX_VALUE);var scale=utils.checkNumber(row.options.scale,1);var offset=utils.checkNumber(row.options.offset,0);var decimals=utils.checkNumber(row.options.decimals,DEFAULT_DECIMALS);var setOnBlur=row.options.set_on_blur||false;var convert=row.options.convert||null;var convertW=row.options.convert_W||null;$(row.element).addClass("wbd-aw");let refresh_from=row.options.refresh_from||row.options.item;refresh_from.on("change",refresh);let input=$(document.createElement("input"));input.addClass("wbd-input rex__input rex__input--default");input.attr("id","AW-"+row.options.id);input.attr("type","text");$(row.element).append(input);let inputTime=null;let timeFormat=null;var old_disable=row.disable;row.disable=function(){old_disable.apply(this,arguments);input.attr("disabled",true);if(inputTime){inputTime.attr("disabled",true)}};var old_enable=row.enable;row.enable=function(){old_enable.apply(this,arguments);input.removeAttr("disabled");if(inputTime){inputTime.removeAttr("disabled")}};function pressEnterKey(){var e=$.Event("keypress");e.which=13;e.keyCode=13;input.trigger(e)}let keyboardOptions={accepted:pressEnterKey};switch(format){case"date":input.attr("type","date");input.on("change",pressEnterKey);utils.initKeyboard(input,keyboardOptions);break;case"time":input.attr("type","time");input.on("change",pressEnterKey);utils.initKeyboard(input,keyboardOptions);break;case"datetime":input.attr("type","date");utils.initKeyboard(input,keyboardOptions);inputTime=$(document.createElement("input"));inputTime.addClass("wbd-input rex__input rex__input--default");inputTime.attr("id","AW-t-"+row.options.id);inputTime.attr("type","time");utils.initKeyboard(inputTime,keyboardOptions);let wrapper=$(document.createElement("div"));wrapper.attr("id","AW-wrapper-"+row.options.id);wrapper.addClass("wbd-aw-wrapper");wrapper.append(input);wrapper.append(inputTime);$(row.element).append(wrapper);input.on("change",pressEnterKey);inputTime.on("change",pressEnterKey);break;case"text":utils.initKeyboard(input,keyboardOptions);break;default:utils.initKeyboard(input,keyboardOptions,"number");break}function onFocus(){row.options.item.disableRefresh=true}function onBlur(){if(setOnBlur){var e=$.Event("keypress");e.which=13;e.keyCode=13;input.trigger(e)}row.options.item.disableRefresh=false;refresh()}function writeFailed(err){log.error(new Error(row.options.id+" writing failed! Probably R/O item!"));log.debug(err.err||err)}input.focus(onFocus).blur(onBlur);if(inputTime){inputTime.focus(onFocus).blur(onBlur);inputTime.keypress(function(evt){var keyCode=evt.keyCode||evt.which;if(keyCode===13){var e=$.Event("keypress");e.which=13;e.keyCode=13;input.trigger(e)}});inputTime.keyup(function(evt){var keyCode=evt.keyCode||evt.which;if(keyCode===27){var setOnBlurTmp=setOnBlur;setOnBlur=false;inputTime.blur();setOnBlur=setOnBlurTmp}})}input.keypress(function(evt){var keyCode=evt.keyCode||evt.which;if(keyCode===13){let value=input.val();switch(format){case"text":let text=value;log.debug(row.options.id+": "+text);row.options.item.write(text).catch(writeFailed);updateRefreshFromItemAfterWrite();break;case"date":if(!value){return}let date=utils.getREXSecondsFromDate(new Date(value));log.debug(row.options.id+": "+date);row.options.item.write(date).catch(writeFailed);updateRefreshFromItemAfterWrite();break;case"time":if(!value){return}let tmpDate=new Date("2000-01-01 "+value);let time=tmpDate.getSeconds()+60*(tmpDate.getMinutes()+60*tmpDate.getHours());log.debug(row.options.id+": "+time);row.options.item.write(time).catch(writeFailed);updateRefreshFromItemAfterWrite();break;case"datetime":if(!value||!inputTime.val()){return}let datetime=utils.getREXSecondsFromDate(new Date(value+" "+inputTime.val()));log.debug(row.options.id+": "+datetime);row.options.item.write(datetime).catch(writeFailed);updateRefreshFromItemAfterWrite();break;default:let numberStr=value.replace(",",".");if(utils.isNumber(numberStr)){var number=Number(numberStr);if(number>=min&&number<=max){input.removeClass("rex__input--error");if(!row.options.isDisabled){if(convertW&&$.isFunction(convertW)){number=convertW(number)}else{number=(number-offset)/scale}log.debug(row.options.id+": "+number);row.options.item.write(number).catch(writeFailed);updateRefreshFromItemAfterWrite()}}else{input.addClass("rex__input--error");return}}else{input.addClass("rex__input--error")}break}}});input.keyup(function(evt){var keyCode=evt.keyCode||evt.which;if(keyCode===27){var setOnBlurTmp=setOnBlur;setOnBlur=false;input.blur();setOnBlur=setOnBlurTmp}});function updateRefreshFromItemAfterWrite(){if(row.options.refresh_from){row.options.refresh_from.setValue(row.options.item.getValue())}}function refresh(){let value=row.options.refresh_from.getValue();switch(format){case"date":input.val(utils.date2str(utils.getDateFromREXSeconds(value)));break;case"time":var totSeconds=value;if(!timeFormat&&totSeconds%60!==0){timeFormat="hh:mm:ss";input.attr("step",1)}input.val(utils.time2str(totSeconds,timeFormat));break;case"datetime":let date=utils.getDateFromREXSeconds(value);var secs=date.getSeconds()+60*(date.getMinutes()+60*date.getHours());input.val(utils.date2str(date));inputTime.val(utils.time2str(secs));break;case"text":input.val(""+value);break;default:if(convert&&$.isFunction(convert)){input.val(convert(value))}else{var resultValue=value*scale+offset;resultValue=utils.round(resultValue,decimals);input.val(""+resultValue)}break}}}module.exports=AnalogWriteRow},{"../../utils/Logger.js":131,"../../utils/utils.js":134}],142:[function(require,module,exports){"use strict";var CONSTANTS=require("../../utils/Constants.js");var utils=require("../../utils/utils.js");function DigitalReadRow(row){var options=row.options;let reverseMeaning=utils.check(options.reverse_meaning,false);let labelColorFalse=utils.getColor(utils.check(options.label_color_false,"textOnInactive"));let labelColorTrue=utils.getColor(utils.check(options.label_color_true,"textOnPrimary"));let labelFalse=utils.check(options.label_false,reverseMeaning?"OFF(1)":"OFF(0)");let labelTrue=utils.check(options.label_true,reverseMeaning?"ON(0)":"ON(1)");let colorFalse=utils.getColor(utils.check(options.color_false,"inactive"));let colorTrue=utils.getColor(utils.check(options.color_true,"primary"));$(row.element).addClass("wbd-dr");let button=$(document.createElement("button"));button.addClass("mdc-button mdc-button--unelevated wbd-button wbd-dr-button");button.attr("id","DR_"+row.options.id);button.html("---");$(row.element).append(button);var old_disable=row.disable;row.disable=function(){old_disable.apply(this,arguments);button.attr("disabled",true);button.css("background",CONSTANTS.COLORS.background);button[0].style.setProperty("color","#000000","important")};var old_enable=row.enable;row.enable=function(){old_enable.apply(this,arguments);button.removeAttr("disabled");refresh()};function changeButtonState(state){if(state){button.css("background",colorTrue);button[0].style.setProperty("color",labelColorTrue,"important");button.html(labelTrue)}else{button.css("background",colorFalse);button[0].style.setProperty("color",labelColorFalse,"important");button.html(labelFalse)}}function refresh(){if(row.isDisabled()){return}let value=row.options.item.getValue();if(value){changeButtonState(!reverseMeaning)}else{changeButtonState(reverseMeaning)}}row.options.item.on("change",refresh)}module.exports=DigitalReadRow},{"../../utils/Constants.js":127,"../../utils/utils.js":134}],143:[function(require,module,exports){"use strict";var CONSTANTS=require("../../utils/Constants.js");var utils=require("../../utils/utils.js");var log=require("../../utils/Logger.js").child({component:"webbudi"});function DigitalWriteRow(row){var options=row.options;let reverseMeaning=utils.check(options.reverse_meaning,false);let labelColorFalse=utils.getColor(utils.check(options.label_color_false,"textOnInactive"));let labelColorTrue=utils.getColor(utils.check(options.label_color_true,"textOnPrimary"));let labelFalse=utils.check(options.label_false,reverseMeaning?"OFF(1)":"OFF(0)");let labelTrue=utils.check(options.label_true,reverseMeaning?"ON(0)":"ON(1)");let colorFalse=utils.getColor(utils.check(options.color_false,"inactive"));let colorTrue=utils.getColor(utils.check(options.color_true,"primary"));let flip=utils.check(options.flip,false);$(row.element).addClass("wbd-dw");let buttons=[];buttons[0]=$(document.createElement("button"));buttons[0].addClass("mdc-button mdc-button--raised wbd-button wbd-dw-button");buttons[0].attr("id","DO_0_"+row.options.id);buttons[0].html(labelFalse);buttons[1]=$(document.createElement("button"));buttons[1].addClass("mdc-button mdc-button--raised wbd-button wbd-dw-button");buttons[1].attr("id","DO_1_"+row.options.id);buttons[1].html(labelTrue);if(flip){$(row.element).append(buttons[1]);$(row.element).append(buttons[0])}else{$(row.element).append(buttons[0]);$(row.element).append(buttons[1])}var old_disable=row.disable;row.disable=function(){old_disable.apply(this,arguments);for(let button of buttons){button.attr("disabled",true);button.css("pointer-events","none");button.css("background",CONSTANTS.COLORS.background);button[0].style.setProperty("color","#000000","important")}};var old_enable=row.enable;row.enable=function(){old_enable.apply(this,arguments);for(let button of buttons){button.removeAttr("disabled");button.css("pointer-events","")}refresh()};let refresh_from=row.options.refresh_from||row.options.item;refresh_from.on("change",refresh);function changeButtonState(button,state){if(state){button.css("background",colorTrue);button[0].style.setProperty("color",labelColorTrue,"important");button.css("pointer-events","none")}else{button.css("background",colorFalse);button[0].style.setProperty("color",labelColorFalse,"important");button.css("pointer-events","")}}function refresh(){if(row.isDisabled()){return}let value=refresh_from.getValue();if(value){changeButtonState(buttons[0],reverseMeaning);changeButtonState(buttons[1],!reverseMeaning)}else{changeButtonState(buttons[0],!reverseMeaning);changeButtonState(buttons[1],reverseMeaning)}}for(let button of buttons){button.bind("touchstart mousedown",function(evt){evt.preventDefault();this.focus();if(evt.handled!==true){if(!(evt.button&&evt.button>0)){if(this===buttons[0].get(0)){row.options.item.write(reverseMeaning).catch(writeFailed)}else{row.options.item.write(!reverseMeaning).catch(writeFailed)}if(refresh_from!==row.options.item){refresh_from.setValue(row.options.item.getValue())}}}});button.bind("touchend touchcancel touchleave mouseup mouseleave",function(evt){evt.preventDefault();this.blur()})}function writeFailed(err){log.error(new Error(row.options.id+" writing failed! Probably R/O item!"));log.debug(err.err||err)}}module.exports=DigitalWriteRow},{"../../utils/Constants.js":127,"../../utils/Logger.js":131,"../../utils/utils.js":134}],144:[function(require,module,exports){"use strict";function EmptySpace(row){row.element.empty();$(row.element).addClass("wbd-es")}module.exports=EmptySpace},{}],145:[function(require,module,exports){"use strict";var CONSTANTS=require("../../utils/Constants.js");function LinkButton(row){var options=row.options;options.target_url=options.target_url||options.url||"";options.desc=options.desc||options.alias||"LINK";options.id=options.alias||(Math.random().toString(16)+"000000000").substr(2,8);options.label=options.label||options.desc;$(row.element).addClass("wbd-link");let button=$(document.createElement("button"));button.addClass("mdc-button mdc-button--raised wbd-button wbd-link");button.attr("id","LINK_"+row.options.id);button.css("background",CONSTANTS.COLORS.inactive);button[0].style.setProperty("color",CONSTANTS.COLORS.textOnInactive,"important");button.html(options.label);$(row.element).append(button);button.bind("touchend touchcancel mouseup",function(evt){evt.preventDefault();this.blur();window.location.href=options.target_url});row.disable=function(){button.removeAttr("disabled");return};row.enable=function(){button.removeAttr("disabled");return}}module.exports=LinkButton},{"../../utils/Constants.js":127}],146:[function(require,module,exports){"use strict";var utils=require("../../utils/utils.js");var CONSTANTS=require("../../utils/Constants.js");var log=require("../../utils/Logger.js").child({component:"webbudi"});function ManualPulseRow(row){var options=row.options;options.color=utils.check(options.color,CONSTANTS.COLORS.primary);options.label=options.label||options.desc;options.labelColor=utils.check(options.labelColor,CONSTANTS.COLORS.textOnPrimary);$(row.element).addClass("wbd-mp");let button=$(document.createElement("button"));button.addClass("mdc-button mdc-button--raised wbd-button");button.attr("id","MP_BTN_"+row.options.id);button.css("background",options.color);button[0].style.setProperty("color",options.labelColor,"important");button.html(row.options.label);$(row.element).append(button);var old_disable=row.disable;row.disable=function(){old_disable.apply(this,arguments);button.attr("disabled",true);button.css("pointer-events","none");button.css("background",CONSTANTS.COLORS.background);button[0].style.setProperty("color","#000000","important")};var old_enable=row.enable;row.enable=function(){old_enable.apply(this,arguments);button.removeAttr("disabled");button.css("pointer-events","");button.css("background",options.color);button[0].style.setProperty("color",options.labelColor,"important")};let pressed;function loopWrite(){row.options.item.write(true).then(()=>{setTimeout(()=>{if(pressed){loopWrite()}},20)}).catch(err=>{log.error(new Error(row.options.id+" writing failed! Probably R/O item!"));log.debug(err.err||err)})}button.bind("touchend touchcancel touchleave mouseup mouseout",function(evt){evt.preventDefault();pressed=false}).on("touchstart mousedown",function(evt){evt.preventDefault();pressed=true;if(options.type==="MPRpt"){loopWrite()}else{pressed=false;loopWrite()}log.debug(row.options.id+" pulse")})}module.exports=ManualPulseRow},{"../../utils/Constants.js":127,"../../utils/Logger.js":131,"../../utils/utils.js":134}],147:[function(require,module,exports){"use strict";var utils=require("../../utils/utils.js");var log=require("../../utils/Logger.js").child({component:"webbudi"});function PushButton(row){var options=row.options;let reverseMeaning=utils.check(options.reverse_meaning,false);let labelColorFalse=utils.getColor(utils.check(options.label_color_false,"textOnInactive"));let labelColorTrue=utils.getColor(utils.check(options.label_color_true,"textOnPrimary"));let labelFalse=utils.check(options.label_false,reverseMeaning?"OFF(1)":"OFF(0)");let labelTrue=utils.check(options.label_true,reverseMeaning?"ON(0)":"ON(1)");let colorFalse=utils.getColor(utils.check(options.color_false,"inactive"));let colorTrue=utils.getColor(utils.check(options.color_true,"primary"));let valueRelease=utils.check(options.value_release,reverseMeaning?1:0);let valuePress=utils.check(options.value_press,reverseMeaning?0:1);let refresh_from=row.options.refresh_from||row.options.item;refresh_from.on("change",refresh);$(row.element).addClass("wbd-pb");let button=$(document.createElement("button"));button.addClass("mdc-button mdc-button--raised wbd-button");button.attr("id","PB_BTN_"+row.options.id);$(row.element).append(button);var pressed=false;button.bind("touchstart mousedown",function(evt){evt.stopPropagation();evt.preventDefault();if(evt.handled!==true){if(!(evt.button&&evt.button>0)){log.debug(row.options.id+" "+evt.type);row.options.item.write(valuePress).catch(writeFailed);pressed=true}evt.handled=true}else{return false}}).bind("touchend touchcancel touchleave mouseup mouseout",function(evt){evt.stopPropagation();evt.preventDefault();if(evt.handled!==true){if(!(evt.button&&evt.button>0)&&pressed){row.options.item.write(valueRelease).catch(writeFailed);pressed=false}evt.handled=true}else{return false}});function refresh(){let value=refresh_from.getValue();if(value==valuePress){button.css("background",colorTrue);button[0].style.setProperty("color",labelColorTrue,"important");button.html(labelTrue)}else{button.css("background",colorFalse);button[0].style.setProperty("color",labelColorFalse,"important");button.html(labelFalse)}}function writeFailed(err){log.error(new Error(row.options.id+" writing failed! Probably R/O item!"));log.debug(err.err||err)}var old_disable=row.disable;row.disable=function(){old_disable.apply(this,arguments);button.attr("disabled",true);button.css("pointer-events","none");button.css("background",utils.CONSTANTS.COLORS.background);button[0].style.setProperty("color",utils.CONSTANTS.COLORS.textOnInactive,"important")};var old_enable=row.enable;row.enable=function(){old_enable.apply(this,arguments);button.removeAttr("disabled");button.css("pointer-events","");refresh()}}module.exports=PushButton},{"../../utils/Logger.js":131,"../../utils/utils.js":134}],148:[function(require,module,exports){"use strict";var log=require("../utils/Logger.js").child({component:"webwatch"});var IntParameter=require("./IntParameter.js");var BoolParameter=require("./BoolParameter.js");var DoubleParameter=require("./DoubleParameter.js");var StringParameter=require("./StringParameter.js");var EnumParameter=require("./EnumParameter.js");var WGroup=require("../group-management/WGroup.js");class BlockDialog{constructor(template,block){this.template=template;this.block=block;this.initDialog();this.block.dialog=this.dialog}createMarkup(){var title=this.block.id.split(".");title=title[title.length-1];this.dialog=$('<div id="'+this.template.name+"-"+this.block.id+'"></div>').dialog({autoOpen:false,title:title,width:300,maxHeight:$("#rex-dialog-container").height(),create:function(){$(window).resize(()=>{$(this).dialog("option","maxHeight",$("#rex-dialog-container").height())})},buttons:{OK:function(){if(writeDialogValues()){$(this).dialog("close")}},Apply:function(){writeDialogValues()},Close:function(){$(this).dialog("close")}},open:()=>{$errorLabel.hide();$(":button:contains('OK')").focus()}});$("body").append(this.dialog.parent());var $content=this.dialog;$content.append('<div class="rex-dialog-desc">'+this.template.description+"</div>");this.block.parameters=[];if(this.template.parameters!==undefined){for(let index in this.template.parameters){var param=this.template.parameters[index];var paramField=this.createParameter($content,this.block,param,this.block.id.replace(/\./g,"__")+"-"+index);this.block.parameters.push(paramField);$content.append("<br/>")}}if(this.template.helpUrl!==undefined){$content.append('<a href="'+this.template.helpUrl+'" target="_blanc"><img style="position: absolute;top:8px;right:6px;" width="16" src="images/rex-block/info.png" /></a>')}var $errorLabel=$("<div id='"+this.block.id+"-error' style='width:100%;color:white;text-align:center;background-color: #FF5925;font: 10pt Segoe UI;'>Unexpected type!</div>");$content.append($errorLabel);this.block.group.on("read",()=>{for(let p of this.block.parameters){p.readHandler()}});var writeDialogValues=()=>{var result=true;for(let param of this.block.parameters){var writeResult=param.writeHandler();param.errorHandler(!writeResult);if(!writeResult){result=false}}if(result===true){if(this.block.group.items.length>0){this.block.group.write().catch(err=>{if(err.msg&&err.msg.header.errno==-1){log.debug(err)}else{log.error(err)}})}$errorLabel.slideUp("fast")}else{$errorLabel.slideDown("fast")}return result}}createParameter(container,block,param,id){var type=param.type;if(param.type==="long"&&param["enum"]!==undefined){type="enum"}switch(type){case"word":case"byte":case"long":return new IntParameter(container,block,param,id);case"double":return new DoubleParameter(container,block,param,id);case"string":return new StringParameter(container,block,param,id);case"enum":return new EnumParameter(container,block,param,id);case"bool":return new BoolParameter(container,block,param,id);default:return}}initDialog(){this.block.group=new WGroup({id:this.block.type+"-"+this.block.id+"-group"});this.block.group.periodReadEnabled=false;this.createMarkup()}}module.exports=BlockDialog},{"../group-management/WGroup.js":107,"../utils/Logger.js":131,"./BoolParameter.js":149,"./DoubleParameter.js":150,"./EnumParameter.js":152,"./IntParameter.js":153,"./StringParameter.js":155}],149:[function(require,module,exports){"use strict";var Parameter=require("./Parameter.js");class BoolParameter extends Parameter{constructor(container,block,param,id){super(container,block,param,id)}createMarkup(container){super.createMarkup(container);var $a=$("<div  title='"+this.tooltip+"' id="+this.id+">"+"<input  value='1' type='radio' id="+this.id+"-on"+" name="+this.id+"radio"+" /><label for="+this.id+"-on"+">ON</label>"+"<input  value='0' type='radio' id="+this.id+"-off"+" name="+this.id+"radio"+" /><label for="+this.id+"-off"+">OFF</label>"+"</div>");$a.controlgroup();$a.find("input").checkboxradio({icon:false});$a.find("label").css("min-width","30px");container.append($a)}readHandler(){if(this.data.value===1){$("#"+this.id+"-on").prop("checked",true).checkboxradio("refresh")}else{$("#"+this.id+"-off").prop("checked",true).checkboxradio("refresh")}this.errorHandler(false)}writeHandler(){this.data.value=$("#"+this.id+"-on").prop("checked");return true}}module.exports=BoolParameter},{"./Parameter.js":154}],150:[function(require,module,exports){"use strict";var utils=require("../utils/utils.js");var IntParameter=require("./IntParameter.js");class DoubleParameter extends IntParameter{constructor(container,block,param,id){super(container,block,param,id)}writeHandler(){var value=$("#"+this.id).val();if(utils.isReal(value,this.param.min,this.param.max)){this.data.value=parseFloat(value);return true}else{return false}}}module.exports=DoubleParameter},{"../utils/utils.js":134,"./IntParameter.js":153}],151:[function(require,module,exports){"use strict";var hmi=require("../hmi.js");var log=require("../utils/Logger.js").child({component:"webwatch"});var Timer=require("../utils/Timer.js");var utils=require("../utils/utils.js");var SubSystem=require("./SubSystem.js");var BlockDialog=require("./BlockDialog.js");var TRNDDialog=require("./TRNDDialog.js");var Group=require("../group-management/Group.js");var EventEmitter=require("../utils/EventEmitter.js");var DECIMALS=3;var HINT_PERIOD=1e4;var State={NONE:0,READY:1,CONNECTED:2,DISCONNECTED:3,FAILED:4};var init=true;class Engine extends EventEmitter{constructor(){super();this._blocks=[];this._displays=[];this._taskName=null;this._svg=null;this._showHint=true;this._blockInfo={};hmi.once("init",()=>{this.State=State.CONNECTED;if(this._blockInfo){this.emit("online")}})}processSvg(svg){if(svg===undefined||!svg.is("svg")){log.error("Given element is not jQuery and SVG element");return}this._svg=svg;this._displays=[];this._recursivProcessing(this._svg[0]);this._taskname=$(this._svg[0]).attr("id");this._initDisplays();if(this.State===State.CONNECTED){log.info("Connection established. Press right mouse button on block to start reading values.");if(this._showHint){this.showHint()}if(this._blockInfo){this.emit("online")}}}disableHint(){this._showHint=false}showHint(){var hint=$("#rex-watch-hint");if(hint.length===0){hint=$(['<div id="rex-watch-hint">',"<strong>Left</strong> click or <strong>Touch</strong> on block to open dialog <br />","<strong>Right</strong> click or <strong>Long press</strong> to start reading the block.","</div>"].join("")).appendTo("body")}hint.show().fadeOut(HINT_PERIOD);hint.on("click",evt=>{hint.hide()})}setBlockInfo(blockInfo){this._blockInfo=blockInfo;if(this.State===State.CONNECTED){this.emit("online")}}enableMonitoring(blockIDs){if(!Array.isArray(blockIDs)){blockIDs=[blockIDs]}for(let bID of blockIDs){let found=false;for(let block of this._blocks){if(bID===block.id){if(block.toggleMonitorFcn){this.on("online",()=>{if(block.monitor){block.toggleMonitorFcn()}})}found=true;break}}if(!found){log.error("Block ID {0} not found!",bID)}}this.disableHint()}_recursivProcessing(element){for(let elName in element.childNodes){var el=element.childNodes[elName];if(el.getAttribute!==undefined){var block_type=el.getAttribute("rex-block-type");if(block_type){var block={element:el,id:el.getAttribute("id"),escapedId:el.getAttribute("id").replace(/\./g,"-"),type:block_type,orientation:el.getAttribute("rex-orientation"),monitor:false,toggleDialogFcn:null,toggleMonitorFcn:null};this._blocks.push(block);if(block.type==="Display"){this._displays.push(block)}if("ontouchstart"in document.documentElement){((element,block)=>{var clickHandler=this._getClickHandler(block);var toggleHandler=this._getToggleMonitoringHandler(block);var cancelUp=false;var timer=new Timer(()=>{toggleHandler();timer.stop();cancelUp=true});timer.Initial=false;element.addEventListener("touchstart",e=>{e.preventDefault();timer.start(1e3)},false);element.addEventListener("touchend",e=>{e.preventDefault();timer.stop();if(!cancelUp){clickHandler(e)}cancelUp=false},false)})(el,block)}if(block.type!=="Display"){el.addEventListener("click",this._getClickHandler(block),false);el.addEventListener("contextmenu",this._getToggleMonitoringHandler(block),false)}el.addEventListener("mouseover",(block=>{return()=>{utils.appendClass(block.element,"rex-block-hover")}})(block),false);el.addEventListener("mouseout",(block=>{return()=>{utils.removeClass(block.element,"rex-block-hover")}})(block),false)}}if(el.childNodes){this._recursivProcessing(el)}}}_getClickHandler(block){var toggleDialogFcn=evt=>{if(this.State!==State.CONNECTED){return}if(!block.dialog){this._createDialog(block,evt).then(()=>{if(block.group){hmi.addGroup(block.group)}if(block.trend){hmi.addTrend(block.trend)}block.dialog.dialog("open")}).catch(err=>{log.warn(err)})}else if(block.type==="TRND"||block.type==="TRNDV"){block._dialog.startPeriodicReading(hmi._defaultRefreshRate);block.dialog.dialog("open")}else{if(block.group&&block.group.items.length>0){block.group.read().then(()=>{block.dialog.dialog("open")}).catch(()=>{log.warn(block.id+": Failed to load dialog data. Using old one!");block.dialog.dialog("open")})}else{block.dialog.dialog("open")}}if(evt){evt.preventDefault();evt.stopPropagation()}};block.toggleDialogFcn=toggleDialogFcn;return toggleDialogFcn}_getToggleMonitoringHandler(block){var toggleMonitorFcn=evt=>{if(this.State!==State.CONNECTED){return}if(!block.monitor){if(!block.monitoringGroup){var escapedId=block.id.replace(/\./g,"\\.");var inputs=$("#"+escapedId+" .rex-block-in");var outputs=$("#"+escapedId+" .rex-block-out");if(block.type==="CNB"||block.type==="CNI"||block.type==="CNR"||block.type==="CNE"||block.type==="CNS"||block.type==="CNA"){outputs.push($("#"+escapedId+" text")[1])}if(inputs&&inputs.length>0||outputs&&outputs.length>0){var monitorG=new Group({id:"mon-"+block.id,period:hmi._defaultRefreshRate});monitorG.isDefPeriod=true;monitorG.isDefURL=true;block.monitoringGroup=monitorG;monitorG.Label=[];block.monitorLabelGroup=document.createElementNS(utils.ns_svg,"g");block.element.appendChild(block.monitorLabelGroup);monitorG.on("periodic",(err,group)=>{if(err){log.error(err);group.stopPeriodicReading()}else{for(var i=0;i<group.Label.length;i++){var input=group.Label[i];if(group.items[i].type=="number"||group.items[i].type=="float"){input.textContent=utils.round(group.items[i].value,DECIMALS)}else{input.textContent=""+group.items[i].value}}}});var inCStrings=[];var outCStrings=[];if(this._blockInfo[block.type]!==undefined){var template=this._blockInfo[block.type];if(template.inPorts!==undefined){inCStrings=template.inPorts}if(template.outPorts!==undefined){outCStrings=template.outPorts}}else{for(let i=0;i<inputs.length;i++){inCStrings.push(inputs[i].textContent)}for(let i=0;i<outputs.length;i++){outCStrings.push(outputs[i].textContent)}}for(let i=0;i<inCStrings.length;i++){monitorG.addItem({id:block.id+"-mon-in-"+i,cstring:block.id+":"+inCStrings[i]});this._createLabel(block,inputs[i],"in")}for(let i=0;i<outCStrings.length;i++){monitorG.addItem({id:block.id+"-mon-out-"+i,cstring:block.id+":"+outCStrings[i]});this._createLabel(block,outputs[i],"out")}block.monitoringGroup.init().then(()=>{hmi.addGroup(block.monitoringGroup)}).catch(()=>{log.error(new Error("Failed to initialize group of items for block: "+block.id))});block.monitoringGroup.on("online",group=>{if(block.monitor){utils.appendClass(block.element,"rex-block-monitor");block.monitorLabelGroup.setAttribute("display","inline");block.monitoringGroup.startPeriodicReading()}})}}else{utils.appendClass(block.element,"rex-block-monitor");block.monitorLabelGroup.setAttribute("display","inline");block.monitoringGroup.startPeriodicReading()}block.monitor=true}else{if(block.monitoringGroup){utils.removeClass(block.element,"rex-block-monitor");block.monitorLabelGroup.setAttribute("display","none");block.monitoringGroup.stopPeriodicReading()}block.monitor=false}if(evt){evt.preventDefault();evt.stopPropagation()}};block.toggleMonitorFcn=toggleMonitorFcn;return toggleMonitorFcn}_initDisplays(){if(this._displays.length>0){if(!this._displaysG){this._displaysG=new Group({period:hmi._defaultRefreshRate});this._displaysG.Label=[]}for(let d of this._displays){d.monitorLabelGroup=document.createElementNS(utils.ns_svg,"g");d.element.appendChild(d.monitorLabelGroup);d.monitoringGroup=this._displaysG;d.monitorLabelGroup.setAttribute("display","inline");this._displaysG.addItem({cstring:d.id+":DispValue"});var label=$(d.element).find("tspan")[0];d.monitoringGroup.Label.push(label)}this._displaysG.on("periodic",(err,group)=>{if(!err){for(var i=0;i<group.Label.length;i++){var input=group.Label[i];input.textContent=group.items[i].value}}});this._displaysG.init().then(()=>{this._displaysG.isDefPeriod=true;this._displaysG.isDefURL=true;if(hmi.baseObjects.indexOf(this._displaysG)==-1){hmi.addGroup(this._displaysG)}}).catch(err=>{log.error(err)})}}_createLabel(block,pin,type){var monLabel=document.createElementNS(utils.ns_svg,"text");var x=parseFloat(pin.getAttribute("x"));var y=parseFloat(pin.getAttribute("y"));var family=pin.getAttribute("font-family");var size=pin.getAttribute("font-size");var fill=pin.getAttribute("fill");if(block.type==="CNB"||block.type==="CNI"||block.type==="CNR"||block.type==="CNE"){x+=3}else if(block.type==="CNS"||block.type==="CNA"){x+=7}if(type==="in"){if(block.orientation===0||block.orientation==="0"){x=x-12;y=y-size/2;monLabel.setAttribute("text-anchor","end")}else if(block.orientation===2||block.orientation==="2"){x=x+12;y=y-size/2;monLabel.setAttribute("text-anchor","start")}else if(block.orientation===1||block.orientation==="1"){y=y+10;monLabel.setAttribute("text-anchor","middle")}else if(block.orientation===3||block.orientation==="3"){y=y-10;monLabel.setAttribute("text-anchor","middle")}}else if(type==="out"){if(block.orientation===0||block.orientation==="0"){x=x+10;y=y-size/2;monLabel.setAttribute("text-anchor","start")}else if(block.orientation===2||block.orientation==="2"){x=x-10;y=y-size/2;monLabel.setAttribute("text-anchor","end")}else if(block.orientation===1||block.orientation==="1"){y=y+10;monLabel.setAttribute("text-anchor","middle")}else if(block.orientation===3||block.orientation==="3"){y=y-10;monLabel.setAttribute("text-anchor","middle")}}monLabel.setAttribute("x",x);monLabel.setAttribute("y",y);monLabel.setAttribute("font-family",family);monLabel.setAttribute("font-size",size);monLabel.setAttribute("fill",fill);block.monitorLabelGroup.appendChild(monLabel);block.monitoringGroup.Label.push(monLabel)}_createDialog(block){if(block.type==="SubSystem"){var $subSvg=$(document.getElementById("sub-"+block.id));new SubSystem($subSvg,block,this);return Promise.resolve()}else if(block.type==="TRND"||block.type==="TRNDV"){return new Promise((resolve,reject)=>{block._dialog=new TRNDDialog(this._blockInfo[block.type],block);block._dialog.init().then(()=>{block.dialog=block._dialog.dialog;block._dialog.startPeriodicReading(hmi._defaultRefreshRate);resolve()}).catch(err=>{reject(new Error("Failed to init trend "+block.id+". "+err))})})}else if(block.type==="Inport"||block.type==="Outport"){return Promise.reject("Dialog is not supported for this block!")}else if(this._blockInfo[block.type]!==undefined){new BlockDialog(this._blockInfo[block.type],block);if(block.group.items.length===0){return Promise.resolve()}if(block.dialog!==null&&block.dialog!==undefined){return block.group.init()}else{block.group=null;return Promise.reject("Failed to create dialog")}}else{if(Object.keys(this._blockInfo).length>0){alert("Dialog is not supported for this block!");return Promise.reject("Dialog is not supported for this block!")}else{alert("Information about block is not ready yet, try it later!");return Promise.reject("Information about block is not ready yet, try it later!")}}}}module.exports=new Engine},{"../group-management/Group.js":102,"../hmi.js":112,"../utils/EventEmitter.js":129,"../utils/Logger.js":131,"../utils/Timer.js":132,"../utils/utils.js":134,"./BlockDialog.js":148,"./SubSystem.js":156,"./TRNDDialog.js":157}],152:[function(require,module,exports){"use strict";var utils=require("../utils/utils.js");var Parameter=require("./Parameter.js");class EnumParameter extends Parameter{constructor(container,block,param,id){super(container,block,param,id)}createMarkup(container){super.createMarkup(container);container.append("<div class='rex-dialog-input' id='in-"+this.id+"'><select title='"+this.tooltip+"' id="+this.id+"/><img style='display:none;' src='images/rex-block/error.png'/></div>");var $select=$("#"+this.id);for(let index in this.param["enum"]){var text=this.param["enum"][index];var value=null;var tmp=text.split(":");if(tmp.length>1){value=parseInt(tmp[0])}$("<option />",{value:value,text:text}).appendTo($select)}}writeHandler(){var value=$("#"+this.id).val();if(utils.isInt(value,this.param.min,this.param.max)){this.data.value=parseInt(value);return true}return false}}module.exports=EnumParameter},{"../utils/utils.js":134,"./Parameter.js":154}],153:[function(require,module,exports){"use strict";var utils=require("../utils/utils.js");var Parameter=require("./Parameter.js");class IntParameter extends Parameter{constructor(container,block,param,id){super(container,block,param,id)}createMarkup(container){super.createMarkup(container);container.append("<div class='rex-dialog-input' id='in-"+this.id+"'><input title='"+this.tooltip+"' type='text' maxlength='10' id="+this.id+" class='text ui-widget-content ui-corner-all' /><img style='display:none;' src='images/rex-block/error.png'/></div>")}writeHandler(){var value=$("#"+this.id).val();if(utils.isInt(value,this.param.min,this.param.max)){this.data.value=parseInt(value);return true}else{return false}}}module.exports=IntParameter},{"../utils/utils.js":134,"./Parameter.js":154}],154:[function(require,module,exports){"use strict";var log=require("../utils/Logger.js").child({component:"webwatch"});class Parameter{constructor(container,block,param,id){this.param=param;this.id=id;this.block=block;this.container=container;block.group.addItem({id:id,cstring:block.id.replace(/__/g,".")+":"+param.name}).then(item=>{this.data=item}).catch(err=>{log.error(err)});this.tooltip=param.description===undefined?"":param.description;this.createMarkup(container)}createMarkup(container){container.append("<label for="+this.id+">"+this.param.label+"</label></br>")}readHandler(){$("#"+this.id).val(this.data.value);this.errorHandler(false)}writeHandler(){this.data.value=$("#"+this.id).val();return true}errorHandler(error){if(!error){$("#in-"+this.id).removeClass("rex-dialog-input-failed")}else{$("#in-"+this.id).addClass("rex-dialog-input-failed")}}}module.exports=Parameter},{"../utils/Logger.js":131}],155:[function(require,module,exports){"use strict";var Parameter=require("./Parameter.js");class StringParameter extends Parameter{constructor(container,block,param,id){super(container,block,param,id)}createMarkup(container){super.createMarkup(container);container.append("<div class='rex-dialog-input' id='in-"+this.id+"'><input title='"+this.tooltip+"' type='text' id="+this.id+" class='text ui-widget-content ui-corner-all' /><img style='display:none;' src='images/rex-block/error.png'/></div>")}}module.exports=StringParameter},{"./Parameter.js":154}],156:[function(require,module,exports){"use strict";class SubSystem{constructor(svg,block){this._svg=svg;this._block=block;this.createMarkup();this._block.dialog=this.dialog}createMarkup(){this.dialog=$('<div id="subsystem-'+this._block.id+'"></div>').dialog({autoOpen:false,title:this._block.id,width:$("#rex-dialog-container").height()-20,maxWidth:$("#rex-dialog-container").width()-20,maxHeight:$("#rex-dialog-container").height()-150});$("body").append(this.dialog.parent());this._svg.detach();this.dialog.append(this._svg);this._svg.css("display","inline")}}module.exports=SubSystem},{}],157:[function(require,module,exports){"use strict";var Graph=require("../ui/graph/Graph.js");var Trend=require("../group-management/Trend.js");var HMI=require("../hmi.js");class TRNDDialog{constructor(template,block){this.template=template;this.block=block;this.graph=null;this.trend=null}createMarkup(){var title=this.trend.trndCfg.title;var self=this;this.dialog=$(`<div id="${this.template.name}-${this.block.escapedId}" style="width=650px;height:300px"></div>`).dialog({autoOpen:false,title:title,create:()=>{},open:()=>{$(":button:contains('OK')").focus();$(this.dialog).find(".graph-graph").removeAttr("style");this.graph.resize()},width:690,height:500,minWidth:300,minHeight:300});this.dialog.on("dialogclose",()=>{this.stopPeriodicReading()});$("body").append(this.dialog.parent());var desc=$('<div class="rex-dialog-desc" style="margin-bottom:5px;">'+this.template.description+"</div>");var graphDiv=$('<div id="graph-'+this.block.escapedId+'" style="width:100%; height:calc(100% - 20px);"></div>');$(this.dialog).append(desc).append(graphDiv);this.graph=new Graph({id:this.block.escapedId,element:graphDiv[0]});$(this.dialog).find(".graph-graph").addClass("webwatch");$(this.dialog).find(".graph-labels").addClass("webwatch")}startPeriodicReading(period){if(this.trend){this.trend.startPeriodicReading(period)}}stopPeriodicReading(){if(this.trend){this.trend.stopPeriodicReading()}}init(){if(!this.trend){this.trend=new Trend({cstring:this.block.id});this.trend.once("init",()=>{this.createMarkup()});var trndID=null;this.trend.on("read",data=>{if(trndID===null){var cfg=this.trend.trndCfg;trndID=this.graph.data.addTrendConfig(cfg);if(cfg.samplecount){if(this.graph.data.maxBuffSize<cfg.samplecount){this.graph.data.maxBuffSize=cfg.samplecount}}}this.graph.data.addTrend(trndID,data);this.graph.refresh()});return this.trend.init()}return Promise.reject("Already initialized")}}module.exports=TRNDDialog},{"../group-management/Trend.js":106,"../hmi.js":112,"../ui/graph/Graph.js":118}],158:[function(require,module,exports){(function(global){"use strict";var events=require("events");var WebSock=global.WebSocket||global.MozWebSocket||require("ws");var cons=require("../utils/Constants.js");var Command=require("./Command.js");var CommandList=require("./CommandList.js");var log=require("../utils/Logger.js").child({component:"ws-client"});class Client extends events.EventEmitter{constructor(options){options=options||{};super(options);this._sock=null;this._url="unset";this._recvdata="";this.subProtocol="visualization-1.1";this.callbacks={};this.commands=new CommandList(this);this.setMaxListeners(0)}off(){this.removeListener.apply(this,arguments)}_onClose(){log.info("Connection closed.");this.emit("closed",this)}_onError(err){log.error({err:err},"WebSocket connection error")}_onMessage(msg){this.emit("heartbeat");if(typeof msg==="string"){let tmp=msg;msg={data:tmp}}if(this.subProtocol==="visualization-v1"){log.error("Unsupported subprotocol."+this.subProtocol)}else{this._parseMessage(msg)}}_parseMessage(msg){var inframe;try{inframe=JSON.parse(msg.data);if(!inframe.cmd||!inframe.header||inframe.header.id===undefined||!inframe.header.err||inframe.header.errno===undefined){throw new Error("Wrong format of incoming message.")}}catch(e){this.emit("err",new Error("Failed to parse message from server: "+e));log.debug({msg:msg},"Failed to parse message from server:"+e);return}if(inframe.header.errno>=0||inframe.header.err==="Success"){this.commands.resolveCmd(inframe.header.id,inframe)}else{this.commands.rejectCmd(inframe.header.id,inframe)}if(inframe.header.flags){this.emit("headerFlags",inframe.header.flags)}}connect(url){if(this.isConnected()){return Promise.reject("Already connected")}this._url=url;return new Promise((resolve,reject)=>{log.debug("Connecting to: "+url);this._sock=new WebSock(url,this.subProtocol);this._sock.onopen=(()=>{this._sock.onopen=(()=>{});this._sock.onerror=(evt=>{this._onError(evt)});this._sock.onclose=(evt=>{this._onClose(evt)});this._sock.onmessage=(msg=>{this._onMessage(msg)});log.info("Connected to: "+url);this.emit("connected");resolve()});this._sock.onerror=(err=>{log.error("Connecting to: %s failed. Check service availability and credentials!",this._url);reject(err)})})}reconnect(){if(this.isConnected()){return Promise.resolve("Already connected")}if(this._keepAliveTimer){clearTimeout(this._keepAliveTimer)}return new Promise((resolve,reject)=>{this.callbacks={};this.commands=new CommandList(this);log.info("Reconnecting to: "+this._url);this._sock=new WebSock(this._url,this.subProtocol);this._sock.onopen=(()=>{this._sock.onopen=(()=>{});this._sock.onerror=(evt=>{this._onError(evt)});this._sock.onclose=(evt=>{this._onClose(evt)});this._sock.onmessage=(msg=>{this._onMessage(msg)});log.info("Connected successfully to: "+this._url);this.emit("connected");resolve()});this._sock.onerror=(err=>{log.error("Connecting to: %s failed. Check service availability and credentials!",this._url);reject(err)})})}disconnect(){if(!this.isConnected()){if(this._sock){this._sock.onerror=(()=>{});this._sock.onclose=(()=>{});this._sock.close();this._sock=null}return Promise.resolve("Target "+this.url+" is not connected")}if(this._keepAliveTimer){clearTimeout(this._keepAliveTimer)}return new Promise((resolve,reject)=>{log.info("Disconnecting from: "+this._url);this._sock.onclose=(()=>{this.emit("disconnected");resolve()});this._sock.onerror=(err=>{log.debug("Failed to disconnect from target "+this.url+" .");reject(err)});this._sock.close()})}_makeAPICall(code,data){if(!this.isConnected()){return{promise:Promise.reject(new Error("Connection to  "+this._url+" lost."))}}var cmd=new Command(this._sock,code,data);this.commands.push(cmd);cmd.promise.catch(err=>{log.debug(err.err||err);this.commands.removeCmd(cmd.id)});return cmd}readItems(names){return this._makeAPICall(cons.CMD_READ_ITEMS,{names:names})}writeItems(names,values){return this._makeAPICall(cons.CMD_WRITE_ITEMS,{names:names,values:values})}addGroup(names){return this._makeAPICall(cons.CMD_ADD_GROUP,{names:names})}removeGroup(groupid){return this._makeAPICall(cons.CMD_REMOVE_GROUP,{groupid:groupid})}readGroup(groupid){return this._makeAPICall(cons.CMD_READ_GROUP,{groupid:groupid})}writeGroup(groupid,values){return this._makeAPICall(cons.CMD_WRITE_GROUP,{groupid:groupid,values:values})}idle(){return this._makeAPICall(cons.CMD_IDLE)}getVersion(){return this._makeAPICall(cons.CMD_VERSION)}getWhoami(){return this._makeAPICall(cons.CMD_WHO_AMI)}getTrendConfig(trend){return this._makeAPICall(cons.CMD_GET_TRND_CFG,{trend:trend})}readTrend(trendid){return this._makeAPICall(cons.CMD_TRND_READ,{trendid:trendid})}browseSymbol(symbol){return this._makeAPICall(cons.CMD_BROWSE_SYMBOL,{symbol:symbol})}names2ids(names){return this._makeAPICall(cons.CMD_NAMES_TO_IDS,{names:names})}getTime(){return this._makeAPICall(cons.CMD_GET_TIME,{})}isConnected(){if(!this._sock){return false}return this._sock.readyState===this._sock.OPEN}setSubProtocol(protocol){this.subProtocol=protocol}}module.exports=Client}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../utils/Constants.js":127,"../utils/Logger.js":131,"./Command.js":159,"./CommandList.js":160,events:16,ws:11}],159:[function(require,module,exports){"use strict";var log=require("../utils/Logger.js").child({component:"ws-client"});const MAX_ID=1e4;class Command{constructor(wsock,cmdCode,data,header){this.cmdCode=cmdCode;this.wsock=wsock;this.data=data||{};this.header=header||{};this.cmdTimer=null;this.msg="";this.promise=new Promise((resolve,reject)=>{this.resolve=resolve;this.reject=reject;if(!this.header.id){this.id=this.header.id=Command.getId()}var frame={cmd:this.cmdCode,header:this.header,data:this.data};this.msg=JSON.stringify(frame);this.wsock.send(this.msg)})}static getId(){if(!Command.requestNo||Command.requestNo>=MAX_ID){Command.requestNo=0}return Command.requestNo++}}module.exports=Command},{"../utils/Logger.js":131}],160:[function(require,module,exports){"use strict";var Command=require("./Command.js");var log=require("../utils/Logger.js").child({component:"ws-client"});var dgnConst=require("../utils/Constants.js");var events=require("events");class CommandList extends Array{constructor(evEmitter){super();this.evEmitter=evEmitter instanceof events.EventEmitter?evEmitter:{emit:()=>{}}}resolveCmd(id,msg){var cmd=this.getCmd(id);let result=msg.data;if(!cmd&&msg.header.id){log.debug("CMD "+msg.cmd+" id: "+msg.header.id+" does not exit!")}switch(msg.cmd){case dgnConst.CMD_INIT:{this.evEmitter.emit("init");if(cmd){cmd.resolve()}break}case dgnConst.CMD_EXIT:{this.evEmitter.emit("exit");if(cmd){cmd.resolve()}break}case dgnConst.CMD_IDLE:{this.evEmitter.emit("idle");if(cmd){cmd.resolve()}break}case dgnConst.CMD_VERSION:{this.evEmitter.rexVersionDetails=msg.data;this.evEmitter.rexVersion=msg.data.version.hi+"."+msg.data.version.lo+"."+msg.data.version.rel+"-"+msg.data.version.rev;this.evEmitter.emit("version",this.evEmitter.rexVersion);if(cmd){cmd.resolve(this.evEmitter.rexVersion)}break}case dgnConst.CMD_READ_ITEMS:{result.names=cmd.data.names;this.evEmitter.emit("read",result);if(cmd){cmd.resolve(result)}break}case dgnConst.CMD_WRITE_ITEMS:{result.names=cmd.data.names;this.evEmitter.emit("write",result);if(cmd){cmd.resolve(result)}break}case dgnConst.CMD_ADD_GROUP:{result.names=cmd.data.names;if(result.ids.length<cmd.data.names.length){this.rejectCmd(id,msg);return}this.evEmitter.emit("add",result);if(cmd){cmd.resolve(result)}break}case dgnConst.CMD_READ_GROUP:{this.evEmitter.emit("read",result);if(cmd){cmd.resolve(result)}break}case dgnConst.CMD_WRITE_GROUP:{this.evEmitter.emit("write",result);if(cmd){cmd.resolve(result)}break}case dgnConst.CMD_WHO_AMI:{this.evEmitter.emit("whoami",result);if(cmd){cmd.resolve(result)}break}default:{if(cmd){cmd.resolve(result)}}}this.removeCmd(id)}rejectCmd(id,msg){var cmd=this.getCmd(id);if(!cmd&&msg.header.id){log.debug("CMD "+msg.cmd+" id: "+msg.header.id+" does not exit!")}if(msg.cmd){switch(msg.cmd){default:{var err=new Error(dgnConst.getCmdName(msg.cmd)+" command failed."+" "+msg.header.err);if(cmd){cmd.reject({id:msg.header.id,err:err,errno:msg.header.errno,msg:msg})}this.evEmitter.emit("err",err)}}}else{if(cmd){cmd.reject({err:new Error(msg),msg:msg})}}this.removeCmd(id)}push(cmd){if(cmd instanceof Command){super.push(cmd)}else{log.debug("CommandList accepts only instances of Command")}}getCmd(id){for(let i=0;i<this.length;i++){if(id===this[i].header.id){return this[i]}}}removeCmd(id){var index=-1;for(let i=0;i<this.length;i++){if(id===this[i].header.id){index=i}}if(index>=0){this.splice(index,1)}}getMsgLength(){var msgLength=0;for(let i=0;i<this.length;i++){if(this[i].msg){msgLength+=this[i].msg.length}}return msgLength}clear(){for(var i=0,l=this.length;i<l;i++){clearTimeout(this[i].cmdTimer)}this.length=0}}module.exports=CommandList},{"../utils/Constants.js":127,"../utils/Logger.js":131,"./Command.js":159,events:16}]},{},[2])(2)});
//# sourceMappingURL=/hmi/rexhmi.min.js-2.50.10-12359.map